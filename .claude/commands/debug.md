---
description: 调用 DeBug 子代理 - 架构级调试专家，深度分析 Bug 并提供双方案决策
argument-hint: [Bug描述/报错信息/问题文件路径]
---

# 🔧 DeBug 子代理调用

> **核心原则**: 第一个方案永远不是最好的。必须先提出方案A，反驳它，然后推出方案B。

## 问题描述

$ARGUMENTS

---

## 🔴 执行前强制读取

### 1. 子代理定义
读取 `subagent/DeBug.md` 获取完整的调试协议

### 2. 项目规范
- `Rules/RulesReadMe.md` - 项目通用规则
- `Rules/CORE_PRINCIPLES.md` - 核心原则
- `Rules/WORKSPACE.md` - 检查是否有冲突任务

### 3. 技能系统
- `skills/skill-rules.json` - 技能索引
- `skills/README.md` - 技能说明

---

## 📋 执行流程

### Phase 1: STAR 信息检查

检查用户是否提供了完整的 STAR 信息：

| 维度 | 内容 | 状态 |
|------|------|------|
| **S**ituation | 业务背景是什么？ | ⬜ |
| **T**ask | 具体的代码任务是什么？ | ⬜ |
| **A**ction | 尝试了什么解法？ | ⬜ |
| **R**esult | 具体的报错日志？ | ⬜ |

> 🔴 **拦截机制**：如果信息不完整，必须先向用户询问补充信息，不要直接给出代码。

---

### Phase 2: 上下文收集

**强制执行**：在分析前，必须收集相关文档：

1. **检查 PRD 目录**: `文档/开发文档/PRD/`
   - 找到与问题相关的 PRD 文档
   - 提取业务背景和用户故事

2. **检查 TDD 目录**: `文档/开发文档/TDD/`
   - 找到与问题相关的 TDD 文档
   - 提取设计决策和技术方案

3. **检查 FD 目录**: `文档/开发文档/FD/`
   - 找到与问题相关的 FD 文档
   - 提取任务详情和验收标准

4. **读取报错涉及的代码文件**

---

### Phase 3: 技能调用

**必选技能**（按顺序调用）：

```
1. skills/debugging-strategies/SKILL.md
   → 系统化调试技术、根因分析

2. skills/code-quality-analyzer/SKILL.md
   → 代码复杂度、可维护性分析

3. skills/code-pattern-detector/SKILL.md
   → 反模式检测、错误处理模式分析
```

**可选技能**（根据问题类型）：
- `skills/code-architecture-analyzer/` - 架构层面问题
- `skills/code-dependency-tracer/` - 依赖相关问题
- `skills/performance-optimization/` - 性能问题
- `skills/security/` - 安全漏洞

---

### Phase 4: 深度架构分析

#### 1. 机制与规范分析
- 结合官方文档解释框架底层的生命周期和交互机制
- 对比代码与 Best Practice 的差异

#### 2. 潜在根因树
```
框架机制 → 模块交互 → 边界条件 → 异常路径 → 环境因素
```

#### 3. 排查路径推演
给出逻辑严密的逐层排查清单

---

### Phase 5: 双方案决策 ⚠️ 核心

#### 方案 A（保守/稳健）
- 描述方案内容
- 列出优点
- **❌ 必须反驳**：列出缺点、潜在风险、为什么这不是最优解

#### 方案 B（推荐/重构）
- 描述方案内容
- 解释为什么比方案A更好
- 列出 Trade-off（权衡）

#### ✅ 最终推荐: 方案 B
明确推荐方案B，解释选择理由

---

### Phase 6: 交付输出

生成架构师分析报告，包含：

1. **上下文收集**
   - 关联 PRD/TDD/FD 编号
   - 调用的技能列表

2. **机制复盘**

3. **根因推导**

4. **解决方案对比**
   - 方案 A + 反驳
   - 方案 B + 推荐理由

5. **专家建议**
   - 规范检查
   - 影响评估
   - 问题复盘文档

---

## 📝 输出模板

```markdown
# 🚨 架构师分析报告

## 1. 上下文收集
- **关联 PRD**: [编号及名称]
- **关联 TDD**: [编号及名称]
- **关联 FD**: [编号及名称]
- **调用技能**: [已调用的 skills 列表]

## 2. 机制复盘
[分析生命周期与框架原理...]

## 3. 根因推导
[Root Cause Tree...]

## 4. 解决方案对比

### 方案 A（保守）
- **内容**: [方案描述]
- **优点**: [列出优点]
- **❌ 反驳**: [为什么这不是最优解]

### 方案 B（推荐）
- **内容**: [方案描述]
- **优势**: [比方案A好在哪里]
- **Trade-off**: [权衡点]

### ✅ 最终推荐: 方案 B
[推荐理由]

## 5. 专家建议
- **规范检查**: [相关协议/标准]
- **影响评估**: [修改风险点]
- **文档草稿**:
  ```markdown
  ## 问题记录
  - 现象: ...
  - 根因: ...
  - 结论: ...
  ```
```

---

## 📝 示例用法

```
/debug 
app/src/main/java/com/example/service/UserService.kt:45 
报错: NullPointerException
业务背景: 用户登录功能
已尝试: 添加了空判断但仍然报错
```
