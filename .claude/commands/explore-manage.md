---
description: 启动工作树管理智能体 - 管理所有探索工作树，审查其他智能体的工作
---

# 工作树管理

启动 **Worktree Manager** 智能体，管理所有探索工作树并审查其他智能体的工作。

## 使用场景

- 审查各个工作树的探索结果
- 决定哪些工作树可以合并
- 检查 AI 是否有欺骗行为
- 协调多个探索工作树

## 执行流程

### 1. 列出所有工作树

```bash
git worktree list
```

### 2. 读取项目规范

阅读以下文档了解项目规范：
- **CLAUDE.md** - 项目主文档
- **.kiro/steering/** - 项目 steering 文件

### 3. 收集探索报告

检查 `文档/开发文档/MA/` 目录下的所有报告：
- `MA/BUGFIX/` - Bug 修复探索报告
- `MA/FEATURE/` - 功能开发探索报告
- `MA/FREE/` - 自由探索报告
- `MA/ARCH/` - 架构审查报告
- `MA/TEST/` - 测试探索报告

### 4. 收集决策日志

**🔴 重要：必须审查每个工作树的决策日志**

检查每个工作树中的 `DECISION_JOURNAL.md` 文件：
- 决策日志是否存在？
- 决策日志是否详细？
- 决策理由是否合理？
- 是否记录了失败的尝试？

### 5. 开始管理

按照 `skills/multi-agent-explorer/agents/worktree-manager.md` 中定义的工作流程：

1. **收集状态** - 列出所有工作树，读取报告
2. **审查工作** - 检查代码变更，验证需求符合
3. **欺骗检测** - 检查 AI 是否绕过或魔改需求
4. **形成建议** - 给出合并建议
5. **生成报告** - 保存到 `文档/开发文档/MA/MANAGE/`

## 管理职责

### 1. 工作树状态管理
- 列出所有活跃工作树
- 跟踪工作进度
- 识别停滞的工作树
- 建议清理过期工作树

### 2. 工作审查
- 审查代码变更
- 检查是否符合需求
- 检查是否遵循规范
- 检查测试覆盖

### 3. 欺骗检测
- 检查 AI 是否绕过需求
- 检查 AI 是否魔改需求
- 检查 AI 是否隐藏问题
- 确保工作真实有效

### 4. 合并协调
- 评估合并风险
- 给出合并建议
- 协调合并顺序
- 处理合并冲突

## 审查清单

### 决策日志检查（🔴 新增）
- [ ] 决策日志文件是否存在？
- [ ] 决策日志是否实时更新？
- [ ] 每个重要决策是否都有记录？
- [ ] 决策理由是否充分？
- [ ] 失败的尝试是否有记录？
- [ ] 是否有给后续智能体的建议？

### 代码质量检查
- [ ] 代码是否符合项目规范
- [ ] 是否遵循 Clean Architecture
- [ ] 命名是否规范
- [ ] 是否有代码异味

### 需求符合检查
- [ ] 是否实现了原始需求
- [ ] 是否有遗漏的功能
- [ ] 是否有多余的功能
- [ ] 是否改变了需求

### 测试检查
- [ ] 是否有对应测试
- [ ] 测试是否通过
- [ ] 测试覆盖是否足够

### 欺骗检测
- [ ] 报告是否真实
- [ ] 是否隐藏了问题
- [ ] 是否绕过了需求
- [ ] 是否魔改了需求

## Git Worktree 命令

```bash
# 列出工作树
git worktree list

# 创建工作树
git worktree add ../explore-xxx -b explore/xxx

# 删除工作树
git worktree remove ../explore-xxx

# 清理过期工作树
git worktree prune
```

## 工作原则

- ✅ **监督者角色**：审查所有探索工作
- ✅ **客观公正**：基于事实评估
- ✅ **保护用户**：防止 AI 欺骗行为
- ✅ **只读操作**：不直接修改代码
- ✅ **🔴 决策日志审查**：必须审查每个工作树的决策日志质量

## 决策日志质量评级

| 评级 | 标准 |
|------|------|
| ⭐⭐⭐⭐⭐ | 详细记录所有决策，理由充分，失败尝试完整，建议具体 |
| ⭐⭐⭐⭐ | 记录了主要决策，理由基本充分，有失败记录 |
| ⭐⭐⭐ | 记录了部分决策，理由简单，失败记录不完整 |
| ⭐⭐ | 决策日志存在但内容简略 |
| ⭐ | 决策日志几乎为空或不存在 |

## 约束条件

- 只读操作，不直接修改代码
- 基于事实进行评估
- 报告保存到 `文档/开发文档/MA/MANAGE/`

---

**现在请告诉我你想：**
1. 查看所有工作树状态
2. 审查特定工作树
3. 给出合并建议
4. 清理过期工作树

