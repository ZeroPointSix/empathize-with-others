---
description: 调用 SubText 子代理 - 代码洞察审计员，直接为代码文件添加高价值注释
argument-hint: [代码文件路径]
---

# 📝 SubText 子代理调用

> **核心原则**: 注释是代码不能表达的东西。直接修改源文件，不生成报告。

## 目标代码

$ARGUMENTS

---

## ⚡ 执行模式：直接写入

**重要**: 本命令直接修改源代码文件，不生成任何报告文档。

执行完成后：
1. ✅ 源文件已添加注释
2. ✅ 在聊天中简要说明添加了哪些注释
3. ❌ 不生成 markdown 报告
4. ❌ 不输出"输出模板"

---

## 🔴 执行前强制读取

### 1. 子代理定义
读取 `subagent/subtext.md` 获取完整的注释协议

### 2. 项目规范
- `Rules/RulesReadMe.md` - 项目通用规则
- `Rules/CORE_PRINCIPLES.md` - 核心原则

### 3. 技能系统
- `skills/skill-rules.json` - 技能索引
- `skills/documentation/SKILL.md` - 文档编写规范

---

## 📋 执行流程

### Phase 1: 上下文收集 (快速)

1. **检查 PRD 目录**: `文档/开发文档/PRD/` - 提取业务背景
2. **检查 TDD 目录**: `文档/开发文档/TDD/` - 提取设计决策
3. **检查 FD 目录**: `文档/开发文档/FD/` - 提取任务编号
4. **分析代码文件** - 理解依赖和数据流

---

### Phase 2: 代码分析

#### Why (意图与权衡)
- 硬编码 → 关联 PRD 业务阈值
- 判空处理 → 上游数据风险
- 数据结构选择 → 关联 TDD 设计决策

#### How (非直观的逻辑)
- 复杂算法思路
- 状态流转
- Hack 写法说明

---

### Phase 3: 直接写入注释 ⚠️ 核心

**直接使用文件编辑工具修改源代码文件**，添加以下注释：

#### 文件头注释 (如果缺失)
```go
// Package xxx 实现了 [功能描述]
//
// 业务背景:
//   - PRD: PRD-00001 [PRD名称]
//
// 设计决策:
//   - TDD: TDD-00001 [TDD名称]
//
// 任务追踪:
//   - FD: FD-00001/T001-T005
package xxx
```

#### 函数注释 (如果缺失或不完整)
```go
// FunctionName 实现了 [功能描述]
//
// 业务规则 (PRD-00001): [规则描述]
// 设计权衡 (TDD-00001): [权衡理由]
// 任务: FD-00001/T003
func FunctionName() {}
```

#### 关键逻辑注释 (复杂代码块)
```go
// [Strategy] 采用惰性删除策略
// 权衡 (TDD-00001): 牺牲读取性能，换取写入压力降低
// 业务规则 (PRD-00001/AC-002): 过期后24h内仍可展示
```

---

### 🚫 绝对禁止

1. **禁止复述语法** - ❌ `// 获取当前时间`
2. **禁止废话** - 自解释代码不加注释
3. **禁止脱离文档** - 必须关联 PRD/TDD/FD 编号
4. **禁止生成报告** - 直接写入文件

---

## ✅ 执行完成标准

执行完成后，在聊天中简要回复：

```
已为 [文件名] 添加注释：
- 文件头注释 (关联 PRD-xxx, TDD-xxx)
- [N] 个函数注释
- [M] 处关键逻辑注释
```

**不要输出任何 markdown 报告模板！**

---

## 📝 示例用法

```
/subtext kit/internal/service/pull_service.go
```

执行结果：直接修改 pull_service.go，添加高价值注释
