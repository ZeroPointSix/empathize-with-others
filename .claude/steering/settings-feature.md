# 设置功能文档编写规范

## 🔴 必读文档

**编写设置功能相关文档前，必须先阅读：**

1. **[PRD-00002-设置功能需求](../../文档/开发文档/PRD/PRD-00002-设置功能需求.md)** - 需求文档
2. **[Rules/开发文档规范.md](../../Rules/开发文档规范.md)** - 文档规范
3. **[Rules/WORKSPACE.md](../../Rules/WORKSPACE.md)** - 工作状态

---

## 文档编写职责

### Claude负责的文档类型

1. **PRD (Product Requirements Document)** ✅ 已完成
   - 文件: `PRD-00002-设置功能需求.md`
   - 位置: `文档/开发文档/PRD/`

2. **FD (Functional Document)** 🔜 待编写
   - 文件: `FD-00002-设置功能设计.md`
   - 位置: `文档/开发文档/FD/`
   - 内容: 详细的功能设计、交互流程、UI设计

3. **TDD (Technical Design Document)** 🔜 待编写
   - 文件: `TDD-00002-设置架构设计.md`
   - 位置: `文档/开发文档/TDD/`
   - 内容: 技术架构、数据模型、API设计

---

## MVP范围说明

### ✅ 包含的功能

1. **AI服务商配置** - 切换默认服务商
2. **隐私保护设置** - 数据掩码、本地优先模式
3. **悬浮窗设置** - 启用/禁用悬浮窗
4. **关于信息** - 版本号、应用简介

### ❌ 不包含的功能

- 主题设置
- 字体大小调节
- 通知设置（使用系统默认）
- 数据导入导出
- 多语言支持

---

## 文档编写要点

### PRD文档要点

**已完成的内容**：
- ✅ 需求概述和背景
- ✅ 用户故事
- ✅ 功能需求详细描述
- ✅ 非功能需求
- ✅ 待讨论问题
- ✅ 验收标准

**待用户确认的问题**：
1. 隐私设置持久化方案
2. 清除数据的范围
3. 关于信息的完整性

### FD文档要点（待编写）

**应包含的内容**：
1. **功能详细设计**
   - 每个功能的详细交互流程
   - UI布局和组件设计
   - 状态转换图

2. **用户界面设计**
   - 页面布局示意图
   - 组件层级结构
   - 交互动画说明

3. **业务流程**
   - 服务商切换流程
   - 权限申请流程
   - 设置保存流程

4. **异常处理**
   - 权限被拒绝的处理
   - 网络异常的处理
   - 数据保存失败的处理

### TDD文档要点（待编写）

**应包含的内容**：
1. **架构设计**
   - 类图和关系图
   - 数据流向图
   - 依赖注入配置

2. **数据模型**
   - SettingsUiState结构
   - SharedPreferences键值设计
   - 数据持久化方案

3. **API设计**
   - SettingsRepository接口
   - PrivacyPreferences接口
   - ViewModel方法签名

4. **技术选型**
   - SharedPreferences vs Room
   - 状态管理方案
   - 依赖注入方案

---

## 文档编写流程

### 1. 编写前准备

- [ ] 读取PRD文档，理解需求
- [ ] 读取WORKSPACE，检查是否有冲突
- [ ] 在WORKSPACE中记录任务开始

### 2. 编写FD文档

**步骤**：
1. 与用户讨论UI设计方案
2. 绘制交互流程图
3. 编写详细的功能说明
4. 添加异常处理说明
5. 请用户Review

**注意事项**：
- 所有UI设计必须符合Material Design 3规范
- 所有交互必须有明确的反馈
- 所有异常情况必须有处理方案

### 3. 编写TDD文档

**步骤**：
1. 设计类结构和关系
2. 定义数据模型
3. 设计API接口
4. 说明技术实现细节
5. 请用户Review

**注意事项**：
- 必须遵循Clean Architecture
- 必须使用MVVM模式
- 必须使用Hilt依赖注入

### 4. 完成后更新

- [ ] 更新WORKSPACE任务状态
- [ ] 添加文档版本记录
- [ ] 添加变更日志
- [ ] 通知Kiro可以开始编码

---

## 文档模板

### FD文档结构

```markdown
# FD-00002-设置功能设计

## 1. 功能概述
## 2. 用户界面设计
## 3. 交互流程设计
## 4. 业务规则
## 5. 异常处理
## 6. 性能要求
## 7. 验收标准
```

### TDD文档结构

```markdown
# TDD-00002-设置架构设计

## 1. 架构概述
## 2. 类设计
## 3. 数据模型
## 4. API设计
## 5. 依赖注入
## 6. 数据持久化
## 7. 测试策略
```

---

## 与其他AI的协作

### 与Kiro的协作

**Claude完成文档后**：
1. 在WORKSPACE中标记"文档已完成，等待编码"
2. 通知用户可以让Kiro开始编码
3. Kiro编码时如有疑问，Claude负责解答

**Kiro编码时**：
- Kiro必须严格按照FD和TDD文档实现
- 如发现文档问题，Kiro应在WORKSPACE中标记
- Claude负责更新文档

### 与Roo的协作

**Roo Review时**：
- Roo负责检查代码是否符合文档设计
- 如发现不一致，Roo应在WORKSPACE中标记
- Claude负责判断是代码问题还是文档问题

---

## 相关文档

- [PRD-00002-设置功能需求](../../文档/开发文档/PRD/PRD-00002-设置功能需求.md)
- [Rules/开发文档规范.md](../../Rules/开发文档规范.md)
- [Rules/WORKSPACE.md](../../Rules/WORKSPACE.md)
