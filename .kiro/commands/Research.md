---
description: 任务前置调研 - 收集任务所需的前置知识信息，生成RE调研文档
---

# 任务前置调研指令

本指令用于在开始任务前，系统性地收集和整理所需的前置知识信息，生成 RESEARCH 文档供后续任务参考。

**🎯 核心目标**：为任务执行提供完整的上下文知识基础

---

## 🔴 执行前必读

1. **Rules/RulesReadMe.md** - 项目通用规则
2. **Rules/开发文档规范.md** - 文档格式规范
3. **WORKSPACE.md** - 当前工作状态
4. **.kiro/steering/structure.md** - 项目架构规范
5. **.kiro/steering/tech.md** - 技术栈规范

---

## 📋 执行流程

### 第一步：确认调研范围

向用户确认以下信息：

1. **调研主题**（必填）- 任务名称或功能模块名称
2. **调研目的**（必填）- 为什么需要调研？调研结果将用于什么任务？
3. **关注重点**（可选）- 特别需要关注的技术点、需要解答的具体问题
4. **关联文档**（可选）- 已有的 PRD、FD、TDD、TD、BUG 文档编号

---

### 第二步：执行调研

#### 2.1 代码现状调研
- 相关文件清单（搜索相关代码文件）
- 代码结构分析（阅读核心文件，整理类/接口/方法清单）
- 依赖关系（分析 import 和注入，绘制依赖图）
- 数据流向（追踪调用链，绘制数据流图）
- 当前实现状态（检查 TODO/FIXME，评估完成度）


#### 2.2 架构合规性调研
- 层级划分（对照 structure.md 检查合规性）
- 命名规范（检查类名/方法名规范符合度）
- 依赖方向（检查 import 是否违规）
- DI 配置（检查 Module 文件，整理注入关系图）

#### 2.3 技术栈调研
- 使用的库（检查 build.gradle.kts）
- 版本信息（检查 libs.versions.toml）
- API 使用模式（分析代码调用）
- 最佳实践对照（对照官方文档）

#### 2.4 相关文档调研
- 需求文档（搜索 PRD 目录）
- 功能设计（搜索 FD 目录）
- 技术设计（搜索 TDD 目录）
- 任务清单（搜索 TD 目录）
- BUG 记录（搜索 BUG 目录）
- 历史调研（搜索 RE 目录）

#### 2.5 测试覆盖调研
- 单元测试（搜索 test 目录）
- 集成测试（搜索 androidTest 目录）
- 测试用例分析（阅读测试代码）

---

### 第三步：问题识别

| 问题类型 | 描述 | 优先级 |
|----------|------|--------|
| 🔴 阻塞问题 | 必须解决才能继续的问题 | P0 |
| 🟡 风险问题 | 可能影响任务进度的问题 | P1 |
| 🟢 优化建议 | 可以改进但不阻塞的问题 | P2 |
| ⚪ 待确认 | 需要与用户确认的问题 | - |

---

### 第四步：生成调研报告

将调研结果整理为 RESEARCH 文档，保存到 `文档/开发文档/RE/` 目录。

---

## 📝 调研报告模板

保存路径: `文档/开发文档/RE/RESEARCH-xxxxx-yyyy调研报告.md`


```markdown
# RESEARCH-xxxxx-yyyy调研报告

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档编号 | RESEARCH-xxxxx |
| 创建日期 | YYYY-MM-DD |
| 调研人 | [调研人] |
| 状态 | 调研完成 / 调研中 |
| 调研目的 | [为什么需要调研] |
| 关联任务 | [将用于什么任务] |

---

## 1. 调研范围

### 1.1 调研主题
[描述调研的主题和范围]

### 1.2 关注重点
- [重点1]
- [重点2]

### 1.3 关联文档

| 文档类型 | 文档编号 | 文档名称 |
|----------|----------|----------|
| PRD | PRD-xxxxx | [名称] |
| FD | FD-xxxxx | [名称] |

---

## 2. 代码现状分析

### 2.1 相关文件清单

| 文件路径 | 类型 | 行数 | 说明 |
|----------|------|------|------|
| `path/to/file.kt` | [类型] | xxx | [说明] |

### 2.2 核心类/接口分析

#### [类名]
- **文件位置**: `path/to/file.kt`
- **职责**: [描述类的职责]
- **关键方法**: [方法列表]
- **依赖关系**: [依赖的类] / [被依赖的类]

### 2.3 数据流分析
[起点] → [步骤1] → [步骤2] → [终点]

### 2.4 当前实现状态

| 功能点 | 状态 | 说明 |
|--------|------|------|
| [功能1] | ✅/⚠️/❌ | [说明] |
```


```markdown
---

## 3. 架构合规性分析

### 3.1 层级划分

| 文件 | 所属层级 | 合规性 | 说明 |
|------|----------|--------|------|
| file.kt | Domain/Data/Presentation | ✅/❌ | [说明] |

### 3.2 依赖方向检查

| 源文件 | 依赖目标 | 合规性 | 说明 |
|--------|----------|--------|------|
| domain/xxx.kt | data/yyy.kt | ❌ 违规 | Domain不应依赖Data |

---

## 4. 技术栈分析

### 4.1 使用的依赖

| 依赖 | 版本 | 用途 |
|------|------|------|
| [依赖名] | x.x.x | [用途] |

### 4.2 最佳实践对照

| 实践项 | 当前实现 | 推荐做法 | 差距 |
|--------|----------|----------|------|
| [实践项] | [当前] | [推荐] | [差距] |

---

## 5. 测试覆盖分析

| 源文件 | 测试文件 | 测试用例数 | 覆盖情况 |
|--------|----------|------------|----------|
| Xxx.kt | XxxTest.kt | x | ✅/⚠️/❌ |

---

## 6. 问题与风险

### 6.1 🔴 阻塞问题 (P0)
#### P0-001: [问题标题]
- **问题描述**: [详细描述]
- **影响范围**: [影响哪些功能/模块]
- **建议解决方案**: [解决方案]

### 6.2 🟡 风险问题 (P1)
#### P1-001: [问题标题]
- **问题描述**: [详细描述]
- **潜在影响**: [可能造成的影响]
- **建议措施**: [建议的应对措施]

### 6.3 🟢 优化建议 (P2)
#### P2-001: [建议标题]
- **当前状态**: [当前实现]
- **优化建议**: [建议的优化方向]
- **预期收益**: [优化后的收益]

### 6.4 ⚪ 待确认问题

| 编号 | 问题 | 需要确认的内容 |
|------|------|----------------|
| Q-001 | [问题] | [需要确认什么] |
```


```markdown
---

## 7. 关键发现总结

### 7.1 核心结论
1. [结论1]
2. [结论2]

### 7.2 技术要点

| 要点 | 说明 | 重要程度 |
|------|------|----------|
| [要点1] | [说明] | 高/中/低 |

### 7.3 注意事项
- ⚠️ [注意事项1]
- ⚠️ [注意事项2]

---

## 8. 后续任务建议

### 8.1 推荐的任务顺序
1. **[任务1]** - [原因]
2. **[任务2]** - [原因]

### 8.2 预估工作量

| 任务 | 预估时间 | 复杂度 | 依赖 |
|------|----------|--------|------|
| [任务1] | x小时 | 高/中/低 | [依赖] |

### 8.3 风险预警

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| [风险1] | 高/中/低 | 高/中/低 | [措施] |

---

## 9. 附录

### 9.1 参考资料
- [资料1](链接)

### 9.2 术语表

| 术语 | 解释 |
|------|------|
| [术语1] | [解释] |

---

**文档版本**: 1.0  
**最后更新**: YYYY-MM-DD
```

---

## ⚠️ 关键规则

1. **全面性**：调研要覆盖代码、架构、文档、测试等多个维度
2. **客观性**：如实记录发现，不做主观臆断
3. **可追溯**：每个结论都要有代码或文档依据
4. **问题导向**：重点识别可能影响任务的问题和风险
5. **实用性**：调研结果要能直接指导后续任务
6. **编号规则**：RESEARCH 文档编号需查询现有最大编号后递增


---

## 📝 示例用法

```
/Research 
调研主题：悬浮窗功能重构
调研目的：为 TD-00009 悬浮窗功能重构任务提供前置知识
关注重点：当前悬浮窗实现架构、已知问题、测试覆盖情况
关联文档：PRD-00009, FD-00009, TDD-00009
```

执行结果：生成 `RESEARCH-00002-悬浮窗功能重构调研报告.md`

---

## 🔄 调研深度级别

### Level 1: 快速调研（30分钟内）
- 适用于：简单 BUG 修复、小功能调整
- 调研内容：相关文件定位、核心代码阅读、直接相关的文档

### Level 2: 标准调研（1-2小时）
- 适用于：中等复杂度功能开发
- 调研内容：完整的代码现状分析、架构合规性检查、相关文档梳理、测试覆盖分析

### Level 3: 深度调研（半天以上）
- 适用于：复杂系统重构、新模块设计
- 调研内容：全面的代码分析、完整的架构评估、技术栈深度分析、性能和安全评估、详细的风险分析

---

## 📊 调研检查清单

在提交调研报告前，确认以下项目：

- [ ] 调研范围已与用户确认
- [ ] 相关文件已全部识别
- [ ] 核心代码已阅读理解
- [ ] 数据流已梳理清楚
- [ ] 架构合规性已检查
- [ ] 相关文档已查阅
- [ ] 测试覆盖已分析
- [ ] 问题和风险已识别
- [ ] 关键发现已总结
- [ ] 后续建议已给出
