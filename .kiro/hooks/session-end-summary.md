---
event: onSessionEnd
description: 会话结束时自动更新统计、审查文档、提醒后续操作
---

# 会话结束自动总结 Hook

当 AI 会话结束时，自动执行以下操作：

## 执行动作

### 1. 检测本次会话创建/修改的文档

扫描本次会话中创建或修改的文档文件：
- `文档/开发文档/PRD/*.md`
- `文档/开发文档/FD/*.md`
- `文档/开发文档/TDD/*.md`
- `文档/开发文档/TD/*.md`
- `文档/开发文档/IMPL/*.md`
- `文档/开发文档/BUG/*.md`

### 2. 自动文档审查提醒

如果本次会话创建了新文档，提醒用户：
```
📄 本次会话创建/修改了以下文档:
   - PRD-00012-事实流内容编辑功能需求.md (新建)
   - TDD-00012-事实流内容编辑功能技术设计.md (修改)

💡 建议执行文档审查:
   scripts\dev.bat doc PRD-00012
   
   或者告诉我: "请审查 PRD-00012 相关的所有文档"
```

### 3. 更新代码统计

运行代码统计脚本，更新以下数据：
- 总代码行数
- 源代码行数
- 测试代码行数
- 文件数量

### 4. 检查未完成任务

扫描本次会话中提到的任务，检查完成状态。

### 5. 更新 WORKSPACE.md

自动更新以下章节：
- 代码统计数据
- 最近完成任务（如果有）
- 变更日志（添加本次会话的主要变更）

### 6. Git 状态检查

检查是否有未提交的更改，提醒用户。

## 输出格式

```
========================================
📊 会话总结
========================================

📁 文件变更:
   - 修改文件: X 个
   - 新增文件: X 个
   - 代码变更: +XXX / -XXX 行

📄 文档变更:
   - PRD-00012 (新建)
   - TDD-00012 (修改)

🧪 测试状态: ✅ 通过 / ⚠️ 未运行 / ❌ 失败

💾 建议操作:
   [ ] 审查新文档: scripts\dev.bat doc PRD-00012
   [ ] 运行测试: scripts\dev.bat test
   [ ] 提交代码: git add . && git commit -m "xxx"

========================================
```

## 自动触发审查（可选）

如果配置了自动审查，会话结束时会：
1. 自动运行 `scripts\auto-doc-pipeline.ps1` 对新文档进行审查
2. 生成审查提示保存到 `.kiro/temp/doc-review-prompt.txt`
3. 在下次会话开始时提醒用户查看审查结果

## 配置选项

```yaml
# 可在 .kiro/settings/hooks.yaml 中配置
session-end-summary:
  enabled: true
  auto-doc-review: true    # 自动审查新文档
  update-workspace: true   # 更新 WORKSPACE.md
  git-status-check: true   # 检查 Git 状态
```
