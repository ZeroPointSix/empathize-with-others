# 灵活 AI 配置功能 - 手动测试指南

## 测试目标

验证 AI 配置功能的核心流程是否正常工作，包括：
- 添加服务商
- 编辑服务商
- 删除服务商
- 设置默认服务商
- 连接测试

## 测试前准备

### 1. 构建并安装应用

```bash
# 构建调试版本
./gradlew assembleDebug

# 安装到设备
./gradlew installDebug
```

### 2. 准备测试数据

准备以下测试用的 API Key（可以使用测试密钥）：
- OpenAI API Key: `sk-test-openai-123456`
- DeepSeek API Key: `sk-test-deepseek-123456`

## 测试用例

### 测试用例 1：添加第一个服务商

**目标**：验证添加服务商的基本流程

**步骤**：
1. 启动应用
2. 进入"联系人"页面
3. 点击右上角"设置"图标
4. 在设置页面，找到"AI 服务商"区域
5. 点击"管理 AI 服务商"按钮
6. 应该看到空状态视图，显示"还没有配置 AI 服务商"
7. 点击右下角的"+"按钮
8. 填写表单：
   - 服务商名称：`OpenAI`
   - API 端点：`https://api.openai.com/v1`
   - API Key：`sk-test-openai-123456`
9. 点击"添加模型"按钮
10. 填写模型信息：
    - 模型 ID：`gpt-4`
    - 显示名称：`GPT-4`
11. 点击"添加"
12. 再添加一个模型：
    - 模型 ID：`gpt-3.5-turbo`
    - 显示名称：`GPT-3.5 Turbo`
13. 确认 `gpt-4` 被设置为默认模型
14. 点击"保存"按钮

**预期结果**：
- ✅ 表单验证正常（空字段会显示错误提示）
- ✅ 模型列表正确显示
- ✅ 保存成功后对话框关闭
- ✅ 服务商列表显示新添加的 OpenAI 服务商
- ✅ OpenAI 卡片显示"默认"标签

### 测试用例 2：添加第二个服务商

**目标**：验证添加多个服务商的功能

**步骤**：
1. 在 AI 配置页面，点击"+"按钮
2. 填写表单：
   - 服务商名称：`DeepSeek`
   - API 端点：`https://api.deepseek.com/v1`
   - API Key：`sk-test-deepseek-123456`
3. 添加模型：
   - 模型 ID：`deepseek-chat`
   - 显示名称：`DeepSeek Chat`
4. 点击"保存"

**预期结果**：
- ✅ 保存成功
- ✅ 服务商列表显示两个服务商
- ✅ OpenAI 仍然显示"默认"标签
- ✅ DeepSeek 不显示"默认"标签

### 测试用例 3：编辑服务商

**目标**：验证编辑服务商的功能

**步骤**：
1. 点击 OpenAI 服务商卡片
2. 应该看到编辑对话框，标题为"编辑服务商"
3. 修改服务商名称为：`OpenAI (测试)`
4. 添加一个新模型：
   - 模型 ID：`gpt-4-turbo`
   - 显示名称：`GPT-4 Turbo`
5. 点击"保存"

**预期结果**：
- ✅ 对话框显示现有数据
- ✅ 可以修改所有字段
- ✅ 保存成功后，卡片显示更新后的名称
- ✅ 模型数量显示为 3 个

### 测试用例 4：设置默认服务商

**目标**：验证切换默认服务商的功能

**步骤**：
1. 在 DeepSeek 服务商卡片上，点击"星形"图标（设为默认）
2. 观察变化

**预期结果**：
- ✅ DeepSeek 卡片显示"默认"标签
- ✅ DeepSeek 卡片背景色变为主色调容器色
- ✅ OpenAI 卡片不再显示"默认"标签
- ✅ OpenAI 卡片背景色恢复为普通色

### 测试用例 5：删除服务商

**目标**：验证删除服务商的功能

**步骤**：
1. 在 OpenAI 服务商卡片上，点击"删除"图标
2. 应该看到确认对话框
3. 点击"取消"
4. 确认对话框关闭，服务商未被删除
5. 再次点击"删除"图标
6. 这次点击"删除"按钮

**预期结果**：
- ✅ 显示确认对话框，防止误删除
- ✅ 点击"取消"不会删除
- ✅ 点击"删除"后，OpenAI 服务商从列表中移除
- ✅ 只剩下 DeepSeek 服务商

### 测试用例 6：表单验证

**目标**：验证表单验证逻辑

**步骤**：
1. 点击"+"按钮添加新服务商
2. 不填写任何字段，直接点击"保存"
3. 观察错误提示
4. 填写服务商名称：`Test`
5. 填写 API 端点：`invalid-url`（无效 URL）
6. 点击"保存"
7. 观察错误提示
8. 修改 API 端点为：`https://api.test.com/v1`
9. 填写 API Key：`sk-123`（少于 8 个字符）
10. 点击"保存"
11. 观察错误提示
12. 修改 API Key 为：`sk-test-123456`
13. 不添加任何模型，点击"保存"
14. 观察错误提示

**预期结果**：
- ✅ 空字段显示"请输入..."错误提示
- ✅ 无效 URL 显示"URL 必须以 http:// 或 https:// 开头"
- ✅ 短 API Key 显示"API Key 长度不能少于 8 个字符"
- ✅ 无模型显示"请至少添加一个模型"
- ✅ 所有验证错误都实时显示

### 测试用例 7：模型列表管理

**目标**：验证模型列表的添加、删除、设置默认功能

**步骤**：
1. 添加一个新服务商（名称：`Test Provider`）
2. 添加第一个模型：`model-1`
3. 确认它自动被设置为默认模型
4. 添加第二个模型：`model-2`
5. 点击 `model-2` 的"设为默认"按钮
6. 确认 `model-2` 现在显示"默认"标签
7. 尝试删除 `model-2`（当前默认模型）
8. 确认删除后，`model-1` 自动成为默认模型
9. 添加 `model-3`
10. 删除所有模型
11. 尝试保存

**预期结果**：
- ✅ 第一个模型自动设为默认
- ✅ 可以切换默认模型
- ✅ 删除默认模型后，自动选择第一个模型为默认
- ✅ 删除所有模型后，保存时显示错误提示

### 测试用例 8：API Key 可见性切换

**目标**：验证 API Key 显示/隐藏功能

**步骤**：
1. 添加新服务商
2. 在 API Key 输入框中输入：`sk-test-123456`
3. 确认默认显示为密码（圆点）
4. 点击"眼睛"图标
5. 确认 API Key 显示为明文
6. 再次点击"眼睛"图标
7. 确认 API Key 恢复为密码显示

**预期结果**：
- ✅ 默认隐藏 API Key
- ✅ 点击图标可以切换显示/隐藏
- ✅ 图标在显示/隐藏状态下有不同的样式

### 测试用例 9：空状态和错误状态

**目标**：验证各种状态的 UI 显示

**步骤**：
1. 删除所有服务商
2. 确认显示空状态视图
3. 添加一个服务商
4. 返回设置页面
5. 确认"当前服务商"显示正确的名称

**预期结果**：
- ✅ 空状态显示友好的提示信息
- ✅ 空状态有"添加"按钮引导
- ✅ 设置页面正确显示当前服务商

### 测试用例 10：数据持久化

**目标**：验证数据是否正确保存

**步骤**：
1. 添加 2-3 个服务商
2. 设置其中一个为默认
3. 完全关闭应用（从最近任务中移除）
4. 重新启动应用
5. 进入 AI 配置页面

**预期结果**：
- ✅ 所有服务商都正确显示
- ✅ 默认服务商标记正确
- ✅ 所有模型信息完整
- ✅ API Key 已加密存储（无法直接查看）

## 测试检查清单

完成以上测试后，请确认以下功能点：

- [ ] 添加服务商功能正常
- [ ] 编辑服务商功能正常
- [ ] 删除服务商功能正常（有确认对话框）
- [ ] 设置默认服务商功能正常
- [ ] 表单验证正确（所有必填字段）
- [ ] 模型列表管理正常（添加、删除、设置默认）
- [ ] API Key 显示/隐藏切换正常
- [ ] 空状态显示正常
- [ ] 数据持久化正常
- [ ] 导航流程正常（设置 -> AI 配置 -> 返回）
- [ ] 所有 UI 组件显示正常
- [ ] 没有崩溃或异常

## 已知限制

以下功能在当前版本中尚未实现：

1. **连接测试功能**：虽然 UI 有"测试连接"按钮，但实际的连接测试逻辑需要在后续阶段完善
2. **配置模板**：预设的 OpenAI、DeepSeek 模板功能将在后续版本添加
3. **配置导入导出**：配置的备份和恢复功能将在后续版本添加

## 问题报告

如果在测试过程中发现问题，请记录以下信息：

1. **问题描述**：简要描述问题
2. **复现步骤**：详细的操作步骤
3. **预期结果**：应该发生什么
4. **实际结果**：实际发生了什么
5. **截图**：如果可能，提供截图
6. **日志**：使用 `adb logcat` 查看相关日志

## 测试完成

完成所有测试后，请在任务列表中标记任务 4.2 为完成，并继续进行任务 5（Checkpoint）。
