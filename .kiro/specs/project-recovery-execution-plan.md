# 项目恢复执行计划

**创建时间**：2025-12-12  
**状态**：待执行  
**预估时间**：1-5 天（取决于测试结果）

## 执行策略选择

请选择以下策略之一：

### 🎯 策略 A：测试驱动修复（推荐）

**执行步骤**：

#### 阶段 1：运行测试并收集结果（30 分钟）
- [ ] 运行单元测试：`./gradlew test`
- [ ] 运行仪器测试：`./gradlew connectedAndroidTest`
- [ ] 生成测试报告
- [ ] 统计通过率和失败原因

#### 阶段 2：分析测试失败（1-2 小时）
- [ ] 分类失败测试（编译错误、逻辑错误、环境问题）
- [ ] 识别关键失败（影响核心功能的测试）
- [ ] 识别次要失败（边缘情况或可选功能）
- [ ] 制定修复优先级

#### 阶段 3：修复关键问题（1-3 天）
- [ ] 修复编译错误
- [ ] 修复核心功能测试
- [ ] 验证修复效果
- [ ] 重新运行测试

#### 阶段 4：修复次要问题（1-2 天）
- [ ] 修复边缘情况测试
- [ ] 优化代码质量
- [ ] 更新文档

### 🚀 策略 B：功能验证优先（快速）

**执行步骤**：

#### 阶段 1：编译和运行（15 分钟）
- [ ] 清理构建：`./gradlew clean`
- [ ] 编译项目：`./gradlew assembleDebug`
- [ ] 安装到设备：`./gradlew installDebug`
- [ ] 启动应用

#### 阶段 2：功能验证（1-2 小时）
- [ ] **AI 分析功能**
  - [ ] 打开聊天分析页面
  - [ ] 输入测试对话
  - [ ] 验证 AI 响应解析
  - [ ] 检查结果显示
  
- [ ] **AI 配置功能**
  - [ ] 打开设置页面
  - [ ] 点击"AI 配置"
  - [ ] 尝试添加新服务商
  - [ ] 验证 API Key 加密存储
  - [ ] 测试连接功能
  
- [ ] **悬浮窗功能**
  - [ ] 启用悬浮窗权限
  - [ ] 启动悬浮窗服务
  - [ ] 测试最小化功能
  - [ ] 验证通知功能
  
- [ ] **联系人功能**
  - [ ] 打开联系人列表
  - [ ] 测试搜索功能
  - [ ] 测试标签添加
  - [ ] 验证数据持久化

#### 阶段 3：问题记录和修复（1-3 天）
- [ ] 记录所有不工作的功能
- [ ] 按优先级排序
- [ ] 逐个修复问题
- [ ] 重新验证

### 🔧 策略 C：全面重建（保守）

**执行步骤**：

#### 阶段 1：清理和重建（30 分钟）
- [ ] 清理所有构建产物：`./gradlew clean`
- [ ] 删除 `.gradle` 缓存
- [ ] 删除 `build` 目录
- [ ] 同步 Gradle：`./gradlew --refresh-dependencies`
- [ ] 重新构建：`./gradlew build`

#### 阶段 2：验证数据库迁移（1 小时）
- [ ] 检查 `AppDatabase.kt` 版本号
- [ ] 验证所有 Entity 定义
- [ ] 检查迁移脚本完整性
- [ ] 测试数据库升级

#### 阶段 3：验证依赖注入（1 小时）
- [ ] 检查所有 Hilt 模块
- [ ] 验证 Repository 绑定
- [ ] 验证 UseCase 注入
- [ ] 验证 ViewModel 注入

#### 阶段 4：运行完整测试（2-3 小时）
- [ ] 运行所有单元测试
- [ ] 运行所有仪器测试
- [ ] 运行性能测试
- [ ] 生成覆盖率报告

#### 阶段 5：功能验证（2-3 小时）
- [ ] 执行完整的手动测试清单
- [ ] 验证所有用户流程
- [ ] 记录任何问题
- [ ] 修复并重新验证

## 推荐执行顺序

### 第一步：快速诊断（选择策略 B）

**目的**：快速了解应用的实际状态

**执行**：
1. 编译并运行应用
2. 快速测试主要功能
3. 记录明显的问题

**预期时间**：1-2 小时

### 第二步：深入分析（选择策略 A）

**目的**：通过测试精确定位问题

**执行**：
1. 运行测试套件
2. 分析失败原因
3. 制定修复计划

**预期时间**：2-4 小时

### 第三步：针对性修复

**目的**：修复发现的问题

**执行**：
1. 按优先级修复问题
2. 每次修复后运行相关测试
3. 验证修复效果

**预期时间**：1-3 天

### 第四步：全面验证（可选：策略 C）

**目的**：确保系统稳定

**执行**：
1. 清理重建
2. 运行完整测试
3. 手动验证所有功能

**预期时间**：1 天

## 具体修复任务模板

### 任务：修复 [功能名称]

**问题描述**：
- 现象：
- 错误信息：
- 影响范围：

**诊断结果**：
- 根本原因：
- 相关文件：
- 依赖关系：

**修复方案**：
1. 步骤 1
2. 步骤 2
3. 步骤 3

**验证方法**：
- [ ] 单元测试通过
- [ ] 功能测试通过
- [ ] 回归测试通过

**完成标准**：
- [ ] 代码修复完成
- [ ] 测试全部通过
- [ ] 文档已更新

## 风险控制

### 备份策略

在开始修复前：
1. 创建当前代码的 Git 分支：`git checkout -b recovery-backup`
2. 提交当前状态：`git commit -am "Backup before recovery"`
3. 创建新的工作分支：`git checkout -b recovery-work`

### 回滚计划

如果修复出现问题：
1. 切换回备份分支：`git checkout recovery-backup`
2. 重新评估策略
3. 寻求额外帮助

### 进度跟踪

创建进度跟踪文档：
- 每日记录修复进展
- 记录遇到的问题和解决方案
- 更新预估完成时间

## 成功标准

### 最小可接受标准（MVP）

- [ ] 应用可以编译和运行
- [ ] 核心功能可用（AI 分析、AI 配置）
- [ ] 无严重崩溃
- [ ] 关键测试通过率 > 80%

### 理想标准

- [ ] 所有功能正常工作
- [ ] 测试通过率 > 95%
- [ ] 无已知严重 Bug
- [ ] 文档完整更新

### 完美标准

- [ ] 所有测试 100% 通过
- [ ] 代码质量优秀
- [ ] 性能指标达标
- [ ] 文档完善详细

## 下一步

**请告诉我**：
1. 你想采用哪种策略？（A、B 或 C）
2. 你的优先级是什么？（快速恢复 vs 彻底修复）
3. 你有多少时间可以投入？（1 天、3 天还是 1 周）

**我会根据你的选择**：
1. 提供详细的执行步骤
2. 帮助你运行测试和诊断
3. 协助修复发现的问题
4. 验证修复效果

---

**准备好了吗？让我们开始恢复你的项目！** 🚀
