# 共情 AI 助手 项目宪法

<!--
同步影响报告:
- 版本更改: 1.0.0 → 1.1.0 (添加AI工具协作原则和更新项目状态)
- 修改的原则列表: 
  - 测试驱动原则 (更新测试覆盖率要求)
  - 文档规范原则 (更新文档路径和分类)
- 添加的章节:
  - AI工具协作原则
  - 项目状态管理
- 删除的章节: 无
- 需要更新的模板:
  - ✅ plan-template.md (已检查，无需更新)
  - ✅ spec-template.md (已检查，无需更新)
  - ✅ tasks-template.md (已检查，无需更新)
- 后续 TODO: 无
-->

## 核心原则

### I. 架构优先

**Clean Architecture + MVVM** 是本项目的核心架构模式。

- 领域层必须是纯 Kotlin，无 Android 依赖
- 数据层实现领域层定义的接口
- 表现层使用 Jetpack Compose + ViewModel
- 依赖注入使用 Hilt
- 严格遵循依赖方向：外层依赖内层，内层不依赖外层

### II. 隐私优先

**零后端架构，所有数据本地存储。**

- 敏感数据使用 EncryptedSharedPreferences
- AI 处理前强制掩码敏感信息
- 用户自带 API 密钥 (BYOK)
- 数据传输必须使用 HTTPS
- 本地数据库必须加密

### III. 中文文档

**所有文档和回答必须使用中文。**

- 代码注释、变量名、类名保持英文
- 说明文档、开发指南使用中文
- 与开发者的沟通使用中文
- 错误信息和日志输出使用中文

### IV. 文档规范

**开发过程文档和项目长期文档分类管理。**

开发过程文档 (PRD, FD, TDD, TP, CR, BUG, IMPL等):
- 存放路径: `文档/开发文档/[类型]/`
- 命名规则: `[类型]-xxxxx-功能描述`
- 必须遵循 `Rules/开发文档规范` 中的格式要求

项目长期文档 (SD, AD, API, UM等):
- 存放路径: `文档/长期文档/[类型]/` (如存在)
- 命名规则: `[类型]-xxxxx-主题描述`
- 必须遵循 `Rules/项目文档规范` 中的格式要求

### V. 测试驱动

**高测试覆盖率是项目质量的保证。**

- 单元测试: JUnit 4.13.2 + MockK 1.13.13
- 协程测试: kotlinx-coroutines-test
- UI 测试: Compose UI Test
- 集成测试: AndroidX Test + Espresso 3.6.1
- 测试覆盖率必须保持在 95% 以上
- 所有新功能必须包含对应的测试用例

### VI. 简洁原则

**保持简单，避免过度设计。**

- 只实现当前需要的功能
- 避免不必要的抽象层
- 代码清晰优于代码简短
- 遵循 KISS、DRY、YAGNI 原则

### VII. AI工具协作

**多AI工具协作开发，职责明确。**

- **Claude (设计文档)**: 负责架构设计、文档编写、代码规范制定
- **Kiro (代码实现)**: 负责核心功能开发、Bug修复、性能优化
- **Roo (代码审查)**: 负责代码审查、测试验证、质量把控
- 所有AI工具必须在开始工作前阅读 `Rules/RulesReadMe.md` 和 `WORKSPACE.md`
- 任务完成后必须更新 `WORKSPACE.md` 的状态

## 技术约束

### 构建系统

- Gradle 8.13 + Kotlin DSL
- AGP 8.7.3
- Kotlin 2.0.21
- JDK 17
- Compose BOM 2024.12.01
- Hilt 2.52

### 目标平台

- Min SDK: 24 (Android 7.0)
- Target SDK: 35 (Android 15)

### 依赖管理

- 使用 Gradle 版本目录 (`gradle/libs.versions.toml`)
- 始终使用目录引用: `libs.androidx.core.ktx`
- 避免直接使用版本号，统一在版本目录管理

### 性能约束

- 应用启动时间 < 2秒
- UI响应时间 < 100ms
- 内存占用 < 150MB
- 数据库操作 < 50ms

## 开发流程

### 需求阶段

1. 阅读 `Rules/RulesReadMe.md` 和 `WORKSPACE.md`
2. 与用户讨论需求细节，确保需求明确
3. 编写 PRD 文档，必须包含用户故事和验收标准
4. PRD文档必须经过用户确认后才能进入下一阶段

### 设计阶段

1. 编写 TDD 技术设计文档
2. 确认架构符合 Clean Architecture
3. 定义接口和数据模型
4. 进行架构检查，确保无违规调用

### 实现阶段

1. 编写 FD 功能文档（任务列表）
2. 按优先级实现用户故事（P1 → P2 → P3）
3. 每个故事独立可测试、可演示
4. 实现过程中必须编写对应的测试用例

### 验收阶段

1. 运行测试确保通过
2. 更新相关文档
3. 代码审查（Roo负责）
4. 更新 `WORKSPACE.md` 状态

## 项目状态管理

### 完成度评估

- 项目整体完成度：90%
- 基础架构：100%完成
- 核心功能：90%完成
- UI界面：90%完成
- 测试覆盖：99.1%

### 里程碑管理

- Phase 1-4 基础设施：✅ 完成
- 联系人画像记忆系统：✅ 完成
- 提示词管理系统：✅ 完成
- 悬浮窗功能重构：✅ 完成
- 发布准备：🔄 进行中

### 技术债务管理

- 所有技术债务必须在 `WORKSPACE.md` 中记录
- 高优先级技术债务必须在下个版本发布前解决
- 数据库迁移必须经过完整测试

## 治理

### 宪法优先级

- 本宪法优先于所有其他实践
- 修改需要文档记录和批准
- 使用 `Rules/RulesReadMe.md` 进行运行时开发指导

### 版本管理

- 宪法版本遵循语义版本规则
- MAJOR: 向后不兼容的治理/原则删除或重新定义
- MINOR: 添加新原则/章节或实质性扩展指导
- PATCH: 澄清、措辞、拼写修复、非语义改进

### 合规审查

- 每个功能开发完成后必须进行合规审查
- 审查内容包括：架构合规性、测试覆盖率、文档完整性
- 审查通过后才能合并到主分支

---

**版本**: 1.1.0 | **批准日期**: 2025-06-13 | **最后修改**: 2025-12-21