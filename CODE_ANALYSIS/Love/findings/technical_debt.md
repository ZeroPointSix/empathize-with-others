# æŠ€æœ¯å€ºåŠ¡æ¸…å•

> **åˆ†ææ—¥æœŸ**: 2025-12-29
> **åˆ†ææ–¹æ³•**: ä»£ç æ‰«æ + TODO/FIXMEç»Ÿè®¡ + Deprecatedæ ‡è®°åˆ†æ

---

## ä¸€ã€æŠ€æœ¯å€ºåŠ¡æ€»è§ˆ

### 1.1 å€ºåŠ¡ç»Ÿè®¡

| å€ºåŠ¡ç±»å‹ | æ•°é‡ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ |
|---------|------|--------|--------|
| **ä»£ç ä¸­TODO/FIXME** | 18ä¸ª | ä¸­ | 3-5å¤© |
| **@Deprecatedæ ‡è®°** | 34ä¸ª | ä½ | æŒ‰è®¡åˆ’æ›¿æ¢ |
| **.bakå¤‡ä»½æ–‡ä»¶** | 20ä¸ª | ä½ | 1å°æ—¶ |
| **æµ‹è¯•æ–‡ä»¶ä½ç½®** | çº¦100ä¸ªæ–‡ä»¶ | ä¸­ | 1-2å¤© |
| **appæ¨¡å—åŒ…ç»“æ„** | 5ä¸ªæ–‡ä»¶ | ä½ | åŠå¤© |

### 1.2 å€ºåŠ¡ä¼˜å…ˆçº§

- ğŸ”´ **é«˜ä¼˜å…ˆçº§**ï¼šæ— 
- ğŸŸ¡ **ä¸­ä¼˜å…ˆçº§**ï¼šæµ‹è¯•æ–‡ä»¶ä½ç½®ä¼˜åŒ–ã€å®ç°TODOåŠŸèƒ½
- ğŸŸ¢ **ä½ä¼˜å…ˆçº§**ï¼šæ¸…ç†å¤‡ä»½æ–‡ä»¶ã€åŒ…ç»“æ„ä¼˜åŒ–ã€æ›¿æ¢Deprecated API

---

## äºŒã€ä¸­ä¼˜å…ˆçº§å€ºåŠ¡

### 2.1 æµ‹è¯•æ–‡ä»¶ä½ç½®ä¼˜åŒ–

#### é—®é¢˜æè¿°

appæ¨¡å—åŒ…å«çº¦100ä¸ªåº”å±äºå…¶ä»–æ¨¡å—çš„æµ‹è¯•æ–‡ä»¶ã€‚

#### å½“å‰ç»“æ„

```
app/src/test/java/com/empathy/ai/
â”œâ”€â”€ data/          (åº”ç§»è‡³data/src/test/)
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ AiRepositoryImplTest.kt
â”‚   â”‚   â”œâ”€â”€ ContactRepositoryImplTest.kt
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ parser/
â”‚       â””â”€â”€ JsonParserTest.kt
â”œâ”€â”€ domain/        (åº”ç§»è‡³domain/src/test/)
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ PrivacyEngineTest.kt
â”‚   â”‚   â””â”€â”€ PromptBuilderTest.kt
â”‚   â””â”€â”€ usecase/
â”‚       â””â”€â”€ AnalyzeChatUseCaseTest.kt
â”œâ”€â”€ presentation/  (åº”ç§»è‡³presentation/src/test/)
â”‚   â””â”€â”€ viewmodel/
â”‚       â”œâ”€â”€ ContactListViewModelTest.kt
â”‚       â””â”€â”€ ChatViewModelTest.kt
â””â”€â”€ integration/   (ä¿ç•™åœ¨app)
    â””â”€â”€ IntegrationTest.kt
```

#### å»ºè®®ç»“æ„

```
data/src/test/java/com/empathy/ai/data/
â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ AiRepositoryImplTest.kt
â”‚   â””â”€â”€ ContactRepositoryImplTest.kt
â””â”€â”€ parser/
    â””â”€â”€ JsonParserTest.kt

domain/src/test/java/com/empathy/ai/domain/
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ PrivacyEngineTest.kt
â”‚   â””â”€â”€ PromptBuilderTest.kt
â””â”€â”€ usecase/
    â””â”€â”€ AnalyzeChatUseCaseTest.kt

presentation/src/test/java/com/empathy/ai/presentation/
â””â”€â”€ viewmodel/
    â”œâ”€â”€ ContactListViewModelTest.kt
    â””â”€â”€ ChatViewModelTest.kt

app/src/androidTest/java/com/empathy/ai/
â””â”€â”€ integration/  # é›†æˆæµ‹è¯•ä¿ç•™
    â””â”€â”€ IntegrationTest.kt
```

#### å½±å“åˆ†æ

**è´Ÿé¢å½±å“**ï¼š
- æ¨¡å—è¾¹ç•Œä¸å¤Ÿæ¸…æ™°
- å½±å“å¤šæ¨¡å—ç¼–è¯‘é€Ÿåº¦
- è¿åæ¨¡å—ç‹¬ç«‹åŸåˆ™

**ä¼˜åŒ–æ”¶ç›Š**ï¼š
- æ¨¡å—èŒè´£æ›´æ¸…æ™°
- ç¼–è¯‘é€Ÿåº¦æå‡
- ç¬¦åˆClean ArchitectureåŸåˆ™

#### å®æ–½è®¡åˆ’

1. **åˆ›å»ºå¯¹åº”æ¨¡å—çš„testç›®å½•**
2. **è¿ç§»æµ‹è¯•æ–‡ä»¶**
3. **æ›´æ–°packageå£°æ˜**
4. **è¿è¡Œæµ‹è¯•éªŒè¯**
5. **æ¸…ç†app/src/test/ç›®å½•**

**å·¥ä½œé‡ä¼°ç®—**ï¼š1-2å¤©

---

### 2.2 å®ç°TODOåŠŸèƒ½

#### å‘ç°çš„TODOæ ‡è®°

**Presentationå±‚**ï¼ˆ18ä¸ªTODOï¼‰ï¼š

1. **AIé…ç½®é¡µé¢**ï¼š
   - æ¸©åº¦è®¾ç½®æ»‘å—
   - Tokenæ•°è®¾ç½®è¾“å…¥æ¡†
   - ç½‘ç»œä»£ç†é…ç½®

2. **è”ç³»äººè¯¦æƒ…é¡µ**ï¼š
   - createdAtå­—æ®µæ˜¾ç¤º
   - æœ€åäº’åŠ¨æ—¶é—´æ ¼å¼åŒ–

3. **æç¤ºè¯ç¼–è¾‘å™¨**ï¼š
   - AIä¼˜åŒ–åŠŸèƒ½
   - æ¨¡æ¿ç®¡ç†
   - ç‰ˆæœ¬å†å²

#### è¯¦ç»†æ¸…å•

##### AiConfigScreen.kt

```kotlin
// TODO: æ·»åŠ æ¸©åº¦è®¾ç½®æ»‘å—
@Composable
fun TemperatureSlider() {
    // æœªå®ç°
}

// TODO: æ·»åŠ Tokenæ•°è®¾ç½®è¾“å…¥æ¡†
@Composable
fun TokenCountInput() {
    // æœªå®ç°
}

// TODO: æ·»åŠ ç½‘ç»œä»£ç†é…ç½®
@Composable
fun ProxyConfig() {
    // æœªå®ç°
}
```

##### ContactDetailScreen.kt

```kotlin
// TODO: æ˜¾ç¤ºcreatedAtå­—æ®µ
@Composable
fun CreatedAtDisplay() {
    // æœªå®ç°
}
```

##### PromptEditorScreen.kt

```kotlin
// TODO: å®ç°AIä¼˜åŒ–åŠŸèƒ½
fun optimizeWithAi() {
    // æœªå®ç°
}

// TODO: æ·»åŠ æ¨¡æ¿ç®¡ç†
@Composable
fun TemplateManagement() {
    // æœªå®ç°
}

// TODO: æ·»åŠ ç‰ˆæœ¬å†å²
@Composable
fun VersionHistory() {
    // æœªå®ç°
}
```

#### å®æ–½ä¼˜å…ˆçº§

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ |
|------|--------|--------|
| AIé…ç½®ï¼ˆæ¸©åº¦ã€Tokenï¼‰ | ä¸­ | 1å¤© |
| è”ç³»äººè¯¦æƒ…ï¼ˆcreatedAtï¼‰ | ä½ | 0.5å¤© |
| æç¤ºè¯ç¼–è¾‘å™¨ï¼ˆAIä¼˜åŒ–ï¼‰ | ä¸­ | 1-2å¤© |
| æç¤ºè¯æ¨¡æ¿ç®¡ç† | ä½ | 1å¤© |
| æç¤ºè¯ç‰ˆæœ¬å†å² | ä½ | 1å¤© |

**æ€»å·¥ä½œé‡ä¼°ç®—**ï¼š3-5å¤©

---

## ä¸‰ã€ä½ä¼˜å…ˆçº§å€ºåŠ¡

### 3.1 appæ¨¡å—åŒ…ç»“æ„ä¼˜åŒ–

#### é—®é¢˜æè¿°

5ä¸ªAndroidä¾èµ–æ–‡ä»¶ä½äº`app/domain/`åŒ…ä¸­ï¼Œå®¹æ˜“è¯¯å¯¼ã€‚

#### å½“å‰ç»“æ„

```
app/src/main/java/com/empathy/ai/domain/
â”œâ”€â”€ service/
â”‚   â””â”€â”€ FloatingWindowService.kt    # AndroidæœåŠ¡
â””â”€â”€ util/
    â”œâ”€â”€ FloatingView.kt                # Androidè§†å›¾
    â”œâ”€â”€ ErrorHandler.kt                # é”™è¯¯å¤„ç†
    â”œâ”€â”€ FloatingViewDebugLogger.kt     # è°ƒè¯•æ—¥å¿—
    â””â”€â”€ PerformanceMonitor.kt          # æ€§èƒ½ç›‘æ§
```

#### é—®é¢˜åˆ†æ

**ä¸ºä»€ä¹ˆåœ¨app/domain/ï¼Ÿ**
- è¿™äº›æ–‡ä»¶ä¾èµ–Android SDKï¼ˆContextã€Viewç­‰ï¼‰
- æ— æ³•æ”¾åœ¨çº¯Kotlinçš„domainæ¨¡å—ä¸­
- ä¸´æ—¶æ”¾åœ¨app/domain/åŒ…ä¸‹

**ä¸ºä»€ä¹ˆæœ‰é—®é¢˜ï¼Ÿ**
- å®¹æ˜“è®©äººè¯¯ä»¥ä¸ºdomainå±‚æœ‰Androidä¾èµ–
- è¿ååŒ…ç»“æ„è¯­ä¹‰
- å½±å“ä»£ç å¯è¯»æ€§

#### å»ºè®®ç»“æ„

```
app/src/main/java/com/empathy/ai/
â”œâ”€â”€ service/
â”‚   â””â”€â”€ FloatingWindowService.kt    # AndroidæœåŠ¡
â””â”€â”€ util/
    â”œâ”€â”€ FloatingView.kt                # Androidè§†å›¾
    â”œâ”€â”€ ErrorHandler.kt                # é”™è¯¯å¤„ç†
    â”œâ”€â”€ FloatingViewDebugLogger.kt     # è°ƒè¯•æ—¥å¿—
    â””â”€â”€ PerformanceMonitor.kt          # æ€§èƒ½ç›‘æ§
```

#### å®æ–½è®¡åˆ’

1. **åˆ›å»ºæ–°åŒ…ç»“æ„**
2. **ç§»åŠ¨æ–‡ä»¶**
3. **æ›´æ–°packageå£°æ˜**
4. **æ›´æ–°importè¯­å¥**
5. **éªŒè¯ç¼–è¯‘**

**å·¥ä½œé‡ä¼°ç®—**ï¼šåŠå¤©

---

### 3.2 æ¸…ç†å¤‡ä»½æ–‡ä»¶

#### å‘ç°çš„å¤‡ä»½æ–‡ä»¶

**20ä¸ª.bakæµ‹è¯•æ–‡ä»¶**ï¼š

```
app/src/test/
â”œâ”€â”€ PromptSceneSettingsTest.kt.bak
â”œâ”€â”€ UserProfileTest.kt.bak
â”œâ”€â”€ ContactProfileTest.kt.bak
â””â”€â”€ ...ï¼ˆ17ä¸ªå…¶ä»–.bakæ–‡ä»¶ï¼‰
```

#### é—®é¢˜åˆ†æ

- å ç”¨ä»£ç åº“ç©ºé—´
- å½±å“ä»£ç æ•´æ´åº¦
- å¯èƒ½æ˜¯ä¸´æ—¶å¤‡ä»½ï¼Œæœªæ¸…ç†

#### å»ºè®®æ–¹æ¡ˆ

**æ–¹æ¡ˆ1ï¼šåˆ é™¤**
- å¦‚æœå¤‡ä»½ä¸å†éœ€è¦ï¼Œç›´æ¥åˆ é™¤

**æ–¹æ¡ˆ2ï¼šå½’æ¡£**
- ç§»è‡³`.archive/`ç›®å½•ä¿å­˜

#### å®æ–½è®¡åˆ’

1. **ç¡®è®¤å¤‡ä»½æ˜¯å¦éœ€è¦**
2. **åˆ é™¤æˆ–å½’æ¡£.bakæ–‡ä»¶**
3. **æ›´æ–°.gitignore**ï¼ˆå¦‚æœéœ€è¦ï¼‰

**å·¥ä½œé‡ä¼°ç®—**ï¼š1å°æ—¶

---

### 3.3 æ›¿æ¢Deprecated API

#### å‘ç°çš„Deprecatedæ ‡è®°

**34ä¸ª@Deprecatedæ ‡è®°**ï¼Œä¸»è¦åˆ†å¸ƒåœ¨ï¼š

1. **æç¤ºè¯ç³»ç»Ÿ**ï¼ˆæœ‰è®¡åˆ’çš„åºŸå¼ƒï¼‰ï¼š

```kotlin
// domain/model/PromptScene.kt
@Deprecated(
    "ä½¿ç”¨POLISHæ›¿ä»£",
    ReplaceWith("PromptScene.POLISH")
)
enum class PromptScene {
    CHECK,  // åºŸå¼ƒ
    EXTRACT,  // æš‚ä¸åœ¨è®¾ç½®ç•Œé¢å±•ç¤º
    // ...
}
```

```kotlin
// domain/util/PromptBuilder.kt
@Deprecated(
    "ä½¿ç”¨buildSystemInstruction()æ›¿ä»£",
    ReplaceWith("buildSystemInstruction()")
)
fun injectContextData(...): String {
    // ...
}
```

2. **æ‚¬æµ®çª—ç³»ç»Ÿ**ï¼š

```kotlin
// domain/util/FloatingWindowManager.kt
@Deprecated(
    "ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„å®ä¾‹",
    ReplaceWith("inject()")
)
fun requestPermission() {
    // ...
}
```

#### æ›¿æ¢è®¡åˆ’

| Deprecated API | æ›¿ä»£æ–¹æ¡ˆ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ |
|----------------|----------|--------|--------|
| PromptScene.CHECK | PromptScene.POLISH | ä¸­ | 1å¤© |
| PromptBuilder.injectContextData() | buildSystemInstruction() | ä¸­ | 1å¤© |
| FloatingWindowManager.requestPermission() | ä¾èµ–æ³¨å…¥ | ä½ | 0.5å¤© |

**æ€»å·¥ä½œé‡ä¼°ç®—**ï¼š2-3å¤©

---

## å››ã€æŠ€æœ¯å€ºåŠ¡æ¸…ç†è·¯çº¿å›¾

### 4.1 ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2å¤©ï¼‰

**ç›®æ ‡**ï¼šä¼˜åŒ–æµ‹è¯•æ–‡ä»¶ä½ç½®

1. è¿ç§»app/src/test/data/ â†’ data/src/test/
2. è¿ç§»app/src/test/domain/ â†’ domain/src/test/
3. è¿ç§»app/src/test/presentation/ â†’ presentation/src/test/
4. éªŒè¯æ‰€æœ‰æµ‹è¯•é€šè¿‡

### 4.2 ç¬¬äºŒé˜¶æ®µï¼ˆ1å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šæ¸…ç†å¤‡ä»½æ–‡ä»¶

1. åˆ é™¤20ä¸ª.bakæ–‡ä»¶
2. æ›´æ–°.gitignore

### 4.3 ç¬¬ä¸‰é˜¶æ®µï¼ˆåŠå¤©ï¼‰

**ç›®æ ‡**ï¼šä¼˜åŒ–appæ¨¡å—åŒ…ç»“æ„

1. ç§»åŠ¨app/domain/ â†’ app/service/å’Œapp/util/
2. æ›´æ–°packageå£°æ˜
3. éªŒè¯ç¼–è¯‘

### 4.4 ç¬¬å››é˜¶æ®µï¼ˆ3-5å¤©ï¼‰

**ç›®æ ‡**ï¼šå®ç°TODOåŠŸèƒ½

1. AIé…ç½®é¡µé¢ï¼ˆ1å¤©ï¼‰
2. è”ç³»äººè¯¦æƒ…é¡µï¼ˆ0.5å¤©ï¼‰
3. æç¤ºè¯ç¼–è¾‘å™¨ï¼ˆ1-2å¤©ï¼‰
4. å…¶ä»–åŠŸèƒ½ï¼ˆ1-2å¤©ï¼‰

### 4.5 ç¬¬äº”é˜¶æ®µï¼ˆ2-3å¤©ï¼‰

**ç›®æ ‡**ï¼šæ›¿æ¢Deprecated API

1. æ›¿æ¢PromptScene.CHECKï¼ˆ1å¤©ï¼‰
2. æ›¿æ¢PromptBuilder.injectContextData()ï¼ˆ1å¤©ï¼‰
3. æ›¿æ¢å…¶ä»–Deprecated APIï¼ˆ0.5-1å¤©ï¼‰

---

## äº”ã€æŠ€æœ¯å€ºåŠ¡å½±å“åˆ†æ

### 5.1 å½“å‰å½±å“

âœ… **ä½å½±å“**
- ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½
- ä¸å½±å“æ¶æ„è´¨é‡
- ä¸å½±å“ç”¨æˆ·ä½“éªŒ

âš ï¸ **ä¸­å½±å“**
- æµ‹è¯•æ–‡ä»¶ä½ç½®å½±å“æ¨¡å—è¾¹ç•Œæ¸…æ™°åº¦
- TODOåŠŸèƒ½å½±å“åŠŸèƒ½å®Œæ•´åº¦

### 5.2 ç´¯ç§¯é£é™©

| å€ºåŠ¡ç±»å‹ | ç´¯ç§¯é£é™© | å»ºè®®å¤„ç†æ—¶é—´ |
|---------|----------|-------------|
| æµ‹è¯•æ–‡ä»¶ä½ç½® | ä¸­ | 1ä¸ªæœˆå†… |
| TODOåŠŸèƒ½ | ä¸­ | 2-3ä¸ªæœˆå†… |
| å¤‡ä»½æ–‡ä»¶ | ä½ | 1å‘¨å†… |
| åŒ…ç»“æ„ä¼˜åŒ– | ä½ | 1ä¸ªæœˆå†… |
| Deprecated API | ä½ | æŒ‰è®¡åˆ’æ›¿æ¢ |

---

## å…­ã€æ€»ç»“

### 6.1 å€ºåŠ¡å¥åº·åº¦

| æŒ‡æ ‡ | è¯„çº§ |
|------|------|
| **å€ºåŠ¡æ€»é‡** | ğŸŸ¢ ä½ |
| **é«˜ä¼˜å…ˆçº§å€ºåŠ¡** | ğŸŸ¢ æ—  |
| **ä¸­ä¼˜å…ˆçº§å€ºåŠ¡** | ğŸŸ¡ 2é¡¹ |
| **ä½ä¼˜å…ˆçº§å€ºåŠ¡** | ğŸŸ¢ 3é¡¹ |
| **å€ºåŠ¡å¢é•¿ç‡** | ğŸŸ¢ ä½ |

### 6.2 å»ºè®®å¤„ç†ä¼˜å…ˆçº§

1. **ç«‹å³å¤„ç†**ï¼šæ— 
2. **1ä¸ªæœˆå†…**ï¼šæµ‹è¯•æ–‡ä»¶ä½ç½®ä¼˜åŒ–ã€æ¸…ç†å¤‡ä»½æ–‡ä»¶
3. **2-3ä¸ªæœˆå†…**ï¼šå®ç°TODOåŠŸèƒ½
4. **æŒ‰éœ€å¤„ç†**ï¼šåŒ…ç»“æ„ä¼˜åŒ–ã€æ›¿æ¢Deprecated API

### 6.3 ç»“è®º

é¡¹ç›®æŠ€æœ¯å€ºåŠ¡å¤„äº**å¥åº·çŠ¶æ€**ï¼Œä¸»è¦ä¸ºä½ä¼˜å…ˆçº§ä¼˜åŒ–é¡¹ï¼Œæ— é˜»å¡æ€§å€ºåŠ¡ã€‚å»ºè®®æŒ‰è®¡åˆ’é€æ­¥æ¸…ç†ã€‚

---

**åˆ†æå®Œæˆæ—¶é—´**ï¼š2025-12-29
