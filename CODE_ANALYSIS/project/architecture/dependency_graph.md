# ä¾èµ–å…³ç³»å›¾è°± (Dependency Graph)

> å…±æƒ…AIåŠ©æ‰‹ (Empathy AI Assistant) ä»£ç æ¶æ„åˆ†æ
> åˆ†ææ—¥æœŸ: 2026-01-03 | ç»´æŠ¤è€…: Claude

---

## 1. æ¨¡å—çº§ä¾èµ–å…³ç³»

### 1.1 Gradle ä¾èµ–é…ç½®

**æ ¹é¡¹ç›® `settings.gradle.kts`**:
```kotlin
include(":app")
include(":domain")
include(":data")
include(":presentation")
```

### 1.2 æ¨¡å—ä¾èµ–çŸ©é˜µ

| æ¨¡å— | domain | data | presentation | app |
|------|--------|------|--------------|-----|
| **domain** | - | âŒ | âŒ | âŒ |
| **data** | âœ… (api) | - | âŒ | âŒ |
| **presentation** | âœ… (api) | âŒ | - | âŒ |
| **app** | âœ… (implementation) | âœ… (implementation) | âœ… (api) | - |

### 1.3 ä¾èµ–æ–¹å‘å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              app (Application)          â”‚
                    â”‚  èŒè´£: åº”ç”¨å…¥å£, Android ç»„ä»¶é›†æˆ        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           presentation                   â”‚
                    â”‚  èŒè´£: UI æ¸²æŸ“, ViewModel, Navigation    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              data                        â”‚
                    â”‚  èŒè´£: æ•°æ®è®¿é—®, æœ¬åœ°å­˜å‚¨, ç½‘ç»œè¯·æ±‚        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              domain                      â”‚
                    â”‚  èŒè´£: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘, æ•°æ®æ¨¡å‹, ä»“åº“æ¥å£    â”‚
                    â”‚  ç‰¹ç‚¹: çº¯ Kotlin, æ—  Android ä¾èµ–         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‚¹**:
- âœ… **å•å‘ä¾èµ–**: åªèƒ½å¤–å±‚ â†’ å†…å±‚
- âœ… **æ¥å£éš”ç¦»**: Repository æ¥å£å®šä¹‰åœ¨ domainï¼Œå®ç° åœ¨ data
- âœ… **DIP éµå¾ª**: ä¾èµ–æŠ½è±¡ï¼Œè€Œéå…·ä½“å®ç°

---

## 2. æ ¸å¿ƒä¾èµ–é“¾

### 2.1 æ•°æ®æµä¾èµ–é“¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·äº¤äº’å±‚                                   â”‚
â”‚  MainActivity â†’ Compose UI â†’ ViewModel                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ StateFlow / Events
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸šåŠ¡é€»è¾‘å±‚                                   â”‚
â”‚  ViewModel â†’ UseCase â†’ Repository (Interface)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®è®¿é—®å±‚                                   â”‚
â”‚  Repository (Impl) â†’ DAO / API â†’ Database / Network             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å…³é”®ä¾èµ–æ³¨å…¥è·¯å¾„

**AI èŠå¤©åˆ†æåŠŸèƒ½**:
```
ChatViewModel
  â””â”€â†’ AnalyzeChatUseCase
       â”œâ”€â†’ ContactRepository
       â”œâ”€â†’ BrainTagRepository
       â”œâ”€â†’ PrivacyRepository
       â”œâ”€â†’ AiRepository
       â”œâ”€â†’ SettingsRepository
       â”œâ”€â†’ AiProviderRepository
       â”œâ”€â†’ ConversationRepository
       â”œâ”€â†’ TopicRepository
       â”œâ”€â†’ PromptBuilder
       â”œâ”€â†’ ConversationContextBuilder
       â”œâ”€â†’ UserProfileContextBuilder
       â””â”€â†’ Logger
```

**æ‚¬æµ®çª—åŠŸèƒ½**:
```
FloatingViewV2 (Compose)
  â””â”€â†’ ChatViewModel
       â””â”€â†’ (åŒä¸Š AI ä¾èµ–é“¾)

æ‚¬æµ®çª—æœåŠ¡
  â””â”€â†’ FloatingWindowManager
       â”œâ”€â†’ FloatingWindowPreferences
       â”œâ”€â†’ ContactRepository
       â””â”€â†’ BrainTagRepository
```

---

## 3. DI æ¨¡å—ä¾èµ–å…³ç³»

### 3.1 Data æ¨¡å— DI

```
data/di/
â”œâ”€â”€ DatabaseModule.kt          â†’ Room Database, DAO
â”œâ”€â”€ NetworkModule.kt           â†’ OkHttpClient, Retrofit, Moshi
â”œâ”€â”€ RepositoryModule.kt        â†’ Repository æ¥å£ç»‘å®š
â”œâ”€â”€ MemoryModule.kt            â†’ è®°å¿†ç³»ç»Ÿé…ç½®
â”œâ”€â”€ PromptModule.kt            â†’ æç¤ºè¯ç³»ç»Ÿé…ç½®
â”œâ”€â”€ DispatcherModule.kt        â†’ åç¨‹è°ƒåº¦å™¨
â””â”€â”€ OkHttpClientFactory.kt     â†’ HTTP å®¢æˆ·ç«¯å·¥å‚
```

### 3.2 App æ¨¡å— DI

```
app/src/main/java/com/empathy/ai/di/
â”œâ”€â”€ LoggerModule.kt            â†’ Logger æ¥å£ç»‘å®š
â”œâ”€â”€ ApiUsageModule.kt          â†’ API ç”¨é‡ç»Ÿè®¡
â”œâ”€â”€ AppDispatcherModule.kt     â†’ åº”ç”¨çº§è°ƒåº¦å™¨
â”œâ”€â”€ EditModule.kt              â†’ ç¼–è¾‘åŠŸèƒ½æ¨¡å—
â”œâ”€â”€ FloatingWindowModule.kt    â†’ æ‚¬æµ®çª—æ¨¡å—
â”œâ”€â”€ NotificationModule.kt      â†’ é€šçŸ¥æ¨¡å—
â”œâ”€â”€ PersonaModule.kt           â†’ äººè®¾æ¨¡å—
â”œâ”€â”€ ProxyModule.kt             â†’ ä»£ç†æ¨¡å—
â”œâ”€â”€ ServiceModule.kt           â†’ æœåŠ¡æ¨¡å—
â”œâ”€â”€ SummaryModule.kt           â†’ æ€»ç»“æ¨¡å—
â”œâ”€â”€ TopicModule.kt             â†’ ä¸»é¢˜æ¨¡å—
â””â”€â”€ UserProfileModule.kt       â†’ ç”¨æˆ·ç”»åƒæ¨¡å—
```

---

## 4. Repository ä¾èµ–å…³ç³»

### 4.1 Repository æ¥å£ (Domain å±‚)

```
domain/repository/
â”œâ”€â”€ ContactRepository.kt       â†’ è”ç³»äºº CRUD
â”œâ”€â”€ BrainTagRepository.kt      â†’ æ ‡ç­¾ç®¡ç†
â”œâ”€â”€ AiRepository.kt            â†’ AI è¯·æ±‚
â”œâ”€â”€ AiProviderRepository.kt    â†’ æœåŠ¡å•†ç®¡ç†
â”œâ”€â”€ ConversationRepository.kt  â†’ å¯¹è¯è®°å½•
â”œâ”€â”€ DailySummaryRepository.kt  â†’ æ¯æ—¥æ€»ç»“
â”œâ”€â”€ PromptRepository.kt        â†’ æç¤ºè¯é…ç½®
â”œâ”€â”€ TopicRepository.kt         â†’ å¯¹è¯ä¸»é¢˜
â”œâ”€â”€ UserProfileRepository.kt   â†’ ç”¨æˆ·ç”»åƒ
â”œâ”€â”€ FailedTaskRepository.kt    â†’ å¤±è´¥ä»»åŠ¡
â”œâ”€â”€ PrivacyRepository.kt       â†’ éšç§æ•°æ®
â”œâ”€â”€ SettingsRepository.kt      â†’ åº”ç”¨è®¾ç½®
â””â”€â”€ FloatingWindowPreferencesRepository.kt â†’ æ‚¬æµ®çª—è®¾ç½®
```

### 4.2 Repository å®ç° (Data å±‚)

```
data/repository/
â”œâ”€â”€ ContactRepositoryImpl.kt           â†’ Room + ContactDao
â”œâ”€â”€ BrainTagRepositoryImpl.kt          â†’ Room + BrainTagDao
â”œâ”€â”€ AiRepositoryImpl.kt                â†’ Retrofit + OpenAiApi
â”œâ”€â”€ AiProviderRepositoryImpl.kt        â†’ Room + AiProviderDao
â”œâ”€â”€ ConversationRepositoryImpl.kt      â†’ Room + ConversationLogDao
â”œâ”€â”€ DailySummaryRepositoryImpl.kt      â†’ Room + DailySummaryDao
â”œâ”€â”€ PromptRepositoryImpl.kt            â†’ File + Room
â”œâ”€â”€ TopicRepositoryImpl.kt             â†’ Room + ConversationTopicDao
â”œâ”€â”€ UserProfileRepositoryImpl.kt       â†’ Room + EncryptedSharedPreferences
â”œâ”€â”€ FailedTaskRepositoryImpl.kt        â†’ Room + FailedSummaryTaskDao
â”œâ”€â”€ PrivacyRepositoryImpl.kt           â†’ PrivacyEngine
â”œâ”€â”€ SettingsRepositoryImpl.kt          â†’ DataStore
â””â”€â”€ ApiUsageRepositoryImpl.kt          â†’ Room + ApiUsageDao
```

---

## 5. å¾ªç¯ä¾èµ–æ£€æµ‹

### 5.1 æ£€æµ‹ç»“æœ

```
âœ“ æ— å¾ªç¯ä¾èµ–:
- domain â†’ data â†’ domain  (é€šè¿‡æ¥å£ï¼Œâœ… æ­£å¸¸)
- domain â†’ presentation â†’ domain (é€šè¿‡æ¥å£ï¼Œâœ… æ­£å¸¸)
- app â†’ data â†’ domain â†’ app  (æ— ç›´æ¥ä¾èµ–ï¼Œâœ… æ­£å¸¸)
```

### 5.2 æ½œåœ¨é£é™©ç‚¹

| é£é™©ç‚¹ | å½“å‰çŠ¶æ€ | é£é™©ç­‰çº§ |
|--------|---------|---------|
| UseCase ä¾èµ– UseCase | æ— ç›´æ¥ä¾èµ–ï¼Œé€šè¿‡ Repository äº¤äº’ | ğŸŸ¢ ä½ |
| ViewModel ä¾èµ– ViewModel | é€šè¿‡ StateFlow é€šä¿¡ï¼Œæ— ç›´æ¥ä¾èµ– | ğŸŸ¢ ä½ |
| Repository ä¾èµ– Repository | é€šè¿‡ UseCase ä¸­è½¬ï¼Œæ— ç›´æ¥ä¾èµ– | ğŸŸ¢ ä½ |

---

## 6. å¤–éƒ¨ä¾èµ–ç®¡ç†

### 6.1 ä¸»è¦ä¾èµ–ç‰ˆæœ¬

| ä¾èµ– | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Kotlin | 2.0.21 | è¯­è¨€æ ¸å¿ƒ |
| Compose BOM | 2024.12.01 | UI æ¡†æ¶ |
| Hilt | 2.52 | ä¾èµ–æ³¨å…¥ |
| Room | 11 | æœ¬åœ°æ•°æ®åº“ |
| Retrofit | 2.9.0 | ç½‘ç»œè¯·æ±‚ |
| Moshi | 1.15.1 | JSON åºåˆ—åŒ– |
| Coroutines | 1.8.1 | å¼‚æ­¥å¤„ç† |

### 6.2 ä¾èµ–ç­–ç•¥

```
implementation vs api:
- data æ¨¡å—å¯¹ domain ä½¿ç”¨ api (æš´éœ²ç»™ app)
- presentation æ¨¡å—å¯¹ domain ä½¿ç”¨ api (æš´éœ²ç»™ app)
- app æ¨¡å—å¯¹æ‰€æœ‰æ¨¡å—ä½¿ç”¨ implementation/api
```

---

## 7. ä¾èµ–è´¨é‡è¯„ä¼°

### 7.1 æŒ‡æ ‡

| æŒ‡æ ‡ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **ä¾èµ–æ–¹å‘** | â­â­â­â­â­ (5/5) | ä¸¥æ ¼éµå¾ª Clean Architecture |
| **æ¥å£æŠ½è±¡** | â­â­â­â­â­ (5/5) | Repository æ¥å£å®šä¹‰åœ¨ domain |
| **å¾ªç¯ä¾èµ–** | â­â­â­â­â­ (5/5) | æ— å¾ªç¯ä¾èµ– |
| **DI ç»„ç»‡** | â­â­â­â­ (4/5) | DI æ¨¡å—åˆ†æ•£åœ¨å¤šä¸ªä½ç½® |
| **å¤–éƒ¨ä¾èµ–** | â­â­â­â­ (4/5) | ç‰ˆæœ¬ç»Ÿä¸€ç®¡ç†è‰¯å¥½ |

### 7.2 ä¼˜åŠ¿

1. âœ… **Domain å±‚çº¯å‡€**: 100% çº¯ Kotlinï¼Œæ—  Android ä¾èµ–
2. âœ… **æ¥å£é©±åŠ¨**: æ‰€æœ‰ä¾èµ–é€šè¿‡æ¥å£æŠ½è±¡
3. âœ… **Hilt é›†æˆ**: è‡ªåŠ¨ä¾èµ–æ³¨å…¥ï¼Œç¼–è¯‘æ—¶è§£æ
4. âœ… **æ¨¡å—åŒ–**: æ”¯æŒç‹¬ç«‹ç¼–è¯‘å’Œæµ‹è¯•

### 7.3 å¾…æ”¹è¿›

1. âš ï¸ **DI é…ç½®åˆ†æ•£**: data å’Œ app éƒ½æœ‰ DI æ¨¡å—
2. âš ï¸ **éƒ¨åˆ†ç±»è€¦åˆ**: AiRepositoryImpl æ‰¿æ‹…è¿‡å¤šèŒè´£
3. âš ï¸ **å¸¸é‡åˆ†æ•£**: æ¨¡å‹åç§°ç­‰å¸¸é‡æ•£è½åœ¨å¤šå¤„

---

## 8. æ€»ç»“

**ä¾èµ–å…³ç³»å¥åº·åº¦**: âœ… ä¼˜ç§€

| æ£€æŸ¥é¡¹ | çŠ¶æ€ |
|--------|------|
| Clean Architecture åˆè§„æ€§ | âœ… å®Œå…¨åˆè§„ |
| ä¾èµ–æ–¹å‘æ­£ç¡®æ€§ | âœ… å•å‘ä¾èµ– |
| æ¥å£æŠ½è±¡ä½¿ç”¨ | âœ… 13 ä¸ª Repository æ¥å£ |
| å¾ªç¯ä¾èµ– | âœ… æ—  |
| DI ç»„ç»‡ | âœ… Hilt æ­£ç¡®é…ç½® |

**æ€»ä½“è¯„ä»·**: é¡¹ç›®ä¾èµ–å…³ç³»è®¾è®¡ä¼˜ç§€ï¼Œä¸¥æ ¼éµå¾ª Clean Architecture åŸåˆ™ï¼ŒDomain å±‚ä¿æŒçº¯ Kotlin å®ç°ã€‚DI é…ç½®å¯è¿›ä¸€æ­¥ç»Ÿä¸€ã€‚

---

**æœ€åæ›´æ–°**: 2026-01-03 | æ›´æ–°è€…: Claude
