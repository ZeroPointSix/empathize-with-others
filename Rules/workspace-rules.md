# WORKSPACE 工作流规则

## 🚨 强制执行规则（最高优先级）

**本规则优先级高于所有其他规则，所有AI工具必须严格遵守。**

---

## 📋 任务开始前的强制检查

### 1. 读取 WORKSPACE 状态
在开始任何任务之前，**必须**先读取 `Rules/WORKSPACE.md` 文件：

```
读取 Rules/WORKSPACE.md
```

### 2. 检查冲突
检查以下内容：
- ✅ 是否有其他AI正在执行相关任务
- ✅ 是否有资源被锁定
- ✅ 是否有待处理的冲突

### 3. 冲突处理
如果发现以下情况，**必须停止并询问用户**：
- ❌ 有其他AI正在修改相同文件
- ❌ 有其他AI正在执行相关任务
- ❌ WORKSPACE中标记了冲突或警告

### 4. 记录任务开始
在 WORKSPACE 中记录：
- 任务ID（自动生成或用户指定）
- 任务名称
- 负责AI（Roo/Kiro/Claude）
- 状态：进行中
- 优先级
- 开始时间

---

## 📝 任务执行中的更新

### 实时状态同步
- 重要里程碑完成时更新 WORKSPACE
- 发现问题时立即记录到"已知问题"
- 需要其他AI协作时在 WORKSPACE 中标记

---

## ✅ 任务完成后的强制更新

### 1. 更新任务状态
将任务从"正在进行"移动到"已完成任务"：
- 记录完成时间
- 记录相关文档链接
- 清理"正在进行的任务"表格

### 2. 更新AI工具状态
更新对应AI工具的：
- 最后活动时间
- 当前任务状态
- 待处理任务

### 3. 更新文档版本（如果有文档变更）
在"文档版本"表格中记录：
- 文档类型
- 最新编号
- 文档名称
- 版本
- 最后更新时间
- 更新者

### 4. 添加变更日志
在"变更日志"部分添加本次任务的详细记录：
```markdown
### YYYY-MM-DD - [AI工具名称]
- 任务描述
- 修改的文件列表
- 相关文档链接
```

---

## 🔄 WORKSPACE 更新模板

### 任务开始时
```markdown
### 正在进行的任务
| 任务ID | 任务名称 | 负责AI | 状态 | 优先级 | 开始时间 | 预计完成 |
|--------|---------|--------|------|--------|----------|----------|
| TASK-001 | 创建XX功能 | Kiro | 进行中 | P1 | 2024-12-12 10:00 | 2024-12-12 12:00 |
```

### 任务完成时
```markdown
### 已完成任务（最近5条）
- [x] 2024-12-12 - 创建XX功能 - Kiro - 相关文档: [PRD-00001](文档/开发文档/PRD/PRD-00001-XX功能.md)
```

---

## ⚠️ 违规处理

如果AI工具未遵守本规则：
1. 用户应立即指出违规行为
2. AI工具必须立即停止当前任务
3. AI工具必须补充更新 WORKSPACE
4. AI工具必须道歉并承诺遵守规则

---

## 📊 检查清单

每次任务执行时，AI工具应自我检查：

**任务开始前：**
- [ ] 已读取 Rules/WORKSPACE.md
- [ ] 已检查是否有冲突
- [ ] 已在 WORKSPACE 中记录任务开始

**任务执行中：**
- [ ] 重要里程碑已更新到 WORKSPACE
- [ ] 发现的问题已记录

**任务完成后：**
- [ ] 已将任务移至"已完成"
- [ ] 已更新AI工具状态
- [ ] 已更新文档版本（如适用）
- [ ] 已添加变更日志
- [ ] 已清理"正在进行的任务"

---

## 🎯 目标

通过严格执行 WORKSPACE 规则，实现：
1. ✅ 避免多个AI同时修改同一文件
2. ✅ 保持项目状态的透明度
3. ✅ 便于追踪任务历史和责任人
4. ✅ 提高多AI协作效率
5. ✅ 减少冲突和返工
