---
æ ‡é¢˜: æ•´ä½“æ¶æ„
ç‰ˆæœ¬: v2.0
åˆ›å»ºæ—¥æœŸ: 2025-12-08
æœ€åæ›´æ–°: 2025-12-08
æ›´æ–°äºº: AI Assistant
çŠ¶æ€: æ´»è·ƒ
æ ‡ç­¾: [æ¶æ„è®¾è®¡, æ•´ä½“æ¶æ„, Clean Architecture]
ç›¸å…³æ–‡æ¡£: [é¢†åŸŸå±‚è®¾è®¡/README.md, æ•°æ®å±‚è®¾è®¡/README.md, æœåŠ¡å±‚è®¾è®¡/README.md, è¡¨ç°å±‚è®¾è®¡/README.md]
---

# æ•´ä½“æ¶æ„

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

|**é¡¹ç›®åç§°**|**ç‰ˆæœ¬**|**çŠ¶æ€**|**æ¶æ„æ¨¡å¼**|
|---|---|---|---|
|Empathy AI Assistant|v2.0|**Ready for Dev**|Clean Architecture + MVVM|

---

## ğŸ—ï¸ æ ¸å¿ƒè®¾è®¡å“²å­¦

æœ¬é¡¹ç›®æ˜¯ä¸€æ¬¾**Native Android è¾…åŠ©å·¥å…·**ï¼Œè®¾è®¡å¿…é¡»ä¸¥æ ¼éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

### 1. é›¶åç«¯ (Zero-Backend)
- åº”ç”¨æœ¬èº«ä¸ç»´æŠ¤æœåŠ¡å™¨
- æ— ç”¨æˆ·è´¦æˆ·ä½“ç³»
- æ‰€æœ‰æ•°æ®æœ¬åœ°å¤„ç†

### 2. BYOK (Bring Your Own Key)
- æ‰€æœ‰çš„ AI èƒ½åŠ›é€šè¿‡ç”¨æˆ·è‡ªå¤‡çš„ API Keyï¼ˆOpenAI/Google/DeepSeekï¼‰ç›´è¿ç¬¬ä¸‰æ–¹
- ç”¨æˆ·å®Œå…¨æ§åˆ¶æ•°æ®æµå‘

### 3. éšç§ç»å¯¹ä¼˜å…ˆ (Privacy First)
- æ•æ„Ÿæ•°æ®ï¼ˆèŠå¤©è®°å½•ï¼‰å¿…é¡»åœ¨æœ¬åœ°è„±æ•åæ‰èƒ½å‘é€ç»™ AI
- Key å¿…é¡»é€šè¿‡ç¡¬ä»¶çº§åŠ å¯†å­˜å‚¨

### 4. æ— æ„Ÿæ¥å…¥ (Passive & Active)
- é€šè¿‡æ‚¬æµ®çª—å’Œæ— éšœç¢æœåŠ¡ (Accessibility) ä¸å®¿ä¸» App (å¾®ä¿¡/QQ) äº¤äº’
- ä¸ä¿®æ”¹å®¿ä¸» App æºç 

---

## ğŸ›ï¸ æ€»ä½“æ¶æ„è®¾è®¡

é‡‡ç”¨ **Clean Architecture** (æ•´æ´æ¶æ„) åˆ†å±‚ï¼Œç»“åˆ **Hilt** ä¾èµ–æ³¨å…¥ã€‚

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer              â”‚
â”‚  (UI, ViewModel, Service)               â”‚
â”‚  - Jetpack Compose                      â”‚
â”‚  - FloatingWindowService                â”‚
â”‚  - AccessibilityService                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Domain Layer                   â”‚
â”‚  (çº¯ä¸šåŠ¡é€»è¾‘ï¼Œæ—  Android ä¾èµ–)          â”‚
â”‚  - UseCase (AnalyzeChat, CheckDraft)    â”‚
â”‚  - Repository Interface                 â”‚
â”‚  - Business Models                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Data Layer                    â”‚
â”‚  (æ•°æ®è·å–ä¸æŒä¹…åŒ–)                     â”‚
â”‚  - Room Database                        â”‚
â”‚  - Retrofit (AI API)                    â”‚
â”‚  - EncryptedSharedPreferences           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æŠ€æœ¯æ ˆé€‰å‹

### æ ¸å¿ƒæŠ€æœ¯

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| **è¯­è¨€** | Kotlin | 2.0.21 | ä¸»å¼€å‘è¯­è¨€ |
| **UI** | Jetpack Compose | 2024.12.01 | å£°æ˜å¼ UI |
| **æ¶æ„** | Hilt | 2.52 | ä¾èµ–æ³¨å…¥ |
| **æ•°æ®åº“** | Room | 2.6.1 | æœ¬åœ°å­˜å‚¨ |
| **ç½‘ç»œ** | Retrofit + OkHttp | 2.11.0 / 4.12.0 | AI API è°ƒç”¨ |
| **JSON** | Moshi | 1.15.1 | JSON è§£æ |
| **åç¨‹** | Kotlin Coroutines | 1.9.0 | å¼‚æ­¥å¤„ç† |
| **å®‰å…¨** | Security Crypto | 1.1.0-alpha06 | åŠ å¯†å­˜å‚¨ |
| **æµ‹è¯•** | JUnit + Mockk | 4.13.2 / 1.13.13 | å•å…ƒæµ‹è¯• |

### æ ¸å¿ƒæœåŠ¡

- **AccessibilityService**: å±å¹•è¯»å–
- **LifecycleService**: æ‚¬æµ®çª—å®¿ä¸»
- **Room Database**: æœ¬åœ°æ•°æ®å­˜å‚¨
- **EncryptedSharedPreferences**: å®‰å…¨å­˜å‚¨
- **Retrofit 2 + OkHttp**: æ”¯æŒåŠ¨æ€ BaseURL
- **FFmpegKit-Android**: éŸ³è§†é¢‘æå–

---

## ğŸ“ æ¨¡å—ä¸ç›®å½•ç»“æ„

å»ºè®®å·¥ç¨‹ç›®å½•ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ç»“æ„å»ºç«‹ï¼š

```
com.empathy.ai
â”œâ”€â”€ app                 // Applicationå…¥å£, Hilté…ç½®
â”œâ”€â”€ data                // [æ•°æ®å±‚] è´Ÿè´£æ•°æ®çš„è·å–ä¸æŒä¹…åŒ–
â”‚   â”œâ”€â”€ local           // Room Database, DAO, EncryptedPrefs
â”‚   â”œâ”€â”€ remote          // Retrofit Service (å«åŠ¨æ€URLæ”¯æŒ)
â”‚   â”œâ”€â”€ media           // FFmpeg/MediaCodec å°è£…å®ç°
â”‚   â”œâ”€â”€ repository      // Repository æ¥å£çš„å®ç°ç±»
â”‚   â””â”€â”€ model           // Data Entities (DTOs)
â”‚
â”œâ”€â”€ domain              // [é¢†åŸŸå±‚] çº¯ä¸šåŠ¡é€»è¾‘ (æ—  Android ä¾èµ–)
â”‚   â”œâ”€â”€ model           // æ ¸å¿ƒä¸šåŠ¡å®ä½“ (Profile, Strategy)
â”‚   â”œâ”€â”€ repository      // Repository æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ usecase         // æ ¸å¿ƒä¸šåŠ¡æµ (e.g., AnalyzeChatUseCase)
â”‚   â””â”€â”€ service         // é¢†åŸŸæœåŠ¡æ¥å£
â”‚
â”œâ”€â”€ presentation        // [è¡¨ç°å±‚] UI ä¸ äº¤äº’
â”‚   â”œâ”€â”€ service         // Android Service (Accessibility, FloatingWindow)
â”‚   â”œâ”€â”€ ui              // Compose Screens (Settings, AnalysisCard)
â”‚   â”œâ”€â”€ viewmodel       // HiltViewModel (çŠ¶æ€ç®¡ç†)
â”‚   â””â”€â”€ theme           // Compose Theme
â”‚
â””â”€â”€ di                  // Hilt æ¨¡å— (NetworkModule, DatabaseModule)
```

---

## ğŸ” å®‰å…¨ä¸éšç§æ¶æ„

### æ•°æ®è„±æ• (Masking)

**åŸåˆ™**: åŸå§‹èŠå¤©è®°å½•ç»ä¸å…è®¸ç›´æ¥ç¦»å¼€è®¾å¤‡ã€‚

**å¼ºåˆ¶è°ƒç”¨é“¾**:
æ‰€æœ‰å‘é€ç»™ AI çš„è¯·æ±‚ï¼Œå¿…é¡»ç»è¿‡ PrivacyEngine å¤„ç†ã€‚å»ºè®®åœ¨ UseCase å±‚å¼ºåˆ¶æ‰§è¡Œï¼š

```kotlin
// AnalyzeChatUseCase.kt
suspend operator fun invoke(rawText: String): AnalysisResult {
    // 1. æœ¬åœ°è„±æ• (æ ¸å¿ƒå®‰å…¨æ …æ )
    val maskedText = privacyEngine.mask(rawText, loadPrivacyDict())
    
    // 2. ä»…å‘é€è„±æ•åçš„æ–‡æœ¬
    val remoteResult = aiRepository.analyze(maskedText)
    
    // 3. (å¯é€‰) æœ¬åœ°è¿˜åŸæ˜¾ç¤º
    return remoteResult
}
```

### å¯†é’¥å­˜å‚¨

- **ä¸¥ç¦**ä½¿ç”¨æ™®é€š `SharedPreferences`
- **å¿…é¡»**ä½¿ç”¨ Jetpack Security çš„ `EncryptedSharedPreferences`

---

## ğŸ—„ï¸ æ•°æ®åº“æ¨¡å‹

ä½¿ç”¨ Room å®šä¹‰æœ¬åœ°çŸ¥è¯†åº“ï¼š

```kotlin
// 1. è”ç³»äººç”»åƒ
@Entity(tableName = "profiles")
data class ContactProfile(
    @PrimaryKey val id: String, 
    val name: String, 
    val targetGoal: String, // é•¿æœŸç›®æ ‡
    val contextDepth: Int = 10 
)

// 2. ç­–ç•¥ä¸é›·åŒº (RAG æ ¸å¿ƒ)
@Entity(tableName = "brain_tags", indices = [Index(value = ["contactId", "type"])])
data class BrainTag(
    @PrimaryKey(autoGenerate = true) val id: Long = 0,
    val contactId: String,
    val type: String, // "RED"(é›·åŒº), "GREEN"(ç­–ç•¥)
    val content: String, // e.g., "ä¸å–œæ¬¢è¢«é—®è–ªèµ„"
    val source: String // "MANUAL" or "AI_AUTO"
)
```

---

## ğŸ”§ å…³é”®æ¨¡å—è¯¦ç»†è®¾è®¡

### è¡¨ç°å±‚ï¼šæ‚¬æµ®çª—ä¸ Compose ç»“åˆ

**æŒ‘æˆ˜**: Compose é€šå¸¸ä¾èµ– Activityï¼Œä½†æ‚¬æµ®çª—éœ€åœ¨ Service ä¸­è¿è¡Œã€‚

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ ComposeView æ¡¥æ¥ WindowManagerï¼Œå¹¶æ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚

- **ç±»ï¼š** `FloatingWindowService` (ç»§æ‰¿ `LifecycleService`)
- **æ ¸å¿ƒé€»è¾‘ï¼š**
    1. åˆ›å»º `ComposeView(context)`
    2. è°ƒç”¨ `setViewCompositionStrategy(DisposeOnViewTreeLifecycleDestroyed)` é˜²æ­¢å†…å­˜æ³„æ¼
    3. `windowManager.addView(composeView, layoutParams)`

### æŠ“å–å±‚ï¼šå±å¹•å†…å®¹è·å–

**æŒ‘æˆ˜**: å¦‚ä½•è·å–å±å¹•å¤–ï¼ˆå†å²ï¼‰èŠå¤©è®°å½•ï¼Ÿ

**ç±»**: ScreenFetcher (AccessibilityService)

**ç®—æ³•æµç¨‹ (æ»šåŠ¨æŠ“å–)**ï¼š
1. **æ‰«æ**: éå†å½“å‰çª—å£èŠ‚ç‚¹ï¼Œæå–æ‰€æœ‰ `TextView` å†…å®¹åŠåæ ‡
2. **åˆ¤æ–­**: è‹¥æŠ“å–æ¡æ•° < è®¾å®šæ·±åº¦ (e.g., 10æ¡)ï¼Œå¯»æ‰¾å¯æ»šåŠ¨èŠ‚ç‚¹ (List/Recycler)
3. **åŠ¨ä½œ**: æ‰§è¡Œ `ACTION_SCROLL_BACKWARD` (å‘ä¸‹æ»‘åŠ¨æŸ¥çœ‹æ—§æ¶ˆæ¯)
4. **å»é‡**: å†æ¬¡æ‰«æï¼Œæ ¹æ® `text + boundsInScreen` è¿›è¡Œå»é‡åˆå¹¶
5. **å¾ªç¯**: ç›´è‡³æ»¡è¶³æ¡æ•°æˆ–æ— æ³•æ»šåŠ¨

### æ•°æ®å±‚ï¼šBYOK åŠ¨æ€ç½‘ç»œæ¶æ„

**æŒ‘æˆ˜**: ç”¨æˆ·å¯èƒ½ä½¿ç”¨ä¸åŒçš„ AI æœåŠ¡å•†ï¼ˆOpenAI, DeepSeek ç­‰ï¼‰ï¼ŒBaseURL ä¸å›ºå®šã€‚

**ç±»**: AiProviderManager

**å®ç°**:
- Retrofit æ¥å£å®šä¹‰ä¸­ä½¿ç”¨ `@Url` æ³¨è§£
- Repository æ ¹æ®ç”¨æˆ·é…ç½®ï¼ŒåŠ¨æ€æ³¨å…¥ `baseUrl` å’Œ `Header (Authorization)`

### æœåŠ¡å±‚ï¼šä¸šåŠ¡é€»è¾‘ç¼–æ’

**å®šä½**: æœåŠ¡å±‚ä½äºDomain Layerï¼Œæ˜¯è¿æ¥è¡¨ç°å±‚å’Œæ•°æ®å±‚çš„æ ¸å¿ƒæ¢çº½ï¼Œå°è£…äº†åº”ç”¨çš„ä¸šåŠ¡é€»è¾‘å’Œä¸šåŠ¡è§„åˆ™ã€‚

**æ ¸å¿ƒç»„ä»¶**:

| ç»„ä»¶ | èŒè´£ | ç¤ºä¾‹ |
|------|------|------|
| **UseCase** | å°è£…å•ä¸ªä¸šåŠ¡æµç¨‹ | AnalyzeChatUseCase |
| **Service** | æä¾›å¯å¤ç”¨çš„é¢†åŸŸèƒ½åŠ› | PrivacyEngine |

**æ¶æ„ç‰¹ç‚¹**:
- âœ… ä¸¥æ ¼éµå¾ªClean Architectureä¾èµ–è§„åˆ™
- âœ… ä½¿ç”¨Result<T>ç»Ÿä¸€é”™è¯¯å¤„ç†
- âœ… æ‰€æœ‰IOæ“ä½œéƒ½æ˜¯suspendå‡½æ•°
- âœ… ä¾èµ–Repositoryæ¥å£è€Œéå®ç°

### åª’ä½“å±‚ï¼šå¤šæ¨¡æ€æ•°æ®å–‚å…»

**æŒ‘æˆ˜**: å¤„ç†ç”¨æˆ·å¯¼å…¥çš„ MP4/MP3ï¼Œæå–çº¯æ–‡æœ¬æˆ–å…³é”®å¸§ã€‚

**ç±»**: MediaProcessor

**å®ç°**:
- é›†æˆ `FFmpegKit-Android`
- **éŸ³é¢‘æå–**: `ffmpeg -i input.mp4 -vn -acodec libmp3lame output.mp3` -> ä¼ ç»™ Whisper API
- **å…³é”®å¸§æå–**: `ffmpeg -i input.mp4 -vf fps=1/5 frame_%03d.jpg` (æ¯5ç§’æˆªä¸€å¸§) -> ä¼ ç»™ Vision API

---

## ğŸ“ˆ å¼€å‘è·¯çº¿å›¾

|**é˜¶æ®µ**|**å‘¨æœŸ**|**æ ¸å¿ƒä»»åŠ¡**|**äº¤ä»˜ç‰©**|
|---|---|---|---|
|**Phase 1: éª¨æ¶**|Week 1|æ„å»º MVVM ç»“æ„ã€FloatingWindowServiceã€åŸºç¡€ Accessibility|èƒ½æ˜¾ç¤ºçš„æ‚¬æµ®çª—ã€èƒ½æŠ“å–å½“å‰å±æ–‡å­—çš„ Log|
|**Phase 2: å¤§è„‘**|Week 2|Room æ•°æ®åº“ã€Settings é¡µã€EncryptedPrefsã€FFmpeg é›†æˆ|æ”¯æŒé…ç½®ä¿å­˜ã€æ”¯æŒè§†é¢‘/éŸ³é¢‘è½¬æ–‡å­—æµç¨‹|
|**Phase 3: è¿æ¥**|Week 3|Retrofit åŠ¨æ€ URLã€PrivacyEngine è„±æ•é€»è¾‘ã€OpenAI/DeepSeek è”è°ƒ|ç‚¹å‡»åˆ†æ -> æŠ“å– -> è„±æ• -> AIè¯·æ±‚ -> å¼¹çª—ç»“æœ|
|**Phase 4: ä¼˜åŒ–**|Week 4|**æ»šåŠ¨æŠ“å–ç®—æ³•**ä¼˜åŒ–ã€UI åŠ¨ç”»ã€è‡ªåŠ¨å¡«å……æ–‡æœ¬é€»è¾‘|å®Œæ•´çš„ MVP v2.0|

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

### æ¶æ„åˆ†å±‚æ–‡æ¡£

- [é¢†åŸŸå±‚è®¾è®¡](./é¢†åŸŸå±‚è®¾è®¡/README.md) - Domain Layerçš„ä¸šåŠ¡æ¨¡å‹å’Œé¢†åŸŸé€»è¾‘è®¾è®¡
- [æ•°æ®å±‚è®¾è®¡](./æ•°æ®å±‚è®¾è®¡/README.md) - Data Layerçš„æ•°æ®å­˜å‚¨ã€ç¼“å­˜å’Œç½‘ç»œè®¿é—®è®¾è®¡
- [æœåŠ¡å±‚è®¾è®¡](./æœåŠ¡å±‚è®¾è®¡/README.md) - Service Layerçš„ä¸šåŠ¡æœåŠ¡å’Œç¼–æ’é€»è¾‘è®¾è®¡
- [è¡¨ç°å±‚è®¾è®¡](./è¡¨ç°å±‚è®¾è®¡/README.md) - Presentation Layerçš„UIç»„ä»¶å’Œäº¤äº’è®¾è®¡

### åŠŸèƒ½è®¾è®¡æ–‡æ¡£

- [åŠŸèƒ½è®¾è®¡](./åŠŸèƒ½è®¾è®¡.md) - æ ¸å¿ƒåŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡

---

## ğŸ“ æ¶æ„åŸåˆ™

1. **åˆ†å±‚æ¶æ„**: ä¸¥æ ¼çš„åˆ†å±‚è®¾è®¡ï¼Œç¡®ä¿èŒè´£åˆ†ç¦»
2. **ä¾èµ–å€’ç½®**: é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡
3. **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸ
4. **å¼€é—­åŸåˆ™**: å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
5. **æ¥å£éš”ç¦»**: ä¸åº”è¯¥å¼ºè¿«å®¢æˆ·ç«¯ä¾èµ–å®ƒä»¬ä¸ä½¿ç”¨çš„æ–¹æ³•
6. **é‡Œæ°æ›¿æ¢**: å­ç±»å‹å¿…é¡»èƒ½å¤Ÿæ›¿æ¢æ‰å®ƒä»¬çš„åŸºç±»å‹

---

## ğŸ¯ è´¨é‡ä¿è¯

### ä»£ç è´¨é‡

- **æµ‹è¯•è¦†ç›–ç‡**: Domain Layer 100%
- **ä»£ç å®¡æŸ¥**: æ‰€æœ‰æ¶æ„å˜æ›´éœ€ç»è¿‡ä»£ç å®¡æŸ¥
- **é™æ€åˆ†æ**: ä½¿ç”¨ Detekt è¿›è¡Œ Kotlin ä»£ç é™æ€åˆ†æ

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | è¯´æ˜ |
|------|------|------|
| **æœ¬åœ°æ£€æŸ¥** | < 500ms | å…³é”®è¯åŒ¹é…å“åº”æ—¶é—´ |
| **å±å¹•æŠ“å–** | < 2s | å®Œæˆæ–‡å­—æŠ“å– |
| **AI åˆ†æ** | < 10s | å®Œæ•´åˆ†ææµç¨‹ |
| **å†…å­˜å ç”¨** | < 200MB | æ­£å¸¸ä½¿ç”¨çŠ¶æ€ |
| **APK å¤§å°** | < 30MB | Release ç‰ˆæœ¬ |

---

**æœ€åæ›´æ–°**: 2025-12-08  
**ç»´æŠ¤è€…**: æŠ€æœ¯å›¢é˜Ÿ  
**ç‰ˆæœ¬**: v2.0