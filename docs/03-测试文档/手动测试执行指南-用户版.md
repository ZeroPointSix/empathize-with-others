# 手动测试执行指南（用户版）

**目标用户**: 测试人员、开发人员  
**预计耗时**: 30-45 分钟  
**前置条件**: 有实际 Android 设备（Android 8.0+）

---

## 🎯 测试目标

完成任务 13 的手动测试，验证以下功能：
1. ✅ 微信兼容性（7 个测试用例）
2. ✅ 性能指标（内存、CPU、响应时间）
3. ✅ 错误处理（4 个场景）
4. ✅ Bug 修复验证（2 个已修复的问题）

---

## 📱 准备工作（10 分钟）

### 步骤 1: 准备设备

**需要的设备**:
- Android 手机或平板（Android 8.0 或更高）
- 建议使用 OPPO、小米、华为等主流品牌
- 至少 4GB RAM，2GB 可用存储

**连接设备**:
```bash
# 1. 开启开发者选项
# 设置 → 关于手机 → 连续点击"版本号" 7 次

# 2. 开启 USB 调试
# 设置 → 开发者选项 → USB 调试 → 开启

# 3. 连接电脑，确认设备
adb devices
# 应该看到你的设备列表
```

### 步骤 2: 安装应用

```bash
# 1. 清理并构建
./gradlew clean assembleDebug

# 2. 安装到设备
./gradlew installDebug

# 3. 确认安装成功
adb shell pm list packages | grep com.empathy.ai
# 应该看到: package:com.empathy.ai
```

### 步骤 3: 安装微信

**方式 1: 从应用商店安装**
- 打开 Google Play Store 或其他应用商店
- 搜索"微信"
- 安装最新版本（8.0.48）

**方式 2: 从 APK 安装**
- 从微信官网或 APKMirror 下载 APK
- 使用 `adb install wechat.apk` 安装

**注意**: 如果要测试多个版本，需要先卸载旧版本再安装新版本

### 步骤 4: 授予权限

**在设备上操作**:

1. **悬浮窗权限**
   ```
   设置 → 应用 → 共情 AI 助手 → 权限 → 显示在其他应用上层 → 允许
   ```

2. **网络权限**（通常自动授予）
   ```
   设置 → 应用 → 共情 AI 助手 → 权限 → 网络 → 允许
   ```

3. **前台服务权限**（通常自动授予）

**验证权限**:
```bash
# 查看应用权限
adb shell dumpsys package com.empathy.ai | grep permission
```

### 步骤 5: 配置 API Key

1. 打开共情 AI 助手
2. 进入"设置"页面
3. 选择 AI 服务商（推荐 DeepSeek）
4. 输入你的 API Key
5. 点击"测试连接"
6. 确认显示"✅ 连接成功"

**如果没有 API Key**:
- OpenAI: https://platform.openai.com/api-keys
- DeepSeek: https://platform.deepseek.com/api_keys
- Google: https://makersuite.google.com/app/apikey

### 步骤 6: 创建测试数据

1. 打开共情 AI 助手
2. 进入"联系人"页面
3. 点击"添加联系人"
4. 填写信息：
   - 姓名: "测试联系人"
   - 目标: "测试微信兼容性"
5. 添加事实信息：
   - 住址: "朝阳区"
   - 爱好: "钓鱼"
6. 添加雷区标签：
   - "不要提钱"
   - "不吃香菜"
7. 添加策略标签：
   - "多夸他衣品好"
8. 保存联系人

---

## 🧪 测试执行（25 分钟）

### 测试 1: 悬浮按钮显示（3 分钟）

**步骤**:
1. 打开共情 AI 助手
2. 进入"设置"页面
3. 打开"启用悬浮窗"开关
4. 确认通知栏显示"悬浮窗服务运行中"
5. 切换到微信
6. 进入任意聊天界面

**检查项**:
- [ ] 悬浮按钮是否显示？
- [ ] 悬浮按钮图标是否清晰？
- [ ] 悬浮按钮位置是否合理？
- [ ] 悬浮按钮是否遮挡重要内容？

**结果**: [ ] ✅ 通过 / [ ] ❌ 失败

**如果失败，记录问题**:
```
问题描述: ___________
截图: ___________
```

---

### 测试 2: 拖动和点击（5 分钟）

**步骤 A: 测试拖动**
1. 长按悬浮按钮（按住 1 秒）
2. 拖动到屏幕左上角
3. 松手
4. 拖动到屏幕右下角
5. 松手
6. 拖动到屏幕中间
7. 松手

**检查项**:
- [ ] 可以拖动悬浮按钮？
- [ ] 拖动时按钮跟随手指？
- [ ] 拖动流畅无卡顿？
- [ ] 松手后停留在当前位置？（不强制吸附）
- [ ] 可以将按钮放在任意位置？

**步骤 B: 测试点击**
1. 轻触悬浮按钮（不拖动）
2. 观察菜单是否展开
3. 再次点击悬浮按钮
4. 观察菜单是否收起

**检查项**:
- [ ] 点击响应迅速？（< 300ms）
- [ ] 菜单正常展开？
- [ ] 菜单正常收起？
- [ ] 显示"帮我分析"和"帮我检查"按钮？

**步骤 C: 测试菜单按钮**
1. 点击悬浮按钮展开菜单
2. 点击"💡 帮我分析"
3. 观察是否打开输入对话框
4. 关闭对话框
5. 再次展开菜单
6. 点击"🛡️ 帮我检查"
7. 观察是否打开输入对话框

**检查项**:
- [ ] "帮我分析"按钮正常工作？
- [ ] "帮我检查"按钮正常工作？
- [ ] 输入对话框正常显示？

**结果**: [ ] ✅ 通过 / [ ] ❌ 失败

**如果失败，记录问题**:
```
问题描述: ___________
截图: ___________
```

---

### 测试 3: 复制粘贴（3 分钟）

**步骤**:
1. 在微信中找到一个聊天对话
2. 长按一条消息
3. 选择"复制"
4. 点击悬浮按钮展开菜单
5. 点击"💡 帮我分析"
6. 在输入框中长按
7. 选择"粘贴"
8. 检查内容是否正确粘贴

**检查项**:
- [ ] 可以复制微信消息？
- [ ] 可以粘贴到输入框？
- [ ] 内容完整无误？
- [ ] 支持多行文本？
- [ ] 支持 emoji？
- [ ] 字符计数正确？

**测试超长文本**:
1. 复制一段超过 5000 字符的文本
2. 粘贴到输入框
3. 观察是否显示警告

**检查项**:
- [ ] 超过 5000 字符时显示警告？

**结果**: [ ] ✅ 通过 / [ ] ❌ 失败

---

### 测试 4: 后台切换（4 分钟）

**步骤 A: 切换到后台**
1. 在微信界面确认悬浮按钮显示
2. 按 Home 键返回桌面
3. 观察悬浮按钮是否仍然显示
4. 打开其他应用（如浏览器）
5. 观察悬浮按钮是否仍然显示

**检查项**:
- [ ] 切换到后台时悬浮按钮保持显示？
- [ ] 在其他应用中悬浮按钮仍然显示？

**步骤 B: 切换回微信**
1. 使用多任务切换或点击微信图标
2. 返回微信应用
3. 观察悬浮按钮是否仍然显示
4. 检查悬浮按钮位置是否保持不变

**检查项**:
- [ ] 切换回微信时悬浮按钮仍然显示？
- [ ] 悬浮按钮位置保持不变？

**步骤 C: 锁屏测试**
1. 在微信界面按电源键锁屏
2. 等待 5 秒
3. 解锁设备
4. 观察悬浮按钮是否仍然显示

**检查项**:
- [ ] 锁屏后解锁悬浮按钮仍然显示？

**步骤 D: 长时间后台**
1. 将微信切换到后台
2. 等待 5 分钟（可以做其他事情）
3. 切换回微信
4. 观察悬浮按钮是否仍然显示

**检查项**:
- [ ] 长时间后台后悬浮按钮仍然显示？
- [ ] 通知栏显示"悬浮窗服务运行中"？

**结果**: [ ] ✅ 通过 / [ ] ❌ 失败

---

### 测试 5: 性能测试（5 分钟）

**步骤 A: 内存占用**
1. 确保悬浮窗服务运行中
2. 在电脑上执行命令：
   ```bash
   adb shell dumpsys meminfo com.empathy.ai | grep "TOTAL"
   ```
3. 记录内存占用（单位: KB）
4. 转换为 MB（除以 1024）

**检查项**:
- 内存占用: _______ MB
- [ ] 内存占用 < 150MB？

**步骤 B: CPU 使用率**
1. 在电脑上执行命令：
   ```bash
   adb shell top -n 1 | grep com.empathy.ai
   ```
2. 记录 CPU 使用率（第 9 列）

**检查项**:
- CPU 使用率: _______ %
- [ ] CPU 使用率 < 10%？

**步骤 C: 响应时间**
1. 使用秒表或手机录屏
2. 点击悬浮按钮
3. 测量从点击到菜单展开的时间
4. 重复 3 次，取平均值

**检查项**:
- 点击响应时间: _______ ms
- [ ] 点击响应时间 < 300ms？

**步骤 D: 拖动帧率**
1. 开启开发者选项中的"显示 GPU 渲染模式分析"
   ```
   设置 → 开发者选项 → 监控 → GPU 渲染模式分析 → 在屏幕上显示为条形图
   ```
2. 拖动悬浮按钮
3. 观察 GPU 渲染图表
4. 确认绿色线（16ms 基准线）以下

**检查项**:
- [ ] 拖动时 GPU 渲染图表大部分在绿色线以下？
- [ ] 拖动流畅无卡顿？

**结果**: [ ] ✅ 通过 / [ ] ❌ 失败

---

### 测试 6: 错误处理（5 分钟）

**步骤 A: 权限错误**
1. 设置 → 应用 → 共情 AI 助手 → 权限 → 显示在其他应用上层 → 禁止
2. 打开共情 AI 助手
3. 设置 → 启用悬浮窗
4. 观察是否显示权限请求对话框

**检查项**:
- [ ] 显示权限请求对话框？
- [ ] 对话框说明权限用途？
- [ ] 点击"去设置"可以跳转到权限设置？

**恢复**: 重新授予悬浮窗权限

**步骤 B: 网络错误**
1. 开启飞行模式
2. 点击悬浮按钮 → 帮我分析
3. 选择联系人，输入文本
4. 点击"确认"
5. 观察错误提示

**检查项**:
- [ ] 显示网络错误提示？
- [ ] 提示信息清晰易懂？

**恢复**: 关闭飞行模式

**步骤 C: 输入验证**
1. 点击悬浮按钮 → 帮我分析
2. 不选择联系人，直接点击"确认"
3. 观察错误提示

**检查项**:
- [ ] 显示"请选择联系人"提示？

4. 选择联系人，不输入文本，点击"确认"
5. 观察错误提示

**检查项**:
- [ ] 显示"请输入内容"提示？

**步骤 D: 超时测试**（可选）
1. 如果有慢速网络环境，可以测试超时
2. 触发 AI 分析
3. 等待 10 秒以上
4. 观察是否显示超时提示

**检查项**:
- [ ] 10 秒后显示超时提示？

**结果**: [ ] ✅ 通过 / [ ] ❌ 失败

---

## ✅ Bug 修复验证（5 分钟）

### 验证 Bug WX-001: 悬浮按钮拖动

**问题**: 之前悬浮按钮无法拖动

**验证步骤**:
1. 长按悬浮按钮
2. 拖动到不同位置
3. 观察按钮是否跟随手指移动

**检查项**:
- [ ] 可以拖动悬浮按钮？
- [ ] 拖动时按钮跟随手指？
- [ ] 拖动流畅无卡顿？

**结果**: [ ] ✅ 已修复 / [ ] ❌ 仍存在问题

---

### 验证优化 WX-002: 自由放置

**问题**: 之前强制吸附到边缘，现在改为自由放置

**验证步骤**:
1. 拖动悬浮按钮到屏幕中间
2. 松手
3. 观察按钮是否停留在中间位置

**检查项**:
- [ ] 松手后停留在当前位置？
- [ ] 不强制吸附到边缘？
- [ ] 可以将按钮放在任意位置？

**结果**: [ ] ✅ 已优化 / [ ] ❌ 仍强制吸附

---

## 📊 测试结果汇总

### 测试用例统计

| 测试用例 | 结果 | 备注 |
|---------|------|------|
| 1. 悬浮按钮显示 | [ ] ✅ / [ ] ❌ | |
| 2. 拖动和点击 | [ ] ✅ / [ ] ❌ | |
| 3. 复制粘贴 | [ ] ✅ / [ ] ❌ | |
| 4. 后台切换 | [ ] ✅ / [ ] ❌ | |
| 5. 性能测试 | [ ] ✅ / [ ] ❌ | |
| 6. 错误处理 | [ ] ✅ / [ ] ❌ | |

**通过率**: ___/6 ( ___% )

### Bug 修复验证

| Bug 编号 | 结果 | 备注 |
|---------|------|------|
| WX-001 | [ ] ✅ / [ ] ❌ | 悬浮按钮拖动 |
| WX-002 | [ ] ✅ / [ ] ❌ | 自由放置 |

---

## 🐛 问题记录

### 发现的问题

如果测试中发现问题，请记录：

**问题 1**:
```
编号: ___________
严重程度: [ ] 高 / [ ] 中 / [ ] 低
测试用例: ___________
问题描述: ___________
复现步骤:
1. ___________
2. ___________
3. ___________
预期结果: ___________
实际结果: ___________
截图: ___________
```

**问题 2**:
```
[同上格式]
```

---

## 📝 提交测试报告

### 步骤 1: 更新测试报告

打开 `docs/03-测试文档/手动测试执行报告.md`，填写：
- 测试环境信息
- 测试结果
- 发现的问题
- 性能数据

### 步骤 2: 更新任务状态

如果所有测试通过：
- 在 `.kiro/specs/android-system-services/tasks.md` 中
- 将任务 13 标记为完成：`- [x] 13. 手动测试和 Bug 修复`

### 步骤 3: 创建 Bug 报告

如果发现新问题：
- 在 `docs/05-FixBug/` 目录创建新的 Bug 报告
- 使用格式：`[功能名称]Bug修复报告.md`
- 包含详细的问题描述和复现步骤

---

## 🎉 完成！

恭喜你完成了手动测试！

### 下一步

1. **如果所有测试通过**:
   - 继续任务 14（文档和代码审查）
   - 准备任务 15（最终验收）

2. **如果发现问题**:
   - 按优先级修复 Bug
   - 重新测试验证修复
   - 更新测试报告

3. **提交测试结果**:
   - 将测试报告提交到代码仓库
   - 通知团队测试完成情况

---

## 📚 参考文档

- `docs/03-测试文档/手动测试执行报告.md` - 详细测试报告
- `docs/03-测试文档/微信兼容性测试指南.md` - 完整测试指南
- `docs/05-FixBug/拖动功能快速验证指南.md` - Bug 修复验证

---

**文档创建**: 2025-12-07  
**维护者**: hushaokang  
**版本**: v1.0

