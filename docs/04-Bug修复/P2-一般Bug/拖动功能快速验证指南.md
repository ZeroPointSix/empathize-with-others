# 拖动功能快速验证指南

**目的**: 快速验证悬浮按钮拖动功能是否修复  
**预计时间**: 5 分钟

---

## 🚀 快速开始

### 1. 重新构建和安装（2 分钟）

```bash
# Windows CMD
gradlew assembleDebug
gradlew installDebug

# 或者使用 PowerShell
./gradlew assembleDebug
./gradlew installDebug
```

### 2. 启动悬浮窗服务（1 分钟）

1. 打开共情 AI 助手
2. 进入"设置"页面
3. 打开"启用悬浮窗"开关
4. 确认通知栏显示"悬浮窗服务运行中"

### 3. 测试拖动功能（2 分钟）

#### 测试 1: 基本拖动

1. 切换到微信应用
2. **长按**悬浮按钮（不要松手）
3. **拖动**到屏幕不同位置
4. **松手**

**预期结果**:
- ✅ 按钮跟随手指移动
- ✅ 拖动流畅无卡顿
- ✅ 松手后按钮停留在当前位置（不强制吸附）

#### 测试 2: 自由放置

1. 拖动按钮到屏幕**中间**
2. 松手
3. 观察按钮是否停留在**中间位置**

4. 拖动按钮到屏幕**任意位置**
5. 松手
6. 观察按钮是否停留在**当前位置**

**预期结果**:
- ✅ 松手后停留在当前位置（不吸附）
- ✅ 可以将按钮放在屏幕任意位置

#### 测试 3: 点击功能

1. **轻触**悬浮按钮（不拖动）
2. 观察菜单是否展开

**预期结果**:
- ✅ 菜单正常展开
- ✅ 点击功能不受影响

---

## ✅ 验证检查清单

### 拖动功能

- [ ] 可以拖动悬浮按钮
- [ ] 拖动时按钮跟随手指
- [ ] 拖动流畅无卡顿
- [ ] 可以拖动到屏幕任意位置

### 自由放置

- [ ] 松手后停留在当前位置
- [ ] 可以将按钮放在屏幕中间
- [ ] 可以将按钮放在任意位置
- [ ] 不会强制吸附到边缘

### 点击功能

- [ ] 轻触按钮可以展开菜单
- [ ] 点击"帮我分析"按钮正常
- [ ] 点击"帮我检查"按钮正常

---

## 🐛 如果还是无法拖动

### 检查步骤

1. **确认代码已更新**
   ```bash
   # 查看 FloatingView.kt 的修改时间
   git log -1 --format="%ai" -- app/src/main/java/com/empathy/ai/domain/util/FloatingView.kt
   ```

2. **清理并重新构建**
   ```bash
   gradlew clean
   gradlew assembleDebug
   gradlew installDebug
   ```

3. **重启设备**
   - 有时候需要重启设备才能生效

4. **检查权限**
   - 设置 → 应用 → 共情 AI 助手 → 权限
   - 确认"显示在其他应用上层"已授予

5. **查看日志**
   ```bash
   adb logcat | grep FloatingView
   ```
   
   查找以下日志：
   - "开始加载主布局"
   - "主布局加载成功"
   - "所有视图组件初始化成功"

---

## 📊 测试结果记录

### 测试环境

- **设备型号**: ___________
- **Android 版本**: ___________
- **微信版本**: ___________
- **测试日期**: ___________

### 测试结果

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 基本拖动 | [ ] 通过 / [ ] 失败 | |
| 自由放置（中间） | [ ] 通过 / [ ] 失败 | |
| 自由放置（任意位置） | [ ] 通过 / [ ] 失败 | |
| 点击功能 | [ ] 通过 / [ ] 失败 | |

### 问题记录

如果测试失败，请记录：

```
问题描述:
[在此描述问题]

复现步骤:
1. [步骤 1]
2. [步骤 2]
3. [步骤 3]

日志信息:
[粘贴相关日志]
```

---

## 🎯 下一步

### 如果测试通过

1. ✅ 标记 Bug WX-001 为已修复
2. ✅ 继续执行完整的微信兼容性测试
3. ✅ 更新测试检查清单

### 如果测试失败

1. ❌ 记录详细的问题信息
2. ❌ 收集日志和截图
3. ❌ 联系开发人员进一步诊断

---

**文档创建**: 2025-12-07  
**维护者**: hushaokang
