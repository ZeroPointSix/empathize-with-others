# BUG-00021 测试计划：悬浮窗UI布局修复

## 测试目标
验证修复后的悬浮窗在展示长文本内容时，底部的"复制"和"重新生成"按钮是否始终可见，且内容区域高度是否限制在合理范围内。

## 测试环境
- **设备**：Android 模拟器 / 真机
- **屏幕尺寸**：覆盖大屏 (Pixel 6 Pro) 和小屏 (Pixel 4a, Nexus 5)
- **字体大小**：默认字体 & 最大字体
- **显示大小**：默认 & 最大

## 测试用例

### TC-001: 长文本显示测试
**前置条件**：
1. 启动应用并开启悬浮窗权限。
2. 打开悬浮窗，切换到"分析"模式。

**步骤**：
1. 在输入框中粘贴一段超过 1000 字的长文本（或让AI生成长回复）。
2. 点击"分析"按钮，等待结果生成。

**预期结果**：
1. 结果卡片显示，包含"军师分析"和"话术建议"。
2. 内容区域出现滚动条，可以滚动查看全部内容。
3. **关键点**：底部的"复制"和"重新生成"按钮始终固定在悬浮窗底部，且在屏幕可见区域内，未被挤出屏幕。
4. 悬浮窗整体高度不超过屏幕高度的 80%（预留给键盘和标题栏）。

### TC-002: 软键盘交互测试
**前置条件**：同上。

**步骤**：
1. 生成分析结果后，点击顶部的输入框，唤起软键盘。
2. 观察悬浮窗布局变化。

**预期结果**：
1. 悬浮窗整体上移，避免被键盘遮挡（由WindowManager处理）。
2. 即使在键盘显示的情况下，如果空间足够，结果卡片仍保持最大高度限制。
3. 如果空间极其有限，操作按钮可能被遮挡（属预期行为，因为键盘优先级高），但在收起键盘后应立即恢复可见。

### TC-003: 润色/回复模式测试
**前置条件**：切换到"润色"或"回复"模式。

**步骤**：
1. 执行润色或回复操作，确保生成的内容较长。

**预期结果**：
1. 结果展示行为与 TC-001 一致。
2. 按钮始终可见。

## 验证方法
通过日志验证动态高度计算是否生效：
```
FloatingViewV2: showResult: 结果已显示，动态设置最大高度为 xxx px (屏幕高度 xxx px)
```
确认 `maxAllowedHeight` 约为 `screenHeight` 的 40%。
