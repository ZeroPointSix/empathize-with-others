# Project-wide Gradle settings.
# 编译优化配置 - 2025-12-21 更新
# 硬件: i7-13650HX (14核20线程) + 24GB RAM

# ============================================
# JVM 配置 (针对 24GB 内存优化)
# ============================================
org.gradle.java.home=C:\\Program Files\\Java\\jdk-17

# JVM 参数优化（针对24GB RAM和i7-13650HX优化）：
# - Xmx6g: 最大堆6GB（充分利用24GB内存）
# - Xms2g: 初始堆2GB，减少扩容开销
# - XX:+UseG1GC: G1垃圾收集器，大堆内存更高效
# - XX:MaxGCPauseMillis: 控制GC暂停时间
# - XX:+UseStringDeduplication: 字符串去重，节省内存
# 注意：移除了 Windows 不支持的 CGroupMemoryLimitForHeap 参数
org.gradle.jvmargs=-Xmx4g -Xms1g -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:MaxMetaspaceSize=1g -Dfile.encoding=UTF-8

# ============================================
# 并行构建优化 (针对 14核20线程)
# ============================================
# 启用并行编译
org.gradle.parallel=true

# 设置最大工作线程数（降低以减少内存压力）
org.gradle.workers.max=8

# 启用构建缓存
org.gradle.caching=true

# 按需配置 - 多模块项目建议启用
org.gradle.configureondemand=true

# 配置缓存 - 暂时禁用以解决构建问题
org.gradle.configuration-cache=false
org.gradle.configuration-cache.problems=warn

# Daemon 配置
org.gradle.daemon=true
org.gradle.daemon.idletimeout=10800000

# ============================================
# Kotlin 编译优化
# ============================================
kotlin.code.style=official
kotlin.incremental=true
kotlin.incremental.useClasspathSnapshot=true

# Kotlin 编译器守护进程 - 针对 AS 优化
kotlin.daemon.jvmargs=-Xmx2g -XX:+UseG1GC -XX:MaxGCPauseMillis=150

# K2 编译器在 Kotlin 2.0+ 中已是默认，无需显式启用

# Kotlin 增量编译优化
kotlin.compiler.execution.strategy=in-process
kotlin.incremental.android=true

# KAPT优化 - 减少KAPT编译时间
kapt.incremental.apt=true
kapt.use.worker.api=true
kapt.include.compile.classpath=false

# Android Studio 专用优化 (AGP 8.7.3 兼容)
# 注意：android.enableBuildCache 已在 AGP 7.0 废弃，8.0 移除
# 现在使用统一的 Gradle 构建缓存机制

# 模块依赖优化（AGP 8.x 兼容）
android.enableModuleDependencies=true

# R8 全模式优化
android.enableR8.fullMode=true

# ============================================
# Android 特定优化
# ============================================
android.useAndroidX=true
android.nonTransitiveRClass=true

# 禁用不必要的构建特性
android.defaults.buildfeatures.aidl=false
android.defaults.buildfeatures.renderscript=false

# R8 全模式
android.enableR8.fullMode=true

# R8 内存优化
org.gradle.workers.worker.heap=1g

# 启用 Jetifier 缓存
android.enableJetifier=false

# 预编译库缓存
org.gradle.dependency.verification=off

# ============================================
# 多模块构建优化 (TD-00017 Clean Architecture)
# ============================================
# 2025-12-24 更新 - 针对4模块架构优化

# 启用模块间增量编译
# 当一个模块变更时，只重新编译依赖它的模块
kotlin.incremental.multiplatform=true

# 启用精确的Java增量编译
# 减少不必要的重新编译
org.gradle.java.compile.incremental=true

# 启用Kotlin编译避免
# 如果模块的ABI没有变化，跳过依赖模块的重新编译
kotlin.build.report.output=file

# 启用Gradle文件系统监视
# 更快地检测文件变化
org.gradle.vfs.watch=true

# 启用Gradle文件系统快照
# 减少文件系统扫描开销
org.gradle.vfs.verbose=false

# 模块化构建说明:
# - :domain (纯Kotlin) - 无Android依赖，编译最快
# - :data (Android Library) - 依赖:domain
# - :presentation (Android Library) - 依赖:domain
# - :app (Application) - 依赖:domain, :data, :presentation

# ============================================
# Hilt 多模块配置
# ============================================
# 禁用Hilt聚合任务，解决多模块类加载问题
android.enableAggregatingTask=false

# ============================================
# 版本号配置 (TD-00024 图标和版本号自动更新)
# ============================================
# 2026-01-01 添加 - 支持自动版本更新

# 应用版本名称 (语义化版本)
APP_VERSION_NAME=1.5.0

# 应用版本代码 (major*10000 + minor*100 + patch)
APP_VERSION_CODE=10500

# 发布阶段 (dev/test/beta/production)
APP_RELEASE_STAGE=dev
