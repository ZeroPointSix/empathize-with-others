// å¼€å‘æ¨¡å¼é…ç½®æ–‡ä»¶
// ä½¿ç”¨æ–¹æ³•: ./gradlew -c dev.gradle assembleDebug
// æˆ–è€…é€šè¿‡å±æ€§å¼€å…³: ./gradlew -PdevMode assembleDebug

// é’ˆå¯¹å¼€å‘æ¨¡å¼çš„ç¼–è¯‘ä¼˜åŒ–
android {
    buildTypes {
        debug {
            // ç¦ç”¨ä¸å¿…è¦çš„æ„å»ºåŠŸèƒ½ï¼ŒåŠ é€Ÿç¼–è¯‘
            ext.enableCrashlytics = false
            crunchPngs = false

            // æ›´å¿«çš„Dexé€‰é¡¹
            dexOptions {
                preDexLibraries = true
                maxProcessCount = 8
                javaMaxHeapSize = "2g"
            }
        }
    }

    // ç¦ç”¨ä¸éœ€è¦çš„æ„å»ºç‰¹æ€§ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
    buildFeatures {
        buildConfig = false
        aidl = false
        renderScript = false
        resValues = false
        shaders = false
    }

    // æµ‹è¯•ä¼˜åŒ–ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
    testOptions {
        unitTests.all {
            // å¼€å‘æ¨¡å¼ä¸‹å¯ä»¥è·³è¿‡éƒ¨åˆ†æµ‹è¯•ä»¥åŠ é€Ÿç¼–è¯‘
            if (project.hasProperty("devMode")) {
                enabled = false
            }
        }
    }
}

// ä¾èµ–è§£æä¼˜åŒ–ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
configurations.all {
    resolutionStrategy {
        cacheDynamicVersionsFor 10, 'seconds'
        cacheChangingModulesFor 10, 'seconds'
    }
}

// ä»»åŠ¡ä¼˜åŒ–
tasks.whenTaskAdded { task ->
    // å¼€å‘æ¨¡å¼ä¸‹è·³è¿‡æŸäº›è€—æ—¶ä»»åŠ¡
    if (project.hasProperty("devMode")) {
        when {
            task.name.startsWith('test') && !task.name.contains('Release') -> {
                task.enabled = false
            }
            task.name.startsWith('lint') -> {
                task.enabled = false
            }
            task.name.contains('Test') -> {
                task.enabled = false
            }
        }
    }
}

println "ğŸš€ å¼€å‘æ¨¡å¼é…ç½®å·²åº”ç”¨ - ç¼–è¯‘é€Ÿåº¦ä¼˜åŒ–æ¨¡å¼"
if (project.hasProperty("devMode")) {
    println "âš¡  å¼€å‘æ¨¡å¼å·²å¯ç”¨ - è·³è¿‡æµ‹è¯•å’ŒLintæ£€æŸ¥"
}