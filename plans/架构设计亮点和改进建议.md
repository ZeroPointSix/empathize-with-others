# æ¶æ„è®¾è®¡äº®ç‚¹å’Œæ”¹è¿›å»ºè®®

## 1. æ¶æ„è®¾è®¡äº®ç‚¹

### 1.1 æŠ€æœ¯æ¶æ„äº®ç‚¹

#### ğŸ”¥ åˆ›æ–°æ€§è®¾è®¡
1. **ä¸‰å±‚AIå“åº”è§£æç­–ç•¥**
   - **Function Callingä¼˜å…ˆ**: æœ€å¯é çš„å¼ºåˆ¶ç»“æ„åŒ–è¾“å‡º
   - **response_formatå…œåº•**: JSONæ ¼å¼å¼ºåˆ¶çº¦æŸ
   - **æ™ºèƒ½å­—æ®µæ˜ å°„**: å…¼å®¹éæ ‡å‡†AIå“åº”æ ¼å¼
   - **è‡ªé€‚åº”é™çº§**: å½“æ ‡å‡†è§£æå¤±è´¥æ—¶çš„æ™ºèƒ½é™çº§å¤„ç†

2. **æ‚¬æµ®çª—æœ€å°åŒ–ç³»ç»Ÿ**
   - **çŠ¶æ€æŒä¹…åŒ–**: åº”ç”¨é‡å¯åæ¢å¤æœªå®Œæˆè¯·æ±‚
   - **æ™ºèƒ½æŒ‡ç¤ºå™¨**: ä¸åŒçŠ¶æ€çš„è§†è§‰åé¦ˆ
   - **è‡ªåŠ¨æ¸…ç†**: å®šæ—¶æ¸…ç†å·²å®ŒæˆæŒ‡ç¤ºå™¨
   - **é€šçŸ¥é›†æˆ**: å®Œæˆåç³»ç»Ÿé€šçŸ¥

3. **å¤šæœåŠ¡å•†åŠ¨æ€é€‚é…**
   - **ç»Ÿä¸€æ¥å£**: æŠ½è±¡AIæœåŠ¡å•†å·®å¼‚
   - **è¿è¡Œæ—¶åˆ‡æ¢**: æ— éœ€é‡å¯åº”ç”¨
   - **å…¼å®¹æ€§æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«æœåŠ¡å•†èƒ½åŠ›
   - **åŠ¨æ€è¶…æ—¶**: æ ¹æ®æœåŠ¡å•†ç‰¹æ€§è°ƒæ•´

#### ğŸ—ï¸ æ¶æ„è´¨é‡äº®ç‚¹

1. **ä¸¥æ ¼çš„Clean Architectureå®ç°**
   - **å±‚æ¬¡åˆ†æ˜**: Presentationâ†’Domainâ†’Dataæ¸…æ™°åˆ†ç¦»
   - **ä¾èµ–å€’ç½®**: é«˜å±‚ä¸ä¾èµ–ä½å±‚å…·ä½“å®ç°
   - **æ¥å£éš”ç¦»**: é¢†åŸŸå±‚ä¸ä¾èµ–æ•°æ®å±‚å®ç°
   - **å•ä¸€èŒè´£**: æ¯ä¸ªç±»èŒè´£æ˜ç¡®ä¸”å•ä¸€

2. **å“åº”å¼ç¼–ç¨‹å…¨é¢åº”ç”¨**
   - **StateFlowç®¡ç†**: UIçŠ¶æ€å“åº”å¼æ›´æ–°
   - **äº‹ä»¶é©±åŠ¨**: UiEventç»Ÿä¸€å¤„ç†ç”¨æˆ·äº¤äº’
   - **åç¨‹ä¼˜åŒ–**: åˆç†ä½¿ç”¨Dispatchersåˆ‡æ¢çº¿ç¨‹
   - **èƒŒå‹å¤„ç†**: FlowèƒŒå‹åˆç†å¤„ç†

3. **ç°ä»£åŒ–æŠ€æœ¯æ ˆåº”ç”¨**
   - **Jetpack Compose**: å£°æ˜å¼UIæ¡†æ¶
   - **Hiltä¾èµ–æ³¨å…¥**: ç¼–è¯‘æ—¶ä¾èµ–æ³¨å…¥
   - **Roomæ•°æ®åº“**: ç±»å‹å®‰å…¨çš„ORM
   - **Retrofitç½‘ç»œ**: ç±»å‹å®‰å…¨çš„HTTPå®¢æˆ·ç«¯

### 1.2 ç”¨æˆ·ä½“éªŒäº®ç‚¹

#### ğŸ¨ UI/UXè®¾è®¡åˆ›æ–°
1. **Material Design 3**: ç°ä»£åŒ–è®¾è®¡è¯­è¨€
2. **æ·±è‰²æ¨¡å¼é€‚é…**: å®Œæ•´çš„ä¸»é¢˜ç³»ç»Ÿ
3. **å“åº”å¼å¸ƒå±€**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸
4. **æ— éšœç¢æ”¯æŒ**: è¯­ä¹‰åŒ–UIç»„ä»¶
5. **å¾®äº¤äº’è®¾è®¡**: ç»†è…»çš„åŠ¨ç”»å’Œåé¦ˆ

#### ğŸ”’ éšç§ä¿æŠ¤è®¾è®¡
1. **å¤šå±‚éšç§ä¿æŠ¤**: 
   - æ•°æ®è„±æ•å¼•æ“
   - API KeyåŠ å¯†å­˜å‚¨
   - éšç§è§„åˆ™æ˜ å°„
2. **ç”¨æˆ·æ§åˆ¶**: ç”¨æˆ·å®Œå…¨æ§åˆ¶éšç§è®¾ç½®
3. **é€æ˜åº¦**: æ¸…æ™°çš„éšç§æ”¿ç­–è¯´æ˜

#### âš¡ æ€§èƒ½ä¼˜åŒ–äº®ç‚¹
1. **æ™ºèƒ½ç¼“å­˜ç­–ç•¥**: å‡å°‘é‡å¤è®¡ç®—
2. **å†…å­˜ç›‘æ§**: å®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨
3. **æ‡’åŠ è½½ä¼˜åŒ–**: æŒ‰éœ€åŠ è½½æ•°æ®
4. **ç¡¬ä»¶åŠ é€Ÿ**: UIæ¸²æŸ“ç¡¬ä»¶åŠ é€Ÿ

## 2. æ”¹è¿›å»ºè®®

### 2.1 æ¶æ„å±‚é¢æ”¹è¿›

#### ğŸ”„ å¼•å…¥äº‹ä»¶é©±åŠ¨æ¶æ„
**å½“å‰é—®é¢˜**:
- æ¨¡å—é—´è€¦åˆåº¦è¾ƒé«˜
- è·¨æ¨¡å—é€šä¿¡å¤æ‚

**æ”¹è¿›æ–¹æ¡ˆ**:
```kotlin
// å¼•å…¥é¢†åŸŸäº‹ä»¶
sealed class DomainEvent {
    data class ContactUpdated(val contactId: String) : DomainEvent()
    data class AnalysisCompleted(val result: AnalysisResult) : DomainEvent()
    data class PrivacySettingsChanged(val settings: PrivacySettings) : DomainEvent()
}

// äº‹ä»¶æ€»çº¿
interface EventBus {
    fun publish(event: DomainEvent)
    fun subscribe(eventType: KClass<out DomainEvent>): Flow<DomainEvent>
}
```

**æ”¶ç›Š**:
- é™ä½æ¨¡å—è€¦åˆåº¦
- æé«˜ä»£ç å¯æµ‹è¯•æ€§
- æ”¯æŒæ’ä»¶åŒ–æ‰©å±•

#### ğŸ“¦ å¢åŠ ç¼“å­˜å±‚
**å½“å‰é—®é¢˜**:
- ç½‘ç»œè¯·æ±‚é¢‘ç¹
- å“åº”æ—¶é—´è¾ƒé•¿

**æ”¹è¿›æ–¹æ¡ˆ**:
```kotlin
// ç¼“å­˜æ¥å£
interface Cache<K, V> {
    suspend fun get(key: K): V?
    suspend fun put(key: K, value: V, ttl: Duration)
    suspend fun invalidate(key: K)
    suspend fun clear()
}

// å¤šå±‚ç¼“å­˜ç­–ç•¥
class MultiLevelCache<T> : Cache<String, T> {
    private val memoryCache = LruCache<String, T>(100)
    private val diskCache = DiskCache<T>()
    
    override suspend fun get(key: String): T? {
        return memoryCache.get(key) ?: diskCache.get(key)
    }
}
```

**æ”¶ç›Š**:
- å‡å°‘ç½‘ç»œè¯·æ±‚
- æé«˜å“åº”é€Ÿåº¦
- æ”¯æŒç¦»çº¿æ¨¡å¼

#### ğŸ§© çŠ¶æ€æœºå¼•å…¥
**å½“å‰é—®é¢˜**:
- å¤æ‚çŠ¶æ€ç®¡ç†å›°éš¾
- çŠ¶æ€è½¬æ¢é€»è¾‘åˆ†æ•£

**æ”¹è¿›æ–¹æ¡ˆ**:
```kotlin
// çŠ¶æ€æœºå®šä¹‰
sealed class FloatingWindowState {
    object Hidden : FloatingWindowState()
    data class DialogVisible(val type: DialogType) : FloatingWindowState()
    data class Minimized(val requestInfo: RequestInfo) : FloatingWindowState()
    data class Processing(val progress: Float) : FloatingWindowState()
}

// çŠ¶æ€æœº
class FloatingWindowStateMachine {
    private val currentState = MutableStateFlow<FloatingWindowState>(FloatingWindowState.Hidden)
    
    fun transition(event: FloatingWindowEvent) {
        currentState.value = when (currentState.value) {
            is FloatingWindowState.Hidden -> handleHiddenState(event)
            is FloatingWindowState.DialogVisible -> handleDialogState(event)
            // ...
        }
    }
}
```

**æ”¶ç›Š**:
- çŠ¶æ€ç®¡ç†æ›´æ¸…æ™°
- å‡å°‘çŠ¶æ€é”™è¯¯
- æé«˜å¯ç»´æŠ¤æ€§

### 2.2 ä»£ç è´¨é‡æ”¹è¿›

#### ğŸ”§ å‡å°‘é‡å¤ä»£ç 
**å½“å‰é—®é¢˜**:
- Repositoryå®ç°å­˜åœ¨é‡å¤é€»è¾‘
- é”™è¯¯å¤„ç†ä»£ç é‡å¤

**æ”¹è¿›æ–¹æ¡ˆ**:
```kotlin
// æŠ½è±¡åŸºç¡€Repository
abstract class BaseRepository<T> {
    protected suspend fun <R> executeWithRetry(
        operation: suspend () -> R
        maxRetries: Int = 3
    ): Result<R> {
        repeat(maxRetries) { attempt ->
            try {
                return Result.success(operation())
            } catch (e: Exception) {
                if (attempt == maxRetries - 1) throw e
                delay(calculateBackoff(attempt))
            }
        }
    }
}

// ç»Ÿä¸€é”™è¯¯å¤„ç†
object ErrorHandler {
    fun handleApiError(throwable: Throwable): Result.Error {
        return when (throwable) {
            is HttpException -> handleHttpError(throwable)
            is IOException -> handleNetworkError(throwable)
            else -> Result.Error(throwable.message ?: "æœªçŸ¥é”™è¯¯")
        }
    }
}
```

**æ”¶ç›Š**:
- å‡å°‘ä»£ç é‡å¤
- æé«˜ä¸€è‡´æ€§
- ä¾¿äºç»´æŠ¤å’Œæµ‹è¯•

#### ğŸ›¡ï¸ å¢å¼ºç±»å‹å®‰å…¨
**å½“å‰é—®é¢˜**:
- è¿è¡Œæ—¶ç±»å‹é”™è¯¯
- ç©ºæŒ‡é’ˆå¼‚å¸¸

**æ”¹è¿›æ–¹æ¡ˆ**:
```kotlin
// ä½¿ç”¨å¯†å°ç±»å’Œç±»å‹ç³»ç»Ÿ
sealed class ApiResult<out T> {
    data class Success<T>(val data: T) : ApiResult<T>()
    data class Error(val exception: ApiException) : ApiResult<Nothing>()
}

// å†…è”ç±»ä¼˜åŒ–
@JvmInlineValue
data class UserId(val value: String)

// éç©ºç±»å‹
typealias NonEmptyString = String
```

**æ”¶ç›Š**:
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
- å‡å°‘è¿è¡Œæ—¶å¼‚å¸¸
- æé«˜ä»£ç å¥å£®æ€§

### 2.3 æ€§èƒ½ä¼˜åŒ–æ”¹è¿›

#### âš¡ å†…å­˜ä¼˜åŒ–
**å½“å‰é—®é¢˜**:
- å¤§å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸å½“
- å†…å­˜æ³„æ¼é£é™©

**æ”¹è¿›æ–¹æ¡ˆ**:
```kotlin
// å¼±å¼•ç”¨ç®¡ç†
class WeakReferenceManager<T> {
    private val weakRefs = mutableListOf<WeakReference<T>>()
    
    fun add(obj: T) {
        weakRefs.add(WeakReference(obj))
        cleanup()
    }
    
    private fun cleanup() {
        weakRefs.removeAll { it.get() == null }
    }
}

// å¯¹è±¡æ± 
class ObjectPool<T> private constructor(
    private val factory: () -> T,
    private val maxSize: Int = 50
) {
    private val pool = ConcurrentLinkedQueue<T>()
    private val currentSize = AtomicInteger(0)
    
    fun acquire(): T {
        return pool.poll() ?: factory().also { 
            if (currentSize.incrementAndGet() > maxSize) {
                // è§¦å‘GCå»ºè®®
                System.gc()
            }
        }
    }
    
    fun release(obj: T) {
        if (pool.size < maxSize) {
            pool.offer(obj)
            currentSize.decrementAndGet()
        }
    }
}
```

**æ”¶ç›Š**:
- å‡å°‘å†…å­˜å ç”¨
- é¿å…å†…å­˜æ³„æ¼
- æé«˜åº”ç”¨ç¨³å®šæ€§

#### ğŸŒ ç½‘ç»œä¼˜åŒ–
**å½“å‰é—®é¢˜**:
- ç½‘ç»œè¯·æ±‚ä¸²è¡Œ
- ç¼ºä¹è¯·æ±‚åˆå¹¶

**æ”¹è¿›æ–¹æ¡ˆ**:
```kotlin
// è¯·æ±‚åˆå¹¶å™¨
class RequestBatcher<T> {
    private val pendingRequests = mutableListOf<T>()
    private val batchJob = SupervisorJob()
    
    suspend fun addRequest(request: T): T {
        return withContext(Dispatchers.IO) {
            val deferred = CompletableDeferred<T>()
            pendingRequests.add(request to deferred)
            
            // æ‰¹é‡å¤„ç†
            if (pendingRequests.size >= BATCH_SIZE) {
                processBatch()
            }
            
            deferred.await()
        }
    }
}

// æ™ºèƒ½é‡è¯•
class SmartRetryPolicy {
    fun calculateDelay(attempt: Int, exception: Throwable): Duration {
        return when (exception) {
            is TimeoutException -> Duration.ofSeconds(2.0.pow(attempt))
            is NetworkException -> Duration.ofMillis(1000 * attempt)
            else -> Duration.ofSeconds(1)
        }
    }
}
```

**æ”¶ç›Š**:
- å‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°
- æé«˜å“åº”é€Ÿåº¦
- æ›´å¥½çš„é”™è¯¯å¤„ç†

### 2.4 æ‰©å±•æ€§æ”¹è¿›

#### ğŸ”Œ æ’ä»¶åŒ–æ¶æ„
**å½“å‰é—®é¢˜**:
- AIæœåŠ¡å•†ç¡¬ç¼–ç 
- åŠŸèƒ½æ‰©å±•å›°éš¾

**æ”¹è¿›æ–¹æ¡ˆ**:
```kotlin
// æ’ä»¶æ¥å£
interface AiProviderPlugin {
    val id: String
    val name: String
    val supportedModels: List<String>
    
    suspend fun analyze(prompt: String): Result<AnalysisResult>
    suspend fun checkSafety(draft: String): Result<SafetyCheckResult>
}

// æ’ä»¶ç®¡ç†å™¨
class PluginManager {
    private val plugins = mutableMapOf<String, AiProviderPlugin>()
    
    fun loadPlugin(pluginPath: String): Result<AiProviderPlugin> {
        return try {
            val plugin = loadPluginClass(pluginPath)
            plugins[plugin.id] = plugin
            Result.success(plugin)
        } catch (e: Exception) {
            Result.failure(e)
        }
    }
}
```

**æ”¶ç›Š**:
- æ”¯æŒåŠ¨æ€åŠ è½½AIæœåŠ¡å•†
- ä¾¿äºç¬¬ä¸‰æ–¹æ‰©å±•
- é™ä½ç»´æŠ¤æˆæœ¬

#### ğŸ“Š ç›‘æ§å’Œåˆ†æ
**å½“å‰é—®é¢˜**:
- ç¼ºä¹æ€§èƒ½ç›‘æ§
- ç”¨æˆ·è¡Œä¸ºåˆ†æä¸è¶³

**æ”¹è¿›æ–¹æ¡ˆ**:
```kotlin
// æ€§èƒ½ç›‘æ§
class PerformanceMonitor {
    data class Metrics(
        val cpuUsage: Float,
        val memoryUsage: Long,
        val networkLatency: Duration,
        val uiFrameRate: Float
    )
    
    fun startMonitoring(): Flow<Metrics>
    fun recordUserAction(action: UserAction)
    fun generateReport(): PerformanceReport
}

// ç”¨æˆ·è¡Œä¸ºåˆ†æ
class UserAnalytics {
    data class UserEvent(
        val type: String,
        val timestamp: Instant,
        val properties: Map<String, Any>
    )
    
    fun trackEvent(event: UserEvent)
    fun getUserBehaviorReport(): BehaviorReport
}
```

**æ”¶ç›Š**:
- å®æ—¶æ€§èƒ½ç›‘æ§
- ç”¨æˆ·è¡Œä¸ºæ´å¯Ÿ
- æ•°æ®é©±åŠ¨ä¼˜åŒ–

## 3. å®æ–½ä¼˜å…ˆçº§å»ºè®®

### ğŸš€ é«˜ä¼˜å…ˆçº§ (ç«‹å³å®æ–½)
1. **å¼•å…¥ç¼“å­˜å±‚** - æ˜¾è‘—æå‡å“åº”é€Ÿåº¦
2. **å‡å°‘é‡å¤ä»£ç ** - æé«˜ä»£ç è´¨é‡
3. **å¢å¼ºé”™è¯¯å¤„ç†** - æé«˜åº”ç”¨ç¨³å®šæ€§

### ğŸ”¥ ä¸­ä¼˜å…ˆçº§ (çŸ­æœŸå®æ–½)
1. **çŠ¶æ€æœºé‡æ„** - æ”¹å–„å¤æ‚çŠ¶æ€ç®¡ç†
2. **å†…å­˜ä¼˜åŒ–** - å‡å°‘å†…å­˜é—®é¢˜
3. **ç½‘ç»œä¼˜åŒ–** - æå‡ç½‘ç»œæ€§èƒ½

### ğŸ“ˆ ä½ä¼˜å…ˆçº§ (é•¿æœŸè§„åˆ’)
1. **æ’ä»¶åŒ–æ¶æ„** - æ”¯æŒç”Ÿæ€æ‰©å±•
2. **ç›‘æ§ä½“ç³»** - æ•°æ®é©±åŠ¨ä¼˜åŒ–
3. **äº‹ä»¶é©±åŠ¨æ¶æ„** - é™ä½æ¨¡å—è€¦åˆ

## 4. æ€»ç»“

è¯¥é¡¹ç›®åœ¨æ¶æ„è®¾è®¡ä¸Šå±•ç°äº†ç°ä»£Androidå¼€å‘çš„æœ€ä½³å®è·µï¼Œç‰¹åˆ«æ˜¯åœ¨AIé›†æˆã€æ‚¬æµ®çª—ç³»ç»Ÿå’Œéšç§ä¿æŠ¤æ–¹é¢æœ‰åˆ›æ–°è®¾è®¡ã€‚é€šè¿‡å®æ–½ä¸Šè¿°æ”¹è¿›å»ºè®®ï¼Œå¯ä»¥è¿›ä¸€æ­¥æå‡ä»£ç è´¨é‡ã€æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ï¼Œä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å¥ å®šåšå®åŸºç¡€ã€‚

å…³é”®æ”¹è¿›æ–¹å‘ï¼š
1. **æ¶æ„æ¼”è¿›**: ä»Clean Architectureå‘äº‹ä»¶é©±åŠ¨æ¶æ„æ¼”è¿›
2. **æ€§èƒ½ä¼˜åŒ–**: å¤šå±‚æ¬¡çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
3. **æ‰©å±•æ€§**: æ’ä»¶åŒ–æ¶æ„æ”¯æŒç”Ÿæ€å‘å±•
4. **è´¨é‡ä¿è¯**: æ›´å¼ºçš„ç±»å‹å®‰å…¨å’Œé”™è¯¯å¤„ç†