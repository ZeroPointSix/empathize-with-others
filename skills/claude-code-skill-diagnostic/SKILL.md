---
name: claude-code-skill-diagnostic
description: Claude Code Skill 安装故障诊断与修复技能 - 自动诊断和修复 Claude Code 技能安装问题,包括环境检查、文件搜索、配置验证、权限修复等完整流程。
category: debugging
---

# Claude Code Skill 安装故障诊断与修复

## 激活时机

当满足以下条件时自动激活此技能：
- Claude Code 技能无法正常加载
- 技能安装后无法在设置中显示
- 技能无法触发或执行时报错
- 需要验证技能配置是否正确
- 技能文件位置未知需要定位

## 诊断流程

### 1. 全环境检查
**目的**：确认 Claude Code 环境和系统状态

检查项：
- Claude Code 版本和运行状态
- 当前用户名和主目录路径
- 系统权限状态（是否有读写权限）
- 网络连接状态（如果需要在线资源）

### 2. 全面搜索技能位置
**目的**：找到所有可能的技能文件位置

搜索位置：
- 主目录：`/Users/[当前用户名]/`
- 官方目录：`~/.claude/plugins/marketplaces/`
- 配置目录：`~/.config/claude/`
- 用户目录：`~/Documents/Claude/Skills/`
- 下载目录：`~/Downloads/`
- 桌面目录：`~/Desktop/`
- 搜索命令：`find ~ -name "*.md" -path "*skill*" -o -name "skill.md" 2>/dev/null`

### 3. 安装流程回溯检查

#### 3.1 目录创建检查
对每个找到的技能目录，检查：
- 目录权限是否正确（755）
- 目录结构是否符合标准
- 是否包含必要的子目录

#### 3.2 文件编写检查
对每个 `SKILL.md` 或 `skill.md` 文件，验证：
- YAML 头部格式是否完全正确
- name 字段是否存在且 ≤64 字符
- description 字段是否存在且 ≤200 字符
- 文件编码是否为 UTF-8
- 文件权限是否正确（644）
- 内容结构是否完整

#### 3.3 配置修改检查
检查 Claude Code 相关配置：
- 设置文件中的技能注册状态
- 技能启用状态
- 配置文件格式是否正确

#### 3.4 系统注册检查
验证技能是否正确注册：
- 技能在设置界面是否可见
- 技能描述是否正确显示
- 技能状态是否为启用

#### 3.5 技能使用检查
测试技能功能：
- 技能是否能正常触发
- 返回结果是否符合预期
- 是否有错误信息

### 4. 常见问题专项检查
**目的**：检查最常见的问题类型

- YAML 语法错误（使用在线 YAML 验证器）
- 特殊字符或编码问题
- 文件名大小写问题
- 路径中的空格或特殊字符
- 权限不足问题
- 缓存问题

### 5. 环境兼容性检查
**目的**：检查系统兼容性

- 操作系统版本兼容性
- Python 环境依赖（如果有脚本）
- 必要的系统工具是否可用

### 6. 网络和资源检查
**目的**：检查外部资源依赖

- 如果技能依赖在线资源，检查网络连接
- 检查 resources 目录中的文件是否完整
- 验证外部依赖的可用性

### 7. 日志和错误信息分析
**目的**：分析系统日志和错误信息

- Claude Code 日志文件
- 系统错误日志
- 技能执行时的错误输出

### 8. 修复建议和方案
**目的**：提供具体的修复方案

基于以上检查结果：
1. 列出所有发现的问题
2. 按优先级排序问题
3. 提供详细的修复步骤
4. 如果需要，提供修复后的完整代码

## 执行原则

**重要说明**：
- 你是一个执行 agent，不仅要诊断问题，还要**立即修复**每个发现的问题
- 使用系统命令（`ls`, `cat`, `find`, `chmod`, `mkdir`等）来**实际操作文件**，而不仅仅是检查
- 对每个步骤执行完毕后，立即输出结果和采取的行动
- 最后生成一份**修复清单**说明你发现了什么问题以及如何修复的

## 输出模板

详见 `templates/diagnostic-report-template.md`

## 常见问题速查表

| 问题类型 | 可能原因 | 修复方法 |
|---------|---------|---------|
| 技能不显示 | YAML 格式错误 | 检查并修正 YAML 头部 |
| 权限错误 | 文件权限不正确 | 执行 `chmod 644 skill.md` |
| 编码问题 | 文件编码非 UTF-8 | 转换为 UTF-8 编码 |
| 路径错误 | 技能目录位置错误 | 移动到正确目录 |
| 缓存问题 | 旧缓存未清理 | 重启 Claude Code |

## 相关资源

- 官方文档：https://support.claude.com/en/articles/12512198-how-to-create-custom-skills
- `templates/diagnostic-report-template.md` - 诊断报告模板

---

**技能状态**: 完成 ✅
**适用环境**: macOS, Linux, Windows (WSL)
**诊断耗时**: 3-10分钟/次（取决于问题复杂度）
**更新日期**: 2025-12-26
