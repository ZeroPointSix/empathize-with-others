# 决策日志指南 (Decision Journal Guide)

> ⚠️ **所有探索智能体必须遵守本规范**
> 
> 这是多智能体系统的核心学习机制。即使任务失败，决策日志也是宝贵的知识资产。

---

## 核心理念

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                                                                              ║
║  🧠 决策日志的价值                                                            ║
║                                                                              ║
║  ┌────────────────────────────────────────────────────────────────────────┐  ║
║  │                                                                        │  ║
║  │   能力较弱的智能体可能无法完成复杂任务                                    │  ║
║  │   但他们的探索过程、遇到的问题、做出的决策                                │  ║
║  │   都是后续智能体和人类开发者的宝贵学习资料                                │  ║
║  │                                                                        │  ║
║  │   失败的任务 + 详细的决策日志 > 成功的任务 + 空白的记录                   │  ║
║  │                                                                        │  ║
║  └────────────────────────────────────────────────────────────────────────┘  ║
║                                                                              ║
║  📝 记录一切，学习一切，传承一切                                              ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

---

## 什么是决策日志？

决策日志是智能体在执行任务过程中**实时维护**的文档，记录：

1. **遇到的问题** - 什么阻碍了进展？
2. **考虑的方案** - 想到了哪些解决方案？
3. **做出的决策** - 最终选择了哪个方案？
4. **决策理由** - 为什么选择这个方案？
5. **放弃的方案** - 其他方案为什么不选？
6. **学到的教训** - 从这个过程中学到了什么？

---

## 为什么需要决策日志？

### 问题场景

```
智能体执行复杂任务
    │
    ├─► 第1次尝试：失败
    ├─► 第2次尝试：失败
    ├─► 第3次尝试：部分成功
    ├─► 第4次尝试：遇到新问题
    └─► 第5次尝试：时间/上下文耗尽
    │
    ▼
最终报告：可能遗漏了中间的关键信息
```

### 没有决策日志的后果

- ❌ 中间遇到的问题被遗忘
- ❌ 尝试过但失败的方案没有记录
- ❌ 为什么做某个决策的理由丢失
- ❌ 后续智能体可能重复同样的错误
- ❌ 人类开发者无法理解探索过程

### 有决策日志的好处

- ✅ 所有问题都有记录，可以追溯
- ✅ 失败的方案也是宝贵的经验
- ✅ 决策理由清晰，便于审查
- ✅ 后续智能体可以学习避免重复错误
- ✅ 人类开发者可以快速理解探索过程

---

## 决策日志文件位置

每个探索任务都应该在工作目录创建决策日志：

```
探索工作树/
├── DECISION_JOURNAL.md    ← 决策日志（必须创建）
├── 其他代码文件...
└── ...
```

或者在报告目录：

```
文档/开发文档/MA/
├── BUGFIX/
│   ├── BUGFIX-20241230-xxx.md           ← 最终报告
│   └── BUGFIX-20241230-xxx-JOURNAL.md   ← 决策日志
├── FEATURE/
│   ├── FEATURE-20241230-xxx.md
│   └── FEATURE-20241230-xxx-JOURNAL.md
└── ...
```

---

## 决策日志模板

```markdown
# 决策日志 (Decision Journal)

## 基本信息

| 项目 | 内容 |
|------|------|
| 任务 | [任务描述] |
| 日期 | YYYY-MM-DD |
| 智能体 | [智能体名称] |
| 分支 | [分支名称] |

---

## 📋 决策记录

### 决策 #1: [决策标题]

**时间**: HH:MM

**遇到的问题**:
[详细描述遇到了什么问题，什么阻碍了进展]

**考虑的方案**:

| 方案 | 描述 | 优点 | 缺点 |
|------|------|------|------|
| A | [方案A描述] | [优点] | [缺点] |
| B | [方案B描述] | [优点] | [缺点] |
| C | [方案C描述] | [优点] | [缺点] |

**最终决策**: 选择方案 [X]

**决策理由**:
[详细解释为什么选择这个方案，不少于3句话]

**放弃其他方案的原因**:
- 方案A: [为什么不选]
- 方案B: [为什么不选]

**预期结果**:
[预期这个决策会带来什么结果]

**实际结果**:
[执行后的实际结果，成功/失败/部分成功]

**学到的教训**:
[从这个决策中学到了什么]

---

### 决策 #2: [决策标题]

[同上格式...]

---

## 🚧 遇到的问题清单

| # | 问题描述 | 严重程度 | 是否解决 | 解决方案/备注 |
|---|---------|---------|---------|--------------|
| 1 | [问题1] | 高/中/低 | ✅/❌/⚠️ | [方案或备注] |
| 2 | [问题2] | 高/中/低 | ✅/❌/⚠️ | [方案或备注] |

---

## 💡 关键洞察

### 洞察 #1: [洞察标题]
**发现时间**: HH:MM
**内容**: [详细描述这个洞察]
**价值**: [这个洞察对后续工作有什么价值]

### 洞察 #2: [洞察标题]
[同上格式...]

---

## ⚠️ 未解决的问题

| # | 问题描述 | 尝试过的方案 | 建议的下一步 |
|---|---------|-------------|-------------|
| 1 | [问题1] | [尝试过什么] | [建议怎么做] |
| 2 | [问题2] | [尝试过什么] | [建议怎么做] |

---

## 📊 时间线

| 时间 | 事件 | 结果 |
|------|------|------|
| HH:MM | 开始任务 | - |
| HH:MM | [事件1] | ✅/❌ |
| HH:MM | [事件2] | ✅/❌ |
| HH:MM | [事件3] | ✅/❌ |
| HH:MM | 结束任务 | [最终状态] |

---

## 📝 给后续智能体的建议

### 如果继续这个任务

1. [建议1]
2. [建议2]
3. [建议3]

### 应该避免的坑

1. [坑1]: [为什么要避免]
2. [坑2]: [为什么要避免]

### 推荐的方向

1. [方向1]: [为什么推荐]
2. [方向2]: [为什么推荐]
```

---

## 何时更新决策日志？

### 必须记录的时刻

1. **遇到问题时** - 立即记录问题描述
2. **做出决策时** - 记录决策和理由
3. **尝试失败时** - 记录失败原因和教训
4. **发现新信息时** - 记录洞察
5. **改变方向时** - 记录为什么改变

### 更新频率

- **最低要求**: 每30分钟至少更新一次
- **推荐频率**: 每个重要决策点都更新
- **理想状态**: 实时记录思考过程

---

## 决策日志的质量标准

### ✅ 高质量决策日志

```markdown
### 决策 #3: 选择使用 Result 包装返回值

**时间**: 14:35

**遇到的问题**:
在修复 ContactRepository.getById() 的空值问题时，我发现直接返回 null 会导致
调用方容易遗漏空值检查。需要找到一种方式强制调用方处理"联系人不存在"的情况。

**考虑的方案**:

| 方案 | 描述 | 优点 | 缺点 |
|------|------|------|------|
| A | 返回 Contact? | 简单，不需要改接口 | 调用方容易忘记检查 null |
| B | 抛出异常 | 强制处理 | 不符合项目规范，异常应该用于异常情况 |
| C | 返回 Result<Contact> | 符合项目规范，强制处理 | 需要修改接口和所有调用方 |

**最终决策**: 选择方案 C (返回 Result<Contact>)

**决策理由**:
1. 项目规范要求所有 UseCase 返回 Result，Repository 也应该保持一致
2. Result 类型在编译期就强制调用方处理成功和失败两种情况
3. 可以携带更丰富的错误信息，比如区分"不存在"和"数据库错误"

**放弃其他方案的原因**:
- 方案A: 虽然简单，但这正是导致当前 Bug 的原因，不能重蹈覆辙
- 方案B: 项目中异常只用于真正的异常情况，"联系人不存在"是正常的业务场景

**预期结果**:
修改后，所有调用 getById 的地方都必须处理 Result，编译器会强制检查

**实际结果**:
✅ 成功。修改后发现有3处调用需要更新，编译器都给出了提示，没有遗漏。

**学到的教训**:
1. 返回类型的设计很重要，好的类型设计可以在编译期防止错误
2. 修改接口虽然工作量大，但比到处添加 null 检查更可靠
3. 项目规范（返回 Result）是有道理的，应该遵循
```

### ❌ 低质量决策日志

```markdown
### 决策 #3: 用 Result

选择了 Result。
```

**问题**:
- 没有说明遇到什么问题
- 没有列出考虑的其他方案
- 没有解释为什么选择这个方案
- 没有记录学到的教训

---

## 决策日志与最终报告的关系

```
决策日志 (实时记录)          最终报告 (总结提炼)
        │                           │
        │  ┌─────────────────────┐  │
        │  │                     │  │
        ├──┤  决策日志是原始素材  ├──┤
        │  │  最终报告是提炼总结  │  │
        │  │                     │  │
        │  └─────────────────────┘  │
        │                           │
        ▼                           ▼
  详细、实时、完整            精炼、结构化、可操作
  记录所有思考过程            突出关键发现和建议
  包含失败的尝试              聚焦成功的方案
  给后续智能体参考            给人类审查者参考
```

### 两者都需要

- **决策日志**: 给后续智能体和深入研究者
- **最终报告**: 给人类审查者和快速决策者

---

## 决策日志的传承机制

### 场景：智能体 A 未完成任务，智能体 B 接手

```
智能体 A 的决策日志
        │
        ├─► 遇到的问题清单
        ├─► 尝试过的方案
        ├─► 失败的原因
        └─► 给后续智能体的建议
        │
        ▼
智能体 B 接手时
        │
        ├─► 首先阅读决策日志
        ├─► 了解已经尝试过什么
        ├─► 避免重复同样的错误
        └─► 从建议的方向继续
```

### 接手任务时的必读清单

1. **DECISION_JOURNAL.md** - 了解探索过程
2. **未解决的问题** - 知道还有什么问题
3. **给后续智能体的建议** - 获取前人的智慧
4. **应该避免的坑** - 不要重蹈覆辙

---

## 与 LEARNINGS.md 的关系

| 文件 | 范围 | 内容 | 更新时机 |
|------|------|------|---------|
| DECISION_JOURNAL.md | 单次任务 | 详细的决策过程 | 实时更新 |
| LEARNINGS.md | 跨任务 | 经过验证的通用经验 | 任务完成后提炼 |

### 从决策日志到 LEARNINGS.md

```
决策日志中的教训
        │
        ├─► 是否经过验证？
        │       │
        │       ├─► 是 → 提炼到 LEARNINGS.md
        │       └─► 否 → 保留在决策日志，标记"待验证"
        │
        └─► 是否具有通用性？
                │
                ├─► 是 → 提炼到 LEARNINGS.md
                └─► 否 → 保留在决策日志
```

---

## 总结

**决策日志是多智能体系统的"记忆"**

- 它记录了每个智能体的思考过程
- 它保存了失败的尝试和学到的教训
- 它让后续智能体可以站在前人的肩膀上
- 它让人类开发者可以理解 AI 的决策过程

**记住**：

```
即使任务失败，详细的决策日志也是成功
因为它为后续的成功铺平了道路
```
