---
æ ‡é¢˜: å®ä½“è®¾è®¡
ç‰ˆæœ¬: v2.0
åˆ›å»ºæ—¥æœŸ: 2025-12-08
æœ€åæ›´æ–°: 2025-12-08
æ›´æ–°äºº: AI Assistant
çŠ¶æ€: æ´»è·ƒ
æ ‡ç­¾: [é¢†åŸŸå±‚è®¾è®¡, å®ä½“è®¾è®¡, æ•°æ®æ¨¡å‹]
ç›¸å…³æ–‡æ¡£: [ä»“å‚¨æ¥å£è®¾è®¡.md, ä¸šåŠ¡é€»è¾‘è®¾è®¡.md, ../æ•°æ®å±‚è®¾è®¡/README.md]
---

# å®ä½“è®¾è®¡

---

## ğŸ“‹ æ ¸å¿ƒæ•°æ®èµ„äº§

åœ¨ MVP é˜¶æ®µï¼Œä¸šåŠ¡å±‚åªç»´æŠ¤ä¸¤å¼ "è¡¨"çš„æ•°æ®é€»è¾‘ï¼š

- **è¡¨ Aï¼šè”ç³»äººç”»åƒ (`ContactProfile`)**
- **è¡¨ Bï¼šç­–ç•¥é”¦å›Š (`BrainTag`)**

---

## ğŸ‘¤ 1. è”ç³»äººç”»åƒ (ContactProfile)

è¿™æ˜¯ä½ çš„æ ¸å¿ƒ"è§’è‰²å¡"ã€‚æˆ‘ä»¬å°†æ‰€æœ‰é›¶ç¢çš„äº‹å®ä¿¡æ¯ï¼ˆä½å€ã€çˆ±å¥½ã€æ€§æ ¼ï¼‰éƒ½ç»Ÿä¸€æ”¾å…¥ `facts` å­—å…¸ä¸­ï¼Œæ–¹ä¾¿åç»­ç›´æ¥éå†æ‹¼æ¥åˆ° Prompt é‡Œã€‚

```kotlin
package com.empathy.ai.domain.model

data class ContactProfile(
    // å”¯ä¸€æ ‡è¯† (é€šå¸¸ä¸º UUID æˆ– å¾®ä¿¡/QQ çš„åŠ å¯† ID)
    val id: String,

    // æ˜¾ç¤ºåç§° (e.g., "ç‹æ€»", "æé“æŸ±")
    val name: String,

    // æ ¸å¿ƒæ”»ç•¥ç›®æ ‡ (è¿™ä¸€æ®µå…³ç³»çš„ç»ˆæç›®çš„ï¼Œe.g., "æ‹¿ä¸‹åˆåŒ", "ä¿®å¤çˆ¶å­å…³ç³»")
    val targetGoal: String,

    // ä¸Šä¸‹æ–‡è¯»å–æ·±åº¦ (é…ç½®é¡¹ï¼šæ¯æ¬¡åˆ†æè¯»å–æœ€è¿‘å¤šå°‘æ¡è®°å½•ï¼Œé»˜è®¤ä¸º 10)
    val contextDepth: Int = 10,

    // ã€æ ¸å¿ƒäº‹å®æ§½ã€‘
    // å­˜å‚¨æ‰€æœ‰äº‹å®ç±»ä¿¡æ¯ï¼Œæ›¿ä»£æ­»æ¿çš„å­—æ®µã€‚
    // AI æˆ–ç”¨æˆ·æå–çš„ä¿¡æ¯éƒ½å­˜è¿™é‡Œï¼Œå‘é€æ—¶ç›´æ¥æ‹¼æ¥ã€‚
    // ç»“æ„ç¤ºä¾‹: {"ç”µè¯": "138...", "ä½å€": "æœé˜³åŒº", "æ€§æ ¼": "åƒè½¯ä¸åƒç¡¬", "çˆ±å¥½": "é’“é±¼"}
    val facts: Map<String, String> = emptyMap()
)
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `id` | String | å”¯ä¸€æ ‡è¯†ç¬¦ | "uuid-1234-5678" |
| `name` | String | æ˜¾ç¤ºåç§° | "ç‹æ€»" |
| `targetGoal` | String | æ”»ç•¥ç›®æ ‡ | "æ‹¿ä¸‹åˆåŒ" |
| `contextDepth` | Int | ä¸Šä¸‹æ–‡æ·±åº¦ | 10 |
| `facts` | Map<String, String> | äº‹å®ä¿¡æ¯å­—å…¸ | {"çˆ±å¥½": "é’“é±¼", "ä½å€": "æœé˜³åŒº"} |

---

## ğŸ·ï¸ 2. ç­–ç•¥æ ‡ç­¾ (BrainTag)

è¿™æ˜¯ AI çš„"å†›å¸ˆé”¦å›Š"ã€‚è¿™é‡Œåªå­˜å‚¨å¯¹å†³ç­–æœ‰ç›´æ¥å½±å“çš„**ä¸»è§‚ç­–ç•¥**ï¼ˆé›·åŒºæˆ–å»ºè®®ï¼‰ï¼Œä¸å†å­˜å‚¨å®¢è§‚äº‹å®ã€‚

```kotlin
package com.empathy.ai.domain.model

// æ ‡ç­¾ç±»å‹å®šä¹‰
enum class TagType {
    RISK_RED,       // ã€é›·åŒº/è­¦å‘Šã€‘ï¼šç»å¯¹ä¸èƒ½è¸©çš„ç‚¹ (e.g., "ä¸è¦æä»–å‰å¦»", "å¿Œè®³è¿Ÿåˆ°")
    STRATEGY_GREEN  // ã€é‡ç‚¹/ç­–ç•¥ã€‘ï¼šå»ºè®®åˆ‡å…¥çš„ç‚¹ (e.g., "å¤šå¤¸ä»–è¡£å“å¥½", "èŠå®¶åº­")
}

data class BrainTag(
    // æ•°æ®åº“è‡ªå¢ ID
    val id: Long = 0,

    // å¤–é”®ï¼šå…³è”åˆ°å“ªä¸ªè”ç³»äºº
    val contactId: String,

    // æ ‡ç­¾å†…å®¹ (e.g., "ä¸å–œæ¬¢åƒé¦™èœ")
    val content: String,

    // ç±»å‹ï¼šé›·åŒº(Red) æˆ– ç­–ç•¥(Green)
    val type: TagType,

    // æ¥æºæ ‡è®°ï¼šç”¨äºåŒºåˆ†æ•°æ®æƒé‡
    // "MANUAL" = ç”¨æˆ·æ‰‹åŠ¨æ·»åŠ  (é«˜æƒé‡ï¼ŒAI ä¸å¯ç¯¡æ”¹)
    // "AI_INFERRED" = AI ä»èŠå¤©è®°å½•åˆ†æå¾—å‡º (ä½æƒé‡ï¼Œç”¨æˆ·å¯ç¡®è®¤è½¬æ­£)
    val source: String = "MANUAL",

    // ç½®ä¿¡åº¦ (0.0 - 1.0)
    val confidence: Float = 1.0f,

    // åˆ›å»ºæ—¶é—´æˆ³
    val createdAt: Long = System.currentTimeMillis()
)
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `id` | Long | æ•°æ®åº“ä¸»é”® | 123 |
| `contactId` | String | è”ç³»äººID | "uuid-1234" |
| `content` | String | æ ‡ç­¾å†…å®¹ | "ä¸è¦æå€Ÿé’±" |
| `type` | TagType | æ ‡ç­¾ç±»å‹ | RISK_RED |
| `source` | String | æ•°æ®æ¥æº | "MANUAL" |
| `confidence` | Float | ç½®ä¿¡åº¦ | 0.95f |
| `createdAt` | Long | åˆ›å»ºæ—¶é—´ | 1703123456789 |

---

## ğŸ’¬ 3. èŠå¤©æ¶ˆæ¯ (ChatMessage)

è¿™æ˜¯æœ€åŸºç¡€çš„ä¸Šä¸‹æ–‡å•å…ƒã€‚å»æ‰äº†å¤šåª’ä½“è·¯å¾„ï¼Œåªä¿ç•™çº¯æ–‡æœ¬å†…å®¹ï¼ˆè§†é¢‘/è¯­éŸ³è½¬æ–‡å­—åçš„ç»“æœï¼‰ã€‚

```kotlin
package com.empathy.ai.domain.model

// å‘é€è€…æšä¸¾
enum class MessageSender { 
    ME,    // æˆ‘å‘çš„
    THEM   // å¯¹æ–¹å‘çš„
}

data class ChatMessage(
    // æ¶ˆæ¯å”¯ä¸€ ID
    val id: String,

    // å†…å®¹æ ¸å¿ƒï¼šæ— è®ºæ˜¯æ–‡æœ¬æ¶ˆæ¯ï¼Œè¿˜æ˜¯è¯­éŸ³è½¬å½•/OCR åçš„æ–‡å­—ï¼Œéƒ½å­˜è¿™é‡Œ
    // AI åªæ¶ˆè´¹è¿™ä¸ªå­—æ®µ
    val content: String,

    // å‘é€è€…
    val sender: MessageSender,

    // æ—¶é—´æˆ³ (ç”¨äºæ’åºï¼Œä¿è¯ä¸Šä¸‹æ–‡é¡ºåºæ­£ç¡®)
    val timestamp: Long
)
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `id` | String | æ¶ˆæ¯å”¯ä¸€ID | "msg-1234" |
| `content` | String | æ¶ˆæ¯å†…å®¹ | "ä»Šå¤©å¤©æ°”ä¸é”™" |
| `sender` | MessageSender | å‘é€è€… | ME |
| `timestamp` | Long | æ—¶é—´æˆ³ | 1703123456789 |

---

## ğŸ“Š 4. åˆ†æç»“æœ (AnalysisResult)

è¿™æ˜¯ AI è®¡ç®—åçš„è¾“å‡ºï¼Œç›´æ¥ç”¨äº UI å±•ç¤ºã€‚

```kotlin
package com.empathy.ai.domain.model

// é£é™©ç­‰çº§æšä¸¾
enum class RiskLevel { 
    SAFE,    // å®‰å…¨
    WARNING, // è­¦å‘Š (æœ‰è½»å¾®ä¸å¦¥)
    DANGER   // å±é™© (è¸©é›·äº†)
}

data class AnalysisResult(
    // è¯æœ¯å»ºè®®ï¼šAI ç”Ÿæˆçš„å¯ä»¥ç›´æ¥å‘é€çš„å›å¤æ–‡æœ¬
    val replySuggestion: String,

    // å†›å¸ˆåˆ†æï¼šAI å¯¹å½“å‰å±€åŠ¿çš„å¿ƒç†åˆ†æ (ç»™ç”¨æˆ·çœ‹çš„)
    val strategyAnalysis: String,

    // é£é™©ç­‰çº§ï¼šç”¨äº UI æ˜¾ç¤ºçº¢/é»„/ç»¿é¢œè‰²
    val riskLevel: RiskLevel,

    // è§¦å‘çš„é£é™©æ ‡ç­¾åˆ—è¡¨ (ç”¨äºè¯¦ç»†åé¦ˆ)
    val triggeredRisks: List<String> = emptyList(),

    // å»ºè®®çš„ç½®ä¿¡åº¦
    val confidence: Float = 0.0f,

    // åˆ†ææ—¶é—´æˆ³
    val timestamp: Long = System.currentTimeMillis()
)
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `replySuggestion` | String | å»ºè®®å›å¤ | "å¯ä»¥èŠèŠé’“é±¼çš„è¯é¢˜" |
| `strategyAnalysis` | String | ç­–ç•¥åˆ†æ | "å¯¹æ–¹æƒ…ç»ªä½è½ï¼Œéœ€è¦å®‰æ…°" |
| `riskLevel` | RiskLevel | é£é™©ç­‰çº§ | WARNING |
| `triggeredRisks` | List<String> | è§¦å‘é£é™© | ["å€Ÿé’±", "å‰ä»»"] |
| `confidence` | Float | ç½®ä¿¡åº¦ | 0.85f |
| `timestamp` | Long | åˆ†ææ—¶é—´ | 1703123456789 |

---

## ğŸ” 5. å®‰å…¨æ£€æŸ¥ç»“æœ (SafetyCheckResult)

ç”¨äºé£æ§æ£€æŸ¥çš„è¯¦ç»†ç»“æœï¼Œæ”¯æŒå…·ä½“çš„åé¦ˆä¿¡æ¯ã€‚

```kotlin
package com.empathy.ai.domain.model

data class SafetyCheckResult(
    // æ˜¯å¦é€šè¿‡æ£€æŸ¥ (UI æ ¹æ®æ­¤å­—æ®µå†³å®šæ˜¯å¦å˜çº¢æ¡†)
    val isSafe: Boolean,

    // è§¦å‘äº†å“ªäº›å…·ä½“çš„é›·åŒºè§„åˆ™ (ç”¨äº UI Toast æç¤ºï¼š"æ£€æµ‹åˆ°æ‚¨æåˆ°äº†'å‰ä»»'")
    val triggeredRisks: List<String> = emptyList(),

    // ç®€çŸ­çš„ä¿®æ­£å»ºè®® (å¯é€‰)
    val suggestion: String? = null,

    // æ£€æŸ¥æ—¶é—´æˆ³
    val timestamp: Long = System.currentTimeMillis()
)
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `isSafe` | Boolean | æ˜¯å¦å®‰å…¨ | false |
| `triggeredRisks` | List<String> | è§¦å‘é£é™© | ["å€Ÿé’±", "å‰ä»»"] |
| `suggestion` | String? | ä¿®æ­£å»ºè®® | "å»ºè®®é¿å…æ•æ„Ÿè¯é¢˜" |
| `timestamp` | Long | æ£€æŸ¥æ—¶é—´ | 1703123456789 |

---

## ğŸ“ 6. åª’ä½“è½¬å½•ç»“æœ (TranscriptionResult)

ç”¨äºå¤šæ¨¡æ€æ•°æ®å¤„ç†çš„è½¬å½•ç»“æœã€‚

```kotlin
package com.empathy.ai.domain.model

// åª’ä½“ç±»å‹
enum class MediaType {
    AUDIO,  // éŸ³é¢‘æ–‡ä»¶
    VIDEO   // è§†é¢‘æ–‡ä»¶
}

data class TranscriptionResult(
    // åŸå§‹æ–‡ä»¶è·¯å¾„
    val sourcePath: String,

    // åª’ä½“ç±»å‹
    val mediaType: MediaType,

    // è½¬å½•åçš„æ–‡æœ¬å†…å®¹
    val transcribedText: String,

    // å¤„ç†è€—æ—¶ (æ¯«ç§’)
    val processingTimeMs: Long,

    // æ˜¯å¦æˆåŠŸ
    val isSuccess: Boolean,

    // é”™è¯¯ä¿¡æ¯ (å¦‚æœå¤±è´¥)
    val errorMessage: String? = null,

    // å¤„ç†æ—¶é—´æˆ³
    val timestamp: Long = System.currentTimeMillis()
)
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `sourcePath` | String | åŸå§‹æ–‡ä»¶è·¯å¾„ | "/path/to/audio.mp3" |
| `mediaType` | MediaType | åª’ä½“ç±»å‹ | AUDIO |
| `transcribedText` | String | è½¬å½•æ–‡æœ¬ | "ä»Šå¤©å¤©æ°”ä¸é”™" |
| `processingTimeMs` | Long | å¤„ç†è€—æ—¶ | 5000 |
| `isSuccess` | Boolean | æ˜¯å¦æˆåŠŸ | true |
| `errorMessage` | String? | é”™è¯¯ä¿¡æ¯ | null |
| `timestamp` | Long | å¤„ç†æ—¶é—´ | 1703123456789 |

---

## ğŸ”— å®ä½“å…³ç³»å›¾

```
ContactProfile (1) â”€â”€â”€â”€ (N) BrainTag
     â”‚
     â”‚ (1:N)
     â–¼
ChatMessage (N)
     â”‚
     â–¼
AnalysisResult (N)
```

### å…³ç³»è¯´æ˜

1. **ContactProfile â†’ BrainTag**: ä¸€å¯¹å¤šå…³ç³»
   - ä¸€ä¸ªè”ç³»äººå¯ä»¥æœ‰å¤šä¸ªç­–ç•¥æ ‡ç­¾
   - é€šè¿‡ `contactId` å¤–é”®å…³è”

2. **ContactProfile â†’ ChatMessage**: ä¸€å¯¹å¤šå…³ç³»
   - ä¸€ä¸ªè”ç³»äººå¯¹åº”å¤šæ¡èŠå¤©æ¶ˆæ¯
   - ç”¨äºæ„å»ºä¸Šä¸‹æ–‡

3. **ChatMessage â†’ AnalysisResult**: ä¸€å¯¹å¤šå…³ç³»
   - ä¸€æ¬¡åˆ†æå¯ä»¥åŸºäºå¤šæ¡æ¶ˆæ¯
   - åˆ†æç»“æœå…³è”åˆ°ç‰¹å®šçš„æ¶ˆæ¯ä¸Šä¸‹æ–‡

---

## ğŸ“Š æ•°æ®çº¦æŸä¸éªŒè¯

### ContactProfile çº¦æŸ

- `id`: ä¸èƒ½ä¸ºç©ºï¼Œå¿…é¡»å”¯ä¸€
- `name`: ä¸èƒ½ä¸ºç©ºï¼Œé•¿åº¦é™åˆ¶ 1-50 å­—ç¬¦
- `targetGoal`: ä¸èƒ½ä¸ºç©ºï¼Œé•¿åº¦é™åˆ¶ 1-200 å­—ç¬¦
- `contextDepth`: å¿…é¡»åœ¨ 1-100 ä¹‹é—´

### BrainTag çº¦æŸ

- `contactId`: ä¸èƒ½ä¸ºç©ºï¼Œå¿…é¡»å¯¹åº”æœ‰æ•ˆçš„ ContactProfile
- `content`: ä¸èƒ½ä¸ºç©ºï¼Œé•¿åº¦é™åˆ¶ 1-200 å­—ç¬¦
- `type`: å¿…é¡»ä¸ºæœ‰æ•ˆçš„ TagType æšä¸¾å€¼
- `source`: å¿…é¡»ä¸º "MANUAL" æˆ– "AI_INFERRED"
- `confidence`: å¿…é¡»åœ¨ 0.0-1.0 ä¹‹é—´

### ChatMessage çº¦æŸ

- `id`: ä¸èƒ½ä¸ºç©ºï¼Œå¿…é¡»å”¯ä¸€
- `content`: ä¸èƒ½ä¸ºç©ºï¼Œé•¿åº¦é™åˆ¶ 1-1000 å­—ç¬¦
- `sender`: å¿…é¡»ä¸ºæœ‰æ•ˆçš„ MessageSender æšä¸¾å€¼
- `timestamp`: å¿…é¡»ä¸ºæœ‰æ•ˆçš„æ—¶é—´æˆ³

---

## ğŸ”„ æ•°æ®ç”Ÿå‘½å‘¨æœŸ

### åˆ›å»ºæµç¨‹

1. **ContactProfile**: ç”¨æˆ·æ‰‹åŠ¨åˆ›å»ºè”ç³»äººæ—¶
2. **BrainTag**: ç”¨æˆ·æ‰‹åŠ¨æ·»åŠ æˆ– AI åˆ†æç”Ÿæˆæ—¶
3. **ChatMessage**: ä»å±å¹•æŠ“å–æˆ–ç”¨æˆ·è¾“å…¥æ—¶
4. **AnalysisResult**: AI åˆ†æå®Œæˆåè‡ªåŠ¨ç”Ÿæˆ

### æ›´æ–°æµç¨‹

1. **ContactProfile**: ç”¨æˆ·æ›´æ–°ä¿¡æ¯æˆ– AI æå–æ–°äº‹å®æ—¶
2. **BrainTag**: ç”¨æˆ·ä¿®æ”¹æ ‡ç­¾å†…å®¹æˆ– AI æ›´æ–°ç½®ä¿¡åº¦æ—¶
3. **ChatMessage**: é€šå¸¸ä¸å¯å˜ï¼Œä»…ç”¨äºå†å²è®°å½•
4. **AnalysisResult**: é‡æ–°åˆ†ææ—¶ç”Ÿæˆæ–°è®°å½•

### åˆ é™¤æµç¨‹

1. **ContactProfile**: åˆ é™¤è”ç³»äººæ—¶çº§è”åˆ é™¤ç›¸å…³æ•°æ®
2. **BrainTag**: ç”¨æˆ·æ‰‹åŠ¨åˆ é™¤ä¸å‡†ç¡®æ ‡ç­¾æ—¶
3. **ChatMessage**: æ ¹æ®é…ç½®è‡ªåŠ¨æ¸…ç†è¿‡æœŸè®°å½•
4. **AnalysisResult**: æ ¹æ®é…ç½®è‡ªåŠ¨æ¸…ç†è¿‡æœŸè®°å½•

---

**æœ€åæ›´æ–°**: 2025-12-08  
**ç»´æŠ¤è€…**: é¢†åŸŸæ¨¡å‹å›¢é˜Ÿ  
**ç‰ˆæœ¬**: v2.0