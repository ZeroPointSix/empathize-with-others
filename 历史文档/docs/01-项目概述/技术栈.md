---
标题: 技术栈
版本: v1.0
创建日期: 2025-12-08
最后更新: 2025-12-08
更新人: AI Assistant
状态: 活跃
标签: [项目概述, 技术栈, 架构]
相关文档: [项目简介.md, 开发路线图.md, ../02-架构设计/README.md]
---

# 技术栈

---

## 🏗️ 技术架构

### 架构模式

**Clean Architecture + MVVM**

```
┌─────────────────────────────────────────┐
│         Presentation Layer              │
│  (UI, ViewModel, Service)               │
│  - Jetpack Compose                      │
│  - FloatingWindowService                │
│  - AccessibilityService                 │
└──────────────┬──────────────────────────┘
               │
┌──────────────▼──────────────────────────┐
│          Domain Layer                   │
│  (纯业务逻辑，无 Android 依赖)          │
│  - UseCase (AnalyzeChat, CheckDraft)    │
│  - Repository Interface                 │
│  - Business Models                      │
└──────────────┬──────────────────────────┘
               │
┌──────────────▼──────────────────────────┐
│           Data Layer                    │
│  (数据获取与持久化)                     │
│  - Room Database                        │
│  - Retrofit (AI API)                    │
│  - EncryptedSharedPreferences           │
└─────────────────────────────────────────┘
```

---

## 📋 技术选型

### 核心技术栈

| 类别 | 技术 | 版本 | 用途 |
|------|------|------|------|
| **语言** | Kotlin | 2.0.21 | 主开发语言 |
| **UI** | Jetpack Compose | 2024.12.01 | 声明式 UI |
| **架构** | Hilt | 2.52 | 依赖注入 |
| **数据库** | Room | 2.6.1 | 本地存储 |
| **网络** | Retrofit + OkHttp | 2.11.0 / 4.12.0 | AI API 调用 |
| **JSON** | Moshi | 1.15.1 | JSON 解析 |
| **协程** | Kotlin Coroutines | 1.9.0 | 异步处理 |
| **安全** | Security Crypto | 1.1.0-alpha06 | 加密存储 |
| **测试** | JUnit + Mockk | 4.13.2 / 1.13.13 | 单元测试 |

---

### 开发工具

| 工具 | 版本 | 用途 |
|------|------|------|
| **Android Studio** | 最新版 | IDE 开发环境 |
| **Gradle** | 8.13 | 构建工具 |
| **JDK** | 17 | Java 运行环境 |
| **Git** | 最新版 | 版本控制 |
| **ADB** | 1.0.41 | Android 调试 |

---

## 🔧 架构设计原则

### 1. Clean Architecture 分层

**Presentation Layer (表现层)**:
- 负责 UI 展示和用户交互
- 包含 ViewModel、UI 组件和导航
- 处理 Android 特定逻辑

**Domain Layer (领域层)**:
- 纯业务逻辑，无 Android 依赖
- 包含 UseCase、Repository 接口和业务模型
- 可独立测试，易于维护

**Data Layer (数据层)**:
- 负责数据获取和持久化
- 包含 Repository 实现、数据库和网络请求
- 处理具体技术实现

---

### 2. MVVM 模式

**Model**:
- 数据模型和业务逻辑
- Repository 接口定义

**View**:
- Jetpack Compose UI 组件
- 响应式状态展示

**ViewModel**:
- 连接 Model 和 View
- 处理 UI 状态和业务逻辑

---

### 3. 依赖注入

使用 Hilt 进行依赖注入：
- 简化依赖管理
- 提高代码可测试性
- 支持作用域管理

---

## 📁 项目结构

### 源代码结构

```
app/src/main/java/com/empathy/ai/
├── app/
│   └── EmpathyApplication.kt       # Application 入口
├── domain/                          # ✅ 已完成
│   ├── model/                       # 数据模型 (5 个)
│   ├── repository/                  # 接口定义 (5 个)
│   ├── usecase/                     # 业务用例 (3 个)
│   └── service/                     # 领域服务 (1 个)
├── data/                            # ✅ 已完成
│   ├── local/                       # Room 数据库
│   ├── remote/                      # Retrofit API
│   └── repository/                  # 实现类
├── presentation/                    # ✅ 已完成
│   ├── ui/                          # Compose UI
│   ├── viewmodel/                   # ViewModel
│   ├── theme/                       # 主题
│   └── service/                     # Android Service
└── di/                              # ✅ 已完成
    └── modules/                     # Hilt 模块
```

---

## 🔐 安全技术

### 1. 数据加密

**EncryptedSharedPreferences**:
- API Key 安全存储
- 硬件级加密 (Android Keystore)
- 自动密钥管理

**数据库加密**:
- Room 数据库加密
- 敏感字段额外加密
- 备份排除机制

---

### 2. 隐私保护

**强制脱敏引擎**:
```kotlin
object PrivacyEngine {
    fun mask(text: String, mapping: Map<String, String>): String
    fun maskBatch(texts: List<String>, mapping: Map<String, String>): List<String>
}
```

**零后端架构**:
- 所有数据本地处理
- 无用户账户体系
- 自备 API Key (BYOK)

---

## 🧪 测试技术

### 单元测试

**测试框架**:
- JUnit 4.13.2 - 测试运行器
- Mockk 1.13.13 - Mock 框架
- Coroutines Test - 协程测试

**测试覆盖**:
- Domain Layer: 100%
- UseCase: 100%
- Repository 接口: 100%

---

### 集成测试

**测试策略**:
- 黑盒测试指南
- 端到端测试场景
- 性能基准测试

---

## 📱 Android 特定技术

### 1. Jetpack 组件

**Compose**:
- 声明式 UI 开发
- Material Design 3
- 响应式状态管理

**Navigation**:
- 类型安全导航
- NavGraph 配置
- 深度链接支持

**ViewModel**:
- 生命周期感知
- 状态保存
- 协程支持

---

### 2. 系统服务

**FloatingWindowService**:
- 悬浮窗功能
- 系统覆盖权限
- 多窗口支持

**AccessibilityService**:
- 屏幕内容抓取
- 事件监听
- 无障碍支持

---

## 🚀 性能优化技术

### 1. 响应时间优化

**本地检查**: < 500ms
- 关键词匹配算法
- 内存缓存策略
- 预计算优化

**AI 分析**: < 10s
- 异步处理
- 流式响应
- 超时控制

---

### 2. 内存管理

**目标**: < 200MB
- 对象池复用
- 弱引用缓存
- 及时资源释放

---

### 3. APK 优化

**目标**: < 30MB
- 代码混淆
- 资源压缩
- 动态功能模块

---

## 🔄 持续集成

### 构建流程

1. **代码检查**
   - Kotlin 静态分析
   - 代码风格检查
   - 安全漏洞扫描

2. **自动化测试**
   - 单元测试执行
   - 集成测试运行
   - 覆盖率报告

3. **构建打包**
   - 多渠道构建
   - 签名配置
   - 版本管理

---

## 📚 技术文档

### 相关文档

- [架构设计详解](../02-架构设计/README.md)
- [开发环境配置](../03-开发指南/环境配置/)
- [测试策略指南](../04-测试文档/测试策略/)
- [Bug 修复流程](../05-Bug修复/README.md)

---

## 🔮 技术演进规划

### 短期优化 (1-3个月)

- 性能监控集成
- 崩溃报告系统
- 用户行为分析

### 中期升级 (3-6个月)

- KMP (Kotlin Multiplatform) 评估
- 模块化架构重构
- CI/CD 流程优化

### 长期规划 (6-12个月)

- AI 模型本地化
- 边缘计算集成
- 隐私计算技术

---

**最后更新**: 2025-12-08  
**维护者**: 技术团队  
**版本**: v1.0