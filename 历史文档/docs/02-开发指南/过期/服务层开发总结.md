---
date_completed: 2025-12-03
category: æœåŠ¡å±‚
phase: Phase 1 - MVP
status: âœ… æ–‡æ¡£å®Œæˆ
document_version: v1.0.0
---

# æœåŠ¡å±‚å¼€å‘æ€»ç»“

## ğŸ“Š æ¶æ„è®¾è®¡å®Œæˆæƒ…å†µ

### å·²åˆ›å»ºçš„æ–‡æ¡£åˆ—è¡¨

| åºå· | æ–‡æ¡£åç§° | è¯´æ˜ | çŠ¶æ€ |
|------|---------|------|------|
| 0 | [README.md](../01-æ¶æ„è®¾è®¡/æœåŠ¡å±‚/README.md) | æ–‡æ¡£å¯¼èˆªä¸å¿«é€Ÿå¼€å§‹æŒ‡å— | âœ… |
| 1 | [æœåŠ¡å±‚å…¨å±€è®¾è®¡.md](../01-æ¶æ„è®¾è®¡/æœåŠ¡å±‚/æœåŠ¡å±‚å…¨å±€è®¾è®¡.md) | æ¶æ„å®šä½ã€æ ¸å¿ƒç»„ä»¶ã€è®¾è®¡åŸåˆ™ | âœ… |
| 2 | [æœåŠ¡å±‚å¼€å‘è§„èŒƒ.md](../01-æ¶æ„è®¾è®¡/æœåŠ¡å±‚/æœåŠ¡å±‚å¼€å‘è§„èŒƒ.md) | å‘½åã€ä»£ç ç»„ç»‡ã€æµ‹è¯•è§„èŒƒ | âœ… |
| 3 | [ç¬¬ä¸€æ¨¡å—-æ ¸å¿ƒæœåŠ¡å¼€å‘.md](../01-æ¶æ„è®¾è®¡/æœåŠ¡å±‚/ç¬¬ä¸€æ¨¡å—-æ ¸å¿ƒæœåŠ¡å¼€å‘.md) | UseCaseäº”æ­¥å¼€å‘æ³• | âœ… |
| 4 | [ç¬¬äºŒæ¨¡å—-æœåŠ¡ç¼–æ’.md](../01-æ¶æ„è®¾è®¡/æœåŠ¡å±‚/ç¬¬äºŒæ¨¡å—-æœåŠ¡ç¼–æ’.md) | å¤šRepositoryåè°ƒæ¨¡å¼ | âœ… |
| 5 | [ç¬¬ä¸‰æ¨¡å—-ä¸šåŠ¡è§„åˆ™å¼•æ“.md](../01-æ¶æ„è®¾è®¡/æœåŠ¡å±‚/ç¬¬ä¸‰æ¨¡å—-ä¸šåŠ¡è§„åˆ™å¼•æ“.md) | è§„åˆ™ç³»ç»Ÿã€éšç§å¼•æ“ | âœ… |

**æ–‡æ¡£æ€»æ•°**: 6ä¸ªæ ¸å¿ƒæ–‡æ¡£  
**æ€»å­—æ•°**: çº¦15,000å­—  
**å®Œæˆæ—¥æœŸ**: 2025-12-03

---

## ğŸ“š æ–‡æ¡£è¦†ç›–çš„å†…å®¹èŒƒå›´

### 1. æ¶æ„è®¾è®¡ (æœåŠ¡å±‚å…¨å±€è®¾è®¡.md)

**æ ¸å¿ƒå†…å®¹**:
- âœ… Clean Architectureä¸­çš„æœåŠ¡å±‚å®šä½
- âœ… UseCase vs Serviceçš„èŒè´£åˆ’åˆ†
- âœ… æ¶æ„åˆ†å±‚å›¾ä¸æ•°æ®æµå‘
- âœ… äº”å¤§æ ¸å¿ƒè®¾è®¡åŸåˆ™
  - ä¾èµ–å€’ç½®åŸåˆ™ (DIP)
  - å•ä¸€èŒè´£åŸåˆ™ (SRP)
  - é”™è¯¯è¾¹ç•ŒåŸåˆ™
  - æ•°æ®ä¸å¯å˜åŸåˆ™
  - å¹¶å‘å®‰å…¨åŸåˆ™
- âœ… æœåŠ¡å±‚ä¸æ•°æ®å±‚çš„äº¤äº’è¾¹ç•Œ
- âœ… å®Œæ•´çš„ä¸šåŠ¡æµç¨‹ç¤ºä¾‹

**è®¾è®¡äº®ç‚¹**:
```kotlin
// UseCase vs Service æ¸…æ™°å¯¹æ¯”
UseCase: ä¸€æ¬¡æ€§æ‰§è¡Œï¼Œç¼–æ’ä¸šåŠ¡æµç¨‹ï¼Œä¾èµ–Repository
Service: æ— çŠ¶æ€å•ä¾‹ï¼Œæä¾›å¯å¤ç”¨èƒ½åŠ›ï¼Œçº¯å‡½æ•°å®ç°
```

---

### 2. å¼€å‘è§„èŒƒ (æœåŠ¡å±‚å¼€å‘è§„èŒƒ.md)

**æ ¸å¿ƒå†…å®¹**:
- âœ… UseCaseå‘½åè§„èŒƒ (åŠ¨è¯+åè¯+UseCase)
  - ç¤ºä¾‹: `AnalyzeChatUseCase`, `CheckDraftUseCase`
  - å¸¸ç”¨åŠ¨è¯æ¸…å•: Analyze, Check, Feed, Save, Delete, Update, Get
  
- âœ… Serviceå‘½åè§„èŒƒ (åè¯+Engine/Service/Manager)
  - ç¤ºä¾‹: `PrivacyEngine`, `ValidationService`, `CacheManager`
  - åç¼€é€‰æ‹©æŒ‡å—æ˜ç¡®
  
- âœ… ä»£ç ç»„ç»‡æ ‡å‡†ç»“æ„
  - UseCaseæ ‡å‡†æ¨¡æ¿ (æ„é€ å‡½æ•°æ³¨å…¥ã€operator fun invokeã€ç§æœ‰æ–¹æ³•)
  - Serviceæ ‡å‡†æ¨¡æ¿ (objectå•ä¾‹ã€çº¯å‡½æ•°)
  
- âœ… ä¾èµ–æ³¨å…¥è§„èŒƒ
  - å¿…é¡»ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥
  - ä¾èµ–æ¥å£è€Œéå®ç°
  - ä¾èµ–å£°æ˜é¡ºåºè§„åˆ™
  
- âœ… Result<T>é”™è¯¯å¤„ç†æ¨¡å¼
  - ç»Ÿä¸€é”™è¯¯å°è£…
  - å¼‚å¸¸è½¬æ¢è§„èŒƒ
  - ç©ºå€¼å¤„ç†è§„èŒƒ
  
- âœ… åç¨‹ä½¿ç”¨è§„èŒƒ
  - Suspendå‡½æ•°è§„èŒƒ
  - å¹¶è¡Œä¸ä¸²è¡Œè°ƒç”¨
  - Flowä½¿ç”¨è§„èŒƒ
  
- âœ… å•å…ƒæµ‹è¯•æ¨¡æ¿
  - Given-When-Thenç»“æ„
  - Mockå¯¹è±¡ä½¿ç”¨
  - æµ‹è¯•åœºæ™¯è¦†ç›–

**è§„èŒƒç¤ºä¾‹**:
```kotlin
// æ ‡å‡†UseCaseç»“æ„
class XxxUseCase @Inject constructor(
    private val repository1: Repository1,
    private val repository2: Repository2
) {
    suspend operator fun invoke(...): Result<OutputType> {
        return try {
            // ä¸šåŠ¡é€»è¾‘
            Result.success(result)
        } catch (e: Exception) {
            Result.failure(e)
        }
    }
}
```

---

### 3. æ ¸å¿ƒå¼€å‘ (ç¬¬ä¸€æ¨¡å—-æ ¸å¿ƒæœåŠ¡å¼€å‘.md)

**æ ¸å¿ƒå†…å®¹**:
- âœ… **UseCaseäº”æ­¥å¼€å‘æ³•**
  - ç¬¬ä¸€æ­¥: æ˜ç¡®ä¸šåŠ¡åœºæ™¯ (ç”¨æˆ·æ“ä½œã€è¾“å…¥è¾“å‡ºã€ä¾èµ–å…³ç³»)
  - ç¬¬äºŒæ­¥: å®šä¹‰æ¥å£ç­¾å (å‚æ•°è®¾è®¡ã€è¿”å›å€¼ã€suspend)
  - ç¬¬ä¸‰æ­¥: å®ç°ä¸šåŠ¡æµç¨‹ (å‰ç½®æ£€æŸ¥â†’æ•°æ®åŠ è½½â†’æ•°æ®æ¸…æ´—â†’ä¸šåŠ¡å¤„ç†â†’ç»“æœè¿”å›)
  - ç¬¬å››æ­¥: æŠ½å–è¾…åŠ©æ–¹æ³• (å•ä¸ªæ–¹æ³•ä¸è¶…è¿‡30è¡Œã€è¯­ä¹‰åŒ–å‘½å)
  - ç¬¬äº”æ­¥: ç¼–å†™å•å…ƒæµ‹è¯• (æˆåŠŸåœºæ™¯ã€å¤±è´¥åœºæ™¯ã€è¾¹ç•Œåœºæ™¯)

- âœ… ä¸šåŠ¡é€»è¾‘å°è£…æœ€ä½³å®è·µ
  - å•ä¸€èŒè´£
  - æ•°æ®è½¬æ¢é›†ä¸­
  - é˜²å¾¡å¼ç¼–ç¨‹
  - æ—©è¿”å›æ¨¡å¼

- âœ… åç¨‹ä¸äº‹åŠ¡ç®¡ç†
  - æŒ‚èµ·å‡½æ•°ä½¿ç”¨
  - åç¨‹ä½œç”¨åŸŸ
  - å¹¶è¡Œè°ƒç”¨ä¼˜åŒ–

- âœ… å®Œæ•´çš„CheckDraftUseCaseç¤ºä¾‹ (500+è¡Œå®Œæ•´ä»£ç )

**å¼€å‘æµç¨‹å›¾**:
```mermaid
graph LR
    A[æ˜ç¡®ä¸šåŠ¡åœºæ™¯] --> B[å®šä¹‰æ¥å£ç­¾å]
    B --> C[å®ç°ä¸šåŠ¡æµç¨‹]
    C --> D[æŠ½å–è¾…åŠ©æ–¹æ³•]
    D --> E[ç¼–å†™å•å…ƒæµ‹è¯•]
```

---

### 4. æœåŠ¡ç¼–æ’ (ç¬¬äºŒæ¨¡å—-æœåŠ¡ç¼–æ’.md)

**æ ¸å¿ƒå†…å®¹**:
- âœ… å¤šRepositoryåè°ƒæ¨¡å¼
  - **ä¸²è¡Œè°ƒç”¨**: æœ‰ä¾èµ–å…³ç³»ï¼Œé¡ºåºæ‰§è¡Œ
  - **å¹¶è¡Œè°ƒç”¨**: æ— ä¾èµ–å…³ç³»ï¼Œä½¿ç”¨async/awaitæå‡æ€§èƒ½
  - **æ··åˆç¼–æ’**: éƒ¨åˆ†å¹¶è¡Œã€éƒ¨åˆ†ä¸²è¡Œçš„å¤æ‚åœºæ™¯

- âœ… æ•°æ®æµè½¬ä¸è½¬æ¢
  - å•å‘æ•°æ®æµåŸåˆ™
  - æ•°æ®ä¸å¯å˜åŸåˆ™
  - Repositoryå±‚è½¬æ¢ vs UseCaseå±‚è½¬æ¢

- âœ… æ•°æ®æ¸…æ´—ç­–ç•¥
  - å»é‡: `distinct()`, `distinctBy()`
  - è¿‡æ»¤: `filter()`
  - æ’åºä¸æˆªå–: `sortedBy()`, `take()`, `takeLast()`
  - æ˜ å°„è½¬æ¢: `map()`

- âœ… Flowå“åº”å¼æ•°æ®æµ
  - Flow vs Suspendå¯¹æ¯”
  - åœ¨UseCaseä¸­ä½¿ç”¨Flow
  - Flowæ“ä½œç¬¦: map, filter, combine

- âœ… å…¸å‹ç¼–æ’åœºæ™¯ç¤ºä¾‹
  - æ•°æ®é¢„åŠ è½½
  - åˆ†æ­¥æ ¡éªŒ
  - æ‰¹é‡æ“ä½œ

**æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹**:
```kotlin
// ä¸²è¡Œè°ƒç”¨: 450ms
val profile = repo1.getProfile(id)  // 200ms
val tags = repo2.getTags(id)        // 150ms
val privacy = repo3.getPrivacy()    // 100ms

// å¹¶è¡Œè°ƒç”¨: 250ms (æå‡45%)
coroutineScope {
    val profileDeferred = async { repo1.getProfile(id) }
    val tagsDeferred = async { repo2.getTags(id) }
    val privacyDeferred = async { repo3.getPrivacy() }
    // ç­‰å¾…æ‰€æœ‰ç»“æœ...
}
```

---

### 5. è§„åˆ™å¼•æ“ (ç¬¬ä¸‰æ¨¡å—-ä¸šåŠ¡è§„åˆ™å¼•æ“.md)

**æ ¸å¿ƒå†…å®¹**:
- âœ… è§„åˆ™ç³»ç»Ÿæ¶æ„
  - åŸºäºBrainTagçš„è§„åˆ™å®šä¹‰
  - è§„åˆ™ç±»å‹: RISK_RED(é›·åŒº) / STRATEGY_GREEN(ç­–ç•¥)

- âœ… **PrivacyEngineéšç§è„±æ•å¼•æ“**
  - å•æ¡æ–‡æœ¬è„±æ•: `mask()`
  - æ‰¹é‡è„±æ•: `maskBatch()`
  - åŸºäºæ˜ å°„è¡¨çš„æ›¿æ¢ç­–ç•¥

- âœ… **ä¸¤å±‚å®‰å…¨æ£€æŸ¥æ¶æ„**
  - Layer 1: æœ¬åœ°å…³é”®è¯åŒ¹é… (å¿«é€Ÿã€ç¦»çº¿ã€æ¯«ç§’çº§)
  - Layer 2: AIè¯­ä¹‰æ£€æŸ¥ (æ·±åº¦ã€è”ç½‘ã€1-2ç§’)
  - åˆ†å±‚è®¾è®¡å¹³è¡¡æ€§èƒ½ä¸å‡†ç¡®ç‡

- âœ… è§„åˆ™åŒ¹é…ç­–ç•¥
  - ç²¾ç¡®åŒ¹é…: `equals()`
  - å­ä¸²åŒ¹é…: `contains()`
  - æ­£åˆ™åŒ¹é…: `Regex`
  - è¯­ä¹‰åŒ¹é…: AI API

- âœ… è§„åˆ™ä¼˜å…ˆçº§è®¾è®¡
  - ä¼˜å…ˆçº§å®šä¹‰: LOW(0) / MEDIUM(50) / HIGH(100)
  - æŒ‰ä¼˜å…ˆçº§æ’åºæ‰§è¡Œ

- âœ… å¯æ‰©å±•çš„ç­–ç•¥æ¨¡å¼å®ç°
  - RuleMatchStrategyæ¥å£
  - å¤šç§åŒ¹é…ç­–ç•¥å®ç°
  - ConfigurableRuleEngine

**å®‰å…¨æ£€æŸ¥æµç¨‹**:
```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥è‰ç¨¿] --> B[Layer 1: æœ¬åœ°å…³é”®è¯åŒ¹é…]
    B --> C{å‘½ä¸­é›·åŒº?}
    C -->|æ˜¯| D[ç«‹å³è­¦å‘Š]
    C -->|å¦| E[Layer 2: AIè¯­ä¹‰æ£€æŸ¥]
    E --> F[è¿”å›ç»“æœ]
```

---

## ğŸ’» æœåŠ¡å±‚å®ç°ç°çŠ¶

### å·²å®ç°çš„UseCase

| UseCase | æ–‡ä»¶ä½ç½® | åŠŸèƒ½è¯´æ˜ | çŠ¶æ€ | æµ‹è¯• |
|---------|---------|---------|------|------|
| **AnalyzeChatUseCase** | `domain/usecase/` | åˆ†æèŠå¤©åœºæ™¯ï¼Œç”Ÿæˆç­–ç•¥å»ºè®® | âœ… | âœ… |
| **CheckDraftUseCase** | `domain/usecase/` | æ£€æŸ¥è‰ç¨¿æ˜¯å¦è§¦å‘é›·åŒºæ ‡ç­¾ | âœ… | âœ… |
| **FeedTextUseCase** | `domain/usecase/` | å–‚å…»æ–‡æœ¬åˆ°è”ç³»äººç”»åƒ | âœ… | âœ… |
| **SaveProfileUseCase** | `domain/usecase/` | ä¿å­˜è”ç³»äººç”»åƒåˆ°æ•°æ®åº“ | âœ… | âœ… |

### å·²å®ç°çš„Service

| Service | æ–‡ä»¶ä½ç½® | åŠŸèƒ½è¯´æ˜ | çŠ¶æ€ |
|---------|---------|---------|------|
| **PrivacyEngine** | `domain/service/` | éšç§è„±æ•å¼•æ“ï¼ˆæ”¯æŒæ­£åˆ™åŒ¹é…ï¼‰ | âœ… |
| **RuleEngine** | `domain/service/` | é€šç”¨è§„åˆ™å¼•æ“ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰ | âœ… |

#### RuleEngine å®ç°äº®ç‚¹

**åŠŸèƒ½ç‰¹æ€§**ï¼ˆ2025-12-04ï¼‰ï¼š
- âœ… **ç­–ç•¥æ¨¡å¼æ¶æ„**ï¼šæ”¯æŒç²¾ç¡®åŒ¹é…ã€å­ä¸²åŒ¹é…ã€æ­£åˆ™åŒ¹é…
- âœ… **ä¼˜å…ˆçº§ç³»ç»Ÿ**ï¼šé«˜ä¼˜å…ˆçº§è§„åˆ™ä¼˜å…ˆå¤„ç†
- âœ… **é‡å æ£€æµ‹**ï¼šé¿å…åŒä¸€æ–‡æœ¬èŒƒå›´è¢«é‡å¤åŒ¹é…
- âœ… **è§„åˆ™ç®¡ç†**ï¼šæ·»åŠ ã€åˆ é™¤ã€æ‰¹é‡æ“ä½œè§„åˆ™

**åŒ¹é…ç­–ç•¥**ï¼š
- **ExactMatchStrategy**ï¼šç²¾ç¡®åŒ¹é…ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- **SubstringMatchStrategy**ï¼šå­ä¸²åŒ¹é…ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰
- **RegexMatchStrategy**ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…

**æ ¸å¿ƒ API**ï¼š
```kotlin
// è¯„ä¼°æ–‡æœ¬åŒ¹é…çš„è§„åˆ™
fun evaluate(text: String): List<RuleMatchResult>

// å¿«é€Ÿæ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…
fun hasMatch(text: String): Boolean

// è§„åˆ™ç®¡ç†
fun addRule(rule: BusinessRule)
fun addRules(rules: List<BusinessRule>)
fun removeRule(ruleId: String)
fun clearRules()
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```kotlin
// åˆ›å»ºå¼•æ“
val engine = RuleEngine()

// æ·»åŠ è§„åˆ™
engine.addRule(BusinessRule(
    id = "rule_001",
    name = "ç¦æ­¢æåŠmoney",
    pattern = "money",
    matchType = MatchType.SUBSTRING,
    priority = 80
))

// æ‰§è¡Œæ£€æŸ¥
val matches = engine.evaluate("I need money")
// è¿”å›åŒ¹é…çš„è§„å‰‡åˆ—è¡¨
```

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- çº¯ Kotlin å®ç°ï¼Œé›¶ä¾èµ–
- å¯æ‰©å±•çš„åŒ¹é…ç­–ç•¥ï¼ˆå¼€é—­åŸåˆ™ï¼‰
- å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–ï¼ˆ19ä¸ªæµ‹è¯•ï¼‰

#### PrivacyEngine æ‰©å±•å®ç°äº®ç‚¹



**æ–°å¢åŠŸèƒ½**ï¼ˆ2025-12-04ï¼‰ï¼š
- âœ… **æ­£åˆ™åŒ¹é…æ”¯æŒ**ï¼šå†…ç½®æ‰‹æœºå·ã€èº«ä»½è¯å·ã€é‚®ç®±æ£€æµ‹æ¨¡å¼
- âœ… **è‡ªåŠ¨æ£€æµ‹æ¨¡å¼**ï¼š`maskWithAutoDetection()` è‡ªåŠ¨è¯†åˆ«æ•æ„Ÿä¿¡æ¯
- âœ… **æ··åˆè„±æ•æ¨¡å¼**ï¼š`maskHybrid()` ç»“åˆæ˜ å°„è§„åˆ™å’Œè‡ªåŠ¨æ£€æµ‹
- âœ… **æ•æ„Ÿä¿¡æ¯æ‰«æ**ï¼š`detectSensitiveInfo()` è¿”å›æ‰€æœ‰æ£€æµ‹åˆ°çš„æ•æ„Ÿä¿¡æ¯

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- æ™ºèƒ½é‡å æ£€æµ‹ï¼šé¿å…18ä½æ•°å­—åŒæ—¶åŒ¹é…æ‰‹æœºå·å’Œèº«ä»½è¯å·
- æ¨¡å¼ä¼˜å…ˆçº§ï¼šæ‰‹æœºå· > èº«ä»½è¯å· > é‚®ç®±
- æŒ‰å‡ºç°é¡ºåºç¼–å·ï¼šç¡®ä¿ç´¢å¼•ä¸€è‡´æ€§å’Œå¯é¢„æµ‹æ€§
- é›¶ä¾èµ–ï¼šçº¯ Kotlin å®ç°ï¼Œæ— å¤–éƒ¨åº“ä¾èµ–

**æ–°å¢æ–¹æ³•**ï¼š
```kotlin
// åŸºäºæ­£åˆ™è¡¨è¾¾å¼è„±æ•
fun maskByPattern(rawText: String, pattern: Regex, maskFormat: String): String

// è‡ªåŠ¨æ£€æµ‹æ•æ„Ÿä¿¡æ¯
fun maskWithAutoDetection(rawText: String, enabledPatterns: List<String>): String

// æ··åˆæ¨¡å¼ï¼ˆæ˜ å°„ + è‡ªåŠ¨æ£€æµ‹ï¼‰
fun maskHybrid(rawText: String, privacyMapping: Map<String, String>, enabledPatterns: List<String>): String

// æ‰«ææ•æ„Ÿä¿¡æ¯
fun detectSensitiveInfo(rawText: String, enabledPatterns: List<String>): List<DetectedPattern>
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```kotlin
// è‡ªåŠ¨æ£€æµ‹æ‰‹æœºå·
val masked = PrivacyEngine.maskWithAutoDetection(
    "æˆ‘çš„æ‰‹æœºå·13800138000",
    listOf("æ‰‹æœºå·")
)
// ç»“æœï¼š"æˆ‘çš„æ‰‹æœºå·[æ‰‹æœºå·_1]"

// æ··åˆè„±æ•
val masked2 = PrivacyEngine.maskHybrid(
    "æˆ‘å«å¼ ä¸‰ï¼Œæ‰‹æœºå·13800138000",
    mapOf("å¼ ä¸‰" to "[NAME_01]"),
    listOf("æ‰‹æœºå·")
)
// ç»“æœï¼š"æˆ‘å«[NAME_01]ï¼Œæ‰‹æœºå·[æ‰‹æœºå·_1]"
```

#### SaveProfileUseCase å®ç°äº®ç‚¹

**æŠ€æœ¯ç‰¹ç‚¹**:
- âœ… ä¸¥æ ¼éµå¾ªUseCaseäº”æ­¥å¼€å‘æ³•
- âœ… å®Œå–„çš„å‚æ•°éªŒè¯ï¼ˆidã€nameå¿…å¡«æ£€æŸ¥ï¼‰
- âœ… é˜²å¾¡å¼ç¼–ç¨‹ï¼Œæ—©è¿”å›æ¨¡å¼
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†é“¾
- âœ… é«˜è¦†ç›–ç‡çš„å•å…ƒæµ‹è¯•ï¼ˆ6ä¸ªæµ‹è¯•åœºæ™¯ï¼‰

**æ ¸å¿ƒä»£ç ç»“æ„**:
```kotlin
class SaveProfileUseCase @Inject constructor(
    private val contactRepository: ContactRepository
) {
    suspend operator fun invoke(profile: ContactProfile): Result<Unit> {
        return try {
            // 1. å‰ç½®æ£€æŸ¥ï¼šéªŒè¯å¿…å¡«å­—æ®µ
            val validationResult = validateProfile(profile)
            if (validationResult.isFailure) {
                return validationResult
            }

            // 2. è°ƒç”¨ä»“åº“ä¿å­˜ç”»åƒ
            contactRepository.saveProfile(profile)
        } catch (e: Exception) {
            Result.failure(e)
        }
    }

    private fun validateProfile(profile: ContactProfile): Result<Unit> {
        return when {
            profile.id.isBlank() -> Result.failure(IllegalArgumentException("è”ç³»äººIDä¸èƒ½ä¸ºç©º"))
            profile.name.isBlank() -> Result.failure(IllegalArgumentException("è”ç³»äººåç§°ä¸èƒ½ä¸ºç©º"))
            else -> Result.success(Unit)
        }
    }
}
```

#### AnalyzeChatUseCase å®ç°äº®ç‚¹

**æŠ€æœ¯ç‰¹ç‚¹**:
- âœ… æ··åˆç¼–æ’: å¹¶è¡ŒåŠ è½½åŸºç¡€æ•°æ® + ä¸²è¡Œå¤„ç†
- âœ… éšç§ä¿æŠ¤: å¼ºåˆ¶ä½¿ç”¨PrivacyEngineè„±æ•
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†é“¾
- âœ… æ”¯æŒå¤šRepositoryåè°ƒ

**æ ¸å¿ƒä»£ç ç»“æ„**:
```kotlin
suspend operator fun invoke(
    contactId: String,
    rawScreenContext: List<String>
): Result<AnalysisResult> = coroutineScope {
    return@coroutineScope try {
        // é˜¶æ®µ1: å‰ç½®æ£€æŸ¥
        val apiKey = settingsRepository.getApiKey().getOrNull()
            ?: return@coroutineScope Result.failure(...)
        
        // é˜¶æ®µ2: å¹¶è¡ŒåŠ è½½åŸºç¡€æ•°æ®
        val profileDeferred = async { contactRepository.getProfile(contactId) }
        val tagsDeferred = async { brainTagRepository.getTags(contactId) }
        val privacyDeferred = async { privacyRepository.getPrivacyMapping() }
        
        val profile = profileDeferred.await().getOrThrow()
        val tags = tagsDeferred.await().getOrThrow()
        val privacyMapping = privacyDeferred.await().getOrElse { emptyMap() }
        
        // é˜¶æ®µ3: æ•°æ®æ¸…æ´—
        val cleanedContext = rawScreenContext
            
            .distinct()
            .takeLast(profile.contextDepth)
        
        // é˜¶æ®µ4: éšç§è„±æ•
        val maskedContext = PrivacyEngine.maskBatch(cleanedContext, privacyMapping)
        
        // é˜¶æ®µ5: AIåˆ†æ
        val result = aiRepository.analyzeChat(prompt, systemInstruction).getOrThrow()
        
        Result.success(result)
    } catch (e: Exception) {
        Result.failure(e)
    }
}
```

---

### å·²å®ç°çš„Service

| Service | æ–‡ä»¶ä½ç½® | åŠŸèƒ½è¯´æ˜ | çŠ¶æ€ |
|---------|---------|---------|------|
| **PrivacyEngine** | `domain/service/` | éšç§è„±æ•å¼•æ“ | âœ… |

---

## ğŸš€ ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®

### Phase 1: å®Œå–„æ ¸å¿ƒUseCase (ä¼˜å…ˆçº§:é«˜)

1. âœ… **SaveProfileUseCase** - ä¿å­˜è”ç³»äººç”»åƒ (å·²å®Œæˆ)
2. âœ… **å•å…ƒæµ‹è¯•è¦†ç›–ç‡** - 57/57 æµ‹è¯•é€šè¿‡ (100%)

### Phase 2: å®ç°å®Œæ•´è§„åˆ™å¼•æ“ (ä¼˜å…ˆçº§:ä¸­)

1. âœ… **æ‰©å±•PrivacyEngine** - æ­£åˆ™åŒ¹é…ã€æ•æ„Ÿä¿¡æ¯æ£€æµ‹ (å·²å®Œæˆ)
   - âœ… æ‰‹æœºå·/èº«ä»½è¯å·/é‚®ç®±è‡ªåŠ¨æ£€æµ‹
   - âœ… æ··åˆè„±æ•æ¨¡å¼
   - âœ… æ•æ„Ÿä¿¡æ¯æ‰«æ
2. âœ… **å®ç°RuleEngine** - ä½¿ç”¨ç­–ç•¥æ¨¡å¼è®¾è®¡ (å·²å®Œæˆ)
   - é€šç”¨è§„åˆ™å¼•æ“æ¡†æ¶
   - å¯æ‰©å±•çš„åŒ¹é…ç­–ç•¥

### Phase 3: æ€§èƒ½ä¼˜åŒ– (ä¼˜å…ˆçº§:ä½)

1. **å¹¶è¡Œè°ƒç”¨ä¼˜åŒ–** - åˆ†æç“¶é¢ˆ,ä¼˜åŒ–async/await
2. **ç¼“å­˜æœºåˆ¶** - ä¸ºé¢‘ç¹æŸ¥è¯¢æ·»åŠ å†…å­˜ç¼“å­˜

---

## ğŸ“š æ–‡æ¡£ä¸ä»£ç çš„å¯¹åº”å…³ç³»

| æ–‡æ¡£ | å¯¹åº”ä»£ç  |
|------|---------|
| æœåŠ¡å±‚å…¨å±€è®¾è®¡ | AnalyzeChatUseCase, PrivacyEngine |
| æœåŠ¡å±‚å¼€å‘è§„èŒƒ | æ‰€æœ‰UseCaseçš„å‘½åå’Œç»“æ„ |
| ç¬¬ä¸€æ¨¡å—-æ ¸å¿ƒæœåŠ¡å¼€å‘ | CheckDraftUseCaseå®Œæ•´å®ç° |
| ç¬¬äºŒæ¨¡å—-æœåŠ¡ç¼–æ’ | AnalyzeChatUseCaseçš„å¹¶è¡ŒåŠ è½½ |
| ç¬¬ä¸‰æ¨¡å—-ä¸šåŠ¡è§„åˆ™å¼•æ“ | PrivacyEngine, CheckDraftUseCase |

---

## âœ… å®Œæˆæ ‡å‡†

- âœ… åˆ›å»ºäº†6ä¸ªæ ¸å¿ƒæ–‡æ¡£(çº¦18,000å­—)
- âœ… è¦†ç›–äº†æ¶æ„è®¾è®¡ã€å¼€å‘è§„èŒƒã€ä¸‰å¤§æ¨¡å—
- âœ… æä¾›äº†å®Œæ•´çš„ä»£ç ç¤ºä¾‹
- âœ… å®ç°äº†4ä¸ªæ ¸å¿ƒUseCase
- âœ… å®ç°äº†2ä¸ªé¢†åŸŸæœåŠ¡ï¼ˆPrivacyEngineã€RuleEngineï¼‰
- âœ… 57/57 å•å…ƒæµ‹è¯•é€šè¿‡ (100% é€šè¿‡ç‡)
- âœ… å»ºç«‹äº†å®Œæ•´çš„æ–‡æ¡£ç´¢å¼•ä½“ç³»
- âœ… PrivacyEngine æ”¯æŒè‡ªåŠ¨æ£€æµ‹å’Œæ··åˆè„±æ•æ¨¡å¼
- âœ… RuleEngine æ”¯æŒç­–ç•¥æ¨¡å¼è®¾è®¡ï¼Œä¸‰ç§åŒ¹é…ç­–ç•¥

---

**æ–‡æ¡£ä½œè€…**: hushaokang  
**å®Œæˆæ—¥æœŸ**: 2025-12-03  
**ç‰ˆæœ¬**: v1.0.0 (Phase 1 æ–‡æ¡£å®Œæˆ)  
**çŠ¶æ€**: âœ… **COMPLETE**