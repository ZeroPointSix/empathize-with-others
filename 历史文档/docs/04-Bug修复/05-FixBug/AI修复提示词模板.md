# AI Bug 修复提示词模板

**文档版本**：1.0.0  
**创建日期**：2025-12-05  
**适用场景**：指导 AI 助手根据修复指导文档进行 Bug 修复

---

## 📋 使用说明

本文档提供了一套标准化的提示词模板，用于指导 AI 助手（如 Claude、GPT-4 等）根据《Bug修复指导文档.md》进行系统化的 Bug 修复工作。

### 使用流程
1. 选择要修复的 Bug（按优先级）
2. 复制对应的提示词模板
3. 根据实际情况调整模板中的参数
4. 将提示词发送给 AI 助手
5. 验证修复结果
6. 记录修复过程

---

## 🎯 通用修复提示词（推荐）

### 模板 1：单个 Bug 完整修复

```
# Bug 修复任务

## 背景信息
我正在开发一个 Android 应用（共情 AI 助手），使用 Kotlin + Jetpack Compose + Clean Architecture。
项目遵循以下规范：
- 架构：Clean Architecture + MVVM
- UI：Jetpack Compose + Material 3
- DI：Hilt
- 数据库：Room
- 网络：Retrofit + Moshi

## 任务目标
请根据 `docs/05-FixBug/Bug修复指导文档.md` 中的指导，修复以下 Bug：

**Bug #[编号]：[Bug 名称]**

## 要求
1. **严格遵循项目规范**
   - 阅读 `.kiro/steering/` 下的所有规范文件
   - 遵循 Clean Architecture 分层原则
   - 使用 Hilt 进行依赖注入
   - 所有文档和注释使用中文

2. **按照修复指导执行**
   - 仔细阅读修复指导文档中该 Bug 的完整章节
   - 按照"实现步骤"逐步执行
   - 使用文档中推荐的修复方案

3. **代码质量要求**
   - 遵循 Kotlin 编码规范
   - 添加必要的中文注释
   - 实现完整的错误处理
   - 使用 StateFlow 管理 UI 状态

4. **测试验证**
   - 对照"验证标准"清单逐项检查
   - 确保不引入新的问题
   - 说明如何手动测试该修复

## 执行步骤
请按以下顺序执行：

1. **分析现状**
   - 检查相关文件是否存在
   - 分析当前代码结构
   - 确认问题根因

2. **设计方案**
   - 说明你选择的修复方案（如果有多个方案）
   - 列出需要修改/创建的文件
   - 说明修改的影响范围

3. **实施修复**
   - 创建或修改必要的文件
   - 确保代码符合项目规范
   - 添加必要的注释

4. **验证修复**
   - 对照验证标准清单
   - 说明测试方法
   - 列出可能的风险点

5. **输出修复记录**
   - 使用修复指导文档中的"修复记录模板"
   - 列出所有修改的文件
   - 说明关键修改点

## 开始执行
请开始修复 Bug #[编号]。
```

---

## 🔴 P0 优先级 Bug 提示词

### Bug #1：添加联系人功能

```
# 修复 Bug #1：添加联系人功能完全无效

## 任务描述
用户点击联系人列表页面右下角的 "+" 浮动按钮后完全无反应，需要实现添加联系人功能。

## 参考文档
- 修复指导：`docs/05-FixBug/Bug修复指导文档.md` - Bug #1 章节
- 项目规范：`.kiro/steering/` 目录下所有文件
- 测试报告：`docs/03-测试文档/人工测试问题.md`

## 具体要求

### 1. 采用推荐方案
请使用修复指导文档中的"方案 A：对话框方式"，因为这是快速实现方案。

### 2. 需要实现的组件
- `AddContactDialog.kt` - 添加联系人对话框组件
- 更新 `ContactListScreen.kt` - 绑定 FAB 点击事件
- 更新 `ContactListViewModel.kt` - 添加事件处理
- 更新 `ContactListUiEvent.kt` - 定义 AddContact 事件

### 3. 功能要求
- 对话框包含：姓名输入框（必填）、电话输入框（必填）
- 输入验证：姓名不能为空，电话格式校验
- 保存成功后关闭对话框并刷新列表
- 取消操作不保存数据

### 4. 验证标准
完成后请确认以下所有项：
- [ ] 点击 "+" 按钮弹出对话框
- [ ] 可以输入姓名和电话
- [ ] 必填字段验证正常
- [ ] 保存后新联系人显示在列表中
- [ ] 取消操作正常

## 实施步骤
1. 首先检查 `ContactListScreen.kt` 中 FAB 的当前实现
2. 检查 `ContactListViewModel.kt` 和 `ContactListUiEvent.kt` 的现有代码
3. 创建 `AddContactDialog.kt` 组件
4. 更新相关文件实现完整流程
5. 说明如何测试

请开始执行。
```



### Bug #3：分析对话功能缺失

```
# 修复 Bug #3："分析对话"功能完全缺失

## 任务描述
联系人详情页面缺少"分析对话"按钮，这是应用的核心功能"AI 军师"，需要完整实现。

## 前置依赖
⚠️ **重要**：此 Bug 依赖 Bug #5（设置页面）的完成，因为需要 API Key 配置才能使用 AI 功能。
建议先完成 Bug #5，或者在实现时添加"未配置 API Key"的友好提示。

## 参考文档
- 修复指导：`docs/05-FixBug/Bug修复指导文档.md` - Bug #3 章节
- 架构设计：`docs/01-架构设计/` 目录
- 项目规范：`.kiro/steering/` 目录

## 具体要求

### 1. 分阶段实现
**阶段 1：添加 UI 入口**
- 在 `ContactDetailScreen.kt` 添加"分析对话"按钮
- 配置导航到聊天分析页面

**阶段 2：实现聊天分析页面**
- 检查 `ChatScreen.kt` 是否存在，不存在则创建
- 实现聊天输入区域
- 实现消息显示区域
- 集成 AI 分析功能

### 2. 核心功能
- 用户可以输入聊天内容
- 可以粘贴多条消息
- 点击"分析"按钮调用 AI
- 显示 AI 分析结果
- 实现数据掩码（隐私保护）

### 3. 错误处理
- 未配置 API Key 时显示友好提示
- 网络错误处理
- AI 调用失败处理
- 加载状态显示

### 4. 验证标准
- [ ] 联系人详情页显示"分析对话"按钮
- [ ] 点击按钮跳转到对话分析页面
- [ ] 可以输入聊天内容
- [ ] AI 分析功能正常（如果已配置 API Key）
- [ ] 敏感信息正确掩码
- [ ] 错误处理完善

## 实施建议
1. 先检查 `ChatScreen.kt`、`ChatViewModel.kt`、`AnalyzeChatUseCase.kt` 是否已实现
2. 如果已有部分实现，评估完整性并补充缺失部分
3. 如果完全缺失，按照 Clean Architecture 从 Domain 层开始实现
4. 确保使用 Hilt 进行依赖注入
5. 实现时考虑隐私保护（数据掩码）

请开始执行。
```

### Bug #5：设置页面缺失

```
# 修复 Bug #5：设置页面缺失

## 任务描述
应用缺少设置页面，导致无法配置 API Key，这是使用 AI 功能的前提条件。

## 优先级说明
⚠️ **最高优先级**：此 Bug 必须在 Bug #3（分析对话功能）之前完成，因为 AI 功能依赖 API Key 配置。

## 参考文档
- 修复指导：`docs/05-FixBug/Bug修复指导文档.md` - Bug #5 章节
- 安全规范：项目使用 EncryptedSharedPreferences 存储敏感信息
- 项目规范：`.kiro/steering/` 目录

## 具体要求

### 1. 完整页面结构
```
SettingsScreen
├── API 配置区域
│   ├── OpenAI API Key 输入框
│   ├── Google API Key 输入框
│   └── DeepSeek API Key 输入框
├── AI 模型选择
│   └── 下拉选择器（OpenAI GPT-4、Google Gemini、DeepSeek）
├── 隐私设置
│   ├── 数据掩码开关
│   └── 本地优先模式开关
└── 关于
    ├── 应用版本信息
    └── 开源许可
```

### 2. 需要创建的文件
```
presentation/ui/screen/settings/
├── SettingsScreen.kt
├── SettingsUiState.kt
└── SettingsUiEvent.kt

presentation/viewmodel/
└── SettingsViewModel.kt
```

### 3. 安全要求
⚠️ **关键**：API Key 必须使用 `EncryptedSharedPreferences` 加密存储
- 检查 `SettingsRepositoryImpl` 是否正确实现加密存储
- 确保 API Key 不会出现在日志中
- 输入框使用密码模式（可切换显示/隐藏）

### 4. 导航集成
- 在 `ContactListScreen` 的 TopAppBar 添加设置图标
- 在 `NavGraph.kt` 添加设置页面路由
- 实现返回导航

### 5. 验证标准
- [ ] 可以从主页面进入设置页面
- [ ] 可以输入和保存 API Key
- [ ] API Key 加密存储（使用 EncryptedSharedPreferences）
- [ ] 可以选择 AI 模型
- [ ] 隐私设置开关正常工作
- [ ] 设置立即生效并持久化
- [ ] 返回后设置保持不变
- [ ] 输入框支持显示/隐藏密码

## 实施步骤
1. 检查 `SettingsRepository` 接口和实现是否存在
2. 确认 `EncryptedSharedPreferences` 配置正确
3. 创建 SettingsScreen UI 组件
4. 实现 SettingsViewModel
5. 添加导航路由和入口
6. 测试加密存储功能

请开始执行。
```

---

## 🟡 P1 优先级 Bug 提示词

### Bug #2：标签添加功能缺失

```
# 修复 Bug #2：标签添加功能缺失

## 任务描述
联系人详情页面的"脑标签"区域显示"还没有标签"，但点击无反应，无法添加标签。

## 参考文档
- 修复指导：`docs/05-FixBug/Bug修复指导文档.md` - Bug #2 章节
- 项目规范：`.kiro/steering/` 目录

## 具体要求

### 1. 采用推荐方案
使用"底部弹出标签选择器"方案，提供更好的用户体验。

### 2. 需要实现的功能
- 点击"还没有标签"区域打开标签选择器
- 标签选择器显示所有可用标签
- 支持选择已有标签
- 支持创建新标签
- 已添加的标签显示为 TagChip
- TagChip 支持删除操作
- 已有标签时显示"+"按钮添加更多

### 3. 需要创建/修改的文件
- 创建：`presentation/ui/component/sheet/TagSelectorBottomSheet.kt`
- 修改：`ContactDetailScreen.kt` - 添加标签选择器
- 修改：`ContactDetailViewModel.kt` - 添加 AddTag/RemoveTag 事件
- 修改：`ContactDetailUiEvent.kt` - 定义标签相关事件

### 4. 数据流程
```
用户点击 → 显示 BottomSheet → 选择/创建标签 → 
ViewModel 处理 → UseCase 保存 → Repository 持久化 → 
UI 更新显示
```

### 5. 验证标准
- [ ] 点击"还没有标签"打开选择器
- [ ] 可以选择已有标签
- [ ] 可以创建新标签
- [ ] 标签正确显示为 Chip
- [ ] 可以删除标签
- [ ] 标签变更立即持久化

## 实施建议
1. 先检查 `BrainTagRepository` 和相关 UseCase 是否完整
2. 创建 TagSelectorBottomSheet 组件
3. 更新 ContactDetailScreen 集成选择器
4. 实现 ViewModel 事件处理
5. 测试完整流程

请开始执行。
```

### Bug #6：搜索功能无效

```
# 修复 Bug #6：搜索功能无效

## 任务描述
联系人列表页面的搜索图标有视觉反馈但无实际功能，需要实现搜索功能。

## 参考文档
- 修复指导：`docs/05-FixBug/Bug修复指导文档.md` - Bug #6 章节
- 项目规范：`.kiro/steering/` 目录

## 具体要求

### 1. 采用推荐方案
使用"展开式搜索栏"方案，点击搜索图标后 TopAppBar 的标题区域变为搜索输入框。

### 2. 搜索功能
- 支持按姓名搜索（模糊匹配）
- 支持按电话号码搜索（部分匹配）
- 支持按标签搜索
- 实时过滤结果
- 使用 debounce 优化性能（避免频繁查询）

### 3. UI 交互
- 点击搜索图标：展开搜索栏，图标变为关闭图标
- 点击关闭图标：收起搜索栏，清空搜索内容，恢复完整列表
- 搜索栏自动获得焦点
- 显示搜索结果数量

### 4. 需要修改的文件
- `ContactListScreen.kt` - 添加搜索状态和 UI
- `ContactListViewModel.kt` - 实现搜索逻辑
- `ContactListUiState.kt` - 添加搜索相关状态
- `ContactListUiEvent.kt` - 添加 Search 事件

### 5. 性能优化
```kotlin
// 使用 debounce 避免频繁查询
searchQuery
    .debounce(300) // 300ms 延迟
    .distinctUntilChanged()
    .collectLatest { query ->
        // 执行搜索
    }
```

### 6. 验证标准
- [ ] 点击搜索图标展开搜索栏
- [ ] 输入关键词实时过滤
- [ ] 支持按姓名搜索
- [ ] 支持按电话搜索
- [ ] 支持按标签搜索
- [ ] 清空搜索恢复完整列表
- [ ] 搜索性能良好（无卡顿）

请开始执行。
```

---

## 🟢 P2 优先级 Bug 提示词

### Bug #7：空状态显示异常

```
# 修复 Bug #7：空状态显示异常

## 任务描述
当联系人列表为空时，页面完全空白，没有任何提示信息，需要添加友好的空状态提示。

## 参考文档
- 修复指导：`docs/05-FixBug/Bug修复指导文档.md` - Bug #7 章节

## 具体要求

### 1. 空状态设计
- 显示图标（PersonAdd 或类似）
- 主标题："还没有联系人"
- 副标题："点击右下角的 + 按钮添加第一个联系人"
- 居中显示，占满整个内容区域

### 2. 实现方式
在 `ContactListScreen.kt` 中添加条件判断：
```kotlin
if (uiState.contacts.isEmpty() && !uiState.isLoading) {
    EmptyView(...)
} else {
    LazyColumn { ... }
}
```

### 3. 可复用组件
建议创建通用的 `EmptyView` 组件，可在其他页面复用：
```
presentation/ui/component/common/EmptyView.kt
```

### 4. 验证标准
- [ ] 无联系人时显示空状态
- [ ] 提示文案清晰友好
- [ ] 有操作引导说明
- [ ] 添加联系人后空状态消失

这是一个简单的 UI 优化任务，预计 15 分钟内完成。

请开始执行。
```

---

## 🔄 批量修复提示词

### 模板 2：按优先级批量修复

```
# 批量 Bug 修复任务 - P0 优先级

## 任务目标
按照优先级顺序，依次修复以下 P0 级别的 Bug：
1. Bug #5：设置页面缺失（前置依赖）
2. Bug #1：添加联系人功能
3. Bug #3：分析对话功能

## 执行要求

### 1. 严格按顺序执行
- 必须先完成 Bug #5（设置页面），因为 Bug #3 依赖它
- 每个 Bug 完成后进行验证再继续下一个
- 如果遇到阻塞问题，立即报告

### 2. 统一规范
- 所有修复遵循相同的代码规范
- 使用一致的命名风格
- 保持架构的一致性

### 3. 参考文档
- 修复指导：`docs/05-FixBug/Bug修复指导文档.md`
- 项目规范：`.kiro/steering/` 目录下所有文件
- 测试报告：`docs/03-测试文档/人工测试问题.md`

### 4. 输出要求
每个 Bug 修复完成后，请输出：
- 修改的文件列表
- 关键代码说明
- 验证结果
- 下一步建议

## 开始执行
请从 Bug #5 开始，逐个完成 P0 优先级的所有 Bug。
```

---

## 📝 验证和测试提示词

### 模板 3：修复后验证

```
# Bug 修复验证任务

## 任务描述
对已修复的 Bug #[编号] 进行全面验证，确保修复质量。

## 验证内容

### 1. 功能验证
对照 `docs/05-FixBug/Bug修复指导文档.md` 中该 Bug 的"验证标准"清单，逐项检查：
- [ ] 验证项 1
- [ ] 验证项 2
- [ ] ...

### 2. 代码审查
检查以下方面：
- [ ] 符合 Clean Architecture 分层原则
- [ ] 使用 Hilt 进行依赖注入
- [ ] 错误处理完善
- [ ] 添加必要的中文注释
- [ ] 无硬编码字符串和颜色
- [ ] 遵循 Kotlin 编码规范

### 3. 性能检查
- [ ] 无内存泄漏风险
- [ ] 列表操作流畅
- [ ] 网络请求有超时处理
- [ ] 数据库操作在后台线程

### 4. 安全检查（如涉及）
- [ ] 敏感数据加密存储
- [ ] 无日志泄露
- [ ] 输入验证完善

### 5. 回归测试
确认修复没有引入新问题：
- [ ] 原有功能正常
- [ ] 相关功能未受影响
- [ ] 应用启动正常
- [ ] 无崩溃和 ANR

## 输出要求
请提供详细的验证报告，包括：
1. 每项验证的结果（通过/失败）
2. 发现的问题（如有）
3. 改进建议
4. 是否可以标记为"已完成"

请开始验证。
```

---

## 🎯 最佳实践建议

### 给 AI 的提示词使用技巧

1. **提供充分上下文**
   - 始终引用具体的文档路径
   - 说明项目的技术栈和架构
   - 指出相关的规范文件

2. **明确优先级和依赖**
   - 说明 Bug 的优先级
   - 指出前置依赖关系
   - 建议修复顺序

3. **具体化要求**
   - 使用清单式的验证标准
   - 提供代码示例或伪代码
   - 说明预期的文件结构

4. **分阶段执行**
   - 将复杂任务分解为多个步骤
   - 每个步骤都有明确的输出
   - 便于中途检查和调整

5. **要求输出规范**
   - 明确要求 AI 说明修改内容
   - 要求提供测试方法
   - 要求记录关键决策

### 常见问题处理

**Q: AI 偏离了修复指导文档的方案怎么办？**
A: 在提示词中明确要求"严格遵循修复指导文档中的推荐方案"，并引用具体章节。

**Q: AI 修复后如何验证？**
A: 使用"模板 3：修复后验证"提示词，让 AI 自己对照验证标准检查。

**Q: 如何确保代码质量？**
A: 在提示词中包含"代码审查清单"，要求 AI 在完成后自查。

**Q: 修复引入了新问题怎么办？**
A: 要求 AI 进行回归测试，并说明可能的影响范围。

---

## 📚 附录：快速参考

### 文档路径速查
```
修复指导文档：docs/05-FixBug/Bug修复指导文档.md
测试报告：docs/03-测试文档/人工测试问题.md
项目规范：.kiro/steering/
架构设计：docs/01-架构设计/
```

### Bug 优先级速查
```
P0（阻塞性）：#1, #3, #5
P1（重要）：#2, #4, #6
P2（优化）：#7, #8
```

### 推荐修复顺序
```
1. Bug #5（设置页面）- 前置依赖
2. Bug #1（添加联系人）- 基础功能
3. Bug #3（分析对话）- 核心功能
4. Bug #2（标签添加）- 重要功能
5. Bug #6（搜索）- 体验优化
6. Bug #4（标签管理）- 管理功能
7. Bug #7（空状态）- UI 优化
```

---

**文档维护**：根据实际使用效果持续优化提示词模板
