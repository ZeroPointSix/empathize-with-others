# AI 修复提示词 - 灵活AI配置设计文档优化

## 使用说明

本文档提供了一套结构化的提示词模板，用于指导 AI 优化灵活AI配置功能的设计文档，解决过度设计问题并确保架构一致性。

### 模板结构

每个提示词包含以下部分：
1. **角色设定** - AI的专业背景和任务定位
2. **背景说明** - 灵活AI配置功能的评估结果
3. **具体改进点** - 基于评估发现的需改进之处
4. **改进指导** - 如何修改设计文档以解决过度设计问题
5. **架构一致性指导** - 如何确保设计符合项目整体架构
6. **输出要求** - 改进后的设计文档应包含的内容和格式

---

## 通用提示词模板

```
# 角色设定

你是一位资深的 Android 架构师和设计文档专家，擅长简化复杂设计、解决过度设计问题，并确保设计文档与项目整体架构保持一致。

# 项目背景

- **项目名称**：共情 AI 助手
- **架构模式**：Clean Architecture + MVVM
- **技术栈**：
  - Kotlin 2.0.21
  - Jetpack Compose
  - Kotlin Coroutines 1.9.0
  - Hilt (依赖注入)
  - Room (本地数据库)
  - Retrofit (网络请求)
  - Android Jetpack Security (安全存储)

# 任务背景

灵活AI配置功能的设计文档已经完成初步设计，但在评估中发现了过度设计问题。该功能旨在允许用户自定义AI服务商和模型选择，当前设计过于复杂，需要简化并确保与项目整体架构保持一致。

# 评估发现的问题

## 主要问题

1. **过度设计**：设计文档包含过多不必要的复杂功能和实现细节
2. **技术选型不当**：使用了项目不常用的技术栈（如Gson而非Moshi）
3. **错误恢复机制过于复杂**：设计了不必要的自动修复功能
4. **安全实现过于自定义**：未充分利用Android Jetpack Security标准实现
5. **开发计划不合理**：周期过长，不符合敏捷开发原则

## 具体改进点

1. **JSON解析库更换**：
   - 当前使用：Gson
   - 应改为：Moshi（与项目其他部分保持一致）

2. **简化错误恢复机制**：
   - 移除自动修复功能
   - 保留基本错误提示和用户手动处理

3. **安全实现简化**：
   - 使用Android Jetpack Security的标准实现
   - 减少自定义加密代码
   - 利用EncryptedSharedPreferences进行API Key存储

4. **渐进式开发方式**：
   - 先实现基础功能（添加、编辑、删除服务商）
   - 后续迭代添加高级功能（导入导出、模板系统等）

5. **调整开发计划**：
   - 缩短迭代周期（从15天调整为2-3个短周期）
   - 优先实现核心功能
   - 简化测试策略

# 改进指导

## 设计原则

1. **KISS原则**：保持简单直接，避免不必要的复杂性
2. **YAGNI原则**：只实现当前需要的功能，不过度设计
3. **渐进式设计**：从简单开始，逐步扩展功能
4. **架构一致性**：严格遵循项目现有架构模式

## 具体改进方向

### 1. 数据模型简化
- 移除不必要的字段和复杂关系
- 简化实体类设计
- 使用项目标准的数据注解和转换方式

### 2. API接口简化
- 减少不必要的接口定义
- 合并相似功能
- 使用项目标准的网络请求模式

### 3. UI设计简化
- 减少界面复杂度
- 使用项目现有UI组件
- 遵循项目现有交互模式

### 4. 安全实现简化
- 使用Android Jetpack Security的标准实现
- 减少自定义加密代码
- 简化API Key存储和检索逻辑

### 5. 错误处理简化
- 移除复杂的错误恢复机制
- 保留基本错误提示
- 简化错误分类和处理逻辑

# 架构一致性指导

## 数据层一致性

1. **数据库设计**：
   - 使用项目标准的Room数据库配置
   - 遵循项目现有的实体类命名和注解规范
   - 使用项目现有的DAO模式

2. **网络请求**：
   - 使用项目标准的Retrofit配置
   - 使用Moshi进行JSON解析
   - 遵循项目现有的错误处理模式

3. **安全存储**：
   - 使用Android Jetpack Security的EncryptedSharedPreferences
   - 遵循项目现有的密钥管理方式

## 服务层一致性

1. **Repository实现**：
   - 遵循项目现有的Repository模式
   - 使用项目标准的Result类型处理
   - 保持与现有Repository接口的一致性

2. **UseCase设计**：
   - 遵循项目现有的UseCase模式
   - 保持简洁的单一职责设计
   - 使用项目标准的依赖注入方式

## UI层一致性

1. **MVVM模式**：
   - 使用项目标准的ViewModel实现
   - 遵循项目现有的状态管理模式
   - 使用项目标准的Compose组件和主题

2. **导航和交互**：
   - 使用项目现有的导航系统
   - 遵循项目现有的交互模式
   - 保持与现有UI风格的一致性

# 输出要求

## 文档结构

请按以下结构输出改进后的设计文档：

```
# 设计文档 - 灵活的 AI 模型配置（简化版）

## 1. 整体架构设计
### 1.1 架构概览（简化版）
### 1.2 与现有架构的集成（重点强调一致性）

## 2. 核心功能设计
### 2.1 数据模型（简化版）
### 2.2 基础功能（添加、编辑、删除服务商）
### 2.3 API接口设计（简化版）

## 3. UI/UX设计（简化版）
### 3.1 主要界面设计
### 3.2 基础交互流程

## 4. 安全设计（简化版）
### 4.1 API Key加密存储（使用Android Jetpack Security）
### 4.2 基本安全措施

## 5. 基础错误处理
### 5.1 简化的错误分类
### 5.2 基本错误提示

## 6. 简化测试策略
### 6.1 核心功能测试
### 6.2 基本集成测试

## 7. 渐进式开发计划
### 7.1 第一阶段：基础功能（1周）
### 7.2 第二阶段：增强功能（1周）
### 7.3 第三阶段：完善功能（1周）
```

## 具体要求

1. **技术栈一致性**：
   - 明确使用Moshi替代Gson
   - 使用Android Jetpack Security标准实现
   - 保持与项目现有技术栈一致

2. **简化设计**：
   - 移除过度设计的功能
   - 简化错误处理机制
   - 减少不必要的自定义实现

3. **渐进式开发**：
   - 分阶段实现功能
   - 优先实现核心功能
   - 短迭代周期开发

4. **架构一致性**：
   - 严格遵循Clean Architecture
   - 保持与现有代码风格一致
   - 使用项目现有组件和模式

## 禁止事项

- ❌ 不要引入项目未使用的技术栈
- ❌ 不要设计过于复杂的错误恢复机制
- ❌ 不要自定义安全实现（使用Android标准）
- ❌ 不要设计过长的开发周期
- ❌ 不要添加不必要的功能

# 开始优化

请根据以上要求优化灵活AI配置功能的设计文档，确保解决过度设计问题并保持与项目整体架构的一致性。
```

---

## 使用指南

### 步骤 1：准备上下文

1. 打开灵活AI配置的设计文档（`.kiro/specs/flexible-ai-config/design.md`）
2. 了解需求文档内容（`.kiro/specs/flexible-ai-config/requirements.md`）
3. 熟悉项目现有架构和技术栈

### 步骤 2：填充模板

将具体信息填入模板中的占位符：
- 根据评估结果调整具体改进点
- 根据项目实际情况调整架构一致性指导
- 根据团队开发节奏调整开发计划

### 步骤 3：提交给 AI

将填充好的提示词提交给 AI（如 Claude、GPT-4 等）

### 步骤 4：评估结果

评估AI生成的优化后设计文档：
1. 是否解决了过度设计问题
2. 是否保持了架构一致性
3. 是否采用了渐进式开发方式
4. 技术选型是否与项目一致

---

## 注意事项

1. **强调简化**：确保AI理解需要简化设计，而不是添加更多功能
2. **架构一致性**：强调与项目现有架构保持一致的重要性
3. **技术栈统一**：明确要求使用项目现有技术栈，特别是Moshi和Android Jetpack Security
4. **渐进式开发**：强调分阶段实现，不要一次性实现所有功能
5. **验证结果**：确保生成的文档符合所有改进要求

## 预期效果

使用本提示词模板优化后的设计文档应该：
1. 显著简化设计复杂度
2. 与项目整体架构保持一致
3. 采用项目标准技术栈
4. 支持渐进式开发
5. 具有更短、更实际的开发周期