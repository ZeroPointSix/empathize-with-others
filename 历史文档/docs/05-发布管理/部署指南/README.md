# 部署指南

本目录包含应用部署相关的操作指南、环境配置和故障排除文档。

## 部署环境

### 开发环境 (dev)
- **用途**: 开发人员日常开发和自测
- **配置**: 开发数据库、测试API
- **更新频率**: 每日更新
- **稳定性**: 不保证

### 测试环境 (test)
- **用途**: 测试人员集成测试和验证
- **配置**: 测试数据库、预发布API
- **更新频率**: 每周更新
- **稳定性**: 中等

### 生产环境 (release)
- **用途**: 正式用户使用
- **配置**: 生产数据库、正式API
- **更新频率**: 按发布计划
- **稳定性**: 高

## 部署流程

### 1. 部署前准备

#### 环境检查
- [ ] 确认目标环境状态
- [ ] 检查网络连接
- [ ] 验证部署权限
- [ ] 准备部署脚本

#### 数据备份
- [ ] 备份当前数据库
- [ ] 备份配置文件
- [ ] 验证备份完整性

#### 版本确认
- [ ] 确认部署版本号
- [ ] 检查版本兼容性
- [ ] 准备回滚方案

### 2. 部署执行

#### 应用部署
```bash
# 1. 停止应用服务
./gradlew :app:stopReleaseProdService

# 2. 备份当前版本
./scripts/backup-current-version.sh

# 3. 部署新版本
./gradlew :app:deployReleaseVersion

# 4. 验证部署结果
./scripts/verify-deployment.sh
```

#### 数据库迁移
```bash
# 1. 数据库备份
./scripts/backup-database.sh

# 2. 执行迁移脚本
./gradlew :app:migrateDatabase

# 3. 验证迁移结果
./scripts/verify-migration.sh
```

#### 配置更新
```bash
# 1. 更新API配置
./scripts/update-api-config.sh

# 2. 更新服务配置
./scripts/update-service-config.sh

# 3. 重启相关服务
./scripts/restart-services.sh
```

### 3. 部署后验证

#### 功能验证
- [ ] 核心功能正常工作
- [ ] API接口响应正常
- [ ] 数据库连接稳定
- [ ] 性能指标正常

#### 监控检查
- [ ] 应用日志无严重错误
- [ ] 系统资源使用正常
- [ ] 用户访问统计正常

#### 回滚测试
- [ ] 回滚方案已验证
- [ ] 回滚脚本可执行
- [ ] 数据可恢复到部署前状态

## 故障排除

### 常见问题

#### 部署失败
**问题**: 部署过程中出现错误
**原因**: 网络问题、权限不足、磁盘空间不足
**解决方案**: 
1. 检查网络连接
2. 确认部署权限
3. 清理磁盘空间
4. 重新执行部署

#### 应用启动失败
**问题**: 应用部署后无法启动
**原因**: 配置错误、依赖缺失、端口冲突
**解决方案**:
1. 检查应用日志
2. 验证配置文件
3. 确认端口可用性
4. 重新安装依赖

#### 性能问题
**问题**: 部署后性能下降
**原因**: 数据库查询优化、缓存未预热、资源不足
**解决方案**:
1. 分析性能瓶颈
2. 优化数据库查询
3. 预热关键缓存
4. 扩展服务器资源

#### 数据库问题
**问题**: 数据库连接失败或数据异常
**原因**: 连接池耗尽、SQL错误、数据损坏
**解决方案**:
1. 检查数据库状态
2. 修复SQL语法错误
3. 恢复数据备份
4. 优化连接池配置

## 紧急响应

### 紧急联系人
- **技术负责人**: [技术负责人姓名]
- **运维负责人**: [运维负责人姓名]
- **产品负责人**: [产品负责人姓名]
- **项目经理**: [项目经理姓名]

### 应急流程
1. **问题报告**: 任何人员发现严重问题立即报告
2. **快速响应**: 技术团队15分钟内响应
3. **问题评估**: 30分钟内完成初步评估
4. **修复执行**: 2小时内启动修复或回滚
5. **结果通报**: 修复完成后立即通报所有相关人员

## 工具和脚本

### 部署脚本
- `deploy.sh`: 主部署脚本
- `backup.sh`: 数据备份脚本
- `rollback.sh`: 回滚脚本
- `verify.sh`: 部署验证脚本

### 监控工具
- **应用监控**: [监控工具名称]
- **服务器监控**: [监控工具名称]
- **数据库监控**: [监控工具名称]
- **日志分析**: [日志分析工具]

---

**创建日期**: 2025-12-08  
**维护者**: 运维团队  
**更新频率**: 部署流程变更时更新