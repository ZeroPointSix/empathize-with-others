# BUG-00050: å¿«é€ŸçŸ¥è¯†Tabç‚¹å‡»æ— å“åº”é—®é¢˜åˆ†æ

> åˆ›å»ºæ—¶é—´: 2026-01-08
> çŠ¶æ€: âœ… å·²ä¿®å¤
> ä¼˜å…ˆçº§: é«˜
> å½±å“èŒƒå›´: æ‚¬æµ®çª—å¿«é€ŸçŸ¥è¯†å›ç­”åŠŸèƒ½ï¼ˆTD-00031ï¼‰
> å…³è”æ–‡æ¡£: PRD-00031, FD-00031, TE-00030
> ä¿®å¤æ—¶é—´: 2026-01-08

---

## é—®é¢˜æè¿°

### ç°è±¡
- **é—®é¢˜**ï¼šæ‚¬æµ®çª—ç¬¬4ä¸ªTab"ğŸ’¡ é—®ç­”"ç‚¹å‡»åæ²¡æœ‰ä»»ä½•ååº”
- **è§¦å‘æ¡ä»¶**ï¼šç¼–è¯‘å®‰è£…APKåï¼Œæ‰“å¼€æ‚¬æµ®çª—ï¼Œç‚¹å‡»ç¬¬4ä¸ªTab
- **é¢„æœŸè¡Œä¸º**ï¼šç‚¹å‡»ååº”åˆ‡æ¢åˆ°å¿«é€Ÿé—®ç­”æ¨¡å¼ï¼Œéšè—è”ç³»äººé€‰æ‹©å™¨ï¼Œæ˜¾ç¤ºçŸ¥è¯†æŸ¥è¯¢è¾“å…¥æ¡†

### ç”¨æˆ·æŠ¥å‘Š
æ¥è‡ª TE-00030 æµ‹è¯•æŠ¥å‘Šï¼š
> "æˆ‘ä»¬å‘ç°æˆ‘ä»¬å®é™…ä¸Šæ˜¯æ— æ³•è§£å†³ï¼Œå°±æ˜¯è¯´æˆ‘ä»¬å‰ç«¯UIä¼¼ä¹æ²¡æœ‰é›†æˆï¼Œå¥½å§ï¼Œç°åœ¨æˆ‘ä»¬å‰ç«¯UIæ— æ³•é›†æˆã€‚å¹¶ä¸”ä¸»è¦æ˜¯ç‚¹å‡»äº†æ²¡æœ‰ååº”"

---

## 1. é—®é¢˜å®šä½

### 1.1 è°ƒæŸ¥è¿‡ç¨‹

é€šè¿‡ context-gatherer å­ä»£ç†å¯¹ä»¥ä¸‹æ–‡ä»¶è¿›è¡Œäº†ç³»ç»Ÿæ€§åˆ†æï¼š

| æ–‡ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `domain/.../ActionType.kt` | âœ… æ­£ç¡® | KNOWLEDGE æšä¸¾å·²å®šä¹‰ |
| `presentation/.../TabSwitcher.kt` | âœ… æ­£ç¡® | tabKnowledge ç»„ä»¶å·²åˆå§‹åŒ–å’Œç»‘å®š |
| `presentation/.../FloatingViewV2.kt` | âœ… æ­£ç¡® | KNOWLEDGE Tab UIé€»è¾‘å·²å¤„ç† |
| `presentation/.../floating_tab_switcher.xml` | âœ… æ­£ç¡® | åŒ…å«4ä¸ªTabæŒ‰é’® |
| `app/.../FloatingWindowService.kt` | âœ… æ­£ç¡® | handleKnowledgeV2() å·²å®ç° |
| `app/.../floating_tab_switcher.xml` | âŒ **é—®é¢˜æ ¹æº** | **åªæœ‰3ä¸ªTabï¼Œç¼ºå°‘é—®ç­”Tab** |

### 1.2 æ ¹å› åˆ†æ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¸ƒå±€æ–‡ä»¶ä¸ä¸€è‡´é—®é¢˜                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  presentation/src/main/res/layout/floating_tab_switcher.xml     â”‚
â”‚  âœ… åŒ…å«4ä¸ªTab: åˆ†æã€æ¶¦è‰²ã€å›å¤ã€é—®ç­”                           â”‚
â”‚                                                                 â”‚
â”‚  app/src/main/res/layout/floating_tab_switcher.xml              â”‚
â”‚  âŒ åªæœ‰3ä¸ªTab: åˆ†æã€æ¶¦è‰²ã€å›å¤ (ç¼ºå°‘é—®ç­”Tab)                   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Androidèµ„æºåˆå¹¶è§„åˆ™ï¼š                                    â”‚   â”‚
â”‚  â”‚ appæ¨¡å—çš„èµ„æºä¼šè¦†ç›–libraryæ¨¡å—çš„åŒåèµ„æº                 â”‚   â”‚
â”‚  â”‚ å› æ­¤ app/res/layout/ ä¼˜å…ˆäº presentation/res/layout/    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ç»“æœï¼šè¿è¡Œæ—¶ä½¿ç”¨çš„æ˜¯ app æ¨¡å—çš„å¸ƒå±€æ–‡ä»¶ï¼ˆåªæœ‰3ä¸ªTabï¼‰          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 é—®é¢˜é“¾è·¯

```
ç”¨æˆ·ç‚¹å‡»ç¬¬4ä¸ªTabä½ç½®
        â†“
TabSwitcher.kt å°è¯• findViewById(R.id.tab_knowledge)
        â†“
ç”±äº app/res/layout/floating_tab_switcher.xml æ²¡æœ‰å®šä¹‰ tab_knowledge
        â†“
findViewById è¿”å› null
        â†“
tabKnowledge?.setOnClickListener { ... } æ— æ•ˆï¼ˆnullå®‰å…¨è°ƒç”¨ï¼‰
        â†“
ç‚¹å‡»äº‹ä»¶æ— æ³•ç»‘å®š
        â†“
ç”¨æˆ·ç‚¹å‡»æ— ååº”
```

---

## 2. åç«¯å®ç°çŠ¶æ€éªŒè¯

### 2.1 Domainå±‚ âœ…

| ç»„ä»¶ | æ–‡ä»¶ | çŠ¶æ€ |
|------|------|------|
| ActionType.KNOWLEDGE | `domain/.../ActionType.kt` | âœ… å·²å®šä¹‰ |
| KnowledgeQueryRequest | `domain/.../KnowledgeQueryRequest.kt` | âœ… å·²åˆ›å»º |
| KnowledgeQueryResponse | `domain/.../KnowledgeQueryResponse.kt` | âœ… å·²åˆ›å»º |
| Recommendation | `domain/.../Recommendation.kt` | âœ… å·²åˆ›å»º |
| QueryKnowledgeUseCase | `domain/.../QueryKnowledgeUseCase.kt` | âœ… å·²å®ç° |
| AiRepository.queryKnowledge() | `domain/.../AiRepository.kt` | âœ… æ¥å£å·²å®šä¹‰ |

### 2.2 Dataå±‚ âœ…

| ç»„ä»¶ | æ–‡ä»¶ | çŠ¶æ€ |
|------|------|------|
| AiRepositoryImpl.queryKnowledge() | `data/.../AiRepositoryImpl.kt` | âœ… å·²å®ç° |
| parseKnowledgeQueryResponse() | `data/.../AiRepositoryImpl.kt` | âœ… å·²å®ç° |
| PromptBuilder.buildKnowledgePrompt() | `domain/.../PromptBuilder.kt` | âœ… å·²å®ç° |
| SystemPrompts.KNOWLEDGE_* | `domain/.../SystemPrompts.kt` | âœ… å·²å®šä¹‰ |

### 2.3 Presentationå±‚ âœ…

| ç»„ä»¶ | æ–‡ä»¶ | çŠ¶æ€ |
|------|------|------|
| TabSwitcher.tabKnowledge | `presentation/.../TabSwitcher.kt` | âœ… ä»£ç æ­£ç¡® |
| FloatingViewV2 KNOWLEDGEå¤„ç† | `presentation/.../FloatingViewV2.kt` | âœ… å·²å®ç° |
| ResultCard.showKnowledgeResult() | `presentation/.../ResultCard.kt` | âœ… å·²å®ç° |
| floating_tab_switcher.xml | `presentation/res/layout/` | âœ… åŒ…å«4ä¸ªTab |

### 2.4 Appå±‚ âœ…ï¼ˆä»£ç ï¼‰/ âŒï¼ˆå¸ƒå±€ï¼‰

| ç»„ä»¶ | æ–‡ä»¶ | çŠ¶æ€ |
|------|------|------|
| FloatingWindowService.handleKnowledgeV2() | `app/.../FloatingWindowService.kt` | âœ… å·²å®ç° |
| QueryKnowledgeUseCaseæ³¨å…¥ | `app/.../FloatingWindowService.kt` | âœ… å·²æ³¨å…¥ |
| floating_tab_switcher.xml | `app/res/layout/` | âŒ **ç¼ºå°‘é—®ç­”Tab** |

---

## 3. ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆï¼šåŒæ­¥ app æ¨¡å—çš„å¸ƒå±€æ–‡ä»¶

**ä¿®æ”¹æ–‡ä»¶**ï¼š`app/src/main/res/layout/floating_tab_switcher.xml`

**ä¿®æ”¹å†…å®¹**ï¼šæ·»åŠ ç¬¬4ä¸ªTabæŒ‰é’®å®šä¹‰

```xml
<!-- é—®ç­”Tab (PRD-00031æ–°å¢) -->
<com.google.android.material.button.MaterialButton
    android:id="@+id/tab_knowledge"
    android:layout_width="0dp"
    android:layout_height="40dp"
    android:layout_weight="1"
    android:text="ğŸ’¡ é—®ç­”"
    android:textSize="12sp"
    android:textColor="@color/tab_text_selector"
    android:paddingHorizontal="4dp"
    android:minWidth="0dp"
    android:insetTop="0dp"
    android:insetBottom="0dp"
    app:cornerRadius="8dp"
    app:strokeWidth="0dp"
    app:backgroundTint="@color/tab_background_selector"
    style="@style/Widget.Material3.Button.TextButton" />
```

### ä¸ºä½•èƒ½ä»æœºåˆ¶ä¸Šè§£å†³é—®é¢˜

1. **èµ„æºåˆå¹¶è§„åˆ™**ï¼šä¿®å¤å app æ¨¡å—çš„å¸ƒå±€æ–‡ä»¶åŒ…å«å®Œæ•´çš„4ä¸ªTab
2. **findViewByIdæˆåŠŸ**ï¼š`R.id.tab_knowledge` èƒ½æ­£ç¡®æ‰¾åˆ°è§†å›¾
3. **ç‚¹å‡»äº‹ä»¶ç»‘å®š**ï¼š`tabKnowledge?.setOnClickListener` èƒ½æ­£ç¡®ç»‘å®š
4. **åŠŸèƒ½é“¾è·¯æ‰“é€š**ï¼šç‚¹å‡» â†’ Tabåˆ‡æ¢ â†’ handleKnowledgeV2() â†’ AIæŸ¥è¯¢

---

## 4. å½±å“èŒƒå›´è¯„ä¼°

### 4.1 ä¿®æ”¹èŒƒå›´

| ç±»å‹ | æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|------|----------|
| å¸ƒå±€ | `app/src/main/res/layout/floating_tab_switcher.xml` | æ·»åŠ ç¬¬4ä¸ªTabæŒ‰é’® |

### 4.2 é£é™©è¯„ä¼°

| é£é™©é¡¹ | è¯„ä¼° | è¯´æ˜ |
|--------|------|------|
| ç¼–è¯‘é£é™© | ä½ | ä»…æ·»åŠ XMLå…ƒç´  |
| è¿è¡Œæ—¶é£é™© | ä½ | å¸ƒå±€å˜æ›´ä¸å½±å“ç°æœ‰é€»è¾‘ |
| å›å½’é£é™© | ä½ | ç°æœ‰3ä¸ªTabåŠŸèƒ½ä¸å—å½±å“ |
| UIé€‚é…é£é™© | ä¸­ | 4ä¸ªTabå¯èƒ½éœ€è¦è°ƒæ•´å­—ä½“å¤§å°æˆ–é—´è· |

### 4.3 æµ‹è¯•è¦ç‚¹

1. **åŠŸèƒ½æµ‹è¯•**ï¼šç‚¹å‡»é—®ç­”Tabèƒ½æ­£ç¡®åˆ‡æ¢
2. **UIæµ‹è¯•**ï¼š4ä¸ªTabå¸ƒå±€å‡åŒ€ï¼Œæ–‡å­—æ¸…æ™°å¯è§
3. **é›†æˆæµ‹è¯•**ï¼šè¾“å…¥æŸ¥è¯¢å†…å®¹ï¼Œæäº¤åèƒ½æ­£ç¡®è°ƒç”¨AIå¹¶æ˜¾ç¤ºç»“æœ
4. **å›å½’æµ‹è¯•**ï¼šåˆ†æã€æ¶¦è‰²ã€å›å¤TabåŠŸèƒ½æ­£å¸¸

---

## 5. ç›¸å…³æ–‡æ¡£

- [PRD-00031-æ‚¬æµ®çª—å¿«é€ŸçŸ¥è¯†å›ç­”åŠŸèƒ½éœ€æ±‚.md](../PRD/PRD-00031-æ‚¬æµ®çª—å¿«é€ŸçŸ¥è¯†å›ç­”åŠŸèƒ½éœ€æ±‚.md)
- [FD-00031-æ‚¬æµ®çª—å¿«é€ŸçŸ¥è¯†å›ç­”åŠŸèƒ½è®¾è®¡.md](../FD/FD-00031-æ‚¬æµ®çª—å¿«é€ŸçŸ¥è¯†å›ç­”åŠŸèƒ½è®¾è®¡.md)
- [TE-00030-å¿«é€ŸçŸ¥è¯†å‰ç«¯é›†æˆ.md](../TE/TE-00030-å¿«é€ŸçŸ¥è¯†å‰ç«¯é›†æˆ.md)
- [TDD-00031-æ‚¬æµ®çª—å¿«é€ŸçŸ¥è¯†å›ç­”åŠŸèƒ½æŠ€æœ¯è®¾è®¡.md](../TDD/TDD-00031-æ‚¬æµ®çª—å¿«é€ŸçŸ¥è¯†å›ç­”åŠŸèƒ½æŠ€æœ¯è®¾è®¡.md)

---

## 6. ä¿®å¤å®æ–½è®°å½•

### 6.1 å·²ä¿®å¤ âœ…

- [x] åˆ é™¤ `app/src/main/res/layout/floating_tab_switcher.xml` é‡å¤å¸ƒå±€æ–‡ä»¶
- [x] é‡æ–°ç¼–è¯‘éªŒè¯é€šè¿‡ï¼ˆBUILD SUCCESSFULï¼‰
- [ ] åŠŸèƒ½æµ‹è¯•éªŒè¯ï¼ˆå¾…ç”¨æˆ·æµ‹è¯•ï¼‰

### 6.2 ä¿®å¤æ–¹æ¡ˆ

**é‡‡ç”¨æ–¹æ¡ˆ**ï¼šåˆ é™¤ app æ¨¡å—ä¸­çš„é‡å¤å¸ƒå±€æ–‡ä»¶ï¼Œè®© TabSwitcher ç»„ä»¶ä½¿ç”¨ presentation æ¨¡å—çš„å¸ƒå±€æ–‡ä»¶ã€‚

**ä¿®å¤åŸå› **ï¼š
- é¿å…ç»´æŠ¤ä¸¤ä»½ç›¸åŒçš„å¸ƒå±€æ–‡ä»¶
- å‡å°‘æœªæ¥åŒæ­¥é—®é¢˜çš„é£é™©
- ç¬¦åˆ Clean Architecture çš„èµ„æºç®¡ç†åŸåˆ™

### 6.3 éªŒè¯æ–¹æ³•

1. ç¼–è¯‘å®‰è£…APK
2. æ‰“å¼€æ‚¬æµ®çª—
3. ç‚¹å‡»ç¬¬4ä¸ªTab"ğŸ’¡ é—®ç­”"
4. éªŒè¯Tabåˆ‡æ¢æˆåŠŸï¼Œè”ç³»äººé€‰æ‹©å™¨éšè—
5. è¾“å…¥æŸ¥è¯¢å†…å®¹ï¼Œç‚¹å‡»æäº¤
6. éªŒè¯AIè¿”å›ç»“æœæ­£ç¡®æ˜¾ç¤º

