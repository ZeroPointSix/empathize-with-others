# BUG-00054: æ¨¡å‹åˆ—è¡¨é•¿æ–‡æœ¬æˆªæ–­é—®é¢˜

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

### é—®é¢˜æè¿°
åœ¨"ç¼–è¾‘æœåŠ¡å•†"é¡µé¢çš„æ¨¡å‹åˆ—è¡¨ä¸­ï¼Œæ¨¡å‹åç§°ï¼ˆå¦‚"Qwen/Qwen2.5 72B"ã€"Qwen/Qwen2.5 Coder"ï¼‰å¤ªé•¿è¢«æˆªæ–­ï¼Œç”¨æˆ·æ— æ³•çœ‹åˆ°å®Œæ•´çš„æ¨¡å‹åç§°ã€‚

### å½±å“èŒƒå›´
- æ–‡ä»¶ï¼š`presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/ios/IOSModelListItem.kt`
- å½±å“é¡µé¢ï¼šç¼–è¾‘æœåŠ¡å•†é¡µé¢ã€æ·»åŠ æœåŠ¡å•†é¡µé¢çš„æ¨¡å‹åˆ—è¡¨

### ä¼˜å…ˆçº§
- **P1ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰**ï¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œç”¨æˆ·æ— æ³•åŒºåˆ†ç›¸ä¼¼åç§°çš„æ¨¡å‹

---

## ğŸ” æ·±åº¦è¯Šæ–­

### é—®é¢˜ç°è±¡
ä»ç”¨æˆ·æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼š
- æ¨¡å‹åç§°å¦‚"Qwen/Qwen Image"ã€"Qwen/Qwen2.5 Coder"ç­‰è¢«æˆªæ–­
- åªèƒ½çœ‹åˆ°éƒ¨åˆ†åç§°ï¼Œæ— æ³•åŒºåˆ†ä¸åŒçš„æ¨¡å‹å˜ä½“
- å³ä½¿ä½¿ç”¨äº†AdaptiveDimensionså“åº”å¼å­—ä½“ï¼Œé—®é¢˜ä»ç„¶å­˜åœ¨

### æ ¹æœ¬åŸå› åˆ†æ

**æ ¸å¿ƒé—®é¢˜**ï¼šAdaptiveDimensionsçš„å­—ä½“ç¼©æ”¾æ˜¯**åŸºäºå±å¹•å°ºå¯¸**çš„ï¼Œè€Œä¸æ˜¯**åŸºäºæ–‡æœ¬å†…å®¹é•¿åº¦**çš„ã€‚

**AdaptiveDimensionsçš„ç¼©æ”¾é€»è¾‘**ï¼š
```kotlin
// å±å¹•å°ºå¯¸ç¼©æ”¾å› å­
val scaleFactor = when (screenSizeType) {
    ScreenSizeType.COMPACT -> 0.85f    // å°å±æ‰‹æœº
    ScreenSizeType.MEDIUM -> 1.0f      // æ™®é€šæ‰‹æœº
    ScreenSizeType.EXPANDED -> 1.1f    // å¤§å±æ‰‹æœº
    ScreenSizeType.LARGE -> 1.2f       // å¹³æ¿
}

// fontSizeBody = 14 * scaleFactor * å…¶ä»–å› å­
// åœ¨æ™®é€šæ‰‹æœºä¸Šçº¦ä¸º14spï¼Œåœ¨å°å±æ‰‹æœºä¸Šçº¦ä¸º11.9sp
```

**é—®é¢˜åˆ†æ**ï¼š
1. å³ä½¿åœ¨å°å±æ‰‹æœºä¸Šï¼ŒfontSizeBodyä¹Ÿåªç¼©å°åˆ°11.9sp
2. å¯¹äºè¶…é•¿æ–‡æœ¬ï¼ˆå¦‚"Qwen/Qwen2.5 72B Instruct 128K"ï¼‰ï¼Œè¿™ä¸ªç¼©æ”¾å¹…åº¦ä¸è¶³ä»¥å®Œå…¨æ˜¾ç¤º
3. å½“å‰ä½¿ç”¨`TextOverflow.Ellipsis`ä¼šæˆªæ–­æ–‡æœ¬å¹¶æ˜¾ç¤ºçœç•¥å·
4. ç”¨æˆ·æ— æ³•çœ‹åˆ°å®Œæ•´çš„æ¨¡å‹åç§°ï¼Œæ— æ³•åŒºåˆ†ç›¸ä¼¼çš„æ¨¡å‹

### å½“å‰å®ç°ï¼ˆIOSModelListItem.ktï¼‰

```kotlin
Text(
    text = displayName.ifBlank { modelId },
    fontSize = dimensions.fontSizeBody,  // å“åº”å¼å­—ä½“ï¼Œä½†ä¸ä¼šæ ¹æ®æ–‡æœ¬é•¿åº¦ç¼©å°
    color = iOSTextPrimary,
    maxLines = 1,
    overflow = TextOverflow.Ellipsis,  // è¶…å‡ºéƒ¨åˆ†æ˜¾ç¤ºçœç•¥å·
    modifier = Modifier.weight(1f)
)
```

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šä½¿ç”¨autoSizeTextï¼ˆæ¨èï¼‰

ä½¿ç”¨Composeçš„`autoSizeText`åŠŸèƒ½ï¼Œè®©æ–‡æœ¬è‡ªåŠ¨ç¼©å°ä»¥é€‚åº”å¯ç”¨ç©ºé—´ã€‚

**å®ç°æ–¹å¼**ï¼š
```kotlin
import androidx.compose.ui.text.style.TextOverflow
import androidx.compose.ui.unit.TextUnit

@Composable
fun AutoSizeText(
    text: String,
    modifier: Modifier = Modifier,
    maxFontSize: TextUnit,
    minFontSize: TextUnit,
    color: Color = Color.Unspecified,
    maxLines: Int = 1
) {
    var fontSize by remember { mutableStateOf(maxFontSize) }
    var readyToDraw by remember { mutableStateOf(false) }

    Text(
        text = text,
        modifier = modifier.drawWithContent {
            if (readyToDraw) drawContent()
        },
        fontSize = fontSize,
        color = color,
        maxLines = maxLines,
        overflow = TextOverflow.Ellipsis,
        onTextLayout = { textLayoutResult ->
            if (textLayoutResult.didOverflowWidth && fontSize > minFontSize) {
                fontSize = (fontSize.value * 0.9f).sp
            } else {
                readyToDraw = true
            }
        }
    )
}
```

### æ–¹æ¡ˆBï¼šä½¿ç”¨ä¸¤è¡Œæ˜¾ç¤º

å…è®¸æ¨¡å‹åç§°æ˜¾ç¤ºä¸¤è¡Œï¼Œè€Œä¸æ˜¯å¼ºåˆ¶å•è¡Œã€‚

```kotlin
Text(
    text = displayName.ifBlank { modelId },
    fontSize = dimensions.fontSizeBody,
    color = iOSTextPrimary,
    maxLines = 2,  // å…è®¸ä¸¤è¡Œ
    overflow = TextOverflow.Ellipsis,
    modifier = Modifier.weight(1f)
)
```

### æ–¹æ¡ˆCï¼šä½¿ç”¨Marqueeæ•ˆæœï¼ˆæ»šåŠ¨æ˜¾ç¤ºï¼‰

å¯¹äºè¶…é•¿æ–‡æœ¬ï¼Œä½¿ç”¨æ°´å¹³æ»šåŠ¨æ•ˆæœã€‚

```kotlin
Text(
    text = displayName.ifBlank { modelId },
    fontSize = dimensions.fontSizeBody,
    color = iOSTextPrimary,
    maxLines = 1,
    modifier = Modifier
        .weight(1f)
        .basicMarquee()  // Compose 1.6.0+
)
```

### æ¨èæ–¹æ¡ˆ

**é‡‡ç”¨æ–¹æ¡ˆAï¼ˆautoSizeTextï¼‰**ï¼ŒåŸå› ï¼š
1. ä¿æŒå•è¡Œæ˜¾ç¤ºï¼Œä¸æ”¹å˜åˆ—è¡¨é¡¹é«˜åº¦
2. è‡ªåŠ¨ç¼©å°å­—ä½“ä»¥é€‚åº”å¯ç”¨ç©ºé—´
3. ç”¨æˆ·å¯ä»¥çœ‹åˆ°å®Œæ•´çš„æ¨¡å‹åç§°
4. ç¬¦åˆiOSè®¾è®¡è§„èŒƒ

---

## ğŸ“ å®æ–½è®¡åˆ’

### ä»»åŠ¡æ¸…å•

| ä»»åŠ¡ID | æè¿° | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|--------|------|--------|------|
| T1 | åˆ›å»ºAutoSizeTextç»„ä»¶ | P0 | å¾…å®æ–½ |
| T2 | ä¿®æ”¹IOSModelListItemä½¿ç”¨AutoSizeText | P0 | å¾…å®æ–½ |
| T3 | ç¼–å†™å•å…ƒæµ‹è¯• | P1 | å¾…å®æ–½ |
| T4 | çœŸæœºæµ‹è¯•éªŒè¯ | P0 | å¾…å®æ–½ |

### ä¿®æ”¹æ–‡ä»¶

1. **æ–°å¢**ï¼š`presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/text/AutoSizeText.kt`
2. **ä¿®æ”¹**ï¼š`presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/ios/IOSModelListItem.kt`
3. **æ–°å¢**ï¼š`presentation/src/test/kotlin/com/empathy/ai/presentation/ui/component/text/AutoSizeTextTest.kt`

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### å•å…ƒæµ‹è¯•

```kotlin
class AutoSizeTextTest {
    @get:Rule
    val composeTestRule = createComposeRule()

    @Test
    fun `çŸ­æ–‡æœ¬åº”è¯¥ä½¿ç”¨æœ€å¤§å­—ä½“`() {
        composeTestRule.setContent {
            AutoSizeText(
                text = "GPT-4",
                maxFontSize = 14.sp,
                minFontSize = 10.sp
            )
        }
        // éªŒè¯å­—ä½“å¤§å°ä¸º14sp
    }

    @Test
    fun `é•¿æ–‡æœ¬åº”è¯¥è‡ªåŠ¨ç¼©å°å­—ä½“`() {
        composeTestRule.setContent {
            AutoSizeText(
                text = "Qwen/Qwen2.5 72B Instruct 128K",
                maxFontSize = 14.sp,
                minFontSize = 10.sp,
                modifier = Modifier.width(200.dp)
            )
        }
        // éªŒè¯å­—ä½“å¤§å°å°äº14sp
    }

    @Test
    fun `è¶…é•¿æ–‡æœ¬åº”è¯¥ä½¿ç”¨æœ€å°å­—ä½“å¹¶æ˜¾ç¤ºçœç•¥å·`() {
        composeTestRule.setContent {
            AutoSizeText(
                text = "Qwen/Qwen2.5 72B Instruct 128K Very Long Model Name",
                maxFontSize = 14.sp,
                minFontSize = 10.sp,
                modifier = Modifier.width(100.dp)
            )
        }
        // éªŒè¯å­—ä½“å¤§å°ä¸º10spï¼Œä¸”æ˜¾ç¤ºçœç•¥å·
    }
}
```

### çœŸæœºæµ‹è¯•

1. æ‰“å¼€"ç¼–è¾‘æœåŠ¡å•†"é¡µé¢
2. æŸ¥çœ‹æ¨¡å‹åˆ—è¡¨
3. éªŒè¯é•¿æ¨¡å‹åç§°ï¼ˆå¦‚"Qwen/Qwen2.5 72B"ï¼‰èƒ½å¤Ÿå®Œæ•´æ˜¾ç¤ºæˆ–ä»¥è¾ƒå°å­—ä½“æ˜¾ç¤º
4. éªŒè¯çŸ­æ¨¡å‹åç§°ï¼ˆå¦‚"GPT-4"ï¼‰ä½¿ç”¨æ­£å¸¸å­—ä½“å¤§å°

---

## ğŸ“Š éªŒè¯æ–¹æ³•

### éªŒè¯æ ‡å‡†

1. **çŸ­æ–‡æœ¬**ï¼ˆ<15å­—ç¬¦ï¼‰ï¼šä½¿ç”¨æ­£å¸¸å­—ä½“å¤§å°ï¼ˆ14spï¼‰
2. **ä¸­ç­‰æ–‡æœ¬**ï¼ˆ15-25å­—ç¬¦ï¼‰ï¼šå­—ä½“é€‚å½“ç¼©å°ï¼ˆ12-14spï¼‰
3. **é•¿æ–‡æœ¬**ï¼ˆ>25å­—ç¬¦ï¼‰ï¼šå­—ä½“ç¼©å°åˆ°æœ€å°å€¼ï¼ˆ10spï¼‰ï¼Œå¿…è¦æ—¶æ˜¾ç¤ºçœç•¥å·
4. **æ‰€æœ‰æ–‡æœ¬**ï¼šä¿æŒå¯è¯»æ€§ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒ

### æµ‹è¯•è®¾å¤‡

- OPPOçœŸæœºï¼ˆColorOSï¼‰
- åä¸ºçœŸæœºï¼ˆEMUI/HarmonyOSï¼‰
- ä¸åŒå±å¹•å°ºå¯¸çš„è®¾å¤‡

---

## ğŸ“ å…³è”æ–‡æ¡£

- BUG-00052: AIå†›å¸ˆç•Œé¢å¸ƒå±€ä¸å­—ä½“è‡ªé€‚åº”é—®é¢˜
- AdaptiveDimensions.kt: å“åº”å¼å°ºå¯¸ç³»ç»Ÿ
- IOSModelListItem.kt: æ¨¡å‹åˆ—è¡¨é¡¹ç»„ä»¶

---

## ğŸ“… æ—¶é—´çº¿

- **åˆ›å»ºæ—¥æœŸ**: 2026-01-09
- **é¢„è®¡å®Œæˆ**: 2026-01-09
- **å®é™…å®Œæˆ**: å¾…å®š

---

## âœ… ä¿®å¤è®°å½•

### ä¿®å¤æ—¥æœŸï¼šå¾…å®š
### ä¿®å¤è€…ï¼šå¾…å®š

### ä¿®å¤å†…å®¹
å¾…å®æ–½

### ä¿®å¤çŠ¶æ€
| é—®é¢˜ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|--------|------|
| æ¨¡å‹åç§°æˆªæ–­ | P1 | å¾…ä¿®å¤ |
