# BUG-00061-ä¼šè¯å†å²è·³è½¬å¤±æ•ˆé—®é¢˜

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| æ–‡æ¡£ç¼–å· | BUG-00061 |
| åˆ›å»ºæ—¥æœŸ | 2026-01-09 |
| é—®é¢˜æ¥æº | ç”¨æˆ·åé¦ˆ |
| ä¼˜å…ˆçº§ | P0 (ç´§æ€¥) |
| çŠ¶æ€ | âœ… å·²ä¿®å¤ |
| å…³è”BUG | BUG-00058, BUG-00060 |
| å…³è”åŠŸèƒ½ | AIå†›å¸ˆä¼šè¯ç®¡ç† |

---

## 1. é—®é¢˜æè¿°

### 1.1 é—®é¢˜æ¦‚è¿°

ç”¨æˆ·åé¦ˆAIå†›å¸ˆä¼šè¯å†å²åŠŸèƒ½å­˜åœ¨ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š

1. **ç‚¹å‡»å†å²ä¼šè¯æ— æ³•è·³è½¬**ï¼šåœ¨ä¼šè¯å†å²åˆ—è¡¨ä¸­ç‚¹å‡»æŸä¸ªå·²æœ‰ä¼šè¯ï¼Œæ²¡æœ‰è·³è½¬åˆ°è¯¥å†å²ä¼šè¯ï¼Œè€Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç©ºç™½ä¼šè¯
2. **æ–°å»ºä¼šè¯ä¸å¯è§**ï¼šæ–°å»ºä¼šè¯åï¼Œåœ¨ç•Œé¢ä¸Šçœ‹ä¸åˆ°æ–°åˆ›å»ºçš„ä¼šè¯

### 1.2 å¤ç°æ­¥éª¤

**é—®é¢˜1ï¼šç‚¹å‡»å†å²ä¼šè¯æ— æ³•è·³è½¬**
1. è¿›å…¥AIå†›å¸ˆå¯¹è¯ç•Œé¢
2. ç‚¹å‡»ä¼šè¯å†å²æŒ‰é’®ï¼Œè¿›å…¥ä¼šè¯å†å²åˆ—è¡¨
3. ç‚¹å‡»åˆ—è¡¨ä¸­çš„æŸä¸ªå†å²ä¼šè¯
4. **é¢„æœŸ**ï¼šè·³è½¬åˆ°è¯¥å†å²ä¼šè¯ï¼Œæ˜¾ç¤ºä¹‹å‰çš„å¯¹è¯å†…å®¹
5. **å®é™…**ï¼šè·³è½¬åˆ°ä¸€ä¸ªç©ºç™½ç•Œé¢ï¼Œæ²¡æœ‰æ˜¾ç¤ºå†å²å¯¹è¯å†…å®¹

**é—®é¢˜2ï¼šæ–°å»ºä¼šè¯ä¸å¯è§**
1. è¿›å…¥AIå†›å¸ˆå¯¹è¯ç•Œé¢
2. ç‚¹å‡»ä¼šè¯å†å²æŒ‰é’®
3. ç‚¹å‡»"æ–°å»º"æŒ‰é’®
4. **é¢„æœŸ**ï¼šåˆ›å»ºæ–°ä¼šè¯å¹¶è·³è½¬ï¼Œæ–°ä¼šè¯åœ¨å†å²åˆ—è¡¨ä¸­å¯è§
5. **å®é™…**ï¼šè¿”å›ç©ºç™½ç•Œé¢ï¼Œæ–°ä¼šè¯åœ¨å†å²åˆ—è¡¨ä¸­ä¸å¯è§

### 1.3 å½±å“èŒƒå›´

- **ç”¨æˆ·ä½“éªŒ**ï¼šæ— æ³•æŸ¥çœ‹å†å²å¯¹è¯ï¼Œä¸¥é‡å½±å“ä½¿ç”¨
- **åŠŸèƒ½å®Œæ•´æ€§**ï¼šä¼šè¯å†å²åŠŸèƒ½å®Œå…¨å¤±æ•ˆ
- **æ•°æ®ä¸€è‡´æ€§**ï¼šå¯èƒ½äº§ç”Ÿå¤§é‡å­¤ç«‹çš„ç©ºç™½ä¼šè¯

---

## 2. æ ¹å› åˆ†æ

### 2.1 é—®é¢˜å®šä½

é€šè¿‡ä»£ç åˆ†æï¼Œå®šä½åˆ°é—®é¢˜çš„æ ¹æœ¬åŸå› åœ¨ `NavGraph.kt` æ–‡ä»¶ä¸­ï¼š

**é—®é¢˜ä»£ç ï¼ˆç¬¬287-292è¡Œï¼‰**ï¼š
```kotlin
onNavigateToChat = { sessionId ->
    // åŠ è½½æŒ‡å®šä¼šè¯å¹¶è¿”å›å¯¹è¯ç•Œé¢
    navController.navigate(NavRoutes.aiAdvisorChat(contactId)) {
        popUpTo(NavRoutes.AI_ADVISOR_SESSIONS) { inclusive = true }
    }
}
```

### 2.2 æ ¹æœ¬åŸå› 

**å‚æ•°ä¼ é€’é“¾æ–­è£‚**ï¼š
- `SessionHistoryScreen` æ­£ç¡®è°ƒç”¨ `onNavigateToChat(sessionId)`ï¼Œä¼ é€’äº†ä¼šè¯ID
- `NavGraph` ä¸­çš„å›è°ƒæ¥æ”¶äº† `sessionId` å‚æ•°ï¼Œä½†**æ²¡æœ‰ä½¿ç”¨å®ƒ**
- å¯¼èˆªæ—¶åªä¼ é€’äº† `contactId`ï¼Œæ²¡æœ‰ä¼ é€’ `sessionId`
- `AiAdvisorChatViewModel` æ— æ³•çŸ¥é“åº”è¯¥åŠ è½½å“ªä¸ªä¼šè¯
- ViewModel é»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªä¼šè¯æˆ–åˆ›å»ºæ–°ä¼šè¯

### 2.3 æ•°æ®æµåˆ†æ

**æ­£ç¡®çš„æ•°æ®æµï¼ˆæœŸæœ›ï¼‰**ï¼š
```
ç”¨æˆ·ç‚¹å‡»å†å²ä¼šè¯
    â†“
SessionHistoryScreen è°ƒç”¨ onNavigateToChat(sessionId)
    â†“
NavGraph å¯¼èˆªåˆ° aiAdvisorChat(contactId, sessionId=xxx)
    â†“
AiAdvisorChatScreen æ¥æ”¶ sessionId å‚æ•°
    â†“
ViewModel æ ¹æ® sessionId åŠ è½½æŒ‡å®šä¼šè¯
    â†“
æ˜¾ç¤ºè¯¥ä¼šè¯çš„å¯¹è¯å†…å®¹ âœ…
```

**å½“å‰çš„æ•°æ®æµï¼ˆé”™è¯¯ï¼‰**ï¼š
```
ç”¨æˆ·ç‚¹å‡»å†å²ä¼šè¯
    â†“
SessionHistoryScreen è°ƒç”¨ onNavigateToChat(sessionId)
    â†“
NavGraph å¯¼èˆªåˆ° aiAdvisorChat(contactId)  â† âŒ sessionIdä¸¢å¤±
    â†“
AiAdvisorChatScreen æ¥æ”¶ä¸åˆ° sessionId
    â†“
ViewModel åŠ è½½æ‰€æœ‰ä¼šè¯ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª
    â†“
æ˜¾ç¤ºé”™è¯¯çš„ä¼šè¯å†…å®¹ âŒ
```

### 2.4 è·¯ç”±å®šä¹‰ç¼ºé™·

å½“å‰ `NavRoutes.kt` ä¸­çš„è·¯ç”±å®šä¹‰ä¸æ”¯æŒ `sessionId` å‚æ•°ï¼š

```kotlin
// å½“å‰å®šä¹‰
const val AI_ADVISOR_CHAT = "ai_advisor_chat/{contactId}?createNew={createNew}"
fun aiAdvisorChat(contactId: String, createNew: Boolean = false): String

// ç¼ºå°‘ sessionId å‚æ•°æ”¯æŒ
```

---

## 3. ä¿®å¤æ–¹æ¡ˆ

### 3.1 æ–¹æ¡ˆæ¦‚è¿°

| ä¿®æ”¹æ–‡ä»¶ | ä¿®æ”¹ç±»å‹ | è¯´æ˜ |
|----------|----------|------|
| `NavRoutes.kt` | ä¿®æ”¹ | æ·»åŠ sessionIdå‚æ•°æ”¯æŒ |
| `NavGraph.kt` | ä¿®æ”¹ | ä¼ é€’sessionIdå‚æ•° |
| `AiAdvisorChatScreen.kt` | ä¿®æ”¹ | æ¥æ”¶sessionIdå‚æ•° |
| `AiAdvisorChatViewModel.kt` | ä¿®æ”¹ | æ ¹æ®sessionIdåŠ è½½ä¼šè¯ |

### 3.2 è¯¦ç»†ä¿®æ”¹æ–¹æ¡ˆ

#### 3.2.1 NavRoutes.kt

**ä¿®æ”¹è·¯ç”±å¸¸é‡**ï¼š
```kotlin
// ä¿®æ”¹å‰
const val AI_ADVISOR_CHAT = "ai_advisor_chat/{contactId}?createNew={createNew}"
const val AI_ADVISOR_CHAT_ARG_CREATE_NEW = "createNew"

// ä¿®æ”¹å
const val AI_ADVISOR_CHAT = "ai_advisor_chat/{contactId}?createNew={createNew}&sessionId={sessionId}"
const val AI_ADVISOR_CHAT_ARG_CREATE_NEW = "createNew"
const val AI_ADVISOR_CHAT_ARG_SESSION_ID = "sessionId"  // æ–°å¢
```

**ä¿®æ”¹è¾…åŠ©å‡½æ•°**ï¼š
```kotlin
// ä¿®æ”¹å‰
fun aiAdvisorChat(contactId: String, createNew: Boolean = false): String {
    return "ai_advisor_chat/$contactId?createNew=$createNew"
}

// ä¿®æ”¹å
fun aiAdvisorChat(
    contactId: String, 
    createNew: Boolean = false,
    sessionId: String? = null  // æ–°å¢å‚æ•°
): String {
    val base = "ai_advisor_chat/$contactId?createNew=$createNew"
    return if (sessionId != null) {
        "$base&sessionId=$sessionId"
    } else {
        base
    }
}
```

#### 3.2.2 NavGraph.kt

**ä¿®æ”¹è·¯ç”±å®šä¹‰**ï¼š
```kotlin
// ä¿®æ”¹composableè·¯ç”±ï¼Œæ·»åŠ sessionIdå‚æ•°
composable(
    route = NavRoutes.AI_ADVISOR_CHAT,
    arguments = listOf(
        navArgument(NavRoutes.AI_ADVISOR_CHAT_ARG_ID) {
            type = NavType.StringType
        },
        navArgument(NavRoutes.AI_ADVISOR_CHAT_ARG_CREATE_NEW) {
            type = NavType.BoolType
            defaultValue = false
        },
        navArgument(NavRoutes.AI_ADVISOR_CHAT_ARG_SESSION_ID) {  // æ–°å¢
            type = NavType.StringType
            nullable = true
            defaultValue = null
        }
    )
)
```

**ä¿®æ”¹onNavigateToChatå›è°ƒ**ï¼š
```kotlin
// ä¿®æ”¹å‰
onNavigateToChat = { sessionId ->
    navController.navigate(NavRoutes.aiAdvisorChat(contactId)) {
        popUpTo(NavRoutes.AI_ADVISOR_SESSIONS) { inclusive = true }
    }
}

// ä¿®æ”¹å
onNavigateToChat = { sessionId ->
    navController.navigate(NavRoutes.aiAdvisorChat(contactId, sessionId = sessionId)) {
        popUpTo(NavRoutes.AI_ADVISOR_SESSIONS) { inclusive = true }
    }
}
```

#### 3.2.3 AiAdvisorChatScreen.kt

**æ·»åŠ sessionIdå‚æ•°**ï¼š
```kotlin
// ä¿®æ”¹å‰
@Composable
fun AiAdvisorChatScreen(
    createNew: Boolean = false,
    onNavigateBack: () -> Unit,
    // ...
)

// ä¿®æ”¹å
@Composable
fun AiAdvisorChatScreen(
    createNew: Boolean = false,
    sessionId: String? = null,  // æ–°å¢å‚æ•°
    onNavigateBack: () -> Unit,
    // ...
)
```

**å¤„ç†sessionIdå‚æ•°**ï¼š
```kotlin
// ä¿®æ”¹LaunchedEffect
LaunchedEffect(createNew, sessionId) {
    when {
        createNew -> {
            // åˆ›å»ºæ–°ä¼šè¯ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
            viewModel.createNewSessionFromNavigation()
        }
        sessionId != null -> {
            // åŠ è½½æŒ‡å®šä¼šè¯
            viewModel.loadSessionById(sessionId)
        }
        // å¦åˆ™ä¿æŒé»˜è®¤è¡Œä¸ºï¼ˆåŠ è½½ç¬¬ä¸€ä¸ªä¼šè¯ï¼‰
    }
}
```

#### 3.2.4 AiAdvisorChatViewModel.kt

**æ·»åŠ loadSessionByIdæ–¹æ³•**ï¼š
```kotlin
/**
 * BUG-00061: æ ¹æ®sessionIdåŠ è½½æŒ‡å®šä¼šè¯
 * 
 * å½“ç”¨æˆ·ä»ä¼šè¯å†å²é¡µé¢ç‚¹å‡»æŸä¸ªä¼šè¯æ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚
 * 
 * @param sessionId è¦åŠ è½½çš„ä¼šè¯ID
 */
fun loadSessionById(sessionId: String) {
    viewModelScope.launch {
        _uiState.update { it.copy(isLoading = true) }
        
        aiAdvisorRepository.getSessionById(sessionId).onSuccess { session ->
            if (session != null) {
                _uiState.update { currentState ->
                    currentState.copy(
                        currentSessionId = session.id,
                        isLoading = false
                    )
                }
                // åŠ è½½è¯¥ä¼šè¯çš„å¯¹è¯å†…å®¹
                loadConversations(session.id)
                // åŒæ—¶åŠ è½½ä¼šè¯åˆ—è¡¨ä»¥ä¿æŒUIåŒæ­¥
                loadSessions(contactId)
            } else {
                // ä¼šè¯ä¸å­˜åœ¨ï¼Œæ˜¾ç¤ºé”™è¯¯
                _uiState.update { 
                    it.copy(
                        error = "ä¼šè¯ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤",
                        isLoading = false
                    ) 
                }
            }
        }.onFailure { error ->
            _uiState.update { 
                it.copy(
                    error = error.message ?: "åŠ è½½ä¼šè¯å¤±è´¥",
                    isLoading = false
                ) 
            }
        }
    }
}
```

### 3.3 ä¼˜å…ˆçº§é€»è¾‘

ä¿®å¤åçš„ä¼šè¯åŠ è½½ä¼˜å…ˆçº§ï¼š

```
1. createNew=true â†’ åˆ›å»ºæ–°ä¼šè¯ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. sessionIdä¸ä¸ºç©º â†’ åŠ è½½æŒ‡å®šä¼šè¯
3. éƒ½ä¸ºç©º â†’ ä¿æŒåŸæœ‰é€»è¾‘ï¼ˆåŠ è½½ç¬¬ä¸€ä¸ªä¼šè¯æˆ–åˆ›å»ºæ–°ä¼šè¯ï¼‰
```

---

## 4. æµ‹è¯•ç”¨ä¾‹

### 4.1 TC-001: ç‚¹å‡»å†å²ä¼šè¯è·³è½¬åˆ°æŒ‡å®šä¼šè¯

**å‰ç½®æ¡ä»¶**: è”ç³»äººå·²æœ‰å¤šä¸ªå†å²ä¼šè¯ï¼Œæ¯ä¸ªä¼šè¯éƒ½æœ‰å¯¹è¯å†…å®¹

**æ­¥éª¤**:
1. è¿›å…¥AIå†›å¸ˆå¯¹è¯ç•Œé¢
2. ç‚¹å‡»ä¼šè¯å†å²æŒ‰é’®
3. ç‚¹å‡»åˆ—è¡¨ä¸­çš„ç¬¬äºŒä¸ªä¼šè¯

**é¢„æœŸç»“æœ**:
- è·³è½¬åˆ°å¯¹è¯ç•Œé¢
- æ˜¾ç¤ºç¬¬äºŒä¸ªä¼šè¯çš„å¯¹è¯å†…å®¹
- å½“å‰ä¼šè¯IDä¸ºç¬¬äºŒä¸ªä¼šè¯çš„ID

### 4.2 TC-002: æ–°å»ºä¼šè¯åŠŸèƒ½æ­£å¸¸

**å‰ç½®æ¡ä»¶**: è”ç³»äººå·²æœ‰å†å²ä¼šè¯

**æ­¥éª¤**:
1. è¿›å…¥AIå†›å¸ˆå¯¹è¯ç•Œé¢
2. ç‚¹å‡»ä¼šè¯å†å²æŒ‰é’®
3. ç‚¹å‡»"æ–°å»º"æŒ‰é’®

**é¢„æœŸç»“æœ**:
- è·³è½¬åˆ°å¯¹è¯ç•Œé¢
- æ˜¾ç¤ºç©ºç™½å¯¹è¯ç•Œé¢
- æ–°ä¼šè¯åœ¨å†å²åˆ—è¡¨ä¸­å¯è§

### 4.3 TC-003: sessionIdæ— æ•ˆæ—¶çš„é”™è¯¯å¤„ç†

**å‰ç½®æ¡ä»¶**: æ— 

**æ­¥éª¤**:
1. é€šè¿‡URLç›´æ¥è®¿é—®å¸¦æœ‰æ— æ•ˆsessionIdçš„è·¯ç”±
2. è§‚å¯Ÿç•Œé¢è¡Œä¸º

**é¢„æœŸç»“æœ**:
- æ˜¾ç¤º"ä¼šè¯ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤"é”™è¯¯æç¤º
- ä¸å´©æºƒï¼Œä¿æŒç•Œé¢ç¨³å®š

### 4.4 TC-004: createNewå’ŒsessionIdåŒæ—¶å­˜åœ¨æ—¶çš„ä¼˜å…ˆçº§

**å‰ç½®æ¡ä»¶**: è”ç³»äººå·²æœ‰å†å²ä¼šè¯

**æ­¥éª¤**:
1. é€šè¿‡URLè®¿é—®å¸¦æœ‰createNew=trueå’ŒsessionIdçš„è·¯ç”±

**é¢„æœŸç»“æœ**:
- createNewä¼˜å…ˆçº§æ›´é«˜
- åˆ›å»ºæ–°ä¼šè¯ï¼Œå¿½ç•¥sessionId

### 4.5 TC-005: ä¼šè¯å·²åˆ é™¤æ—¶çš„é”™è¯¯å¤„ç†

**å‰ç½®æ¡ä»¶**: 
1. è”ç³»äººæœ‰ä¸€ä¸ªä¼šè¯A
2. åœ¨å¦ä¸€ä¸ªè®¾å¤‡/çª—å£åˆ é™¤ä¼šè¯A

**æ­¥éª¤**:
1. åœ¨ä¼šè¯å†å²åˆ—è¡¨ä¸­ç‚¹å‡»ä¼šè¯A

**é¢„æœŸç»“æœ**:
- æ˜¾ç¤º"ä¼šè¯ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤"é”™è¯¯æç¤º
- è‡ªåŠ¨åˆ·æ–°ä¼šè¯åˆ—è¡¨

---

## 5. éªŒè¯æ¸…å•

### 5.1 åŠŸèƒ½éªŒè¯
- [ ] ç‚¹å‡»å†å²ä¼šè¯èƒ½æ­£ç¡®è·³è½¬åˆ°æŒ‡å®šä¼šè¯
- [ ] æ–°å»ºä¼šè¯åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ–°å»ºçš„ä¼šè¯åœ¨å†å²åˆ—è¡¨ä¸­å¯è§
- [ ] sessionIdæ— æ•ˆæ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
- [ ] createNewä¼˜å…ˆçº§é«˜äºsessionId

### 5.2 è¾¹ç•Œæƒ…å†µ
- [ ] ç©ºä¼šè¯åˆ—è¡¨æ—¶çš„å¤„ç†
- [ ] ä¼šè¯å·²åˆ é™¤æ—¶çš„å¤„ç†
- [ ] ç½‘ç»œé”™è¯¯æ—¶çš„å¤„ç†
- [ ] å¹¶å‘æ“ä½œæ—¶çš„æ•°æ®ä¸€è‡´æ€§

### 5.3 å›å½’æµ‹è¯•
- [ ] åŸæœ‰çš„ä¼šè¯åˆ›å»ºåŠŸèƒ½ä¸å—å½±å“
- [ ] åŸæœ‰çš„ä¼šè¯åˆ é™¤åŠŸèƒ½ä¸å—å½±å“
- [ ] åŸæœ‰çš„ä¼šè¯é‡å‘½ååŠŸèƒ½ä¸å—å½±å“
- [ ] åŸæœ‰çš„ä¼šè¯ç½®é¡¶åŠŸèƒ½ä¸å—å½±å“

---

## 6. é£é™©è¯„ä¼°

| é£é™©é¡¹ | ç­‰çº§ | è¯´æ˜ | ç¼“è§£æªæ–½ |
|--------|------|------|----------|
| å¯¼èˆªå‚æ•°å…¼å®¹æ€§ | ä½ | æ–°å¢å‚æ•°å¯èƒ½å½±å“ç°æœ‰å¯¼èˆª | ä½¿ç”¨nullableå’ŒdefaultValue |
| ViewModelçŠ¶æ€ç®¡ç† | ä½ | æ–°å¢æ–¹æ³•å¯èƒ½å½±å“çŠ¶æ€ | å¤ç”¨ç°æœ‰çš„loadConversationsæ–¹æ³• |
| æµ‹è¯•è¦†ç›– | ä¸­ | éœ€è¦æ–°å¢æµ‹è¯•ç”¨ä¾‹ | ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•å’ŒUIæµ‹è¯• |

---

## 7. ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹ç±»å‹ | è¯´æ˜ |
|----------|----------|------|
| `presentation/.../navigation/NavRoutes.kt` | ä¿®æ”¹ | æ·»åŠ sessionIdå‚æ•° |
| `presentation/.../navigation/NavGraph.kt` | ä¿®æ”¹ | ä¼ é€’sessionIdå‚æ•° |
| `presentation/.../ui/screen/advisor/AiAdvisorChatScreen.kt` | ä¿®æ”¹ | æ¥æ”¶sessionIdå‚æ•° |
| `presentation/.../viewmodel/AiAdvisorChatViewModel.kt` | ä¿®æ”¹ | æ·»åŠ loadSessionByIdæ–¹æ³• |

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2026-01-09
**ä¿®å¤çŠ¶æ€**: ğŸ”„ åˆ†æå®Œæˆï¼Œå¾…å®ç°


---

## 8. ä¿®å¤å®ç°è®°å½•

### 8.1 ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹ç±»å‹ | è¯´æ˜ |
|----------|----------|------|
| `presentation/.../navigation/NavRoutes.kt` | ä¿®æ”¹ | æ·»åŠ sessionIdå‚æ•°å¸¸é‡å’Œè¾…åŠ©å‡½æ•° |
| `presentation/.../navigation/NavGraph.kt` | ä¿®æ”¹ | æ·»åŠ sessionIdè·¯ç”±å‚æ•°ï¼Œä¿®æ”¹onNavigateToChatå›è°ƒ |
| `presentation/.../ui/screen/advisor/AiAdvisorChatScreen.kt` | ä¿®æ”¹ | æ·»åŠ sessionIdå‚æ•°ï¼Œå¤„ç†ä¼˜å…ˆçº§é€»è¾‘ |
| `presentation/.../viewmodel/AiAdvisorChatViewModel.kt` | ä¿®æ”¹ | æ·»åŠ loadSessionByIdæ–¹æ³• |

### 8.2 æ ¸å¿ƒä¿®æ”¹å†…å®¹

#### NavRoutes.kt
```kotlin
// æ–°å¢sessionIdå‚æ•°å¸¸é‡
const val AI_ADVISOR_CHAT_ARG_SESSION_ID = "sessionId"

// ä¿®æ”¹è·¯ç”±å®šä¹‰
const val AI_ADVISOR_CHAT = "ai_advisor_chat/{contactId}?createNew={createNew}&sessionId={sessionId}"

// ä¿®æ”¹è¾…åŠ©å‡½æ•°
fun aiAdvisorChat(
    contactId: String, 
    createNew: Boolean = false,
    sessionId: String? = null
): String
```

#### NavGraph.kt
```kotlin
// æ·»åŠ sessionIdè·¯ç”±å‚æ•°
navArgument(NavRoutes.AI_ADVISOR_CHAT_ARG_SESSION_ID) {
    type = NavType.StringType
    nullable = true
    defaultValue = null
}

// ä¿®æ”¹onNavigateToChatå›è°ƒï¼Œä¼ é€’sessionId
onNavigateToChat = { sessionId ->
    navController.navigate(NavRoutes.aiAdvisorChat(contactId, sessionId = sessionId))
}
```

#### AiAdvisorChatScreen.kt
```kotlin
// æ·»åŠ sessionIdå‚æ•°
fun AiAdvisorChatScreen(
    createNew: Boolean = false,
    sessionId: String? = null,  // æ–°å¢
    ...
)

// å¤„ç†ä¼˜å…ˆçº§é€»è¾‘
LaunchedEffect(createNew, sessionId) {
    when {
        createNew -> viewModel.createNewSessionFromNavigation()
        sessionId != null -> viewModel.loadSessionById(sessionId)
    }
}
```

#### AiAdvisorChatViewModel.kt
```kotlin
// æ–°å¢loadSessionByIdæ–¹æ³•
fun loadSessionById(sessionId: String) {
    viewModelScope.launch {
        aiAdvisorRepository.getSessionById(sessionId).onSuccess { session ->
            if (session != null) {
                _uiState.update { it.copy(currentSessionId = session.id) }
                loadConversations(session.id)
                loadSessions(contactId)
            } else {
                _uiState.update { it.copy(error = "ä¼šè¯ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤") }
            }
        }
    }
}
```

### 8.3 éªŒè¯ç»“æœ

- âœ… ä»£ç è¯Šæ–­æ— é”™è¯¯
- âœ… æµ‹è¯•ç”¨ä¾‹å·²ç¼–å†™
- â³ å¾…äººå·¥éªŒæ”¶

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.1
**æœ€åæ›´æ–°**: 2026-01-09
**ä¿®å¤çŠ¶æ€**: âœ… å·²ä¿®å¤
