# BUG-00061：编辑提示词模块点击刷新问题

## 问题概述

【问题分类】用户体验问题

【优先级】P1-高

【发现版本】未知

【发现时间】2025-01-09

---

## 问题描述

### 现象描述

在「设置」-「编辑提示词」模块中，当用户点击表格框切换不同的提示词配置（如「AI总结」、「AI军师润色回复」）时，整个屏幕会触发一次完整的刷新。

### 问题表现

1. **触发场景**：点击表格框切换 AI 总结 / AI 军师润色回复选项时
2. **问题现象**：整个屏幕重新渲染刷新
3. **用户体验**：操作体验极差，正常的选项切换不应该导致全屏刷新

### 期望行为

- 点击选项切换时应该平滑过渡
- 不应该触发全屏刷新
- 切换应该只影响相关内容区域，而非整个页面

### 实际行为

- 点击切换选项时，整个屏幕闪动刷新
- 给用户一种「应用卡顿」或「操作无效」的错觉

---

## 问题分析

### 影响范围

- **功能影响**：「编辑提示词」模块的所有切换操作
- **用户影响**：所有使用编辑提示词功能的用户
- **频率**：每次切换都会触发

### 可能原因（待技术验证）

1. **状态管理**：切换操作触发了全局状态更新，导致页面重建
2. **依赖注入**：可能触发了 ViewModel 或 Repository 的重新初始化
3. **Compose 重组**：Compose 重组范围过大，影响了整个页面
4. **导航重入**：切换可能触发了某种导航重入机制

---

## 测试步骤

1. 进入「设置」页面
2. 点击「编辑提示词」进入编辑界面
3. 点击表格框中的「AI总结」选项
4. 观察屏幕是否发生全屏刷新
5. 切换到「AI军师润色回复」选项
6. 再次观察是否有全屏刷新现象
7. 记录每次切换的视觉体验

---

## 参考方案

### 优化方向

1. **优化状态管理**：确保切换操作只更新必要的状态
2. **缩小重组范围**：使用稳定的 key 和适当的重组范围控制
3. **局部刷新**：只刷新受影响的 UI 组件，而非整个页面
4. **避免不必要的重初始化**：检查依赖注入是否触发了不必要的重建

### 具体建议

- 检查 `remember { }` 和 `derivedStateOf` 的使用
- 确保 StateFlow 的收集不会触发不必要的重组
- 考虑使用 `Stable` 注解优化 Compose 的重组判断

---

## 相关问题

- 来源：BUG-00059 人工测试问题
- 相关模块：「设置」-「编辑提示词」

---

## 备注

这是一个影响用户体验的**交互体验问题**。正常的选择切换不应该让用户感受到全屏刷新。需要从技术层面优化状态管理和 UI 渲染逻辑。
