# DR-00036: TD-00036 区域截图功能任务清单审查报告

> **文档类型**: 文档审查报告 (DR)
> **版本**: 1.0
> **创建日期**: 2026-01-12
> **更新日期**: 2026-01-12
> **负责人**: Codex
> **关联文档**: TD-00036
> **状态**: ✅ 审查完成

---

## 📄 文档信息
- 文档类型、编号、标题: TD-00036 / 区域截图功能任务清单
- 存放路径: `文档/开发文档/TD/TD-00036-区域截图功能任务清单.md`
- 关联的前置文档列表: PRD-00036, FD-00036, TDD-00036

---

## 📊 质量评分
- 格式规范性：8/10
- 内容完整性：8/10
- 开发可行性：7/10
- 架构符合性：7/10
- **功能集成性：6/10**（🔴 新增）
- 整体评分：**7.2/10**

---

## ✅ 优点
- 任务分阶段清晰，覆盖资源、模型能力、多模态DTO、悬浮窗流程与测试。
- 任务粒度细，包含明确文件路径，便于执行与追踪。
- 依赖顺序合理，先基础设置与数据结构，再进入US1/US2与测试收尾。

---

## ⚠️ 需要改进项
- **TD命名/文档信息缺失类型字段**：TD文档信息区未显式标注文档类型（仅编号）。建议补充“文档类型：TD”。
- **资源文件路径不一致**：TDD/FD要求文案与权限落点在 `app/src/main/res`，而TD未包含 `presentation` 资源路径说明，可能与实际资源模块归属产生混淆。
- **部分任务缺少需求追溯**：未使用 `_需求: PRD-00036 ...` 标记，影响需求到任务的可追踪性。

---

## ❌ 严重问题
- **任务清单与实现现状差距大**：多条任务涉及新类/DTO/权限，但当前代码库未见对应落地（详见集成完整性）。该问题不影响TD作为计划本身，但会影响可行性评估与落地节奏。

---

## 🔗 前置文档一致性
- 与 PRD-00036/FD-00036/TDD-00036 的功能范围一致。
- FD 已明确“缩略图列表/权限/降级/失败保留”等，TD任务覆盖对应实现，整体一致。

---

## 🔗 功能集成完整性检查

### 功能组件清单
| 组件类型 | 组件名称 | 集成状态 |
|---------|---------|---------|
| Screen | 无新增页面 | ✅ |
| ViewModel | SettingsViewModel（扩展） | ⚠️（任务计划中） |
| UseCase | 未新增 | ✅ |
| Repository | FloatingWindowPreferencesRepository（扩展） | ⚠️（任务计划中） |
| DAO | 无新增 | ✅ |
| Entity | 无新增 | ✅ |

### 集成点验证
| 集成点 | 文件 | 状态 | 说明 |
|--------|------|------|------|
| 导航注册 | `presentation/navigation/NavGraph.kt` | ✅ | 无新增页面，不需要路由集成 |
| DI绑定 | `app/di/*`, `data/di/*` | ⚠️ | TD未包含DI模块注册任务，可能遗漏 |
| DAO提供 | `data/di/DatabaseModule.kt` | ✅ | 不新增表，无需DAO |
| Entity注册 | `data/local/AppDatabase.kt` | ✅ | 不新增表 |
| 入口点 | `app/domain/service/FloatingWindowService.kt`, `app/domain/util/FloatingView.kt` | ⚠️ | 任务覆盖入口，但尚未实现 |
| 调用链完整 | Service → DTO → Repository | ⚠️ | 任务覆盖，但落地前无法验证 |
| 字符串资源 | `app/src/main/res/values/strings.xml` | ⚠️ | 任务覆盖但未执行 |
| 权限声明 | `app/src/main/AndroidManifest.xml` | ⚠️ | 任务覆盖但未执行 |

### ❌ 集成缺失问题

#### INT-001: DI注册任务缺失
**问题描述**: TD包含新 Repository/Preferences 扩展，但未明确DI注册（RepositoryModule/ServiceModule）。
**缺失位置**: `data/src/main/kotlin/com/empathy/ai/data/di/RepositoryModule.kt`、`app/src/main/java/com/empathy/ai/app/di/ServiceModule.kt`
**修复建议**:
```kotlin
// 在 RepositoryModule 中新增绑定或 @Provides
```

#### INT-002: 资源与布局模块归属需明确
**问题描述**: TD将文案与布局放在 app 资源，但实际悬浮窗UI部分在 app View-based 与 presentation Compose 混用，需明确资源归属。
**缺失位置**: `app/src/main/res/` 与 `presentation/src/main/res/`
**修复建议**:
```text
// 在TD中声明资源归属与调用方
```

---

## 📋 改进建议
- **P0**: 增补 DI 注册任务（Repository/Preferences/Service 相关）。
- **P1**: 在任务清单中增加 `_需求:` 追溯标记，确保与 PRD/TDD 对齐。
- **P1**: 明确资源与布局归属模块，避免实现中资源放错模块。
- **P2**: 将“降级提示文案”任务附加到具体任务ID中，避免遗漏。

---

## 审查结论
TD-00036 任务清单结构完整、覆盖面充足，已对齐最新 FD/TDD，但仍需补充 DI 注册与需求追溯信息，避免实现阶段遗漏关键集成点。

---

**审查人**: Codex
**审查日期**: 2026-01-12
**文档状态**: ✅ 审查完成
