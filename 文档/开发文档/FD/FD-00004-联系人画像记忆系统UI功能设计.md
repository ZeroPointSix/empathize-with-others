# FD-00004: è”ç³»äººç”»åƒè®°å¿†ç³»ç»ŸUIåŠŸèƒ½è®¾è®¡ v2.1

> **æ–‡æ¡£ç±»å‹**: åŠŸèƒ½è®¾è®¡æ–‡æ¡£ (FD)  
> **ç‰ˆæœ¬**: 2.1 (å®Œå–„ç‰ˆ - åŒ…å«å®æ–½è®¡åˆ’ã€æ•°æ®æ¨¡å‹å’Œé”™è¯¯å¤„ç†)  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-14  
> **æœ€åæ›´æ–°**: 2025-12-14  
> **è´Ÿè´£äºº**: Kiro  
> **å®¡æŸ¥äºº**: Roo  
> **çŠ¶æ€**: âœ… å®¡æŸ¥é€šè¿‡ï¼ˆå¾…å¼€å‘ï¼‰  
> **ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
> **å…³è”PRD**: PRD-00004  
> **å…³è”å®¡æŸ¥**: DR-00007 


---

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°è”ç³»äººç”»åƒè®°å¿†ç³»ç»ŸUIçš„æŠ€æœ¯æ¶æ„ã€ç»„ä»¶è®¾è®¡ã€æ•°æ®æµå’Œå®ç°ç»†èŠ‚ã€‚

**è®¾è®¡ç›®æ ‡**ï¼š
- å®ç°æƒ…æ„ŸåŒ–çš„ç”¨æˆ·ç•Œé¢
- ç¡®ä¿æŠ€æœ¯æ¶æ„ç¬¦åˆClean Architecture + MVVM
- æä¾›é«˜æ€§èƒ½ã€æµç•…çš„ç”¨æˆ·ä½“éªŒ
- æ”¯æŒåŠ¨æ€çš„è§†è§‰åé¦ˆç³»ç»Ÿ

**æ–‡æ¡£æ›´æ–°è®°å½•**ï¼š
- v2.0 (2025-12-14): åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«å®Œæ•´çš„UIè®¾è®¡å’ŒæŠ€æœ¯å®ç°
- v2.1 (2025-12-14): æ ¹æ®DR-00007å®¡æŸ¥æŠ¥å‘Šè¡¥å……å®æ–½è®¡åˆ’ã€æ•°æ®æ¨¡å‹è®¾è®¡å’Œé”™è¯¯å¤„ç†æœºåˆ¶

---

## ğŸ“‘ ç›®å½•

1. [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
2. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’) ğŸ†•
3. [æ•°æ®æ¨¡å‹è®¾è®¡](#æ•°æ®æ¨¡å‹è®¾è®¡) ğŸ†•
4. [å…¨å±€è®¾è®¡ç³»ç»Ÿ](#å…¨å±€è®¾è®¡ç³»ç»Ÿ)
5. [ç•Œé¢è¯¦ç»†è®¾è®¡](#ç•Œé¢è¯¦ç»†è®¾è®¡)
6. [ViewModelè®¾è®¡](#viewmodelè®¾è®¡)
7. [é”™è¯¯å¤„ç†æœºåˆ¶](#é”™è¯¯å¤„ç†æœºåˆ¶) ğŸ†•
8. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
9. [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„

### æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Screen     â”‚  â”‚  ViewModel   â”‚  â”‚  UiState/    â”‚  â”‚
â”‚  â”‚  (Compose)   â”‚â†â†’â”‚  (StateFlow) â”‚â†â†’â”‚  UiEvent     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Domain Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   UseCase    â”‚  â”‚  Repository  â”‚  â”‚    Model     â”‚  â”‚
â”‚  â”‚              â”‚â†’ â”‚  Interface   â”‚  â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Repository  â”‚  â”‚     DAO      â”‚  â”‚    Entity    â”‚  â”‚
â”‚  â”‚     Impl     â”‚â†’ â”‚   (Room)     â”‚â†’ â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—åˆ’åˆ†

```
presentation/
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ screen/
â”‚   â”‚   â””â”€â”€ contact/
â”‚   â”‚       â”œâ”€â”€ ContactDetailScreen.kt          # ä¸»å±å¹•
â”‚   â”‚       â”œâ”€â”€ overview/                       # ç•Œé¢ä¸€ï¼šæ¦‚è§ˆ
â”‚   â”‚       â”‚   â”œâ”€â”€ OverviewTab.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ DynamicEmotionalHeader.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ TopTagsSection.kt
â”‚   â”‚       â”‚   â””â”€â”€ LatestFactHookCard.kt
â”‚   â”‚       â”œâ”€â”€ factstream/                     # ç•Œé¢äºŒï¼šäº‹å®æµ
â”‚   â”‚       â”‚   â”œâ”€â”€ FactStreamTab.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ TimelineView.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ ListView.kt
â”‚   â”‚       â”‚   â””â”€â”€ FactStreamTopBar.kt
â”‚   â”‚       â”œâ”€â”€ persona/                        # ç•Œé¢ä¸‰ï¼šæ ‡ç­¾ç”»åƒ
â”‚   â”‚       â”‚   â”œâ”€â”€ PersonaTab.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ ConfirmedTag.kt
â”‚   â”‚       â”‚   â”œâ”€â”€ GuessedTag.kt
â”‚   â”‚       â”‚   â””â”€â”€ TagConfirmationDialog.kt
â”‚   â”‚       â””â”€â”€ vault/                          # ç•Œé¢å››ï¼šèµ„æ–™åº“
â”‚   â”‚           â”œâ”€â”€ DataVaultTab.kt
â”‚   â”‚           â”œâ”€â”€ DataSourceCard.kt
â”‚   â”‚           â””â”€â”€ StatusBadge.kt
â”‚   â””â”€â”€ component/
â”‚       â”œâ”€â”€ emotion/                            # æƒ…æ„ŸåŒ–ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ EmotionalBackground.kt
â”‚       â”‚   â”œâ”€â”€ GlassmorphicCard.kt
â”‚       â”‚   â””â”€â”€ EmotionalTimelineNode.kt
â”‚       â”œâ”€â”€ card/                               # å¡ç‰‡ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ PhotoMomentCard.kt
â”‚       â”‚   â”œâ”€â”€ AiSummaryCard.kt
â”‚       â”‚   â”œâ”€â”€ MilestoneCard.kt
â”‚       â”‚   â””â”€â”€ ConversationCard.kt
â”‚       â””â”€â”€ control/                            # æ§åˆ¶ç»„ä»¶
â”‚           â”œâ”€â”€ SegmentedControl.kt
â”‚           â””â”€â”€ QuickFilterChips.kt
â””â”€â”€ viewmodel/
    â”œâ”€â”€ ContactDetailViewModel.kt               # ä¸»ViewModel
    â”œâ”€â”€ ContactDetailUiState.kt
    â””â”€â”€ ContactDetailUiEvent.kt
```

---

## ğŸ“… å®æ–½è®¡åˆ’

### æ€»ä½“æ—¶é—´è§„åˆ’

**é¢„è®¡æ€»å·¥ä½œé‡**: 14-21ä¸ªå·¥ä½œæ—¥  
**å»ºè®®å›¢é˜Ÿè§„æ¨¡**: 1-2åå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ  
**å¼€å§‹æ—¥æœŸ**: å¾…å®š  
**ç›®æ ‡å®Œæˆæ—¥æœŸ**: å¼€å§‹å3å‘¨å†…

### é˜¶æ®µåˆ’åˆ†

#### é˜¶æ®µ1ï¼šå…¨å±€è®¾è®¡ç³»ç»Ÿï¼ˆ2-3å¤©ï¼‰

**ç›®æ ‡**: å»ºç«‹å¯å¤ç”¨çš„è®¾è®¡ç³»ç»ŸåŸºç¡€

**äº¤ä»˜ç‰©**:
- [ ] `EmotionalBackground.kt` - æƒ…æ„ŸåŒ–èƒŒæ™¯ç»„ä»¶
- [ ] `GlassmorphicCard.kt` - ç£¨ç ‚ç»ç’ƒå¡ç‰‡ç»„ä»¶
- [ ] `SegmentedControl.kt` - åˆ†æ®µæ§åˆ¶å™¨
- [ ] æµä½“åˆ‡æ¢åŠ¨ç”»ç³»ç»Ÿ
- [ ] è®¾è®¡ç³»ç»Ÿæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

**éªŒæ”¶æ ‡å‡†**:
- èƒŒæ™¯é¢œè‰²èƒ½æ ¹æ®å…³ç³»åˆ†æ•°æ­£ç¡®å˜åŒ–ï¼ˆ4ä¸ªæ¡£ä½ï¼‰
- ç£¨ç ‚ç»ç’ƒæ•ˆæœåœ¨ä¸åŒèƒŒæ™¯ä¸‹æ˜¾ç¤ºæ­£å¸¸
- åŠ¨ç”»è¿‡æ¸¡æµç•…ï¼Œå¸§ç‡â‰¥60fps
- ç»„ä»¶å¯åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹æ­£å¸¸æ˜¾ç¤º

**é£é™©**:
- ğŸŸ¡ ç£¨ç ‚ç»ç’ƒæ•ˆæœåœ¨ä½ç«¯è®¾å¤‡ä¸Šå¯èƒ½æ€§èƒ½ä¸ä½³
- ğŸŸ¢ ç¼“è§£æªæ–½ï¼šæä¾›é™çº§æ–¹æ¡ˆï¼Œä½ç«¯è®¾å¤‡ä½¿ç”¨çº¯è‰²èƒŒæ™¯

---

#### é˜¶æ®µ2ï¼šç•Œé¢ä¸€ - æ¦‚è§ˆï¼ˆ2-3å¤©ï¼‰

**ç›®æ ‡**: å®ç°è”ç³»äººè¯¦æƒ…é¡µçš„æ¦‚è§ˆç•Œé¢

**äº¤ä»˜ç‰©**:
- [ ] `DynamicEmotionalHeader.kt` - åŠ¨æ€æƒ…æ„Ÿå¤´éƒ¨ï¼ˆå«Sticky Headerï¼‰
- [ ] `TopTagsSection.kt` - æ ¸å¿ƒæ ‡ç­¾é€Ÿè§ˆ
- [ ] `LatestFactHookCard.kt` - æœ€æ–°åŠ¨æ€å¡ç‰‡
- [ ] `OverviewTab.kt` - æ¦‚è§ˆæ ‡ç­¾é¡µé›†æˆ

**éªŒæ”¶æ ‡å‡†**:
- å¤´éƒ¨éšæ»šåŠ¨å¹³æ»‘æ”¶ç¼©ï¼ŒåŠ¨ç”»æµç•…
- æ ‡ç­¾æŒ‰æƒé‡æ­£ç¡®æ’åºï¼Œæœ€å¤šæ˜¾ç¤º5ä¸ª
- æœ€æ–°åŠ¨æ€å¡ç‰‡æ­£ç¡®æ˜¾ç¤ºæœ€è¿‘çš„Fact
- ç‚¹å‡»å¡ç‰‡èƒ½è·³è½¬åˆ°äº‹å®æµè¯¦æƒ…

**ä¾èµ–**:
- ä¾èµ–é˜¶æ®µ1çš„è®¾è®¡ç³»ç»Ÿç»„ä»¶
- éœ€è¦ContactDetailViewModelæä¾›æ•°æ®

**é£é™©**:
- ğŸŸ¡ Sticky Headeråœ¨å¿«é€Ÿæ»šåŠ¨æ—¶å¯èƒ½å‡ºç°å¡é¡¿
- ğŸŸ¢ ç¼“è§£æªæ–½ï¼šä¼˜åŒ–æ»šåŠ¨ç›‘å¬ï¼Œä½¿ç”¨derivedStateOfå‡å°‘é‡ç»„

---

#### é˜¶æ®µ3ï¼šç•Œé¢äºŒ - äº‹å®æµï¼ˆ3-4å¤©ï¼‰

**ç›®æ ‡**: å®ç°åŒè§†å›¾æ¨¡å¼çš„äº‹å®æµç•Œé¢

**äº¤ä»˜ç‰©**:
- [ ] `TimelineView.kt` - æ—¶å…‰è½´ç€‘å¸ƒæµè§†å›¾
- [ ] `ListView.kt` - æ¸…å•åˆ—è¡¨è§†å›¾
- [ ] `EmotionalTimelineNode.kt` - æƒ…ç»ªèŠ‚ç‚¹ç»„ä»¶
- [ ] `PhotoMomentCard.kt` / `AiSummaryCard.kt` / `MilestoneCard.kt` / `ConversationCard.kt` - å¤šæ ·åŒ–å¡ç‰‡
- [ ] `QuickFilterChips.kt` - å¿«é€Ÿç­›é€‰ç»„ä»¶
- [ ] `FactStreamTab.kt` - äº‹å®æµæ ‡ç­¾é¡µé›†æˆ

**éªŒæ”¶æ ‡å‡†**:
- æ—¶å…‰è½´å’Œåˆ—è¡¨è§†å›¾åˆ‡æ¢æµç•…ï¼Œæ— å¡é¡¿
- æƒ…ç»ªèŠ‚ç‚¹æ­£ç¡®æ˜¾ç¤ºå¯¹åº”çš„Emoji
- ç€‘å¸ƒæµå¸ƒå±€ç¾è§‚ï¼Œå¡ç‰‡é«˜åº¦è‡ªé€‚åº”
- ç­›é€‰åŠŸèƒ½æ­£å¸¸ï¼Œèƒ½å³æ—¶è¿‡æ»¤æ•°æ®
- åˆ—è¡¨æ”¯æŒä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½æ›´å¤š

**ä¾èµ–**:
- ä¾èµ–é˜¶æ®µ1çš„è®¾è®¡ç³»ç»Ÿç»„ä»¶
- éœ€è¦ConversationRepositoryå’ŒDailySummaryRepositoryæä¾›æ•°æ®

**é£é™©**:
- ğŸ”´ ç€‘å¸ƒæµå¸ƒå±€åœ¨æ•°æ®é‡å¤§æ—¶å¯èƒ½æ€§èƒ½ä¸ä½³
- ğŸŸ¡ ç¼“è§£æªæ–½ï¼šä½¿ç”¨LazyVerticalStaggeredGridï¼Œå¯ç”¨keyä¼˜åŒ–ï¼Œé™åˆ¶åˆå§‹åŠ è½½æ•°é‡

---

#### é˜¶æ®µ4ï¼šç•Œé¢ä¸‰ - æ ‡ç­¾ç”»åƒï¼ˆ2-3å¤©ï¼‰

**ç›®æ ‡**: å®ç°æ ‡ç­¾ç®¡ç†å’Œç¡®è®¤åŠŸèƒ½

**äº¤ä»˜ç‰©**:
- [ ] `ConfirmedTag.kt` - ç”¨æˆ·ç¡®è®¤æ ‡ç­¾ç»„ä»¶
- [ ] `GuessedTag.kt` - AIæ¨æµ‹æ ‡ç­¾ç»„ä»¶ï¼ˆå«å‘¼å¸åŠ¨æ•ˆï¼‰
- [ ] `TagConfirmationDialog.kt` - æ ‡ç­¾ç¡®è®¤å¯¹è¯æ¡†
- [ ] `PersonaTab.kt` - æ ‡ç­¾ç”»åƒæ ‡ç­¾é¡µé›†æˆ

**éªŒæ”¶æ ‡å‡†**:
- ç¡®è®¤æ ‡ç­¾å’Œæ¨æµ‹æ ‡ç­¾è§†è§‰å·®å¼‚æ˜æ˜¾
- å‘¼å¸åŠ¨æ•ˆæµç•…ï¼Œä¸å½±å“æ€§èƒ½
- ç‚¹å‡»æ¨æµ‹æ ‡ç­¾èƒ½å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
- ç¡®è®¤/é©³å›æ“ä½œèƒ½æ­£ç¡®æ›´æ–°æ•°æ®åº“
- æ ‡ç­¾æŒ‰ç±»åˆ«æ­£ç¡®åˆ†ç»„æ˜¾ç¤º

**ä¾èµ–**:
- ä¾èµ–é˜¶æ®µ1çš„è®¾è®¡ç³»ç»Ÿç»„ä»¶
- éœ€è¦ContactRepositoryæä¾›æ ‡ç­¾æ•°æ®

**é£é™©**:
- ğŸŸ¢ é£é™©è¾ƒä½ï¼ŒåŠŸèƒ½ç›¸å¯¹ç‹¬ç«‹

---

#### é˜¶æ®µ5ï¼šç•Œé¢å›› - èµ„æ–™åº“ï¼ˆ1-2å¤©ï¼‰

**ç›®æ ‡**: å®ç°æ•°æ®æºç®¡ç†ç•Œé¢

**äº¤ä»˜ç‰©**:
- [ ] `DataSourceCard.kt` - æ•°æ®æºå¡ç‰‡ç»„ä»¶
- [ ] `StatusBadge.kt` - çŠ¶æ€è§’æ ‡ç»„ä»¶
- [ ] `DataVaultTab.kt` - èµ„æ–™åº“æ ‡ç­¾é¡µé›†æˆ

**éªŒæ”¶æ ‡å‡†**:
- æ•°æ®æºå¡ç‰‡æ­£ç¡®æ˜¾ç¤ºæ•°é‡å’ŒçŠ¶æ€
- çŠ¶æ€è§’æ ‡é¢œè‰²å’Œå›¾æ ‡æ­£ç¡®
- ç‚¹å‡»å¡ç‰‡èƒ½è·³è½¬åˆ°å¯¹åº”çš„æ•°æ®ç®¡ç†é¡µé¢
- æœªå®ç°çš„åŠŸèƒ½æ˜¾ç¤º"æ•¬è¯·æœŸå¾…"æç¤º

**ä¾èµ–**:
- ä¾èµ–é˜¶æ®µ1çš„è®¾è®¡ç³»ç»Ÿç»„ä»¶
- éœ€è¦å„Repositoryæä¾›æ•°æ®ç»Ÿè®¡

**é£é™©**:
- ğŸŸ¢ é£é™©è¾ƒä½ï¼Œä¸»è¦æ˜¯å±•ç¤ºåŠŸèƒ½

---

#### é˜¶æ®µ6ï¼šViewModelå’Œæ•°æ®é›†æˆï¼ˆ2-3å¤©ï¼‰

**ç›®æ ‡**: å®Œå–„ViewModelå’Œæ•°æ®æµ

**äº¤ä»˜ç‰©**:
- [ ] å®Œå–„`ContactDetailViewModel.kt`
- [ ] å®ç°æ•°æ®åŠ è½½å’ŒçŠ¶æ€ç®¡ç†é€»è¾‘
- [ ] å®ç°æ ‡ç­¾ç¡®è®¤/é©³å›åŠŸèƒ½
- [ ] å®ç°ç­›é€‰å’Œæ’åºåŠŸèƒ½
- [ ] æ·»åŠ é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

**éªŒæ”¶æ ‡å‡†**:
- æ‰€æœ‰UIæ“ä½œèƒ½æ­£ç¡®è§¦å‘ViewModeläº‹ä»¶
- æ•°æ®åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
- æ”¯æŒä¸‹æ‹‰åˆ·æ–°å’Œé‡è¯•
- çŠ¶æ€ç®¡ç†ç¬¦åˆMVVMæ¨¡å¼
- æ— å†…å­˜æ³„æ¼

**ä¾èµ–**:
- ä¾èµ–é˜¶æ®µ2-5çš„æ‰€æœ‰UIç»„ä»¶
- éœ€è¦æ‰€æœ‰Repositoryæ¥å£å®Œæ•´å®ç°

**é£é™©**:
- ğŸŸ¡ å¤æ‚çš„çŠ¶æ€ç®¡ç†å¯èƒ½å¯¼è‡´bug
- ğŸŸ¢ ç¼“è§£æªæ–½ï¼šç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•ï¼Œä½¿ç”¨StateFlowç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§

---

#### é˜¶æ®µ7ï¼šæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰

**ç›®æ ‡**: ç¡®ä¿è´¨é‡å’Œæ€§èƒ½

**äº¤ä»˜ç‰©**:
- [ ] ViewModelå•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡â‰¥80%ï¼‰
- [ ] UIç»„ä»¶æµ‹è¯•ï¼ˆå…³é”®è·¯å¾„100%è¦†ç›–ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆåŠ¨ç”»æµç•…åº¦ã€åˆ—è¡¨æ»šåŠ¨ï¼‰
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼ˆåŠ è½½çŠ¶æ€ã€ç©ºçŠ¶æ€ã€é”™è¯¯çŠ¶æ€ï¼‰
- [ ] ä»£ç å®¡æŸ¥å’Œé‡æ„

**éªŒæ”¶æ ‡å‡†**:
- æ‰€æœ‰æµ‹è¯•é€šè¿‡
- åŠ¨ç”»å¸§ç‡â‰¥60fps
- åˆ—è¡¨æ»šåŠ¨æµç•…ï¼Œæ— å¡é¡¿
- å†…å­˜å ç”¨åˆç†ï¼ˆ<100MBï¼‰
- ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ

**é£é™©**:
- ğŸŸ¡ æ€§èƒ½ä¼˜åŒ–å¯èƒ½éœ€è¦é¢å¤–æ—¶é—´
- ğŸŸ¢ ç¼“è§£æªæ–½ï¼šæå‰è¿›è¡Œæ€§èƒ½ç›‘æ§ï¼ŒåŠæ—¶å‘ç°é—®é¢˜

---

### é‡Œç¨‹ç¢‘å’Œäº¤ä»˜ç‰©

| é‡Œç¨‹ç¢‘ | å®Œæˆæ—¥æœŸ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|--------|---------|--------|---------|
| M1: è®¾è®¡ç³»ç»Ÿå®Œæˆ | D+3 | å…¨å±€è®¾è®¡ç»„ä»¶ | ç»„ä»¶å¯å¤ç”¨ï¼ŒåŠ¨ç”»æµç•… |
| M2: æ¦‚è§ˆç•Œé¢å®Œæˆ | D+6 | ç•Œé¢ä¸€å®Œæ•´å®ç° | åŠŸèƒ½å®Œæ•´ï¼Œæ•°æ®æ­£ç¡® |
| M3: äº‹å®æµå®Œæˆ | D+10 | ç•Œé¢äºŒå®Œæ•´å®ç° | åŒè§†å›¾åˆ‡æ¢æµç•… |
| M4: æ ‡ç­¾ç”»åƒå®Œæˆ | D+13 | ç•Œé¢ä¸‰å®Œæ•´å®ç° | æ ‡ç­¾ç®¡ç†åŠŸèƒ½æ­£å¸¸ |
| M5: èµ„æ–™åº“å®Œæˆ | D+15 | ç•Œé¢å››å®Œæ•´å®ç° | æ•°æ®ç»Ÿè®¡æ­£ç¡® |
| M6: æ•°æ®é›†æˆå®Œæˆ | D+18 | ViewModelå®Œæ•´ | æ•°æ®æµæ­£å¸¸ |
| M7: æµ‹è¯•å®Œæˆ | D+21 | æµ‹è¯•æŠ¥å‘Š | æ‰€æœ‰æµ‹è¯•é€šè¿‡ |

### èµ„æºåˆ†é…

**äººåŠ›èµ„æº**:
- å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ Ã— 1-2äºº
- UI/UXè®¾è®¡å¸ˆ Ã— 0.5äººï¼ˆå…¼èŒï¼Œæä¾›è®¾è®¡æ”¯æŒï¼‰
- æµ‹è¯•å·¥ç¨‹å¸ˆ Ã— 0.5äººï¼ˆå…¼èŒï¼ŒååŠ©æµ‹è¯•ï¼‰

**æŠ€æœ¯èµ„æº**:
- Android Studioæœ€æ–°ç‰ˆ
- æµ‹è¯•è®¾å¤‡ï¼šè‡³å°‘3å°ä¸åŒé…ç½®çš„Androidè®¾å¤‡ï¼ˆé«˜ä¸­ä½ç«¯å„ä¸€å°ï¼‰
- æ€§èƒ½åˆ†æå·¥å…·ï¼šAndroid Profiler

### é£é™©è¯„ä¼°å’Œåº”å¯¹

| é£é™© | ä¸¥é‡ç¨‹åº¦ | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|------|---------|------|------|---------|
| ä½ç«¯è®¾å¤‡æ€§èƒ½é—®é¢˜ | ğŸŸ¡ ä¸­ | 60% | ç”¨æˆ·ä½“éªŒä¸‹é™ | æä¾›é™çº§æ–¹æ¡ˆï¼Œä¼˜åŒ–åŠ¨ç”» |
| å¤æ‚çŠ¶æ€ç®¡ç†å¯¼è‡´bug | ğŸŸ¡ ä¸­ | 40% | åŠŸèƒ½å¼‚å¸¸ | å®Œå–„å•å…ƒæµ‹è¯•ï¼Œä»£ç å®¡æŸ¥ |
| ç€‘å¸ƒæµå¸ƒå±€æ€§èƒ½é—®é¢˜ | ğŸ”´ é«˜ | 30% | æ»šåŠ¨å¡é¡¿ | ä½¿ç”¨keyä¼˜åŒ–ï¼Œé™åˆ¶åˆå§‹åŠ è½½ |
| æ—¶é—´å»¶æœŸ | ğŸŸ¡ ä¸­ | 30% | é¡¹ç›®å»¶æœŸ | é¢„ç•™ç¼“å†²æ—¶é—´ï¼Œä¼˜å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ |

---

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### æ•°æ®æµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      UI Layer                            â”‚
â”‚  ContactDetailScreen â†’ ContactDetailViewModel            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ StateFlow
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ContactDetailUiState                   â”‚
â”‚  - contact: ContactProfile?                              â”‚
â”‚  - conversations: List<ConversationLog>                  â”‚
â”‚  - summaries: List<DailySummary>                         â”‚
â”‚  - facts: List<Fact>                                     â”‚
â”‚  - timelineItems: List<TimelineItem>                     â”‚
â”‚  - viewMode: ViewMode                                    â”‚
â”‚  - selectedFilters: Set<FilterType>                      â”‚
â”‚  - isLoading: Boolean                                    â”‚
â”‚  - error: String?                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ UseCase
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Domain Layer                           â”‚
â”‚  - GetContactUseCase                                     â”‚
â”‚  - GetConversationsUseCase                               â”‚
â”‚  - GetSummariesUseCase                                   â”‚
â”‚  - ConfirmTagUseCase                                     â”‚
â”‚  - RejectTagUseCase                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ Repository
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Layer                            â”‚
â”‚  - ContactRepository                                     â”‚
â”‚  - ConversationRepository                                â”‚
â”‚  - DailySummaryRepository                                â”‚
â”‚  - Room Database                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### 1. ContactDetailUiState

**èŒè´£**: ç®¡ç†è”ç³»äººè¯¦æƒ…é¡µçš„æ‰€æœ‰UIçŠ¶æ€

```kotlin
data class ContactDetailUiState(
    // åŸºç¡€æ•°æ®
    val contact: ContactProfile? = null,
    val conversations: List<ConversationLog> = emptyList(),
    val summaries: List<DailySummary> = emptyList(),
    val facts: List<Fact> = emptyList(),
    
    // ç•Œé¢ä¸€ï¼šæ¦‚è§ˆ
    val topTags: List<Fact> = emptyList(),
    val latestFact: Fact? = null,
    val daysSinceFirstMet: Int = 0,
    
    // ç•Œé¢äºŒï¼šäº‹å®æµ
    val currentTab: DetailTab = DetailTab.Overview,
    val viewMode: ViewMode = ViewMode.Timeline,
    val selectedFilters: Set<FilterType> = emptySet(),
    val timelineItems: List<TimelineItem> = emptyList(),
    
    // ç•Œé¢ä¸‰ï¼šæ ‡ç­¾ç”»åƒ
    val groupedFacts: Map<String, List<Fact>> = emptyMap(),
    val confirmedTagsCount: Int = 0,
    val guessedTagsCount: Int = 0,
    
    // ç•Œé¢å››ï¼šèµ„æ–™åº“
    val conversationCount: Int = 0,
    val summaryCount: Int = 0,
    
    // çŠ¶æ€ç®¡ç†
    val isLoading: Boolean = false,
    val isRefreshing: Boolean = false,
    val error: UiError? = null,
    val successMessage: String? = null
) {
    // æ´¾ç”ŸçŠ¶æ€
    val hasData: Boolean
        get() = contact != null
    
    val isEmpty: Boolean
        get() = !hasData && !isLoading
    
    val relationshipScore: Int
        get() = contact?.relationshipScore ?: 0
}

enum class DetailTab {
    Overview,      // æ¦‚è§ˆ
    FactStream,    // äº‹å®æµ
    Persona,       // æ ‡ç­¾ç”»åƒ
    DataVault      // èµ„æ–™åº“
}
```

#### 2. TimelineItemï¼ˆæ—¶é—´çº¿é¡¹ç›®ï¼‰

**èŒè´£**: ç»Ÿä¸€è¡¨ç¤ºæ—¶é—´çº¿ä¸Šçš„ä¸åŒç±»å‹å†…å®¹

```kotlin
sealed class TimelineItem {
    abstract val id: String
    abstract val timestamp: Long
    abstract val emotionType: EmotionType
    
    data class PhotoMoment(
        override val id: String,
        override val timestamp: Long,
        override val emotionType: EmotionType,
        val photoUrl: String,
        val description: String,
        val tags: List<String> = emptyList()
    ) : TimelineItem()
    
    data class AiSummary(
        override val id: String,
        override val timestamp: Long,
        override val emotionType: EmotionType,
        val summary: DailySummary
    ) : TimelineItem()
    
    data class Milestone(
        override val id: String,
        override val timestamp: Long,
        override val emotionType: EmotionType,
        val title: String,
        val description: String,
        val icon: String
    ) : TimelineItem()
    
    data class Conversation(
        override val id: String,
        override val timestamp: Long,
        override val emotionType: EmotionType,
        val log: ConversationLog
    ) : TimelineItem()
}
```

#### 3. EmotionTypeï¼ˆæƒ…ç»ªç±»å‹ï¼‰

**èŒè´£**: å®šä¹‰æƒ…ç»ªèŠ‚ç‚¹çš„è§†è§‰è¡¨ç°

```kotlin
enum class EmotionType(
    val emoji: String,
    val displayName: String,
    val color: Color
) {
    SWEET("â¤ï¸", "ç”œèœœ", Color(0xFFFF6B9D)),
    CONFLICT("â›ˆï¸", "å†²çª", Color(0xFF6B8CAE)),
    GIFT("ğŸ", "ç¤¼ç‰©", Color(0xFFFFA06B)),
    DATE("ğŸ½ï¸", "çº¦ä¼š", Color(0xFFFFC371)),
    DEEP_TALK("ğŸ’¬", "æ·±èŠ", Color(0xFF7FD8BE)),
    NEUTRAL("â­•", "æ—¥å¸¸", Color(0xFFB8C5D6));
    
    companion object {
        fun fromText(text: String): EmotionType {
            return when {
                text.contains("çˆ±") || text.contains("å–œæ¬¢") -> SWEET
                text.contains("ç”Ÿæ°”") || text.contains("åµæ¶") -> CONFLICT
                text.contains("ç¤¼ç‰©") || text.contains("é€") -> GIFT
                text.contains("åƒé¥­") || text.contains("çº¦ä¼š") -> DATE
                text.contains("èŠå¤©") || text.contains("è°ˆå¿ƒ") -> DEEP_TALK
                else -> NEUTRAL
            }
        }
    }
}
```

#### 4. ViewModeï¼ˆè§†å›¾æ¨¡å¼ï¼‰

**èŒè´£**: æ§åˆ¶äº‹å®æµçš„å±•ç¤ºæ–¹å¼

```kotlin
enum class ViewMode(val displayName: String) {
    Timeline("æ—¶å…‰è½´"),
    List("æ¸…å•");
    
    fun toggle(): ViewMode = when (this) {
        Timeline -> List
        List -> Timeline
    }
}
```

#### 5. FilterTypeï¼ˆç­›é€‰ç±»å‹ï¼‰

**èŒè´£**: å®šä¹‰äº‹å®æµçš„ç­›é€‰æ¡ä»¶

```kotlin
enum class FilterType(
    val displayName: String,
    val icon: ImageVector,
    val predicate: (TimelineItem) -> Boolean
) {
    ALL("å…¨éƒ¨", Icons.Default.FilterList, { true }),
    AI_SUMMARY("åªçœ‹AI", Icons.Default.Psychology, { it is TimelineItem.AiSummary }),
    CONFLICT("åªçœ‹å†²çª", Icons.Default.Warning, { it.emotionType == EmotionType.CONFLICT }),
    DATE("åªçœ‹çº¦ä¼š", Icons.Default.Restaurant, { it.emotionType == EmotionType.DATE }),
    SWEET("åªçœ‹ç”œèœœ", Icons.Default.Favorite, { it.emotionType == EmotionType.SWEET });
    
    fun apply(items: List<TimelineItem>): List<TimelineItem> {
        return items.filter(predicate)
    }
}
```

#### 6. UiErrorï¼ˆUIé”™è¯¯ï¼‰

**èŒè´£**: ç»Ÿä¸€ç®¡ç†UIå±‚çš„é”™è¯¯çŠ¶æ€

```kotlin
sealed class UiError {
    abstract val message: String
    abstract val canRetry: Boolean
    
    data class NetworkError(
        override val message: String = "ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®",
        override val canRetry: Boolean = true
    ) : UiError()
    
    data class DataNotFound(
        override val message: String = "æœªæ‰¾åˆ°è”ç³»äººä¿¡æ¯",
        override val canRetry: Boolean = false
    ) : UiError()
    
    data class DatabaseError(
        override val message: String = "æ•°æ®åº“æ“ä½œå¤±è´¥",
        override val canRetry: Boolean = true
    ) : UiError()
    
    data class UnknownError(
        override val message: String = "æœªçŸ¥é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•",
        override val canRetry: Boolean = true
    ) : UiError()
}
```

### æ•°æ®åŒæ­¥ç­–ç•¥

#### 1. æ•°æ®åŠ è½½æµç¨‹

```kotlin
// ViewModelä¸­çš„æ•°æ®åŠ è½½
private fun loadContactDetail() {
    viewModelScope.launch {
        _uiState.update { it.copy(isLoading = true, error = null) }
        
        try {
            // å¹¶è¡ŒåŠ è½½æ•°æ®
            val contactDeferred = async { 
                contactRepository.getProfile(contactId).getOrThrow() 
            }
            val conversationsDeferred = async { 
                conversationRepository.getConversationsByContact(contactId).first() 
            }
            val summariesDeferred = async { 
                dailySummaryRepository.getSummariesByContact(contactId).first() 
            }
            
            val contact = contactDeferred.await()
            val conversations = conversationsDeferred.await()
            val summaries = summariesDeferred.await()
            
            // æ„å»ºæ´¾ç”Ÿæ•°æ®
            val timelineItems = buildTimelineItems(conversations, summaries)
            val groupedFacts = contact.facts.groupBy { it.key }
            
            _uiState.update {
                it.copy(
                    contact = contact,
                    conversations = conversations,
                    summaries = summaries,
                    facts = contact.facts,
                    topTags = contact.facts
                        .sortedByDescending { it.confidence }
                        .take(5),
                    latestFact = contact.facts.maxByOrNull { it.timestamp },
                    timelineItems = timelineItems,
                    groupedFacts = groupedFacts,
                    conversationCount = conversations.size,
                    summaryCount = summaries.size,
                    isLoading = false
                )
            }
        } catch (e: Exception) {
            _uiState.update {
                it.copy(
                    isLoading = false,
                    error = mapExceptionToUiError(e)
                )
            }
        }
    }
}
```

#### 2. æ•°æ®ç¼“å­˜ç­–ç•¥

```kotlin
// ä½¿ç”¨Flowè‡ªåŠ¨æ›´æ–°UI
init {
    viewModelScope.launch {
        combine(
            contactRepository.getProfileFlow(contactId),
            conversationRepository.getConversationsByContact(contactId),
            dailySummaryRepository.getSummariesByContact(contactId)
        ) { contact, conversations, summaries ->
            Triple(contact.getOrNull(), conversations, summaries)
        }
        .catch { e ->
            _uiState.update {
                it.copy(error = mapExceptionToUiError(e))
            }
        }
        .collect { (contact, conversations, summaries) ->
            if (contact != null) {
                updateUiState(contact, conversations, summaries)
            }
        }
    }
}
```

#### 3. æ•°æ®æ›´æ–°ç­–ç•¥

```kotlin
// æ ‡ç­¾ç¡®è®¤/é©³å›
private fun confirmTag(factId: Long) {
    viewModelScope.launch {
        try {
            val updatedFacts = _uiState.value.facts.map { fact ->
                if (fact.timestamp == factId) {
                    fact.copy(source = "MANUAL", confidence = 1.0f)
                } else {
                    fact
                }
            }
            
            val updatedContact = _uiState.value.contact?.copy(facts = updatedFacts)
            if (updatedContact != null) {
                contactRepository.updateProfile(updatedContact)
                    .onSuccess {
                        _uiState.update {
                            it.copy(
                                facts = updatedFacts,
                                successMessage = "æ ‡ç­¾å·²ç¡®è®¤"
                            )
                        }
                    }
                    .onFailure { e ->
                        _uiState.update {
                            it.copy(error = mapExceptionToUiError(e))
                        }
                    }
            }
        } catch (e: Exception) {
            _uiState.update {
                it.copy(error = mapExceptionToUiError(e))
            }
        }
    }
}
```

---

## ğŸ¨ å…¨å±€è®¾è®¡ç³»ç»Ÿ

### 1. æƒ…æ„ŸåŒ–èƒŒæ™¯ç³»ç»Ÿ

#### 1.1 EmotionalBackground ç»„ä»¶

**èŒè´£**ï¼šæ ¹æ®å…³ç³»åˆ†æ•°åŠ¨æ€ç”ŸæˆèƒŒæ™¯æ¸å˜è‰²

**è¾“å…¥**ï¼š
- `relationshipScore: Int` (0-100)

**è¾“å‡º**ï¼š
- å¾„å‘æ¸å˜èƒŒæ™¯

**å®ç°**ï¼š

```kotlin
@Composable
fun EmotionalBackground(
    relationshipScore: Int,
    modifier: Modifier = Modifier
) {
    val backgroundColor = remember(relationshipScore) {
        when {
            relationshipScore >= 81 -> RelationshipColors.Excellent
            relationshipScore >= 61 -> RelationshipColors.Good
            relationshipScore >= 31 -> RelationshipColors.Normal
            else -> RelationshipColors.Poor
        }
    }
    
    val animatedColors = backgroundColor.map { color ->
        animateColorAsState(
            targetValue = color,
            animationSpec = tween(durationMillis = 1000)
        ).value
    }
    
    Box(
        modifier = modifier
            .fillMaxSize()
            .background(
                Brush.radialGradient(
                    colors = animatedColors,
                    center = Offset(0.5f, 0.3f),
                    radius = 1000f
                )
            )
    )
}

object RelationshipColors {
    val Excellent = listOf(Color(0xFFFF6B9D), Color(0xFFFFA06B))
    val Good = listOf(Color(0xFFFFC371), Color(0xFF7FD8BE))
    val Normal = listOf(Color(0xFF89B5E0), Color(0xFFB8C5D6))
    val Poor = listOf(Color(0xFF6B8CAE), Color(0xFF8B9DAF))
}
```

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- ä½¿ç”¨ `remember` ç¼“å­˜é¢œè‰²è®¡ç®—
- ä½¿ç”¨ `animateColorAsState` å®ç°å¹³æ»‘è¿‡æ¸¡
- é¿å…åœ¨æ¯æ¬¡é‡ç»„æ—¶é‡æ–°è®¡ç®—

#### 1.2 GlassmorphicCard ç»„ä»¶

**èŒè´£**ï¼šæä¾›ç£¨ç ‚ç»ç’ƒæ•ˆæœçš„å¡ç‰‡å®¹å™¨

**ç‰¹æ€§**ï¼š
- åŠé€æ˜èƒŒæ™¯
- èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ
- ç™½è‰²è¾¹æ¡†å…‰æ™•
- ç»†å¾®é˜´å½±

**å®ç°**ï¼š

```kotlin
@Composable
fun GlassmorphicCard(
    modifier: Modifier = Modifier,
    backgroundColor: Color = MaterialTheme.colorScheme.surface.copy(alpha = 0.7f),
    borderColor: Color = Color.White.copy(alpha = 0.2f),
    onClick: (() -> Unit)? = null,
    content: @Composable () -> Unit
) {
    val interactionSource = remember { MutableInteractionSource() }
    
    Surface(
        modifier = modifier.then(
            if (onClick != null) {
                Modifier.clickable(
                    interactionSource = interactionSource,
                    indication = rememberRipple(),
                    onClick = onClick
                )
            } else Modifier
        ),
        shape = RoundedCornerShape(16.dp),
        color = backgroundColor,
        border = BorderStroke(width = 1.dp, color = borderColor),
        shadowElevation = 8.dp
    ) {
        Box(
            modifier = Modifier.background(
                Brush.verticalGradient(
                    colors = listOf(
                        Color.White.copy(alpha = 0.1f),
                        Color.Transparent
                    )
                )
            )
        ) {
            content()
        }
    }
}
```

### 2. æµä½“åŠ¨ç”»ç³»ç»Ÿ

#### 2.1 ViewMode åˆ‡æ¢åŠ¨ç”»

**éœ€æ±‚**ï¼šæ—¶å…‰è½´ â†” æ¸…å•åˆ—è¡¨çš„å¹³æ»‘åˆ‡æ¢

**å®ç°**ï¼š

```kotlin
@Composable
fun FactStreamContent(
    viewMode: ViewMode,
    conversations: List<ConversationLog>,
    summaries: List<DailySummary>,
    onViewModeChange: (ViewMode) -> Unit
) {
    AnimatedContent(
        targetState = viewMode,
        transitionSpec = {
            fadeIn(
                animationSpec = tween(300, easing = FastOutSlowInEasing)
            ) + scaleIn(
                initialScale = 0.95f,
                animationSpec = tween(300, easing = FastOutSlowInEasing)
            ) with fadeOut(
                animationSpec = tween(300, easing = FastOutSlowInEasing)
            ) + scaleOut(
                targetScale = 0.95f,
                animationSpec = tween(300, easing = FastOutSlowInEasing)
            )
        },
        label = "ViewModeTransition"
    ) { mode ->
        when (mode) {
            ViewMode.Timeline -> TimelineView(conversations, summaries)
            ViewMode.List -> ListView(conversations)
        }
    }
}
```

#### 2.2 Sticky Header åŠ¨ç”»

**éœ€æ±‚**ï¼šå¤´éƒ¨åŒºåŸŸéšæ»šåŠ¨å¹³æ»‘æ”¶ç¼©

**å®ç°**ï¼š

```kotlin
@Composable
fun DynamicEmotionalHeader(
    contact: ContactProfile,
    scrollState: LazyListState,
    modifier: Modifier = Modifier
) {
    val headerHeight by remember {
        derivedStateOf {
            val offset = scrollState.firstVisibleItemScrollOffset.toFloat()
            val maxScroll = 200f
            val progress = (offset / maxScroll).coerceIn(0f, 1f)
            
            lerp(
                start = Dimensions.HeaderHeightExpanded.value,
                stop = Dimensions.HeaderHeightCollapsed.value,
                fraction = progress
            ).dp
        }
    }
    
    val avatarSize by remember {
        derivedStateOf {
            val offset = scrollState.firstVisibleItemScrollOffset.toFloat()
            val maxScroll = 200f
            val progress = (offset / maxScroll).coerceIn(0f, 1f)
            
            lerp(
                start = Dimensions.AvatarSizeLarge.value,
                stop = Dimensions.AvatarSizeSmall.value,
                fraction = progress
            ).dp
        }
    }
    
    val backgroundAlpha by remember {
        derivedStateOf {
            val offset = scrollState.firstVisibleItemScrollOffset.toFloat()
            val maxScroll = 200f
            val progress = (offset / maxScroll).coerceIn(0f, 1f)
            
            1f - progress
        }
    }
    
    Box(
        modifier = modifier
            .fillMaxWidth()
            .height(headerHeight)
            .background(
                Brush.verticalGradient(
                    colors = getEmotionalColors(contact.relationshipScore)
                        .map { it.copy(alpha = backgroundAlpha) }
                )
            )
    ) {
        Row(
            modifier = Modifier
                .fillMaxSize()
                .padding(16.dp),
            verticalAlignment = Alignment.CenterVertically,
            horizontalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            // å¤´åƒ
            AsyncImage(
                model = contact.avatarUrl,
                contentDescription = "å¤´åƒ",
                modifier = Modifier
                    .size(avatarSize)
                    .clip(CircleShape)
            )
            
            // å§“åå’Œç›¸è¯†æ—¶é•¿
            Column {
                Text(
                    text = contact.name,
                    style = MaterialTheme.typography.headlineMedium,
                    color = Color.White
                )
                
                if (headerHeight > Dimensions.HeaderHeightCollapsed) {
                    Text(
                        text = "å·²ç›¸è¯† ${getDaysSince(contact.createdAt)} å¤©",
                        style = MaterialTheme.typography.bodyMedium,
                        color = Color.White.copy(alpha = 0.8f)
                    )
                }
            }
        }
    }
}
```

---

## ğŸ“± ç•Œé¢ä¸€ï¼šæ¦‚è§ˆ (Overview)

### ç»„ä»¶ç»“æ„

```
OverviewTab
â”œâ”€â”€ DynamicEmotionalHeader (åŠ¨æ€æƒ…æ„Ÿå¤´éƒ¨)
â”œâ”€â”€ TopTagsSection (æ ¸å¿ƒæ ‡ç­¾é€Ÿè§ˆ)
â””â”€â”€ LatestFactHookCard (æœ€æ–°åŠ¨æ€å¡ç‰‡)
```

### æ•°æ®æµ

```
ContactDetailViewModel
    â†“ uiState.contact
    â†“ uiState.topTags
    â†“ uiState.latestFact
OverviewTab
    â†“ æ¸²æŸ“
UI Components
```

### ç»„ä»¶è®¾è®¡

#### 1. TopTagsSection

**èŒè´£**ï¼šå±•ç¤ºæƒé‡æœ€é«˜çš„3-5ä¸ªæ ‡ç­¾

**è¾“å…¥**ï¼š
- `tags: List<Fact>` - æ ‡ç­¾åˆ—è¡¨ï¼ˆå·²æŒ‰æƒé‡æ’åºï¼‰

**è¾“å‡º**ï¼š
- æ¨ªå‘æ»šåŠ¨çš„æ ‡ç­¾åˆ—è¡¨

**å®ç°**ï¼š

```kotlin
@Composable
fun TopTagsSection(
    tags: List<Fact>,
    modifier: Modifier = Modifier
) {
    Column(
        modifier = modifier
            .fillMaxWidth()
            .padding(vertical = 16.dp)
    ) {
        Text(
            text = "æ ¸å¿ƒæ ‡ç­¾",
            style = MaterialTheme.typography.titleMedium,
            modifier = Modifier.padding(horizontal = 16.dp, vertical = 8.dp)
        )
        
        LazyRow(
            horizontalArrangement = Arrangement.spacedBy(8.dp),
            contentPadding = PaddingValues(horizontal = 16.dp)
        ) {
            items(
                items = tags.take(5),
                key = { it.timestamp }
            ) { tag ->
                SolidTagChip(
                    text = tag.value,
                    confidence = tag.confidence,
                    backgroundColor = getTagColor(tag.key)
                )
            }
        }
    }
}

@Composable
fun SolidTagChip(
    text: String,
    confidence: Float,
    backgroundColor: Color,
    modifier: Modifier = Modifier
) {
    Surface(
        modifier = modifier,
        shape = RoundedCornerShape(16.dp),
        color = backgroundColor,
        shadowElevation = 2.dp
    ) {
        Text(
            text = text,
            modifier = Modifier.padding(horizontal = 16.dp, vertical = 8.dp),
            style = MaterialTheme.typography.labelLarge,
            color = Color.White
        )
    }
}

fun getTagColor(category: String): Color {
    return when (category) {
        "å…´è¶£çˆ±å¥½" -> TagColors.Interest
        "æ€§æ ¼ç‰¹å¾" -> TagColors.Personality
        "ä»·å€¼è§‚" -> TagColors.Value
        "ç¦å¿Œè¯é¢˜" -> TagColors.Taboo
        else -> MaterialTheme.colorScheme.primary
    }
}
```

#### 2. LatestFactHookCard

**èŒè´£**ï¼šå±•ç¤ºæœ€æ–°çš„å…³é”®äº’åŠ¨æˆ–AIæ´å¯Ÿ

**è¾“å…¥**ï¼š
- `latestFact: Fact?` - æœ€æ–°çš„äº‹å®è®°å½•

**è¾“å‡º**ï¼š
- ç£¨ç ‚ç»ç’ƒå¡ç‰‡ï¼Œå¸¦è£…é¥°æ€§å›¾æ ‡

**å®ç°**ï¼š

```kotlin
@Composable
fun LatestFactHookCard(
    latestFact: Fact?,
    onViewMore: () -> Unit,
    modifier: Modifier = Modifier
) {
    if (latestFact == null) return
    
    GlassmorphicCard(
        modifier = modifier
            .fillMaxWidth()
            .padding(16.dp),
        onClick = onViewMore
    ) {
        Row(
            modifier = Modifier.padding(16.dp),
            horizontalArrangement = Arrangement.spacedBy(12.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            // è£…é¥°æ€§å›¾æ ‡
            Icon(
                imageVector = getFactIcon(latestFact.key),
                contentDescription = null,
                tint = MaterialTheme.colorScheme.primary,
                modifier = Modifier.size(32.dp)
            )
            
            Column(modifier = Modifier.weight(1f)) {
                Text(
                    text = "æœ€æ–°å‘ç°",
                    style = MaterialTheme.typography.labelMedium,
                    color = MaterialTheme.colorScheme.primary
                )
                
                Spacer(modifier = Modifier.height(4.dp))
                
                Text(
                    text = latestFact.value,
                    style = MaterialTheme.typography.bodyMedium
                )
                
                Spacer(modifier = Modifier.height(4.dp))
                
                Text(
                    text = formatRelativeTime(latestFact.timestamp),
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
            
            Icon(
                imageVector = Icons.Default.ChevronRight,
                contentDescription = "æŸ¥çœ‹æ›´å¤š",
                tint = MaterialTheme.colorScheme.onSurfaceVariant
            )
        }
    }
}

fun getFactIcon(category: String): ImageVector {
    return when (category) {
        "å…´è¶£çˆ±å¥½" -> Icons.Default.Favorite
        "æ€§æ ¼ç‰¹å¾" -> Icons.Default.Psychology
        "ä»·å€¼è§‚" -> Icons.Default.Star
        "ç¦å¿Œè¯é¢˜" -> Icons.Default.Warning
        else -> Icons.Default.Info
    }
}
```

---

## ğŸ“± ç•Œé¢äºŒï¼šäº‹å®æµ (Fact Stream)

### ç»„ä»¶ç»“æ„

```
FactStreamTab
â”œâ”€â”€ FactStreamTopBar (é¡¶éƒ¨æ§ä»¶)
â”‚   â”œâ”€â”€ SegmentedControl (è§†å›¾åˆ‡æ¢)
â”‚   â””â”€â”€ FilterButton (ç­›é€‰æŒ‰é’®)
â”œâ”€â”€ TimelineView (æ—¶å…‰è½´è§†å›¾)
â”‚   â”œâ”€â”€ EmotionalTimelineNode (æƒ…ç»ªèŠ‚ç‚¹)
â”‚   â”œâ”€â”€ PhotoMomentCard (å›¾æ–‡å¡ç‰‡)
â”‚   â”œâ”€â”€ AiSummaryCard (AIæ€»ç»“å¡ç‰‡)
â”‚   â”œâ”€â”€ MilestoneCard (é‡Œç¨‹ç¢‘æ¨ªå¹…)
â”‚   â””â”€â”€ ConversationCard (å¯¹è¯å¡ç‰‡)
â””â”€â”€ ListView (æ¸…å•åˆ—è¡¨è§†å›¾)
    â”œâ”€â”€ QuickFilterChips (å¿«é€Ÿç­›é€‰)
    â””â”€â”€ ListViewRow (åˆ—è¡¨é¡¹)
```

### æ•°æ®æ¨¡å‹

```kotlin
// æ—¶é—´çº¿é¡¹ç›®ç±»å‹
sealed class TimelineItem {
    abstract val id: String
    abstract val timestamp: Long
    abstract val emotionType: EmotionType
    
    data class PhotoMoment(
        override val id: String,
        override val timestamp: Long,
        override val emotionType: EmotionType,
        val photoUrl: String,
        val description: String
    ) : TimelineItem()
    
    data class AiSummary(
        override val id: String,
        override val timestamp: Long,
        override val emotionType: EmotionType,
        val summary: DailySummary
    ) : TimelineItem()
    
    data class Milestone(
        override val id: String,
        override val timestamp: Long,
        override val emotionType: EmotionType,
        val title: String,
        val description: String,
        val icon: String
    ) : TimelineItem()
    
    data class Conversation(
        override val id: String,
        override val timestamp: Long,
        override val emotionType: EmotionType,
        val log: ConversationLog
    ) : TimelineItem()
}

// æƒ…ç»ªç±»å‹
enum class EmotionType(val emoji: String) {
    SWEET("â¤ï¸"),
    CONFLICT("â›ˆï¸"),
    GIFT("ğŸ"),
    DATE("ğŸ½ï¸"),
    DEEP_TALK("ğŸ’¬"),
    NEUTRAL("â­•")
}

// è§†å›¾æ¨¡å¼
enum class ViewMode {
    Timeline,
    List
}

// ç­›é€‰ç±»å‹
enum class FilterType(val displayName: String, val icon: ImageVector) {
    AI_SUMMARY("åªçœ‹AI", Icons.Default.Psychology),
    CONFLICT("åªçœ‹å†²çª", Icons.Default.Warning),
    DATE("åªçœ‹çº¦ä¼š", Icons.Default.Restaurant),
    ALL("å…¨éƒ¨", Icons.Default.FilterList)
}
```

### å…³é”®å®ç°

#### 1. TimelineView - ç€‘å¸ƒæµå¸ƒå±€

```kotlin
@Composable
fun TimelineView(
    items: List<TimelineItem>,
    modifier: Modifier = Modifier
) {
    LazyVerticalStaggeredGrid(
        columns = StaggeredGridCells.Fixed(2),
        modifier = modifier.fillMaxSize(),
        contentPadding = PaddingValues(16.dp),
        horizontalArrangement = Arrangement.spacedBy(12.dp),
        verticalItemSpacing = 12.dp
    ) {
        items(
            items = items,
            key = { it.id }
        ) { item ->
            TimelineItemCard(item)
        }
    }
}

@Composable
fun TimelineItemCard(item: TimelineItem) {
    Column {
        // æƒ…ç»ªèŠ‚ç‚¹
        EmotionalTimelineNode(item.emotionType)
        
        Spacer(modifier = Modifier.height(8.dp))
        
        // å¡ç‰‡å†…å®¹
        when (item) {
            is TimelineItem.PhotoMoment -> PhotoMomentCard(item)
            is TimelineItem.AiSummary -> AiSummaryCard(item.summary)
            is TimelineItem.Milestone -> MilestoneCard(item)
            is TimelineItem.Conversation -> ConversationCard(item.log)
        }
    }
}
```

#### 2. ListView - é«˜æ•ˆæ£€ç´¢

```kotlin
@Composable
fun ListView(
    conversations: List<ConversationLog>,
    selectedFilters: Set<FilterType>,
    onFilterToggle: (FilterType) -> Unit,
    modifier: Modifier = Modifier
) {
    Column(modifier = modifier.fillMaxSize()) {
        // å¿«é€Ÿç­›é€‰
        QuickFilterChips(
            selectedFilters = selectedFilters,
            onFilterToggle = onFilterToggle
        )
        
        // åˆ—è¡¨
        LazyColumn(
            contentPadding = PaddingValues(vertical = 8.dp)
        ) {
            items(
                items = conversations,
                key = { it.id }
            ) { log ->
                ListViewRow(log)
                Divider()
            }
        }
    }
}
```

---

## ğŸ“± ç•Œé¢ä¸‰ï¼šæ ‡ç­¾ç”»åƒ (Persona Tags)

### ç»„ä»¶ç»“æ„

```
PersonaTab
â”œâ”€â”€ CategorySection (åˆ†ç±»åŒºåŸŸ)
â”‚   â”œâ”€â”€ CategoryTitle (åˆ†ç±»æ ‡é¢˜)
â”‚   â””â”€â”€ TagFlowRow (æ ‡ç­¾æµå¼å¸ƒå±€)
â”‚       â”œâ”€â”€ ConfirmedTag (ç¡®è®¤æ ‡ç­¾)
â”‚       â””â”€â”€ GuessedTag (æ¨æµ‹æ ‡ç­¾)
â””â”€â”€ TagConfirmationDialog (æ ‡ç­¾ç¡®è®¤å¯¹è¯æ¡†)
```

### æ ‡ç­¾çŠ¶æ€æœº

```
AIæ¨æµ‹æ ‡ç­¾ (GuessedTag)
    â†“ ç”¨æˆ·ç‚¹å‡»
TagConfirmationDialog
    â†“ ç”¨æˆ·é€‰æ‹©
    â”œâ”€ ç¡®è®¤ â†’ ConfirmedTag (æ›´æ–°sourceä¸ºMANUAL)
    â”œâ”€ é©³å› â†’ åˆ é™¤æ ‡ç­¾
    â””â”€ å–æ¶ˆ â†’ ä¿æŒåŸçŠ¶
```

### å…³é”®å®ç°

#### 1. æ ‡ç­¾åˆ†ç±»å±•ç¤º

```kotlin
@Composable
fun PersonaTab(
    facts: List<Fact>,
    onConfirmTag: (Long) -> Unit,
    onRejectTag: (Long) -> Unit,
    modifier: Modifier = Modifier
) {
    val groupedFacts = remember(facts) {
        facts.groupBy { it.key }
    }
    
    LazyColumn(
        modifier = modifier.fillMaxSize(),
        contentPadding = PaddingValues(16.dp),
        verticalArrangement = Arrangement.spacedBy(24.dp)
    ) {
        groupedFacts.forEach { (category, tags) ->
            item(key = category) {
                CategorySection(
                    category = category,
                    tags = tags,
                    onConfirmTag = onConfirmTag,
                    onRejectTag = onRejectTag
                )
            }
        }
    }
}

@Composable
fun CategorySection(
    category: String,
    tags: List<Fact>,
    onConfirmTag: (Long) -> Unit,
    onRejectTag: (Long) -> Unit
) {
    Column {
        Text(
            text = getCategoryDisplayName(category),
            style = MaterialTheme.typography.titleMedium,
            color = MaterialTheme.colorScheme.primary
        )
        
        Spacer(modifier = Modifier.height(12.dp))
        
        FlowRow(
            horizontalArrangement = Arrangement.spacedBy(8.dp),
            verticalArrangement = Arrangement.spacedBy(8.dp)
        ) {
            tags.forEach { tag ->
                if (isConfirmed(tag)) {
                    ConfirmedTag(tag)
                } else {
                    GuessedTag(
                        tag = tag,
                        onConfirm = { onConfirmTag(tag.timestamp) },
                        onReject = { onRejectTag(tag.timestamp) }
                    )
                }
            }
        }
    }
}

fun isConfirmed(tag: Fact): Boolean {
    return tag.source == "MANUAL" || tag.confidence >= 0.9f
}
```

#### 2. å‘¼å¸åŠ¨æ•ˆå®ç°

```kotlin
@Composable
fun GuessedTag(
    tag: Fact,
    onConfirm: () -> Unit,
    onReject: () -> Unit
) {
    var showDialog by remember { mutableStateOf(false) }
    
    // å‘¼å¸åŠ¨æ•ˆ
    val infiniteTransition = rememberInfiniteTransition(label = "breathing")
    val alpha by infiniteTransition.animateFloat(
        initialValue = 0.6f,
        targetValue = 0.9f,
        animationSpec = infiniteRepeatable(
            animation = tween(2000, easing = LinearEasing),
            repeatMode = RepeatMode.Reverse
        ),
        label = "alpha"
    )
    
    Surface(
        modifier = Modifier.clickable { showDialog = true },
        shape = RoundedCornerShape(16.dp),
        color = MaterialTheme.colorScheme.surfaceVariant.copy(alpha = alpha),
        border = BorderStroke(
            width = 1.dp,
            color = MaterialTheme.colorScheme.outline.copy(alpha = 0.5f)
        )
    ) {
        Row(
            modifier = Modifier.padding(horizontal = 12.dp, vertical = 6.dp),
            horizontalArrangement = Arrangement.spacedBy(4.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            Text(
                text = tag.value,
                style = MaterialTheme.typography.labelMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
            Icon(
                imageVector = Icons.Default.HelpOutline,
                contentDescription = "AIæ¨æµ‹",
                modifier = Modifier.size(14.dp),
                tint = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.6f)
            )
        }
    }
    
    if (showDialog) {
        TagConfirmationDialog(
            tag = tag,
            onConfirm = {
                onConfirm()
                showDialog = false
            },
            onReject = {
                onReject()
                showDialog = false
            },
            onDismiss = { showDialog = false }
        )
    }
}
```

---

## ğŸ¯ ViewModelè®¾è®¡

### ContactDetailViewModel

```kotlin
@HiltViewModel
class ContactDetailViewModel @Inject constructor(
    private val contactRepository: ContactRepository,
    private val conversationRepository: ConversationRepository,
    private val dailySummaryRepository: DailySummaryRepository,
    savedStateHandle: SavedStateHandle
) : ViewModel() {
    
    private val contactId: String = savedStateHandle["contactId"] ?: ""
    
    private val _uiState = MutableStateFlow(ContactDetailUiState())
    val uiState: StateFlow<ContactDetailUiState> = _uiState.asStateFlow()
    
    init {
        loadContactDetail()
    }
    
    fun onEvent(event: ContactDetailUiEvent) {
        when (event) {
            is ContactDetailUiEvent.SwitchTab -> switchTab(event.tab)
            is ContactDetailUiEvent.SwitchViewMode -> switchViewMode(event.mode)
            is ContactDetailUiEvent.ToggleFilter -> toggleFilter(event.filter)
            is ContactDetailUiEvent.ConfirmTag -> confirmTag(event.factId)
            is ContactDetailUiEvent.RejectTag -> rejectTag(event.factId)
            is ContactDetailUiEvent.RefreshData -> loadContactDetail()
        }
    }
    
    private fun loadContactDetail() {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }
            
            try {
                // å¹¶è¡ŒåŠ è½½æ•°æ®
                val contactDeferred = async { contactRepository.getProfile(contactId) }
                val conversationsDeferred = async { 
                    conversationRepository.getConversationsByContact(contactId).first() 
                }
                val summariesDeferred = async { 
                    dailySummaryRepository.getSummariesByContact(contactId).first() 
                }
                
                val contact = contactDeferred.await().getOrNull()
                val conversations = conversationsDeferred.await()
                val summaries = summariesDeferred.await()
                
                _uiState.update {
                    it.copy(
                        contact = contact,
                        conversations = conversations,
                        summaries = summaries,
                        facts = contact?.facts ?: emptyList(),
                        topTags = contact?.facts?.sortedByDescending { it.confidence }?.take(5) ?: emptyList(),
                        latestFact = contact?.facts?.maxByOrNull { it.timestamp },
                        timelineItems = buildTimelineItems(conversations, summaries),
                        isLoading = false
                    )
                }
            } catch (e: Exception) {
                _uiState.update {
                    it.copy(
                        isLoading = false,
                        error = e.message
                    )
                }
            }
        }
    }
    
    private fun buildTimelineItems(
        conversations: List<ConversationLog>,
        summaries: List<DailySummary>
    ): List<TimelineItem> {
        val items = mutableListOf<TimelineItem>()
        
        // æ·»åŠ å¯¹è¯è®°å½•
        conversations.forEach { log ->
            items.add(
                TimelineItem.Conversation(
                    id = "conv_${log.id}",
                    timestamp = log.timestamp,
                    emotionType = detectEmotion(log),
                    log = log
                )
            )
        }
        
        // æ·»åŠ æ¯æ—¥æ€»ç»“
        summaries.forEach { summary ->
            items.add(
                TimelineItem.AiSummary(
                    id = "summary_${summary.id}",
                    timestamp = summary.createdAt,
                    emotionType = EmotionType.NEUTRAL,
                    summary = summary
                )
            )
        }
        
        // æŒ‰æ—¶é—´å€’åºæ’åº
        return items.sortedByDescending { it.timestamp }
    }
    
    private fun detectEmotion(log: ConversationLog): EmotionType {
        // ç®€å•çš„æƒ…ç»ªæ£€æµ‹é€»è¾‘
        val text = log.userInput + (log.aiResponse ?: "")
        return when {
            text.contains("çˆ±") || text.contains("å–œæ¬¢") -> EmotionType.SWEET
            text.contains("ç”Ÿæ°”") || text.contains("åµæ¶") -> EmotionType.CONFLICT
            text.contains("ç¤¼ç‰©") || text.contains("é€") -> EmotionType.GIFT
            text.contains("åƒé¥­") || text.contains("çº¦ä¼š") -> EmotionType.DATE
            else -> EmotionType.NEUTRAL
        }
    }
    
    private fun confirmTag(factId: Long) {
        viewModelScope.launch {
            val updatedFacts = _uiState.value.facts.map { fact ->
                if (fact.timestamp == factId) {
                    fact.copy(source = "MANUAL", confidence = 1.0f)
                } else {
                    fact
                }
            }
            
            val updatedContact = _uiState.value.contact?.copy(facts = updatedFacts)
            if (updatedContact != null) {
                contactRepository.updateProfile(updatedContact)
                _uiState.update { it.copy(facts = updatedFacts) }
            }
        }
    }
    
    private fun rejectTag(factId: Long) {
        viewModelScope.launch {
            val updatedFacts = _uiState.value.facts.filter { it.timestamp != factId }
            val updatedContact = _uiState.value.contact?.copy(facts = updatedFacts)
            
            if (updatedContact != null) {
                contactRepository.updateProfile(updatedContact)
                _uiState.update { it.copy(facts = updatedFacts) }
            }
        }
    }
}
```

### UiStateå®šä¹‰

```kotlin
data class ContactDetailUiState(
    // åŸºç¡€æ•°æ®
    val contact: ContactProfile? = null,
    val conversations: List<ConversationLog> = emptyList(),
    val summaries: List<DailySummary> = emptyList(),
    val facts: List<Fact> = emptyList(),
    
    // ç•Œé¢ä¸€ï¼šæ¦‚è§ˆ
    val topTags: List<Fact> = emptyList(),
    val latestFact: Fact? = null,
    
    // ç•Œé¢äºŒï¼šäº‹å®æµ
    val currentTab: DetailTab = DetailTab.Overview,
    val viewMode: ViewMode = ViewMode.Timeline,
    val selectedFilters: Set<FilterType> = emptySet(),
    val timelineItems: List<TimelineItem> = emptyList(),
    
    // çŠ¶æ€
    val isLoading: Boolean = false,
    val error: String? = null
)

enum class DetailTab {
    Overview,      // æ¦‚è§ˆ
    FactStream,    // äº‹å®æµ
    Persona,       // æ ‡ç­¾ç”»åƒ
    DataVault      // èµ„æ–™åº“
}
```

---

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†æœºåˆ¶

### é”™è¯¯å¤„ç†æ¶æ„

```
å¼‚å¸¸å‘ç”Ÿ
    â†“
Repositoryå±‚æ•è·
    â†“ Result<T>
ViewModelå±‚å¤„ç†
    â†“ mapExceptionToUiError()
UiErrorå¯¹è±¡
    â†“ StateFlow
UIå±‚å±•ç¤º
    â†“
ç”¨æˆ·æ“ä½œï¼ˆé‡è¯•/å–æ¶ˆï¼‰
```

### 1. å¼‚å¸¸åˆ†ç±»å’Œæ˜ å°„

#### å¼‚å¸¸ç±»å‹å®šä¹‰

```kotlin
// Domainå±‚å¼‚å¸¸
sealed class DomainException : Exception() {
    data class ContactNotFoundException(val contactId: String) : 
        DomainException()
    
    data class DatabaseException(override val cause: Throwable?) : 
        DomainException()
    
    data class NetworkException(override val cause: Throwable?) : 
        DomainException()
    
    data class ValidationException(val field: String, val reason: String) : 
        DomainException()
}
```

#### å¼‚å¸¸æ˜ å°„å‡½æ•°

```kotlin
// ViewModelä¸­çš„å¼‚å¸¸æ˜ å°„
private fun mapExceptionToUiError(exception: Throwable): UiError {
    return when (exception) {
        is DomainException.ContactNotFoundException -> 
            UiError.DataNotFound("æœªæ‰¾åˆ°è”ç³»äººä¿¡æ¯")
        
        is DomainException.DatabaseException -> 
            UiError.DatabaseError("æ•°æ®åº“æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")
        
        is DomainException.NetworkException -> 
            UiError.NetworkError("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®")
        
        is DomainException.ValidationException -> 
            UiError.UnknownError("æ•°æ®éªŒè¯å¤±è´¥ï¼š${exception.reason}")
        
        is IOException -> 
            UiError.NetworkError("ç½‘ç»œè¿æ¥å¤±è´¥")
        
        is SQLException -> 
            UiError.DatabaseError("æ•°æ®åº“æ“ä½œå¤±è´¥")
        
        else -> 
            UiError.UnknownError("æœªçŸ¥é”™è¯¯ï¼š${exception.message}")
    }
}
```

### 2. UIå±‚é”™è¯¯å±•ç¤º

#### é”™è¯¯çŠ¶æ€ç»„ä»¶

```kotlin
@Composable
fun ErrorView(
    error: UiError,
    onRetry: () -> Unit,
    onDismiss: () -> Unit,
    modifier: Modifier = Modifier
) {
    Column(
        modifier = modifier
            .fillMaxSize()
            .padding(32.dp),
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.Center
    ) {
        // é”™è¯¯å›¾æ ‡
        Icon(
            imageVector = when (error) {
                is UiError.NetworkError -> Icons.Default.CloudOff
                is UiError.DataNotFound -> Icons.Default.SearchOff
                is UiError.DatabaseError -> Icons.Default.Error
                is UiError.UnknownError -> Icons.Default.ErrorOutline
            },
            contentDescription = null,
            modifier = Modifier.size(64.dp),
            tint = MaterialTheme.colorScheme.error
        )
        
        Spacer(modifier = Modifier.height(16.dp))
        
        // é”™è¯¯æ¶ˆæ¯
        Text(
            text = error.message,
            style = MaterialTheme.typography.bodyLarge,
            textAlign = TextAlign.Center,
            color = MaterialTheme.colorScheme.onSurface
        )
        
        Spacer(modifier = Modifier.height(24.dp))
        
        // æ“ä½œæŒ‰é’®
        Row(
            horizontalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            if (error.canRetry) {
                Button(onClick = onRetry) {
                    Icon(Icons.Default.Refresh, contentDescription = null)
                    Spacer(modifier = Modifier.width(8.dp))
                    Text("é‡è¯•")
                }
            }
            
            OutlinedButton(onClick = onDismiss) {
                Text("å–æ¶ˆ")
            }
        }
    }
}
```

#### é”™è¯¯æç¤ºSnackbar

```kotlin
@Composable
fun ContactDetailScreen(
    viewModel: ContactDetailViewModel,
    snackbarHostState: SnackbarHostState = remember { SnackbarHostState() }
) {
    val uiState by viewModel.uiState.collectAsState()
    
    // ç›‘å¬é”™è¯¯çŠ¶æ€
    LaunchedEffect(uiState.error) {
        uiState.error?.let { error ->
            val result = snackbarHostState.showSnackbar(
                message = error.message,
                actionLabel = if (error.canRetry) "é‡è¯•" else null,
                duration = SnackbarDuration.Long
            )
            
            when (result) {
                SnackbarResult.ActionPerformed -> {
                    viewModel.onEvent(ContactDetailUiEvent.RetryLoad)
                }
                SnackbarResult.Dismissed -> {
                    viewModel.onEvent(ContactDetailUiEvent.DismissError)
                }
            }
        }
    }
    
    Scaffold(
        snackbarHost = { SnackbarHost(snackbarHostState) }
    ) { padding ->
        // UIå†…å®¹
    }
}
```

### 3. è¾¹ç•Œæ¡ä»¶å¤„ç†

#### ç©ºçŠ¶æ€å¤„ç†

```kotlin
@Composable
fun EmptyStateView(
    type: EmptyStateType,
    onAction: () -> Unit,
    modifier: Modifier = Modifier
) {
    Column(
        modifier = modifier
            .fillMaxSize()
            .padding(32.dp),
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.Center
    ) {
        when (type) {
            EmptyStateType.NoConversations -> {
                Icon(
                    imageVector = Icons.Default.ChatBubbleOutline,
                    contentDescription = null,
                    modifier = Modifier.size(64.dp),
                    tint = MaterialTheme.colorScheme.onSurfaceVariant
                )
                Spacer(modifier = Modifier.height(16.dp))
                Text(
                    text = "è¿˜æ²¡æœ‰å¯¹è¯è®°å½•",
                    style = MaterialTheme.typography.titleMedium
                )
                Text(
                    text = "å¼€å§‹ä¸TAèŠå¤©ï¼ŒAIä¼šè‡ªåŠ¨è®°å½•",
                    style = MaterialTheme.typography.bodyMedium,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
            
            EmptyStateType.NoTags -> {
                Icon(
                    imageVector = Icons.Default.Label,
                    contentDescription = null,
                    modifier = Modifier.size(64.dp),
                    tint = MaterialTheme.colorScheme.onSurfaceVariant
                )
                Spacer(modifier = Modifier.height(16.dp))
                Text(
                    text = "è¿˜æ²¡æœ‰æ ‡ç­¾",
                    style = MaterialTheme.typography.titleMedium
                )
                Text(
                    text = "AIä¼šæ ¹æ®å¯¹è¯è‡ªåŠ¨æ¨æ–­æ ‡ç­¾",
                    style = MaterialTheme.typography.bodyMedium,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
            
            EmptyStateType.NoSearchResults -> {
                Icon(
                    imageVector = Icons.Default.SearchOff,
                    contentDescription = null,
                    modifier = Modifier.size(64.dp),
                    tint = MaterialTheme.colorScheme.onSurfaceVariant
                )
                Spacer(modifier = Modifier.height(16.dp))
                Text(
                    text = "æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å†…å®¹",
                    style = MaterialTheme.typography.titleMedium
                )
                Button(onClick = onAction) {
                    Text("æ¸…é™¤ç­›é€‰")
                }
            }
        }
    }
}

enum class EmptyStateType {
    NoConversations,
    NoTags,
    NoSearchResults
}
```

#### åŠ è½½çŠ¶æ€å¤„ç†

```kotlin
@Composable
fun LoadingStateView(
    message: String = "åŠ è½½ä¸­...",
    modifier: Modifier = Modifier
) {
    Box(
        modifier = modifier.fillMaxSize(),
        contentAlignment = Alignment.Center
    ) {
        Column(
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            CircularProgressIndicator()
            Text(
                text = message,
                style = MaterialTheme.typography.bodyMedium,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
        }
    }
}
```

#### æ•°æ®éªŒè¯

```kotlin
// ViewModelä¸­çš„æ•°æ®éªŒè¯
private fun validateContactData(contact: ContactProfile): Result<Unit> {
    return when {
        contact.name.isBlank() -> 
            Result.failure(DomainException.ValidationException("name", "å§“åä¸èƒ½ä¸ºç©º"))
        
        contact.relationshipScore !in 0..100 -> 
            Result.failure(DomainException.ValidationException(
                "relationshipScore", 
                "å…³ç³»åˆ†æ•°å¿…é¡»åœ¨0-100ä¹‹é—´"
            ))
        
        else -> Result.success(Unit)
    }
}
```

### 4. ç½‘ç»œé”™è¯¯å¤„ç†

#### é‡è¯•æœºåˆ¶

```kotlin
// Repositoryä¸­çš„é‡è¯•é€»è¾‘
suspend fun <T> retryWithExponentialBackoff(
    maxRetries: Int = 3,
    initialDelay: Long = 1000,
    maxDelay: Long = 10000,
    factor: Double = 2.0,
    block: suspend () -> T
): Result<T> {
    var currentDelay = initialDelay
    repeat(maxRetries) { attempt ->
        try {
            return Result.success(block())
        } catch (e: IOException) {
            if (attempt == maxRetries - 1) {
                return Result.failure(DomainException.NetworkException(e))
            }
            delay(currentDelay)
            currentDelay = (currentDelay * factor).toLong().coerceAtMost(maxDelay)
        }
    }
    return Result.failure(DomainException.NetworkException(null))
}
```

#### è¶…æ—¶å¤„ç†

```kotlin
// ViewModelä¸­çš„è¶…æ—¶å¤„ç†
private fun loadDataWithTimeout() {
    viewModelScope.launch {
        try {
            withTimeout(30000) { // 30ç§’è¶…æ—¶
                loadContactDetail()
            }
        } catch (e: TimeoutCancellationException) {
            _uiState.update {
                it.copy(
                    isLoading = false,
                    error = UiError.NetworkError("åŠ è½½è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥")
                )
            }
        }
    }
}
```

### 5. æ•°æ®åº“é”™è¯¯å¤„ç†

#### äº‹åŠ¡å›æ»š

```kotlin
// Repositoryä¸­çš„äº‹åŠ¡å¤„ç†
suspend fun updateContactWithRollback(contact: ContactProfile): Result<Unit> {
    return try {
        database.withTransaction {
            contactDao.update(contact.toEntity())
            // å¦‚æœåç»­æ“ä½œå¤±è´¥ï¼Œè‡ªåŠ¨å›æ»š
        }
        Result.success(Unit)
    } catch (e: SQLException) {
        Result.failure(DomainException.DatabaseException(e))
    }
}
```

#### æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

```kotlin
// DAOä¸­çš„æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
@Query("SELECT * FROM contact_profiles WHERE contact_id = :id")
suspend fun getProfileWithValidation(id: String): ContactProfileEntity? {
    val entity = getProfile(id)
    
    // éªŒè¯æ•°æ®å®Œæ•´æ€§
    if (entity != null) {
        require(entity.name.isNotBlank()) { "Contact name cannot be blank" }
        require(entity.relationshipScore in 0..100) { "Invalid relationship score" }
    }
    
    return entity
}
```

### 6. ç”¨æˆ·æ“ä½œé”™è¯¯å¤„ç†

#### è¾“å…¥éªŒè¯

```kotlin
// ViewModelä¸­çš„è¾“å…¥éªŒè¯
fun onEvent(event: ContactDetailUiEvent) {
    when (event) {
        is ContactDetailUiEvent.ConfirmTag -> {
            if (event.factId <= 0) {
                _uiState.update {
                    it.copy(error = UiError.UnknownError("æ— æ•ˆçš„æ ‡ç­¾ID"))
                }
                return
            }
            confirmTag(event.factId)
        }
        // å…¶ä»–äº‹ä»¶...
    }
}
```

#### é˜²æŠ–å¤„ç†

```kotlin
// é˜²æ­¢é‡å¤ç‚¹å‡»
private var lastClickTime = 0L
private val clickDebounceTime = 500L

fun onConfirmTagClick(factId: Long) {
    val currentTime = System.currentTimeMillis()
    if (currentTime - lastClickTime < clickDebounceTime) {
        return // å¿½ç•¥é‡å¤ç‚¹å‡»
    }
    lastClickTime = currentTime
    
    viewModel.onEvent(ContactDetailUiEvent.ConfirmTag(factId))
}
```

### 7. é”™è¯¯æ—¥å¿—è®°å½•

```kotlin
// é”™è¯¯æ—¥å¿—å·¥å…·
object ErrorLogger {
    fun logError(
        tag: String,
        message: String,
        throwable: Throwable? = null
    ) {
        if (BuildConfig.DEBUG) {
            Log.e(tag, message, throwable)
        }
        
        // ç”Ÿäº§ç¯å¢ƒå¯ä»¥ä¸ŠæŠ¥åˆ°é”™è¯¯è¿½è¸ªæœåŠ¡
        // FirebaseCrashlytics.getInstance().recordException(throwable)
    }
}

// åœ¨ViewModelä¸­ä½¿ç”¨
private fun loadContactDetail() {
    viewModelScope.launch {
        try {
            // åŠ è½½é€»è¾‘...
        } catch (e: Exception) {
            ErrorLogger.logError(
                tag = "ContactDetailViewModel",
                message = "Failed to load contact detail: contactId=$contactId",
                throwable = e
            )
            _uiState.update {
                it.copy(error = mapExceptionToUiError(e))
            }
        }
    }
}
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. åˆ—è¡¨ä¼˜åŒ–

```kotlin
// ä½¿ç”¨keyå‚æ•°ä¼˜åŒ–é‡ç»„
LazyColumn {
    items(
        items = conversations,
        key = { it.id }  // å…³é”®ï¼šä½¿ç”¨ç¨³å®šçš„key
    ) { conversation ->
        ConversationCard(conversation)
    }
}

// ä½¿ç”¨contentTypeä¼˜åŒ–ä¸åŒç±»å‹çš„item
LazyColumn {
    items(
        items = timelineItems,
        key = { it.id },
        contentType = { item ->
            when (item) {
                is TimelineItem.PhotoMoment -> "photo"
                is TimelineItem.AiSummary -> "summary"
                is TimelineItem.Milestone -> "milestone"
                is TimelineItem.Conversation -> "conversation"
            }
        }
    ) { item ->
        TimelineItemCard(item)
    }
}
```

### 2. åŠ¨ç”»ä¼˜åŒ–

```kotlin
// é™åˆ¶åŒæ—¶è¿è¡Œçš„åŠ¨ç”»æ•°é‡
@Composable
fun OptimizedBreathingAnimation(
    enabled: Boolean,
    content: @Composable (Float) -> Unit
) {
    val alpha = if (enabled) {
        val infiniteTransition = rememberInfiniteTransition()
        infiniteTransition.animateFloat(
            initialValue = 0.6f,
            targetValue = 0.9f,
            animationSpec = infiniteRepeatable(
                animation = tween(2000),
                repeatMode = RepeatMode.Reverse
            )
        ).value
    } else {
        0.7f
    }
    
    content(alpha)
}
```

### 3. æ•°æ®åŠ è½½ä¼˜åŒ–

```kotlin
// ä½¿ç”¨Flowè‡ªåŠ¨æ›´æ–°UI
init {
    viewModelScope.launch {
        combine(
            contactRepository.getProfileFlow(contactId),
            conversationRepository.getConversationsByContact(contactId),
            dailySummaryRepository.getSummariesByContact(contactId)
        ) { contact, conversations, summaries ->
            Triple(contact, conversations, summaries)
        }.collect { (contact, conversations, summaries) ->
            _uiState.update {
                it.copy(
                    contact = contact.getOrNull(),
                    conversations = conversations,
                    summaries = summaries,
                    timelineItems = buildTimelineItems(conversations, summaries)
                )
            }
        }
    }
}
```

---

## ğŸ“Š æ•°æ®æµå›¾

```
ç”¨æˆ·æ“ä½œ
    â†“
ContactDetailScreen
    â†“ onEvent()
ContactDetailViewModel
    â†“ è°ƒç”¨UseCase/Repository
Domain Layer
    â†“ è¿”å›Result/Flow
ContactDetailViewModel
    â†“ æ›´æ–°_uiState
ContactDetailScreen
    â†“ é‡ç»„UI
ç”¨æˆ·çœ‹åˆ°æ›´æ–°
```

---

## ğŸ¯ æµ‹è¯•ç­–ç•¥

### 1. ViewModelå•å…ƒæµ‹è¯•

```kotlin
@Test
fun `confirmTag should update fact source to MANUAL`() = runTest {
    // Given
    val viewModel = ContactDetailViewModel(...)
    val factId = 123L
    
    // When
    viewModel.onEvent(ContactDetailUiEvent.ConfirmTag(factId))
    
    // Then
    val updatedFact = viewModel.uiState.value.facts.find { it.timestamp == factId }
    assertEquals("MANUAL", updatedFact?.source)
    assertEquals(1.0f, updatedFact?.confidence)
}
```

### 2. UIç»„ä»¶æµ‹è¯•

```kotlin
@Test
fun `GuessedTag should show confirmation dialog on click`() {
    composeTestRule.setContent {
        GuessedTag(
            tag = Fact(...),
            onConfirm = {},
            onReject = {}
        )
    }
    
    // ç‚¹å‡»æ ‡ç­¾
    composeTestRule.onNodeWithText("æµ‹è¯•æ ‡ç­¾").performClick()
    
    // éªŒè¯å¯¹è¯æ¡†æ˜¾ç¤º
    composeTestRule.onNodeWithText("ç¡®è®¤æ ‡ç­¾").assertIsDisplayed()
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [PRD-00004 v2.0 - è”ç³»äººç”»åƒè®°å¿†ç³»ç»ŸUIé›†æˆéœ€æ±‚](../PRD/PRD-00004-è”ç³»äººç”»åƒè®°å¿†ç³»ç»ŸUIé›†æˆéœ€æ±‚-v2.md)
- [HANDOFF-00001 - è®°å¿†ç³»ç»ŸUIå¼€å‘çŸ¥è¯†ä¼ é€’](../HANDOFF/HANDOFF-00001-è®°å¿†ç³»ç»ŸUIå¼€å‘çŸ¥è¯†ä¼ é€’.md)
- [IMPL-00003 - è”ç³»äººç”»åƒè®°å¿†ç³»ç»Ÿå®ç°è¿›åº¦](../IMPL/IMPL-00003-è”ç³»äººç”»åƒè®°å¿†ç³»ç»Ÿå®ç°è¿›åº¦.md)

---

## ğŸ“ å˜æ›´è®°å½•

### v2.1 (2025-12-14) - å®Œå–„ç‰ˆ

**å˜æ›´å†…å®¹**ï¼š
- âœ… æ–°å¢ï¼šè¯¦ç»†çš„å®æ–½è®¡åˆ’ï¼ˆ7ä¸ªé˜¶æ®µï¼Œ14-21å¤©ï¼‰
- âœ… æ–°å¢ï¼šå®Œæ•´çš„æ•°æ®æ¨¡å‹è®¾è®¡ï¼ˆæ•°æ®æµæ¶æ„ã€æ ¸å¿ƒæ•°æ®æ¨¡å‹ã€æ•°æ®åŒæ­¥ç­–ç•¥ï¼‰
- âœ… æ–°å¢ï¼šå…¨é¢çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼ˆå¼‚å¸¸åˆ†ç±»ã€UIå±•ç¤ºã€è¾¹ç•Œæ¡ä»¶ã€é‡è¯•æœºåˆ¶ï¼‰
- âœ… ä¼˜åŒ–ï¼šè¡¥å……é‡Œç¨‹ç¢‘å’Œäº¤ä»˜ç‰©å®šä¹‰
- âœ… ä¼˜åŒ–ï¼šæ·»åŠ é£é™©è¯„ä¼°å’Œåº”å¯¹æªæ–½
- âœ… ä¼˜åŒ–ï¼šå®Œå–„èµ„æºåˆ†é…è®¡åˆ’

**å®¡æŸ¥ç»“æœ**ï¼š
- æ ¹æ®DR-00007å®¡æŸ¥æŠ¥å‘Šçš„é«˜ä¼˜å…ˆçº§å»ºè®®è¿›è¡Œä¼˜åŒ–
- ç»¼åˆè¯„åˆ†ä»8.24/10æå‡è‡³é¢„æœŸ9.0+/10
- å†…å®¹å®Œæ•´æ€§ä»6/10æå‡è‡³é¢„æœŸ9/10

### v2.0 (2025-12-14) - åˆå§‹ç‰ˆæœ¬

**å˜æ›´å†…å®¹**ï¼š
- âœ… åˆ›å»ºæ–‡æ¡£ï¼ŒåŒ…å«å®Œæ•´çš„UIè®¾è®¡å’ŒæŠ€æœ¯å®ç°
- âœ… å®šä¹‰å…¨å±€è®¾è®¡ç³»ç»Ÿï¼ˆæƒ…æ„ŸåŒ–èƒŒæ™¯ã€ç£¨ç ‚ç»ç’ƒå¡ç‰‡ã€æµä½“åŠ¨ç”»ï¼‰
- âœ… è®¾è®¡å››ä¸ªä¸»è¦ç•Œé¢ï¼ˆæ¦‚è§ˆã€äº‹å®æµã€æ ‡ç­¾ç”»åƒã€èµ„æ–™åº“ï¼‰
- âœ… å®ç°ViewModelå’Œæ•°æ®æµè®¾è®¡
- âœ… æ·»åŠ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥å’Œæµ‹è¯•ç­–ç•¥

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.1  
**æœ€åæ›´æ–°**: 2025-12-14  
**æ›´æ–°è€…**: Kiro  
**å®¡æŸ¥è€…**: Roo  
**çŠ¶æ€**: âœ… å®¡æŸ¥é€šè¿‡ï¼ˆå¾…å¼€å‘ï¼‰
