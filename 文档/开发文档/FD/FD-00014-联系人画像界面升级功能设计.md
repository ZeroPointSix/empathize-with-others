# FD-00014: 联系人画像界面升级功能设计

---
**文档类型**: FD (Functional Design) - 开发过程文档  
**存放规范**: 符合项目宪法第IV条 - 文档规范  
**版本控制**: Git管理，见.commit钩子  
---

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 文档类型 | FD (Functional Design) |
| 文档编号 | FD-00014 |
| 功能名称 | 联系人画像界面升级 |
| 版本 | 1.0 |
| 创建日期 | 2025-12-21 |
| 最后更新 | 2025-12-21 |
| 作者 | Kiro |
| 审核人 | 待定 |
| 关联文档 | PRD-00014, TD-00014 |

---

## 2. 功能概述

### 2.1 功能目标

升级联系人画像界面（Persona Tab），使其成为一个动态、交互丰富、视觉友好的个性化信息中心：
1. **动态分类展示**：基于Fact Key自动分组，不再限制于预设的"雷区标签"和"策略标签"
2. **高效管理能力**：提供搜索、多选、批量操作等功能
3. **视觉体验提升**：引入动态配色系统和流畅的布局动画

### 2.2 功能边界

| 包含 (V1) | 不包含 (V2规划) |
|-----------|-----------------|
| 基于Fact Key的动态分组展示 | AI自动标签推荐 |
| 分类动态配色系统 | 标签关联分析 |
| 标签搜索与实时过滤 | 标签使用统计 |
| 长按进入编辑模式 | 标签云可视化 |
| 批量选择与删除 | 跨联系人标签对比 |
| 批量修改分类（Key） | 标签导入导出 |
| 单个标签编辑 | 标签模板功能 |
| 分类折叠/展开 | 标签历史记录 |


---

## 3. 功能流程设计

### 3.1 整体流程图

```
┌─────────────────────────────────────────────────────────────┐
│                 联系人画像界面升级整体流程                    │
└─────────────────────────────────────────────────────────────┘

  ┌──────────────┐
  │ 联系人详情页 │ ← 用户点击"标签画像"Tab
  └──────────────┘
         │
         ▼
  ┌──────────────┐     有标签数据?
  │ PersonaTab   │ ─────────────────────────────────────┐
  └──────────────┘        否                            │
         │                                              │
         │ 是                                           ▼
         ▼                                    ┌──────────────┐
  ┌──────────────┐                            │ 显示空状态   │
  │ 加载标签数据 │                            │ 引导添加标签 │
  └──────────────┘                            └──────────────┘
         │
         │ 按Key分组
         ▼
  ┌──────────────┐
  │ 动态分组展示 │
  │ 分配分类颜色 │
  └──────────────┘
         │
         │ 用户操作
         ▼
  ┌──────────────────────────────────────────────────────────┐
  │                    用户交互分支                           │
  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
  │  │ 搜索标签    │  │ 长按标签    │  │ 点击标签    │      │
  │  └─────────────┘  └─────────────┘  └─────────────┘      │
  │        │                │                │              │
  │        ▼                ▼                ▼              │
  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
  │  │ 实时过滤    │  │ 进入编辑模式│  │ 查看/编辑   │      │
  │  │ 显示结果    │  │ 批量操作    │  │ 标签详情    │      │
  │  └─────────────┘  └─────────────┘  └─────────────┘      │
  └──────────────────────────────────────────────────────────┘
```

### 3.2 动态分组展示流程

```
  加载联系人Facts数据
         │
         ▼
  ┌──────────────┐
  │ 提取所有Key  │
  │ 去重排序     │
  └──────────────┘
         │
         ▼
  ┌──────────────┐
  │ 按Key分组    │
  │ Facts列表    │
  └──────────────┘
         │
         ▼
  ┌──────────────┐
  │ 为每个分类   │
  │ 分配颜色     │
  └──────────────┘
         │
         ▼
  ┌──────────────────────────────────────┐
  │           分类展示区域                │
  │  ┌────────────────────────────────┐  │
  │  │ 🔴 性格特点                 ▼  │  │
  │  │ [内向] [理性] [细心]          │  │
  │  └────────────────────────────────┘  │
  │  ┌────────────────────────────────┐  │
  │  │ 🟢 兴趣爱好                 ▼  │  │
  │  │ [阅读] [运动] [旅行]          │  │
  │  └────────────────────────────────┘  │
  │  ┌────────────────────────────────┐  │
  │  │ 🔵 工作信息                 ▼  │  │
  │  │ [程序员] [互联网行业]         │  │
  │  └────────────────────────────────┘  │
  └──────────────────────────────────────┘
```

### 3.3 搜索过滤流程

```
  用户输入搜索关键词
         │
         ▼
  ┌──────────────┐
  │ 实时监听输入 │
  │ 防抖300ms    │
  └──────────────┘
         │
         ▼
  ┌──────────────┐     关键词为空?      ┌──────────────┐
  │ 检查关键词   │ ─────────────────→   │ 显示全部标签 │
  └──────────────┘        是            └──────────────┘
         │
         │ 否
         ▼
  ┌──────────────┐
  │ 匹配标签内容 │
  │ 匹配分类名称 │
  └──────────────┘
         │
         ▼
  ┌──────────────┐     有匹配结果?      ┌──────────────┐
  │ 过滤结果     │ ─────────────────→   │ 显示空搜索   │
  └──────────────┘        否            │ 结果提示     │
         │                              └──────────────┘
         │ 是
         ▼
  ┌──────────────┐
  │ 显示匹配标签 │
  │ 高亮关键词   │
  └──────────────┘
```

### 3.4 编辑模式流程

```
  用户长按任意标签
         │
         ▼
  ┌──────────────┐
  │ 触发震动反馈 │
  │ 进入编辑模式 │
  └──────────────┘
         │
         ▼
  ┌──────────────────────────────────────┐
  │           编辑模式界面                │
  │  ┌────────────────────────────────┐  │
  │  │ 已选择 0 项          [取消]   │  │
  │  └────────────────────────────────┘  │
  │                                      │
  │  ┌────────────────────────────────┐  │
  │  │ 性格特点              [全选]  │  │
  │  │ [☐内向] [☐理性] [☐细心]      │  │
  │  └────────────────────────────────┘  │
  │                                      │
  │  ┌────────────────────────────────┐  │
  │  │ 🗑️删除    📁移动分类          │  │
  │  └────────────────────────────────┘  │
  └──────────────────────────────────────┘
         │
         │ 用户选择操作
         ▼
  ┌──────────────────────────────────────────────────────────┐
  │                    批量操作分支                           │
  │  ┌─────────────┐              ┌─────────────┐            │
  │  │ 批量删除    │              │ 批量移动    │            │
  │  └─────────────┘              └─────────────┘            │
  │        │                            │                    │
  │        ▼                            ▼                    │
  │  ┌─────────────┐              ┌─────────────┐            │
  │  │ 确认对话框  │              │ 选择目标分类│            │
  │  │ 二次确认    │              │ 对话框      │            │
  │  └─────────────┘              └─────────────┘            │
  │        │                            │                    │
  │        ▼                            ▼                    │
  │  ┌─────────────┐              ┌─────────────┐            │
  │  │ 执行删除    │              │ 执行移动    │            │
  │  │ 更新数据库  │              │ 更新Key     │            │
  │  └─────────────┘              └─────────────┘            │
  └──────────────────────────────────────────────────────────┘
         │
         ▼
  ┌──────────────┐
  │ 退出编辑模式 │
  │ 刷新UI显示   │
  └──────────────┘
```


---

## 4. 数据模型设计

### 4.1 现有Fact模型（无需修改）

```kotlin
/**
 * 事实模型 - 已存在于domain/model/Fact.kt
 * 本次升级复用现有模型，无需修改
 */
data class Fact(
    val id: String = UUID.randomUUID().toString(),
    val key: String,           // 分类键，如"性格特点"、"兴趣爱好"
    val value: String,         // 标签值，如"内向"、"阅读"
    val timestamp: Long,
    val source: FactSource,
    val isUserModified: Boolean = false,
    val lastModifiedTime: Long = timestamp,
    val originalKey: String? = null,
    val originalValue: String? = null
)
```

### 4.2 分类分组模型（新增）

```kotlin
/**
 * 标签分类分组
 * 用于UI层展示动态分组后的标签
 */
data class FactCategory(
    val key: String,                    // 分类名称（Fact的Key）
    val facts: List<Fact>,              // 该分类下的所有标签
    val color: CategoryColor,           // 分类颜色
    val isExpanded: Boolean = true      // 是否展开
) {
    val factCount: Int get() = facts.size
    val isEmpty: Boolean get() = facts.isEmpty()
}

/**
 * 分类颜色
 * 包含标题颜色和标签背景色
 */
data class CategoryColor(
    val titleColor: Color,              // 分类标题颜色
    val tagBackgroundColor: Color,      // 标签背景色
    val tagTextColor: Color             // 标签文字颜色
)
```

### 4.3 编辑模式状态模型（新增）

```kotlin
/**
 * 编辑模式状态
 */
data class EditModeState(
    val isActive: Boolean = false,              // 是否处于编辑模式
    val selectedFactIds: Set<String> = emptySet(), // 已选中的Fact ID集合
    val showDeleteConfirm: Boolean = false,     // 是否显示删除确认对话框
    val showMoveDialog: Boolean = false         // 是否显示移动分类对话框
) {
    val selectedCount: Int get() = selectedFactIds.size
    val hasSelection: Boolean get() = selectedFactIds.isNotEmpty()
}
```

### 4.4 搜索状态模型（新增）

```kotlin
/**
 * 搜索状态
 */
data class SearchState(
    val query: String = "",                     // 搜索关键词
    val isSearching: Boolean = false,           // 是否正在搜索
    val filteredCategories: List<FactCategory> = emptyList() // 过滤后的分类
) {
    val hasQuery: Boolean get() = query.isNotBlank()
    val hasResults: Boolean get() = filteredCategories.isNotEmpty()
}
```

### 4.5 颜色调色板（新增）

```kotlin
/**
 * Pastel色系调色板
 * 用于动态分配给不同分类
 */
object CategoryColorPalette {
    
    private val lightColors = listOf(
        CategoryColor(
            titleColor = Color(0xFFE57373),     // 红色系
            tagBackgroundColor = Color(0xFFFFEBEE),
            tagTextColor = Color(0xFFC62828)
        ),
        CategoryColor(
            titleColor = Color(0xFF81C784),     // 绿色系
            tagBackgroundColor = Color(0xFFE8F5E9),
            tagTextColor = Color(0xFF2E7D32)
        ),
        CategoryColor(
            titleColor = Color(0xFF64B5F6),     // 蓝色系
            tagBackgroundColor = Color(0xFFE3F2FD),
            tagTextColor = Color(0xFF1565C0)
        ),
        CategoryColor(
            titleColor = Color(0xFFFFB74D),     // 橙色系
            tagBackgroundColor = Color(0xFFFFF3E0),
            tagTextColor = Color(0xFFE65100)
        ),
        CategoryColor(
            titleColor = Color(0xFFBA68C8),     // 紫色系
            tagBackgroundColor = Color(0xFFF3E5F5),
            tagTextColor = Color(0xFF7B1FA2)
        ),
        CategoryColor(
            titleColor = Color(0xFF4DB6AC),     // 青色系
            tagBackgroundColor = Color(0xFFE0F2F1),
            tagTextColor = Color(0xFF00695C)
        ),
        CategoryColor(
            titleColor = Color(0xFFF06292),     // 粉色系
            tagBackgroundColor = Color(0xFFFCE4EC),
            tagTextColor = Color(0xFFC2185B)
        ),
        CategoryColor(
            titleColor = Color(0xFF90A4AE),     // 灰蓝色系
            tagBackgroundColor = Color(0xFFECEFF1),
            tagTextColor = Color(0xFF455A64)
        )
    )
    
    private val darkColors = listOf(
        CategoryColor(
            titleColor = Color(0xFFEF9A9A),
            tagBackgroundColor = Color(0xFF4A2020),
            tagTextColor = Color(0xFFFFCDD2)
        ),
        CategoryColor(
            titleColor = Color(0xFFA5D6A7),
            tagBackgroundColor = Color(0xFF1B3D1B),
            tagTextColor = Color(0xFFC8E6C9)
        ),
        CategoryColor(
            titleColor = Color(0xFF90CAF9),
            tagBackgroundColor = Color(0xFF1A3A5C),
            tagTextColor = Color(0xFFBBDEFB)
        ),
        CategoryColor(
            titleColor = Color(0xFFFFCC80),
            tagBackgroundColor = Color(0xFF4A3520),
            tagTextColor = Color(0xFFFFE0B2)
        ),
        CategoryColor(
            titleColor = Color(0xFFCE93D8),
            tagBackgroundColor = Color(0xFF3D1A4A),
            tagTextColor = Color(0xFFE1BEE7)
        ),
        CategoryColor(
            titleColor = Color(0xFF80CBC4),
            tagBackgroundColor = Color(0xFF1A3D3A),
            tagTextColor = Color(0xFFB2DFDB)
        ),
        CategoryColor(
            titleColor = Color(0xFFF48FB1),
            tagBackgroundColor = Color(0xFF4A1A2E),
            tagTextColor = Color(0xFFF8BBD9)
        ),
        CategoryColor(
            titleColor = Color(0xFFB0BEC5),
            tagBackgroundColor = Color(0xFF2A3A4A),
            tagTextColor = Color(0xFFCFD8DC)
        )
    )
    
    /**
     * 根据分类名称获取颜色
     * 使用哈希算法确保同一分类始终获得相同颜色
     */
    fun getColorForCategory(categoryKey: String, isDarkMode: Boolean): CategoryColor {
        val colors = if (isDarkMode) darkColors else lightColors
        val index = abs(categoryKey.hashCode()) % colors.size
        return colors[index]
    }
}
```


---

## 5. 交互设计

### 5.1 界面布局设计

#### 5.1.1 整体布局

```
┌────────────────────────────────────────┐
│ ← 联系人详情                           │
├────────────────────────────────────────┤
│  [概览] [事实流] [标签画像] [资料库]   │
├────────────────────────────────────────┤
│                                        │
│  ┌────────────────────────────────┐   │
│  │ 🔍 搜索标签...                 │   │
│  └────────────────────────────────┘   │
│                                        │
│  ┌────────────────────────────────┐   │
│  │ 🔴 性格特点 (3)            ▼  │   │
│  │ ┌──────┐ ┌──────┐ ┌──────┐    │   │
│  │ │ 内向 │ │ 理性 │ │ 细心 │    │   │
│  │ └──────┘ └──────┘ └──────┘    │   │
│  └────────────────────────────────┘   │
│                                        │
│  ┌────────────────────────────────┐   │
│  │ 🟢 兴趣爱好 (4)            ▼  │   │
│  │ ┌──────┐ ┌──────┐ ┌──────┐    │   │
│  │ │ 阅读 │ │ 运动 │ │ 旅行 │    │   │
│  │ └──────┘ └──────┘ └──────┘    │   │
│  │ ┌──────┐                       │   │
│  │ │ 音乐 │                       │   │
│  │ └──────┘                       │   │
│  └────────────────────────────────┘   │
│                                        │
│  ┌────────────────────────────────┐   │
│  │ 🔵 工作信息 (2)            ▼  │   │
│  │ ┌────────┐ ┌──────────┐        │   │
│  │ │ 程序员 │ │ 互联网行业│        │   │
│  │ └────────┘ └──────────┘        │   │
│  └────────────────────────────────┘   │
│                                        │
└────────────────────────────────────────┘
```

#### 5.1.2 编辑模式布局

```
┌────────────────────────────────────────┐
│ 已选择 3 项                   [取消]   │
├────────────────────────────────────────┤
│                                        │
│  ┌────────────────────────────────┐   │
│  │ 🔴 性格特点 (3)        [全选] │   │
│  │ ┌────────┐ ┌────────┐ ┌──────┐│   │
│  │ │☑ 内向 │ │☐ 理性 │ │☑细心││   │
│  │ └────────┘ └────────┘ └──────┘│   │
│  └────────────────────────────────┘   │
│                                        │
│  ┌────────────────────────────────┐   │
│  │ 🟢 兴趣爱好 (4)        [全选] │   │
│  │ ┌────────┐ ┌────────┐ ┌──────┐│   │
│  │ │☐ 阅读 │ │☑ 运动 │ │☐旅行││   │
│  │ └────────┘ └────────┘ └──────┘│   │
│  └────────────────────────────────┘   │
│                                        │
├────────────────────────────────────────┤
│  ┌────────────────────────────────┐   │
│  │  🗑️ 删除      📁 移动分类     │   │
│  └────────────────────────────────┘   │
└────────────────────────────────────────┘
```

### 5.2 搜索栏设计

#### 5.2.1 搜索栏规范

| 属性 | 值 |
|------|-----|
| 位置 | 标签页内容顶部 |
| 高度 | 48dp |
| 圆角 | 24dp |
| 背景色 | SurfaceVariant |
| 图标 | Search图标（左侧） |
| 清除按钮 | 有输入时显示（右侧） |
| 占位文字 | "搜索标签..." |

#### 5.2.2 搜索交互

| 交互 | 行为 |
|------|------|
| 输入文字 | 防抖300ms后触发过滤 |
| 点击清除 | 清空输入，显示全部标签 |
| 点击搜索栏外 | 收起键盘，保持搜索结果 |
| 无匹配结果 | 显示"未找到匹配的标签" |

### 5.3 分类卡片设计

#### 5.3.1 分类卡片规范

| 属性 | 值 |
|------|-----|
| 外边距 | 水平16dp，垂直8dp |
| 内边距 | 12dp |
| 圆角 | 12dp |
| 背景色 | Surface |
| 阴影 | elevation 2dp |

#### 5.3.2 分类标题栏

| 元素 | 规范 |
|------|------|
| 颜色指示器 | 8dp圆形，使用分类颜色 |
| 分类名称 | titleMedium，使用分类标题颜色 |
| 标签数量 | bodySmall，OnSurfaceVariant |
| 折叠图标 | ExpandMore/ExpandLess，24dp |
| 全选按钮 | 仅编辑模式显示 |

#### 5.3.3 折叠/展开交互

| 交互 | 行为 |
|------|------|
| 点击标题栏 | 切换折叠/展开状态 |
| 展开动画 | 300ms，EaseInOut |
| 折叠状态 | 仅显示标题栏，隐藏标签 |

### 5.4 标签样式设计

#### 5.4.1 普通状态标签

| 属性 | 值 |
|------|-----|
| 高度 | 32dp |
| 内边距 | 水平12dp，垂直6dp |
| 圆角 | 16dp |
| 背景色 | 分类对应的tagBackgroundColor |
| 文字颜色 | 分类对应的tagTextColor |
| 字体 | bodyMedium |

#### 5.4.2 选中状态标签（编辑模式）

| 属性 | 值 |
|------|-----|
| 边框 | 2dp，Primary色 |
| 背景色 | PrimaryContainer |
| 选中图标 | Check图标，左上角角标 |
| 动画 | 150ms缩放动画 |

#### 5.4.3 搜索高亮标签

| 属性 | 值 |
|------|-----|
| 匹配文字 | 加粗 + Primary色 |
| 其他文字 | 正常样式 |

### 5.5 编辑模式设计

#### 5.5.1 进入编辑模式

| 触发方式 | 长按任意标签（500ms） |
|----------|----------------------|
| 震动反馈 | 轻微震动（50ms） |
| 视觉变化 | 所有标签显示选择框 |
| 顶部变化 | 搜索栏变为选择状态栏 |
| 底部变化 | 显示批量操作栏 |

#### 5.5.2 选择状态栏

```
┌────────────────────────────────────────┐
│ 已选择 3 项                   [取消]   │
└────────────────────────────────────────┘
```

| 元素 | 规范 |
|------|------|
| 选择计数 | titleMedium，实时更新 |
| 取消按钮 | TextButton，退出编辑模式 |

#### 5.5.3 批量操作栏

```
┌────────────────────────────────────────┐
│  🗑️ 删除 (3)      📁 移动分类 (3)    │
└────────────────────────────────────────┘
```

| 元素 | 规范 |
|------|------|
| 位置 | 底部固定 |
| 高度 | 56dp |
| 背景色 | Surface |
| 阴影 | elevation 8dp |
| 删除按钮 | Error色，显示选中数量 |
| 移动按钮 | Primary色，显示选中数量 |
| 禁用状态 | 无选中时按钮禁用 |

### 5.6 对话框设计

#### 5.6.1 删除确认对话框

```
┌────────────────────────────────────────┐
│ ⚠️ 确认删除                            │
│                                        │
│ 确定要删除选中的 3 个标签吗？          │
│ 此操作无法撤销。                        │
│                                        │
│           [取消]  [删除]               │
└────────────────────────────────────────┘
```

| 属性 | 值 |
|------|-----|
| 删除按钮颜色 | Error色 |
| 取消按钮样式 | TextButton |

#### 5.6.2 移动分类对话框

```
┌────────────────────────────────────────┐
│ 移动到分类                             │
│                                        │
│ 选择目标分类:                          │
│ ○ 性格特点                             │
│ ○ 兴趣爱好                             │
│ ○ 工作信息                             │
│ ○ 家庭情况                             │
│ ─────────────────────────────────────  │
│ ○ 新建分类...                          │
│                                        │
│           [取消]  [确定]               │
└────────────────────────────────────────┘
```

| 属性 | 值 |
|------|-----|
| 分类列表 | 显示所有现有分类 |
| 新建分类 | 点击后显示输入框 |
| 确定按钮 | 选择分类后启用 |

#### 5.6.3 标签编辑对话框

```
┌────────────────────────────────────────┐
│ 编辑标签                               │
│                                        │
│ 分类                                   │
│ [性格特点              ▼]             │
│                                        │
│ 标签内容                               │
│ [内向_____________________]           │
│                                        │
│ 来源: AI推断 | 2025-12-15             │
│                                        │
│  🗑️删除     [取消]  [保存]            │
└────────────────────────────────────────┘
```


---

## 6. 业务规则设计

### 6.1 分组规则

| 规则ID | 规则描述 | 处理方式 |
|--------|----------|----------|
| GR-001 | 按Fact的Key字段分组 | 相同Key的Fact归为一组 |
| GR-002 | 分组按字母顺序排序 | 中文按拼音首字母排序 |
| GR-003 | 空分类不显示 | 无Fact的分类自动隐藏 |
| GR-004 | 分类内标签按时间排序 | 最新添加的排在前面 |
| GR-005 | 颜色分配基于Key哈希 | 同一Key始终获得相同颜色 |

### 6.2 搜索规则

| 规则ID | 规则描述 | 处理方式 |
|--------|----------|----------|
| SR-001 | 搜索匹配标签内容（Value） | 不区分大小写 |
| SR-002 | 搜索匹配分类名称（Key） | 不区分大小写 |
| SR-003 | 搜索防抖300ms | 避免频繁过滤 |
| SR-004 | 空搜索显示全部 | 清空搜索框恢复全部显示 |
| SR-005 | 匹配结果高亮显示 | 匹配文字加粗+Primary色 |

### 6.3 编辑模式规则

| 规则ID | 规则描述 | 处理方式 |
|--------|----------|----------|
| EM-001 | 长按500ms进入编辑模式 | 触发震动反馈 |
| EM-002 | 点击取消退出编辑模式 | 清空所有选择 |
| EM-003 | 点击标签切换选中状态 | 更新选中计数 |
| EM-004 | 点击分类全选按钮 | 选中/取消该分类所有标签 |
| EM-005 | 无选中时禁用操作按钮 | 删除和移动按钮置灰 |

### 6.4 批量操作规则

| 规则ID | 规则描述 | 处理方式 |
|--------|----------|----------|
| BO-001 | 批量删除需二次确认 | 显示确认对话框 |
| BO-002 | 删除后自动退出编辑模式 | 刷新UI显示 |
| BO-003 | 移动分类修改Fact的Key | 保持其他字段不变 |
| BO-004 | 移动到新分类需输入名称 | 验证名称有效性 |
| BO-005 | 操作完成显示Toast提示 | "已删除N个标签"/"已移动N个标签" |

### 6.5 输入验证规则

| 规则ID | 规则描述 | 处理方式 |
|--------|----------|----------|
| VR-001 | 新分类名称不能为空 | 显示错误提示 |
| VR-002 | 新分类名称2-20字符 | 显示字数限制提示 |
| VR-003 | 分类名称不能重复 | 提示"该分类已存在" |
| VR-004 | 标签内容不能为空 | 禁用保存按钮 |
| VR-005 | 标签内容1-100字符 | 显示字数限制提示 |

---

## 7. 组件设计

### 7.1 UI组件清单

| 组件名称 | 类型 | 职责 |
|----------|------|------|
| PersonaTabV2 | Composable | 升级后的标签画像主界面 |
| CategorySearchBar | Composable | 标签搜索栏 |
| DynamicCategoryCard | Composable | 动态分类卡片 |
| SelectableTagChip | Composable | 可选择的标签芯片 |
| EditModeTopBar | Composable | 编辑模式顶部栏 |
| BatchActionBar | Composable | 批量操作栏 |
| MoveCategoryDialog | Composable | 移动分类对话框 |
| BatchDeleteConfirmDialog | Composable | 批量删除确认对话框 |
| TagEditDialog | Composable | 标签编辑对话框（复用现有） |

### 7.2 业务组件清单

| 组件名称 | 层级 | 职责 |
|----------|------|------|
| GroupFactsByCategoryUseCase | Domain | 按分类分组Facts |
| BatchDeleteFactsUseCase | Domain | 批量删除Facts |
| BatchMoveFactsUseCase | Domain | 批量移动Facts到新分类 |
| CategoryColorAssigner | Domain | 分类颜色分配器 |
| FactSearchFilter | Domain | 标签搜索过滤器 |

### 7.3 组件交互图

```
┌─────────────────────────────────────────────────────────────┐
│                     Presentation Layer                       │
│  ┌─────────────────┐    ┌─────────────────┐                 │
│  │ PersonaTabV2    │───→│ ContactDetail   │                 │
│  │ (主界面)        │    │ TabViewModel    │                 │
│  └─────────────────┘    └─────────────────┘                 │
│         │                       │                           │
│         ▼                       ▼                           │
│  ┌─────────────────┐    ┌─────────────────┐                 │
│  │ DynamicCategory │    │ PersonaUiState  │                 │
│  │ Card            │    │ 状态管理        │                 │
│  │ SelectableTag   │    │                 │                 │
│  │ Chip            │    │                 │                 │
│  └─────────────────┘    └─────────────────┘                 │
└────────────────────────────┼────────────────────────────────┘
                              │
┌────────────────────────────┼────────────────────────────────┐
│                     Domain Layer                             │
│                            ▼                                │
│  ┌─────────────────┐    ┌─────────────────┐                 │
│  │ GroupFactsBy    │    │ BatchDelete     │                 │
│  │ CategoryUseCase │    │ FactsUseCase    │                 │
│  └─────────────────┘    └─────────────────┘                 │
│         │                       │                           │
│         ▼                       ▼                           │
│  ┌─────────────────┐    ┌─────────────────┐                 │
│  │ BatchMoveFacts  │    │ FactSearch      │                 │
│  │ UseCase         │    │ Filter          │                 │
│  └─────────────────┘    └─────────────────┘                 │
│         │                       │                           │
│         └───────────┬───────────┘                           │
│                     ▼                                       │
│         ┌─────────────────────┐                             │
│         │ ContactRepository   │                             │
│         │ (复用现有)          │                             │
│         └─────────────────────┘                             │
└────────────────────────────┼────────────────────────────────┘
                              │
┌────────────────────────────┼────────────────────────────────┐
│                     Data Layer                               │
│                            ▼                                │
│         ┌─────────────────────┐                             │
│         │ ContactRepository   │                             │
│         │ Impl (复用现有)     │                             │
│         └─────────────────────┘                             │
│                     │                                       │
│                     ▼                                       │
│         ┌─────────────────────┐                             │
│         │ ContactDao          │                             │
│         │ (复用现有)          │                             │
│         └─────────────────────┘                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.4 PersonaTabV2组件设计

```kotlin
/**
 * 升级后的标签画像Tab
 * 支持动态分类、搜索、编辑模式和批量操作
 */
@Composable
fun PersonaTabV2(
    facts: List<Fact>,
    onFactClick: (Fact) -> Unit,
    onFactsDelete: (List<String>) -> Unit,
    onFactsMove: (List<String>, String) -> Unit,
    modifier: Modifier = Modifier
) {
    // 状态管理
    var searchQuery by remember { mutableStateOf("") }
    var editModeState by remember { mutableStateOf(EditModeState()) }
    var expandedCategories by remember { mutableStateOf(setOf<String>()) }
    
    // 分组和过滤
    val categories = remember(facts) {
        groupFactsByCategory(facts)
    }
    val filteredCategories = remember(categories, searchQuery) {
        filterCategories(categories, searchQuery)
    }
    
    Column(modifier = modifier.fillMaxSize()) {
        // 顶部：搜索栏或编辑模式状态栏
        if (editModeState.isActive) {
            EditModeTopBar(
                selectedCount = editModeState.selectedCount,
                onCancel = { editModeState = EditModeState() }
            )
        } else {
            CategorySearchBar(
                query = searchQuery,
                onQueryChange = { searchQuery = it }
            )
        }
        
        // 中间：分类列表
        if (filteredCategories.isEmpty()) {
            EmptyPersonaView()
        } else {
            LazyColumn(
                modifier = Modifier.weight(1f),
                contentPadding = PaddingValues(16.dp),
                verticalArrangement = Arrangement.spacedBy(12.dp)
            ) {
                items(
                    items = filteredCategories,
                    key = { it.key }
                ) { category ->
                    DynamicCategoryCard(
                        category = category,
                        isExpanded = category.key in expandedCategories,
                        isEditMode = editModeState.isActive,
                        selectedFactIds = editModeState.selectedFactIds,
                        searchQuery = searchQuery,
                        onExpandToggle = { 
                            expandedCategories = if (category.key in expandedCategories) {
                                expandedCategories - category.key
                            } else {
                                expandedCategories + category.key
                            }
                        },
                        onFactClick = { fact ->
                            if (editModeState.isActive) {
                                editModeState = editModeState.copy(
                                    selectedFactIds = if (fact.id in editModeState.selectedFactIds) {
                                        editModeState.selectedFactIds - fact.id
                                    } else {
                                        editModeState.selectedFactIds + fact.id
                                    }
                                )
                            } else {
                                onFactClick(fact)
                            }
                        },
                        onFactLongClick = { fact ->
                            if (!editModeState.isActive) {
                                editModeState = EditModeState(
                                    isActive = true,
                                    selectedFactIds = setOf(fact.id)
                                )
                            }
                        },
                        onSelectAll = { categoryKey ->
                            val categoryFactIds = categories
                                .find { it.key == categoryKey }
                                ?.facts?.map { it.id }?.toSet() ?: emptySet()
                            editModeState = editModeState.copy(
                                selectedFactIds = editModeState.selectedFactIds + categoryFactIds
                            )
                        },
                        modifier = Modifier.animateItemPlacement()
                    )
                }
            }
        }
        
        // 底部：批量操作栏（仅编辑模式显示）
        AnimatedVisibility(
            visible = editModeState.isActive,
            enter = slideInVertically(initialOffsetY = { it }),
            exit = slideOutVertically(targetOffsetY = { it })
        ) {
            BatchActionBar(
                selectedCount = editModeState.selectedCount,
                onDelete = { editModeState = editModeState.copy(showDeleteConfirm = true) },
                onMove = { editModeState = editModeState.copy(showMoveDialog = true) }
            )
        }
    }
    
    // 删除确认对话框
    if (editModeState.showDeleteConfirm) {
        BatchDeleteConfirmDialog(
            count = editModeState.selectedCount,
            onConfirm = {
                onFactsDelete(editModeState.selectedFactIds.toList())
                editModeState = EditModeState()
            },
            onDismiss = { 
                editModeState = editModeState.copy(showDeleteConfirm = false) 
            }
        )
    }
    
    // 移动分类对话框
    if (editModeState.showMoveDialog) {
        MoveCategoryDialog(
            existingCategories = categories.map { it.key },
            onConfirm = { targetCategory ->
                onFactsMove(editModeState.selectedFactIds.toList(), targetCategory)
                editModeState = EditModeState()
            },
            onDismiss = { 
                editModeState = editModeState.copy(showMoveDialog = false) 
            }
        )
    }
}
```

### 7.5 DynamicCategoryCard组件设计

```kotlin
/**
 * 动态分类卡片
 * 支持折叠/展开、编辑模式、全选功能
 */
@Composable
fun DynamicCategoryCard(
    category: FactCategory,
    isExpanded: Boolean,
    isEditMode: Boolean,
    selectedFactIds: Set<String>,
    searchQuery: String,
    onExpandToggle: () -> Unit,
    onFactClick: (Fact) -> Unit,
    onFactLongClick: (Fact) -> Unit,
    onSelectAll: (String) -> Unit,
    modifier: Modifier = Modifier
) {
    val isDarkMode = isSystemInDarkTheme()
    val categoryColor = remember(category.key, isDarkMode) {
        CategoryColorPalette.getColorForCategory(category.key, isDarkMode)
    }
    
    Card(
        modifier = modifier.fillMaxWidth(),
        colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surface),
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Column(modifier = Modifier.padding(12.dp)) {
            // 分类标题栏
            Row(
                modifier = Modifier
                    .fillMaxWidth()
                    .clickable { onExpandToggle() },
                verticalAlignment = Alignment.CenterVertically
            ) {
                // 颜色指示器
                Box(
                    modifier = Modifier
                        .size(8.dp)
                        .background(categoryColor.titleColor, CircleShape)
                )
                
                Spacer(modifier = Modifier.width(8.dp))
                
                // 分类名称
                Text(
                    text = category.key,
                    style = MaterialTheme.typography.titleMedium,
                    color = categoryColor.titleColor,
                    modifier = Modifier.weight(1f)
                )
                
                // 标签数量
                Text(
                    text = "(${category.factCount})",
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )
                
                // 编辑模式下显示全选按钮
                if (isEditMode) {
                    TextButton(onClick = { onSelectAll(category.key) }) {
                        Text("全选")
                    }
                }
                
                // 折叠/展开图标
                Icon(
                    imageVector = if (isExpanded) Icons.Default.ExpandLess 
                                  else Icons.Default.ExpandMore,
                    contentDescription = if (isExpanded) "收起" else "展开",
                    tint = MaterialTheme.colorScheme.onSurfaceVariant
                )
            }
            
            // 标签列表（可折叠）
            AnimatedVisibility(
                visible = isExpanded,
                enter = expandVertically(),
                exit = shrinkVertically()
            ) {
                FlowRow(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(top = 8.dp),
                    horizontalArrangement = Arrangement.spacedBy(8.dp),
                    verticalArrangement = Arrangement.spacedBy(8.dp)
                ) {
                    category.facts.forEach { fact ->
                        SelectableTagChip(
                            fact = fact,
                            categoryColor = categoryColor,
                            isSelected = fact.id in selectedFactIds,
                            isEditMode = isEditMode,
                            searchQuery = searchQuery,
                            onClick = { onFactClick(fact) },
                            onLongClick = { onFactLongClick(fact) }
                        )
                    }
                }
            }
        }
    }
}
```

### 7.6 SelectableTagChip组件设计

```kotlin
/**
 * 可选择的标签芯片
 * 支持普通状态、选中状态、搜索高亮
 */
@OptIn(ExperimentalFoundationApi::class)
@Composable
fun SelectableTagChip(
    fact: Fact,
    categoryColor: CategoryColor,
    isSelected: Boolean,
    isEditMode: Boolean,
    searchQuery: String,
    onClick: () -> Unit,
    onLongClick: () -> Unit,
    modifier: Modifier = Modifier
) {
    val hapticFeedback = LocalHapticFeedback.current
    
    val backgroundColor = if (isSelected) {
        MaterialTheme.colorScheme.primaryContainer
    } else {
        categoryColor.tagBackgroundColor
    }
    
    val textColor = if (isSelected) {
        MaterialTheme.colorScheme.onPrimaryContainer
    } else {
        categoryColor.tagTextColor
    }
    
    val borderColor = if (isSelected) {
        MaterialTheme.colorScheme.primary
    } else {
        Color.Transparent
    }
    
    Surface(
        modifier = modifier
            .combinedClickable(
                onClick = onClick,
                onLongClick = {
                    hapticFeedback.performHapticFeedback(HapticFeedbackType.LongPress)
                    onLongClick()
                }
            )
            .animateContentSize(),
        shape = RoundedCornerShape(16.dp),
        color = backgroundColor,
        border = if (isSelected) BorderStroke(2.dp, borderColor) else null
    ) {
        Row(
            modifier = Modifier.padding(horizontal = 12.dp, vertical = 6.dp),
            verticalAlignment = Alignment.CenterVertically
        ) {
            // 选中图标（编辑模式）
            if (isEditMode) {
                Icon(
                    imageVector = if (isSelected) Icons.Default.CheckCircle 
                                  else Icons.Default.RadioButtonUnchecked,
                    contentDescription = null,
                    modifier = Modifier.size(16.dp),
                    tint = if (isSelected) MaterialTheme.colorScheme.primary 
                           else MaterialTheme.colorScheme.onSurfaceVariant
                )
                Spacer(modifier = Modifier.width(4.dp))
            }
            
            // 标签文字（支持搜索高亮）
            if (searchQuery.isNotBlank() && fact.value.contains(searchQuery, ignoreCase = true)) {
                HighlightedText(
                    text = fact.value,
                    highlight = searchQuery,
                    textColor = textColor,
                    highlightColor = MaterialTheme.colorScheme.primary
                )
            } else {
                Text(
                    text = fact.value,
                    style = MaterialTheme.typography.bodyMedium,
                    color = textColor
                )
            }
        }
    }
}

/**
 * 高亮文字组件
 */
@Composable
fun HighlightedText(
    text: String,
    highlight: String,
    textColor: Color,
    highlightColor: Color
) {
    val annotatedString = buildAnnotatedString {
        var startIndex = 0
        val lowerText = text.lowercase()
        val lowerHighlight = highlight.lowercase()
        
        while (true) {
            val index = lowerText.indexOf(lowerHighlight, startIndex)
            if (index < 0) {
                append(text.substring(startIndex))
                break
            }
            
            append(text.substring(startIndex, index))
            withStyle(SpanStyle(color = highlightColor, fontWeight = FontWeight.Bold)) {
                append(text.substring(index, index + highlight.length))
            }
            startIndex = index + highlight.length
        }
    }
    
    Text(
        text = annotatedString,
        style = MaterialTheme.typography.bodyMedium,
        color = textColor
    )
}
```


---

## 8. 异常处理设计

### 8.1 错误分类与处理

| 错误类型 | 错误码 | 用户提示 | 处理策略 |
|----------|--------|----------|----------|
| 数据加载失败 | E001 | 加载标签失败，请重试 | 显示重试按钮 |
| 删除失败 | E002 | 删除失败，请重试 | 保持编辑模式，提供重试 |
| 移动失败 | E003 | 移动失败，请重试 | 保持编辑模式，提供重试 |
| 分类名称无效 | E004 | 分类名称不能为空 | 禁用确定按钮 |
| 分类名称重复 | E005 | 该分类已存在 | 显示错误提示 |
| 网络错误 | E006 | 网络异常，请检查连接 | 显示错误Toast |

### 8.2 错误处理流程

```kotlin
/**
 * 批量删除Facts用例
 */
class BatchDeleteFactsUseCase @Inject constructor(
    private val contactRepository: ContactRepository
) {
    suspend operator fun invoke(
        contactId: String,
        factIds: List<String>
    ): Result<Int> = runCatching {
        if (factIds.isEmpty()) {
            return@runCatching 0
        }
        
        val contact = contactRepository.getContactById(contactId)
            ?: throw IllegalArgumentException("联系人不存在")
        
        val updatedFacts = contact.facts.filterNot { it.id in factIds }
        val deletedCount = contact.facts.size - updatedFacts.size
        
        contactRepository.updateContact(contact.copy(facts = updatedFacts))
        
        deletedCount
    }
}

/**
 * 批量移动Facts用例
 */
class BatchMoveFactsUseCase @Inject constructor(
    private val contactRepository: ContactRepository
) {
    suspend operator fun invoke(
        contactId: String,
        factIds: List<String>,
        targetCategory: String
    ): Result<Int> = runCatching {
        if (factIds.isEmpty()) {
            return@runCatching 0
        }
        
        require(targetCategory.isNotBlank()) { "目标分类不能为空" }
        require(targetCategory.length in 2..20) { "分类名称长度应为2-20字符" }
        
        val contact = contactRepository.getContactById(contactId)
            ?: throw IllegalArgumentException("联系人不存在")
        
        val updatedFacts = contact.facts.map { fact ->
            if (fact.id in factIds) {
                fact.copy(
                    key = targetCategory,
                    isUserModified = true,
                    lastModifiedTime = System.currentTimeMillis()
                )
            } else {
                fact
            }
        }
        
        contactRepository.updateContact(contact.copy(facts = updatedFacts))
        
        factIds.size
    }
}
```

### 8.3 用户反馈设计

| 场景 | 反馈方式 | 持续时间 |
|------|----------|----------|
| 删除成功 | Toast "已删除N个标签" | 2秒 |
| 移动成功 | Toast "已移动N个标签到[分类名]" | 2秒 |
| 操作失败 | Snackbar + 重试按钮 | 5秒 |
| 输入验证失败 | 输入框下方错误提示 | 持续显示 |

---

## 9. 性能设计

### 9.1 性能指标

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| 分组计算 | < 50ms | 100个标签分组时间 |
| 搜索过滤 | < 100ms | 100个标签过滤时间 |
| 列表滚动 | 60fps | 滚动帧率 |
| 动画流畅度 | 60fps | 折叠/展开动画帧率 |
| 内存占用 | < 5MB | 100个标签内存增量 |

### 9.2 优化策略

#### 9.2.1 分组计算优化

```kotlin
/**
 * 按分类分组Facts
 * 使用groupBy优化分组性能
 */
fun groupFactsByCategory(facts: List<Fact>): List<FactCategory> {
    if (facts.isEmpty()) return emptyList()
    
    val isDarkMode = /* 从Composition获取 */
    
    return facts
        .groupBy { it.key }
        .map { (key, factList) ->
            FactCategory(
                key = key,
                facts = factList.sortedByDescending { it.timestamp },
                color = CategoryColorPalette.getColorForCategory(key, isDarkMode)
            )
        }
        .sortedBy { it.key }
}
```

#### 9.2.2 搜索防抖优化

```kotlin
/**
 * 搜索防抖处理
 */
@Composable
fun rememberDebouncedSearch(
    delayMs: Long = 300L
): Pair<String, (String) -> Unit> {
    var query by remember { mutableStateOf("") }
    var debouncedQuery by remember { mutableStateOf("") }
    
    LaunchedEffect(query) {
        delay(delayMs)
        debouncedQuery = query
    }
    
    return debouncedQuery to { newQuery -> query = newQuery }
}
```

#### 9.2.3 列表项复用

```kotlin
/**
 * 使用key优化列表项复用
 */
LazyColumn {
    items(
        items = filteredCategories,
        key = { it.key }  // 使用稳定的key
    ) { category ->
        DynamicCategoryCard(
            category = category,
            modifier = Modifier.animateItemPlacement()
        )
    }
}
```

#### 9.2.4 颜色缓存

```kotlin
/**
 * 缓存分类颜色，避免重复计算
 */
@Composable
fun rememberCategoryColor(categoryKey: String): CategoryColor {
    val isDarkMode = isSystemInDarkTheme()
    return remember(categoryKey, isDarkMode) {
        CategoryColorPalette.getColorForCategory(categoryKey, isDarkMode)
    }
}
```

---

## 10. 验收标准

### 10.1 功能验收

#### P0 - 核心功能（必须通过）

- [ ] 标签按Key正确分组显示
- [ ] 每个分类有独特的颜色标识
- [ ] 空分类不显示
- [ ] 搜索能正确过滤标签
- [ ] 长按标签能进入编辑模式
- [ ] 批量删除功能正常工作
- [ ] 删除前有二次确认
- [ ] 数据正确保存到数据库

#### P1 - 增强功能（应该通过）

- [ ] 分类可折叠/展开
- [ ] 搜索结果高亮显示
- [ ] 批量移动分类功能正常
- [ ] 点击分类标题可全选
- [ ] 编辑模式有震动反馈
- [ ] 操作完成有Toast提示

#### P2 - 优化功能（可以通过）

- [ ] 列表滚动流畅（60fps）
- [ ] 折叠/展开动画流畅
- [ ] 深色模式颜色适配正确
- [ ] 100+标签性能正常

### 10.2 性能验收

- [ ] 分组计算时间 < 50ms（100标签）
- [ ] 搜索过滤时间 < 100ms（100标签）
- [ ] 列表滚动帧率 ≥ 60fps
- [ ] 内存增量 < 5MB（100标签）

### 10.3 兼容性验收

- [ ] 与现有PersonaTab数据兼容
- [ ] 与现有Fact模型兼容
- [ ] 不同屏幕尺寸适配正常
- [ ] 深色/浅色模式切换正常

---

## 11. 开发优先级

### 11.1 阶段划分

#### 阶段一：基础架构（1-2天）

| 任务 | 优先级 | 预估工时 |
|------|--------|----------|
| FactCategory模型定义 | P0 | 1h |
| EditModeState模型定义 | P0 | 1h |
| SearchState模型定义 | P0 | 1h |
| CategoryColorPalette实现 | P0 | 2h |
| GroupFactsByCategoryUseCase | P0 | 2h |
| FactSearchFilter实现 | P0 | 2h |
| 模型单元测试 | P0 | 2h |

#### 阶段二：UI组件实现（2-3天）

| 任务 | 优先级 | 预估工时 |
|------|--------|----------|
| CategorySearchBar组件 | P0 | 2h |
| DynamicCategoryCard组件 | P0 | 3h |
| SelectableTagChip组件 | P0 | 2h |
| HighlightedText组件 | P1 | 1h |
| EditModeTopBar组件 | P0 | 1h |
| BatchActionBar组件 | P0 | 2h |
| PersonaTabV2主界面 | P0 | 3h |

#### 阶段三：批量操作实现（1-2天）

| 任务 | 优先级 | 预估工时 |
|------|--------|----------|
| BatchDeleteFactsUseCase | P0 | 2h |
| BatchMoveFactsUseCase | P0 | 2h |
| BatchDeleteConfirmDialog | P0 | 1h |
| MoveCategoryDialog | P0 | 2h |
| ViewModel事件处理 | P0 | 2h |

#### 阶段四：集成与优化（1-2天）

| 任务 | 优先级 | 预估工时 |
|------|--------|----------|
| 替换现有PersonaTab | P0 | 2h |
| 深色模式适配 | P1 | 2h |
| 动画优化 | P1 | 2h |
| 性能测试与优化 | P1 | 2h |
| 集成测试 | P0 | 2h |

### 11.2 依赖关系

```
阶段一
  │
  ├── 数据模型定义 ──────────┐
  │                          │
  ├── 颜色调色板实现 ────────┼──→ 阶段二
  │                          │      │
  └── UseCase实现 ───────────┘      │
                                    │
                              ┌─────┘
                              │
阶段二                        ▼
  │
  ├── 搜索栏组件 ────────────┐
  │                          │
  ├── 分类卡片组件 ──────────┼──→ 阶段三
  │                          │
  ├── 标签芯片组件 ──────────┤
  │                          │
  └── 主界面组件 ────────────┘
                              │
                              │
阶段三                        ▼
  │
  ├── 批量删除UseCase ───────┐
  │                          │
  ├── 批量移动UseCase ───────┼──→ 阶段四
  │                          │
  └── 对话框组件 ────────────┘
```

---

## 12. 风险评估

### 12.1 技术风险

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 颜色在深色模式下可读性差 | 中 | 中 | 设计专门的深色模式调色板 |
| 大量标签性能下降 | 低 | 中 | 使用LazyColumn + key优化 |
| 动画卡顿 | 低 | 低 | 使用animateItemPlacement |
| 与现有功能冲突 | 低 | 中 | 充分测试，渐进式替换 |

### 12.2 产品风险

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 用户误操作批量删除 | 中 | 高 | 二次确认对话框 |
| 编辑模式入口不明显 | 中 | 中 | 添加引导提示 |
| 分类颜色不协调 | 低 | 低 | 使用设计好的Pastel色系 |

---

## 13. 附录

### 13.1 与现有组件的关系

| 现有组件 | 处理方式 | 说明 |
|----------|----------|------|
| PersonaTab | 替换 | 使用PersonaTabV2替换 |
| CategorySection | 替换 | 使用DynamicCategoryCard替换 |
| GuessedTag | 复用 | 在SelectableTagChip中复用样式 |
| ConfirmedTag | 复用 | 在SelectableTagChip中复用样式 |
| TagConfirmationDialog | 保留 | 单个标签确认/驳回功能保留 |
| EditFactDialog | 复用 | 单个标签编辑功能复用 |

### 13.2 相关文档

- [PRD-00014-联系人画像界面升级需求](../PRD/PRD-00014-联系人画像界面升级需求.md)
- [TDD-00004-联系人画像记忆系统UI架构设计](../TDD/TDD-00004-联系人画像记忆系统UI架构设计.md)
- [FD-00004-联系人画像记忆系统UI功能设计](./FD-00004-联系人画像记忆系统UI功能设计.md)
