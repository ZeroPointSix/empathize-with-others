# FD-00025: AIé…ç½®åŠŸèƒ½å®Œå–„åŠŸèƒ½è®¾è®¡

> **æ–‡æ¡£ç±»å‹**: åŠŸèƒ½è®¾è®¡æ–‡æ¡£ (FD)
> **ç‰ˆæœ¬**: 1.1
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-01
> **æ›´æ–°æ—¥æœŸ**: 2026-01-01
> **è´Ÿè´£äºº**: Kiro
> **å…³è”PRD**: PRD-00025
> **å…³è”å®¡æŸ¥**: DR-00025
> **çŠ¶æ€**: âœ… å®¡æŸ¥é€šè¿‡

---

## 0. æ–‡æ¡£èƒŒæ™¯

### 0.1 èƒŒæ™¯è¯´æ˜

å½“å‰AIé…ç½®åŠŸèƒ½åœ¨å‰ç«¯å·²ç»å®ç°äº†åŸºç¡€ç•Œé¢ï¼ˆAiConfigScreenï¼‰ï¼Œä½†åç«¯åŠŸèƒ½å°šæœªå®Œå…¨å®ç°ã€‚ç”¨æˆ·æ— æ³•çœŸæ­£ä½¿ç”¨é«˜çº§é€‰é¡¹ï¼ˆTemperatureã€æœ€å¤§Tokenæ•°ï¼‰ã€æµ‹è¯•è¿æ¥ç­‰åŠŸèƒ½ï¼Œæ¨¡å‹åˆ—è¡¨æ’åºæ–¹å¼ä¸å¤Ÿç›´è§‚ï¼ˆä½¿ç”¨ä¸Šä¸‹ç®­å¤´è€Œéæ‹–æ‹½ï¼‰ï¼Œé€šç”¨é€‰é¡¹ä¸­çš„ç½‘ç»œä»£ç†å’Œç”¨é‡ç»Ÿè®¡åŠŸèƒ½ä¹Ÿç¼ºå°‘å®é™…çš„åç«¯æ”¯æŒã€‚

æœ¬æ–‡æ¡£åŸºäºPRD-00025éœ€æ±‚ï¼Œè®¾è®¡å®Œæ•´çš„åŠŸèƒ½å®ç°æ–¹æ¡ˆï¼Œç¡®ä¿å‰ç«¯ç•Œé¢ä¸åç«¯åŠŸèƒ½çš„å®Œæ•´å¯¹æ¥ï¼Œæä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒå’Œå¯é çš„AIæœåŠ¡å•†ç®¡ç†åŠŸèƒ½ã€‚

### 0.2 æ–‡æ¡£ç›®çš„

- ä¸ºå¼€å‘å›¢é˜Ÿæä¾›è¯¦ç»†çš„æŠ€æœ¯å®ç°æ–¹æ¡ˆ
- æ˜ç¡®å„æ¨¡å—çš„æ”¹åŠ¨èŒƒå›´å’Œæ–°å¢å†…å®¹
- å®šä¹‰æ¸…æ™°çš„éªŒæ”¶æ ‡å‡†å’Œæµ‹è¯•ç­–ç•¥
- è¯†åˆ«æ½œåœ¨é£é™©å¹¶æä¾›ç¼“è§£æªæ–½

### 0.3 è¯»è€…å¯¹è±¡

- åç«¯å¼€å‘å·¥ç¨‹å¸ˆ
- å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ
- æµ‹è¯•å·¥ç¨‹å¸ˆ
- é¡¹ç›®ç»ç†

---

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 åŠŸèƒ½ç›®æ ‡

å®Œå–„AIé…ç½®åŠŸèƒ½ï¼Œå®ç°å‰ç«¯ç•Œé¢ä¸åç«¯åŠŸèƒ½çš„å®Œæ•´å¯¹æ¥ï¼ŒåŒ…æ‹¬ï¼š
- é«˜çº§é€‰é¡¹è®¾ç½®ï¼ˆTemperatureã€æœ€å¤§Tokenæ•°ã€è¯·æ±‚è¶…æ—¶ï¼‰
- æµ‹è¯•è¿æ¥åŠŸèƒ½å¢å¼º
- æ¨¡å‹åˆ—è¡¨æ‹–æ‹½æ’åº
- ç½‘ç»œä»£ç†è®¾ç½®
- ç”¨é‡ç»Ÿè®¡åŠŸèƒ½

### 1.2 å½“å‰å®ç°çŠ¶æ€

| åŠŸèƒ½æ¨¡å— | å‰ç«¯çŠ¶æ€ | åç«¯çŠ¶æ€ | è¯´æ˜ |
|----------|----------|----------|------|
| é«˜çº§é€‰é¡¹è®¾ç½® | âœ… UIå·²æœ‰ | âš ï¸ éƒ¨åˆ†å®ç° | AiProviderå·²æœ‰timeoutMså­—æ®µï¼Œç¼ºå°‘temperatureå’ŒmaxTokens |
| æµ‹è¯•è¿æ¥ | âœ… UIå·²æœ‰ | âœ… å·²å®ç° | TestConnectionUseCaseå·²å®Œæ•´å®ç° |
| æ¨¡å‹æ‹–æ‹½æ’åº | âš ï¸ äº‹ä»¶å·²å®šä¹‰ | âš ï¸ å¾…å®ç° | ReorderFormModelsäº‹ä»¶å·²å®šä¹‰ï¼Œæ‹–æ‹½UIå¾…å®ç° |
| ç½‘ç»œä»£ç† | âœ… UIå ä½ | âŒ æœªå®ç° | ä»…æœ‰TODOå ä½ |
| ç”¨é‡ç»Ÿè®¡ | âœ… UIå ä½ | âŒ æœªå®ç° | ä»…æœ‰TODOå ä½ |

### 1.3 æ¶‰åŠæ¨¡å—

| æ¨¡å— | æ–‡ä»¶è·¯å¾„ | æ”¹åŠ¨ç±»å‹ |
|------|----------|----------|
| :domain | `model/AiProvider.kt` | ä¿®æ”¹ - æ·»åŠ æ–°å­—æ®µ |
| :domain | `model/ApiUsageRecord.kt` | æ–°å»º - ç”¨é‡è®°å½•æ¨¡å‹ |
| :domain | `model/ProxyConfig.kt` | æ–°å»º - ä»£ç†é…ç½®æ¨¡å‹ |
| :domain | `repository/ApiUsageRepository.kt` | æ–°å»º - ç”¨é‡ç»Ÿè®¡ä»“åº“æ¥å£ |
| :domain | `usecase/RecordApiUsageUseCase.kt` | æ–°å»º - è®°å½•ç”¨é‡ç”¨ä¾‹ |
| :domain | `usecase/GetApiUsageStatsUseCase.kt` | æ–°å»º - è·å–ç»Ÿè®¡ç”¨ä¾‹ |
| :data | `entity/ApiUsageEntity.kt` | æ–°å»º - ç”¨é‡æ•°æ®åº“å®ä½“ |
| :data | `dao/ApiUsageDao.kt` | æ–°å»º - ç”¨é‡DAO |
| :data | `local/ProxyPreferences.kt` | æ–°å»º - ä»£ç†é…ç½®å­˜å‚¨ |
| :data | `repository/ApiUsageRepositoryImpl.kt` | æ–°å»º - ç”¨é‡ä»“åº“å®ç° |
| :presentation | `screen/aiconfig/AiConfigScreen.kt` | ä¿®æ”¹ - æ‹–æ‹½æ’åºUI |
| :presentation | `screen/aiconfig/ProxySettingsDialog.kt` | æ–°å»º - ä»£ç†è®¾ç½®å¯¹è¯æ¡† |
| :presentation | `screen/aiconfig/UsageStatsScreen.kt` | æ–°å»º - ç”¨é‡ç»Ÿè®¡é¡µé¢ |

---

## 2. æ•°æ®æ¨¡å‹è®¾è®¡

### 2.1 AiProvider æ¨¡å‹æ‰©å±•

**æ–‡ä»¶ä½ç½®**: `domain/src/main/kotlin/com/empathy/ai/domain/model/AiProvider.kt`

**æ–°å¢å­—æ®µ**:

```kotlin
data class AiProvider(
    // ç°æœ‰å­—æ®µ...
    val id: String,
    val name: String,
    val baseUrl: String,
    val apiKey: String,
    val models: List<AiModel>,
    val defaultModelId: String,
    val isDefault: Boolean = false,
    val timeoutMs: Long = 30000L,
    val createdAt: Long = System.currentTimeMillis(),
    
    // ğŸ†• æ–°å¢å­—æ®µ
    val temperature: Float = 0.7f,        // Temperatureè®¾ç½®ï¼ŒèŒƒå›´0-2
    val maxTokens: Int = 4096             // æœ€å¤§Tokenæ•°
)
```

### 2.2 ApiUsageRecord æ¨¡å‹ï¼ˆæ–°å»ºï¼‰

**æ–‡ä»¶ä½ç½®**: `domain/src/main/kotlin/com/empathy/ai/domain/model/ApiUsageRecord.kt`

```kotlin
/**
 * API ç”¨é‡è®°å½•
 *
 * è®°å½•æ¯æ¬¡ API è°ƒç”¨çš„ç”¨é‡ä¿¡æ¯
 */
data class ApiUsageRecord(
    val id: String,                       // è®°å½•IDï¼ˆUUIDï¼‰
    val providerId: String,               // æœåŠ¡å•†ID
    val providerName: String,             // æœåŠ¡å•†åç§°ï¼ˆå†—ä½™å­˜å‚¨ï¼Œä¾¿äºç»Ÿè®¡ï¼‰
    val modelId: String,                  // æ¨¡å‹ID
    val modelName: String,                // æ¨¡å‹åç§°ï¼ˆå†—ä½™å­˜å‚¨ï¼‰
    val promptTokens: Int,                // è¾“å…¥Tokenæ•°
    val completionTokens: Int,            // è¾“å‡ºTokenæ•°
    val totalTokens: Int,                 // æ€»Tokenæ•°
    val requestTimeMs: Long,              // è¯·æ±‚è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰
    val isSuccess: Boolean,               // æ˜¯å¦æˆåŠŸ
    val errorMessage: String? = null,     // é”™è¯¯ä¿¡æ¯ï¼ˆå¤±è´¥æ—¶ï¼‰
    val createdAt: Long = System.currentTimeMillis()
)
```

### 2.3 ApiUsageStats æ¨¡å‹ï¼ˆæ–°å»ºï¼‰

**æ–‡ä»¶ä½ç½®**: `domain/src/main/kotlin/com/empathy/ai/domain/model/ApiUsageStats.kt`

```kotlin
/**
 * API ç”¨é‡ç»Ÿè®¡
 *
 * èšåˆç»Ÿè®¡ç»“æœ
 */
data class ApiUsageStats(
    val totalRequests: Int,               // æ€»è¯·æ±‚æ•°
    val successRequests: Int,             // æˆåŠŸè¯·æ±‚æ•°
    val failedRequests: Int,              // å¤±è´¥è¯·æ±‚æ•°
    val totalTokens: Long,                // æ€»Tokenæ¶ˆè€—
    val totalPromptTokens: Long,          // æ€»è¾“å…¥Token
    val totalCompletionTokens: Long,      // æ€»è¾“å‡ºToken
    val avgRequestTimeMs: Long,           // å¹³å‡è¯·æ±‚è€—æ—¶
    val byProvider: List<ProviderUsageStats>,  // æŒ‰æœåŠ¡å•†ç»Ÿè®¡
    val byModel: List<ModelUsageStats>,        // æŒ‰æ¨¡å‹ç»Ÿè®¡
    val periodStart: Long,                // ç»Ÿè®¡å‘¨æœŸå¼€å§‹
    val periodEnd: Long                   // ç»Ÿè®¡å‘¨æœŸç»“æŸ
)

/**
 * æŒ‰æœåŠ¡å•†ç»Ÿè®¡
 */
data class ProviderUsageStats(
    val providerId: String,
    val providerName: String,
    val totalRequests: Int,
    val totalTokens: Long,
    val successRate: Float                // æˆåŠŸç‡ 0-1
)

/**
 * æŒ‰æ¨¡å‹ç»Ÿè®¡
 */
data class ModelUsageStats(
    val modelId: String,
    val modelName: String,
    val providerId: String,
    val totalRequests: Int,
    val totalTokens: Long,
    val avgRequestTimeMs: Long
)
```


### 2.4 ProxyConfig æ¨¡å‹ï¼ˆæ–°å»ºï¼‰

**æ–‡ä»¶ä½ç½®**: `domain/src/main/kotlin/com/empathy/ai/domain/model/ProxyConfig.kt`

```kotlin
/**
 * ç½‘ç»œä»£ç†é…ç½®
 */
data class ProxyConfig(
    val enabled: Boolean = false,         // æ˜¯å¦å¯ç”¨ä»£ç†
    val type: ProxyType = ProxyType.HTTP, // ä»£ç†ç±»å‹
    val host: String = "",                // ä»£ç†æœåŠ¡å™¨åœ°å€
    val port: Int = 0,                    // ä»£ç†ç«¯å£
    val username: String? = null,         // ç”¨æˆ·åï¼ˆå¯é€‰ï¼‰
    val password: String? = null          // å¯†ç ï¼ˆå¯é€‰ï¼‰
) {
    /**
     * éªŒè¯é…ç½®æ˜¯å¦æœ‰æ•ˆ
     */
    fun isValid(): Boolean {
        if (!enabled) return true
        return host.isNotBlank() && port in 1..65535
    }
}

/**
 * ä»£ç†ç±»å‹
 */
enum class ProxyType {
    HTTP,
    HTTPS,
    SOCKS4,
    SOCKS5
}
```

---

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 AiProviderEntity æ‰©å±•

**æ–‡ä»¶ä½ç½®**: `data/src/main/kotlin/com/empathy/ai/data/local/entity/AiProviderEntity.kt`

**æ–°å¢å­—æ®µ**:

```kotlin
@Entity(tableName = "ai_providers")
data class AiProviderEntity(
    // ç°æœ‰å­—æ®µ...
    
    // ğŸ†• æ–°å¢å­—æ®µ
    @ColumnInfo(name = "temperature")
    val temperature: Float = 0.7f,
    
    @ColumnInfo(name = "max_tokens")
    val maxTokens: Int = 4096
)
```

### 3.2 ApiUsageEntityï¼ˆæ–°å»ºï¼‰

**æ–‡ä»¶ä½ç½®**: `data/src/main/kotlin/com/empathy/ai/data/local/entity/ApiUsageEntity.kt`

```kotlin
@Entity(
    tableName = "api_usage_records",
    indices = [
        Index(value = ["provider_id"]),
        Index(value = ["model_id"]),
        Index(value = ["created_at"])
    ]
)
data class ApiUsageEntity(
    @PrimaryKey
    @ColumnInfo(name = "id")
    val id: String,
    
    @ColumnInfo(name = "provider_id")
    val providerId: String,
    
    @ColumnInfo(name = "provider_name")
    val providerName: String,
    
    @ColumnInfo(name = "model_id")
    val modelId: String,
    
    @ColumnInfo(name = "model_name")
    val modelName: String,
    
    @ColumnInfo(name = "prompt_tokens")
    val promptTokens: Int,
    
    @ColumnInfo(name = "completion_tokens")
    val completionTokens: Int,
    
    @ColumnInfo(name = "total_tokens")
    val totalTokens: Int,
    
    @ColumnInfo(name = "request_time_ms")
    val requestTimeMs: Long,
    
    @ColumnInfo(name = "is_success")
    val isSuccess: Boolean,
    
    @ColumnInfo(name = "error_message")
    val errorMessage: String?,
    
    @ColumnInfo(name = "created_at")
    val createdAt: Long
)
```


### 3.3 æ•°æ®åº“è¿ç§»

**è¿ç§»ç‰ˆæœ¬**: v11 â†’ v12

```kotlin
val MIGRATION_11_12 = object : Migration(11, 12) {
    override fun migrate(database: SupportSQLiteDatabase) {
        // 1. ä¸º ai_providers è¡¨æ·»åŠ æ–°å­—æ®µ
        database.execSQL(
            "ALTER TABLE ai_providers ADD COLUMN temperature REAL NOT NULL DEFAULT 0.7"
        )
        database.execSQL(
            "ALTER TABLE ai_providers ADD COLUMN max_tokens INTEGER NOT NULL DEFAULT 4096"
        )
        
        // 2. åˆ›å»º api_usage_records è¡¨
        database.execSQL("""
            CREATE TABLE IF NOT EXISTS api_usage_records (
                id TEXT PRIMARY KEY NOT NULL,
                provider_id TEXT NOT NULL,
                provider_name TEXT NOT NULL,
                model_id TEXT NOT NULL,
                model_name TEXT NOT NULL,
                prompt_tokens INTEGER NOT NULL,
                completion_tokens INTEGER NOT NULL,
                total_tokens INTEGER NOT NULL,
                request_time_ms INTEGER NOT NULL,
                is_success INTEGER NOT NULL,
                error_message TEXT,
                created_at INTEGER NOT NULL
            )
        """)
        
        // 3. åˆ›å»ºç´¢å¼•
        database.execSQL(
            "CREATE INDEX IF NOT EXISTS index_api_usage_records_provider_id ON api_usage_records(provider_id)"
        )
        database.execSQL(
            "CREATE INDEX IF NOT EXISTS index_api_usage_records_model_id ON api_usage_records(model_id)"
        )
        database.execSQL(
            "CREATE INDEX IF NOT EXISTS index_api_usage_records_created_at ON api_usage_records(created_at)"
        )
    }
}
```

---

## 4. Repository æ¥å£è®¾è®¡

### 4.1 ApiUsageRepositoryï¼ˆæ–°å»ºï¼‰

**æ–‡ä»¶ä½ç½®**: `domain/src/main/kotlin/com/empathy/ai/domain/repository/ApiUsageRepository.kt`

```kotlin
/**
 * API ç”¨é‡ç»Ÿè®¡ä»“åº“æ¥å£
 */
interface ApiUsageRepository {
    /**
     * è®°å½• API è°ƒç”¨
     */
    suspend fun recordUsage(record: ApiUsageRecord): Result<Unit>
    
    /**
     * è·å–ç”¨é‡ç»Ÿè®¡
     *
     * @param startTime å¼€å§‹æ—¶é—´æˆ³
     * @param endTime ç»“æŸæ—¶é—´æˆ³
     */
    suspend fun getUsageStats(startTime: Long, endTime: Long): Result<ApiUsageStats>
    
    /**
     * è·å–æœ€è¿‘çš„ç”¨é‡è®°å½•
     *
     * @param limit è¿”å›æ•°é‡é™åˆ¶
     */
    suspend fun getRecentRecords(limit: Int = 100): Result<List<ApiUsageRecord>>
    
    /**
     * æ¸…é™¤æŒ‡å®šæ—¶é—´ä¹‹å‰çš„è®°å½•
     *
     * @param beforeTime æ—¶é—´æˆ³
     */
    suspend fun clearRecordsBefore(beforeTime: Long): Result<Int>
    
    /**
     * è·å–æ€»ç”¨é‡æ¦‚è§ˆ
     */
    suspend fun getTotalUsage(): Result<ApiUsageStats>
    
    /**
     * ğŸ†• å¯¼å‡ºç”¨é‡æ•°æ®ä¸ºJSONæ ¼å¼
     *
     * @param startTime å¼€å§‹æ—¶é—´æˆ³
     * @param endTime ç»“æŸæ—¶é—´æˆ³
     * @return JSONæ ¼å¼çš„ç”¨é‡æ•°æ®
     */
    suspend fun exportUsageData(startTime: Long, endTime: Long): Result<String>
}
```

### 4.2 æ•°æ®æ¸…ç†ç­–ç•¥

ä¸ºé¿å…ç”¨é‡ç»Ÿè®¡æ•°æ®é•¿æœŸå­˜å‚¨å¯¼è‡´æ•°æ®åº“è†¨èƒ€ï¼Œé‡‡ç”¨ä»¥ä¸‹æ¸…ç†ç­–ç•¥ï¼š

| ç­–ç•¥ | è¯´æ˜ | è§¦å‘æ—¶æœº |
|------|------|----------|
| **è‡ªåŠ¨æ¸…ç†** | ä¿ç•™æœ€è¿‘90å¤©çš„æ•°æ® | åº”ç”¨å¯åŠ¨æ—¶æ£€æŸ¥ |
| **æ‰‹åŠ¨æ¸…ç†** | ç”¨æˆ·å¯åœ¨ç”¨é‡ç»Ÿè®¡é¡µé¢æ‰‹åŠ¨æ¸…é™¤ | ç”¨æˆ·ç‚¹å‡»æ¸…é™¤æŒ‰é’® |
| **å­˜å‚¨é™åˆ¶** | æœ€å¤šä¿ç•™10000æ¡è®°å½• | æ¯æ¬¡è®°å½•æ—¶æ£€æŸ¥ |

```kotlin
// è‡ªåŠ¨æ¸…ç†å®ç°
class CleanupApiUsageUseCase @Inject constructor(
    private val repository: ApiUsageRepository
) {
    suspend operator fun invoke(): Result<Int> {
        val ninetyDaysAgo = System.currentTimeMillis() - (90L * 24 * 60 * 60 * 1000)
        return repository.clearRecordsBefore(ninetyDaysAgo)
    }
}
```

### 4.3 AiProviderRepository æ‰©å±•

åœ¨ç°æœ‰æ¥å£ä¸­æ·»åŠ ä»£ç†é…ç½®ç›¸å…³æ–¹æ³•ï¼š

```kotlin
interface AiProviderRepository {
    // ç°æœ‰æ–¹æ³•...
    
    // ğŸ†• æ–°å¢æ–¹æ³•
    /**
     * è·å–ä»£ç†é…ç½®
     */
    suspend fun getProxyConfig(): Result<ProxyConfig>
    
    /**
     * ä¿å­˜ä»£ç†é…ç½®
     */
    suspend fun saveProxyConfig(config: ProxyConfig): Result<Unit>
}
```


---

## 5. UseCase è®¾è®¡

### 5.1 RecordApiUsageUseCaseï¼ˆæ–°å»ºï¼‰

**æ–‡ä»¶ä½ç½®**: `domain/src/main/kotlin/com/empathy/ai/domain/usecase/RecordApiUsageUseCase.kt`

```kotlin
/**
 * è®°å½• API ç”¨é‡ç”¨ä¾‹
 *
 * åœ¨æ¯æ¬¡ AI API è°ƒç”¨åè®°å½•ç”¨é‡ä¿¡æ¯
 */
class RecordApiUsageUseCase @Inject constructor(
    private val repository: ApiUsageRepository
) {
    suspend operator fun invoke(
        providerId: String,
        providerName: String,
        modelId: String,
        modelName: String,
        promptTokens: Int,
        completionTokens: Int,
        requestTimeMs: Long,
        isSuccess: Boolean,
        errorMessage: String? = null
    ): Result<Unit> {
        val record = ApiUsageRecord(
            id = UUID.randomUUID().toString(),
            providerId = providerId,
            providerName = providerName,
            modelId = modelId,
            modelName = modelName,
            promptTokens = promptTokens,
            completionTokens = completionTokens,
            totalTokens = promptTokens + completionTokens,
            requestTimeMs = requestTimeMs,
            isSuccess = isSuccess,
            errorMessage = errorMessage
        )
        return repository.recordUsage(record)
    }
}
```

### 5.2 GetApiUsageStatsUseCaseï¼ˆæ–°å»ºï¼‰

**æ–‡ä»¶ä½ç½®**: `domain/src/main/kotlin/com/empathy/ai/domain/usecase/GetApiUsageStatsUseCase.kt`

```kotlin
/**
 * è·å– API ç”¨é‡ç»Ÿè®¡ç”¨ä¾‹
 */
class GetApiUsageStatsUseCase @Inject constructor(
    private val repository: ApiUsageRepository
) {
    /**
     * è·å–æŒ‡å®šæ—¶é—´èŒƒå›´çš„ç»Ÿè®¡
     */
    suspend operator fun invoke(
        startTime: Long? = null,
        endTime: Long? = null
    ): Result<ApiUsageStats> {
        return if (startTime != null && endTime != null) {
            repository.getUsageStats(startTime, endTime)
        } else {
            repository.getTotalUsage()
        }
    }
    
    /**
     * è·å–ä»Šæ—¥ç»Ÿè®¡
     */
    suspend fun getToday(): Result<ApiUsageStats> {
        val calendar = Calendar.getInstance()
        calendar.set(Calendar.HOUR_OF_DAY, 0)
        calendar.set(Calendar.MINUTE, 0)
        calendar.set(Calendar.SECOND, 0)
        calendar.set(Calendar.MILLISECOND, 0)
        val startOfDay = calendar.timeInMillis
        val now = System.currentTimeMillis()
        return repository.getUsageStats(startOfDay, now)
    }
    
    /**
     * è·å–æœ¬æœˆç»Ÿè®¡
     */
    suspend fun getThisMonth(): Result<ApiUsageStats> {
        val calendar = Calendar.getInstance()
        calendar.set(Calendar.DAY_OF_MONTH, 1)
        calendar.set(Calendar.HOUR_OF_DAY, 0)
        calendar.set(Calendar.MINUTE, 0)
        calendar.set(Calendar.SECOND, 0)
        calendar.set(Calendar.MILLISECOND, 0)
        val startOfMonth = calendar.timeInMillis
        val now = System.currentTimeMillis()
        return repository.getUsageStats(startOfMonth, now)
    }
}
```

---

## 6. ç»„ä»¶è®¾è®¡

### 6.1 é«˜çº§é€‰é¡¹ç»„ä»¶

#### 6.1.1 TemperatureSliderï¼ˆTemperatureæ»‘å—ï¼‰

**æ–‡ä»¶ä½ç½®**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/ios/TemperatureSlider.kt`

**è®¾è®¡è§„æ ¼**:
- æ»‘å—èŒƒå›´: 0.0 - 2.0
- æ­¥è¿›å€¼: 0.1
- å®æ—¶æ˜¾ç¤ºå½“å‰å€¼
- iOSé£æ ¼æ»‘å—æ ·å¼

```kotlin
@Composable
fun TemperatureSlider(
    value: Float,
    onValueChange: (Float) -> Unit,
    modifier: Modifier = Modifier
)
```


#### 6.1.2 TokenLimitInputï¼ˆTokené™åˆ¶è¾“å…¥ï¼‰

**æ–‡ä»¶ä½ç½®**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/ios/TokenLimitInput.kt`

**è®¾è®¡è§„æ ¼**:
- æ•°å­—è¾“å…¥æ¡†
- æ”¯æŒå¿«æ·é€‰é¡¹: 1024, 2048, 4096, 8192, 16384
- è¾“å…¥éªŒè¯: æ­£æ•´æ•°

```kotlin
@Composable
fun TokenLimitInput(
    value: Int,
    onValueChange: (Int) -> Unit,
    quickOptions: List<Int> = listOf(1024, 2048, 4096, 8192, 16384),
    modifier: Modifier = Modifier
)
```

### 6.2 æ¨¡å‹æ‹–æ‹½æ’åºç»„ä»¶

#### 6.2.1 DraggableModelListï¼ˆå¯æ‹–æ‹½æ¨¡å‹åˆ—è¡¨ï¼‰

**æ–‡ä»¶ä½ç½®**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/ios/DraggableModelList.kt`

**è®¾è®¡è§„æ ¼**:
- é•¿æŒ‰è§¦å‘æ‹–æ‹½
- æ‹–æ‹½é¡¹æ”¾å¤§1.05å€
- å…¶ä»–é¡¹è‡ªåŠ¨è…¾å‡ºç©ºé—´
- ä¸‰ä¸ªè“è‰²æ¨ªæ æ‹–æ‹½æ‰‹æŸ„
- æ‹–æ‹½èŒƒå›´é™åˆ¶åœ¨åˆ—è¡¨å†…

```kotlin
@OptIn(ExperimentalFoundationApi::class)
@Composable
fun DraggableModelList(
    models: List<FormModel>,
    defaultModelId: String,
    onReorder: (fromIndex: Int, toIndex: Int) -> Unit,
    onSetDefault: (modelId: String) -> Unit,
    onDelete: (modelId: String) -> Unit,
    modifier: Modifier = Modifier
)
```

**äº¤äº’è®¾è®¡**:

| äº¤äº’ | è¡Œä¸º |
|------|------|
| é•¿æŒ‰æ¨¡å‹é¡¹ | å¼€å§‹æ‹–æ‹½ï¼Œé¡¹ç›®æ”¾å¤§ï¼Œæ˜¾ç¤ºé˜´å½± |
| æ‹–æ‹½è¿‡ç¨‹ | å…¶ä»–é¡¹ç›®è‡ªåŠ¨è…¾å‡ºç©ºé—´ï¼Œå¹³æ»‘åŠ¨ç”» |
| é‡Šæ”¾ | é¡¹ç›®å½’ä½ï¼Œè§¦å‘onReorderå›è°ƒ |
| ç‚¹å‡»æ¨¡å‹é¡¹ | è®¾ä¸ºé»˜è®¤æ¨¡å‹ |
| å·¦æ»‘ | æ˜¾ç¤ºåˆ é™¤æŒ‰é’® |

### 6.3 ç½‘ç»œä»£ç†è®¾ç½®ç»„ä»¶

#### 6.3.1 ProxySettingsDialogï¼ˆä»£ç†è®¾ç½®å¯¹è¯æ¡†ï¼‰

**æ–‡ä»¶ä½ç½®**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/aiconfig/ProxySettingsDialog.kt`

**è®¾è®¡è§„æ ¼**:
- å…¨å±iOSé£æ ¼å¯¹è¯æ¡†
- ä»£ç†ç±»å‹é€‰æ‹©å™¨
- æœåŠ¡å™¨åœ°å€å’Œç«¯å£è¾“å…¥
- å¯é€‰çš„ç”¨æˆ·åå¯†ç è®¤è¯
- æµ‹è¯•ä»£ç†è¿æ¥æŒ‰é’®

```kotlin
@Composable
fun ProxySettingsDialog(
    config: ProxyConfig,
    onConfigChange: (ProxyConfig) -> Unit,
    onDismiss: () -> Unit,
    onSave: () -> Unit,
    modifier: Modifier = Modifier
)
```

**é¡µé¢ç»“æ„**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IOSNavigationBar                â”‚
â”‚ â”œâ”€â”€ å–æ¶ˆæŒ‰é’®                    â”‚
â”‚ â”œâ”€â”€ æ ‡é¢˜ "ç½‘ç»œä»£ç†"             â”‚
â”‚ â””â”€â”€ ä¿å­˜æŒ‰é’®                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IOSSettingsSection "ä»£ç†è®¾ç½®"   â”‚
â”‚ â”œâ”€â”€ IOSSwitch (å¯ç”¨ä»£ç†)        â”‚
â”‚ â”œâ”€â”€ ProxyTypePicker (ä»£ç†ç±»å‹)  â”‚
â”‚ â”œâ”€â”€ IOSFormField (æœåŠ¡å™¨åœ°å€)   â”‚
â”‚ â””â”€â”€ IOSFormField (ç«¯å£)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IOSSettingsSection "è®¤è¯ä¿¡æ¯"   â”‚
â”‚ â”œâ”€â”€ IOSFormField (ç”¨æˆ·å)       â”‚
â”‚ â””â”€â”€ IOSFormField (å¯†ç )         â”‚
â”‚ Footer: "è®¤è¯ä¿¡æ¯ä¸ºå¯é€‰é¡¹..."   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IOSSettingsSection              â”‚
â”‚ â””â”€â”€ TestProxyButton             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 6.4 ç”¨é‡ç»Ÿè®¡ç»„ä»¶

#### 6.4.1 UsageStatsScreenï¼ˆç”¨é‡ç»Ÿè®¡é¡µé¢ï¼‰

**æ–‡ä»¶ä½ç½®**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/aiconfig/UsageStatsScreen.kt`

**é¡µé¢ç»“æ„**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IOSLargeTitleBar                â”‚
â”‚ â”œâ”€â”€ è¿”å›æŒ‰é’®                    â”‚
â”‚ â”œâ”€â”€ å¤§æ ‡é¢˜ "ç”¨é‡ç»Ÿè®¡"           â”‚
â”‚ â””â”€â”€ å¯¼å‡ºæŒ‰é’®ï¼ˆåˆ†äº«å›¾æ ‡ï¼‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UsageOverviewCard               â”‚
â”‚ â”œâ”€â”€ æ€»è¯·æ±‚æ•°                    â”‚
â”‚ â”œâ”€â”€ æ€»Tokenæ¶ˆè€—                 â”‚
â”‚ â””â”€â”€ æˆåŠŸç‡                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IOSTabSwitcher                  â”‚
â”‚ â”œâ”€â”€ æŒ‰æœåŠ¡å•†                    â”‚
â”‚ â””â”€â”€ æŒ‰æ¨¡å‹                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ProviderUsageList / ModelUsageList â”‚
â”‚ â”œâ”€â”€ UsageListItem               â”‚
â”‚ â”œâ”€â”€ UsageListItem               â”‚
â”‚ â””â”€â”€ UsageListItem               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IOSSettingsSection "æ•°æ®ç®¡ç†"   â”‚
â”‚ â”œâ”€â”€ å¯¼å‡ºæ•°æ®æŒ‰é’®                â”‚
â”‚ â””â”€â”€ æ¸…é™¤å†å²æ•°æ®æŒ‰é’®            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.4.2 UsageOverviewCardï¼ˆç”¨é‡æ¦‚è§ˆå¡ç‰‡ï¼‰

```kotlin
@Composable
fun UsageOverviewCard(
    stats: ApiUsageStats,
    modifier: Modifier = Modifier
)
```

**è®¾è®¡è§„æ ¼**:
- åœ†è§’å¡ç‰‡: 12dp
- ä¸‰åˆ—å¸ƒå±€: è¯·æ±‚æ•° | Tokenæ•° | æˆåŠŸç‡
- æ•°å­—: 28sp, Bold, iOSè“è‰²
- æ ‡ç­¾: 13sp, ç°è‰²

#### 6.4.3 UsageListItemï¼ˆç”¨é‡åˆ—è¡¨é¡¹ï¼‰

```kotlin
@Composable
fun UsageListItem(
    title: String,
    subtitle: String,
    requestCount: Int,
    tokenCount: Long,
    modifier: Modifier = Modifier
)
```

#### 6.4.4 æ•°æ®å¯¼å‡ºåŠŸèƒ½

**å¯¼å‡ºæ ¼å¼**: JSON

**å¯¼å‡ºå†…å®¹**:
- ç»Ÿè®¡æ¦‚è§ˆï¼ˆæ€»è¯·æ±‚æ•°ã€æ€»Tokenæ•°ã€æˆåŠŸç‡ï¼‰
- æŒ‰æœåŠ¡å•†ç»Ÿè®¡æ˜ç»†
- æŒ‰æ¨¡å‹ç»Ÿè®¡æ˜ç»†
- å¯¼å‡ºæ—¶é—´èŒƒå›´

```kotlin
// å¯¼å‡ºæ•°æ®ç»“æ„
data class UsageExportData(
    val exportTime: Long,
    val periodStart: Long,
    val periodEnd: Long,
    val overview: ApiUsageStats,
    val records: List<ApiUsageRecord>
)
```

**äº¤äº’æµç¨‹**:
1. ç”¨æˆ·ç‚¹å‡»å¯¼å‡ºæŒ‰é’®
2. æ˜¾ç¤ºæ—¥æœŸèŒƒå›´é€‰æ‹©å¯¹è¯æ¡†
3. ç”¨æˆ·ç¡®è®¤åç”ŸæˆJSONæ–‡ä»¶
4. è°ƒç”¨ç³»ç»Ÿåˆ†äº«åŠŸèƒ½

---

## 7. ViewModel è®¾è®¡

### 7.1 AiConfigUiState æ‰©å±•

```kotlin
data class AiConfigUiState(
    // ç°æœ‰å­—æ®µ...
    
    // ğŸ†• é«˜çº§é€‰é¡¹
    val formTemperature: Float = 0.7f,
    val formMaxTokens: Int = 4096,
    
    // ğŸ†• ä»£ç†è®¾ç½®
    val proxyConfig: ProxyConfig = ProxyConfig(),
    val showProxyDialog: Boolean = false,
    val isTestingProxy: Boolean = false,
    val proxyTestResult: ProxyTestResult? = null,
    
    // ğŸ†• ç”¨é‡ç»Ÿè®¡å¯¼èˆª
    val shouldNavigateToUsageStats: Boolean = false
)

sealed class ProxyTestResult {
    data class Success(val latencyMs: Long) : ProxyTestResult()
    data class Failure(val message: String) : ProxyTestResult()
}
```

### 7.2 AiConfigUiEvent æ‰©å±•

```kotlin
sealed interface AiConfigUiEvent {
    // ç°æœ‰äº‹ä»¶...
    
    // ğŸ†• é«˜çº§é€‰é¡¹äº‹ä»¶
    data class UpdateFormTemperature(val temperature: Float) : AiConfigUiEvent
    data class UpdateFormMaxTokens(val maxTokens: Int) : AiConfigUiEvent
    
    // ğŸ†• ä»£ç†è®¾ç½®äº‹ä»¶
    data object ShowProxyDialog : AiConfigUiEvent
    data object DismissProxyDialog : AiConfigUiEvent
    data class UpdateProxyConfig(val config: ProxyConfig) : AiConfigUiEvent
    data object SaveProxyConfig : AiConfigUiEvent
    data object TestProxy : AiConfigUiEvent
    data object ClearProxyTestResult : AiConfigUiEvent
    
    // ğŸ†• ç”¨é‡ç»Ÿè®¡äº‹ä»¶
    data object NavigateToUsageStats : AiConfigUiEvent
}
```

### 7.3 UsageStatsViewModelï¼ˆæ–°å»ºï¼‰

**æ–‡ä»¶ä½ç½®**: `presentation/src/main/kotlin/com/empathy/ai/presentation/viewmodel/UsageStatsViewModel.kt`

```kotlin
@HiltViewModel
class UsageStatsViewModel @Inject constructor(
    private val getApiUsageStatsUseCase: GetApiUsageStatsUseCase,
    private val apiUsageRepository: ApiUsageRepository
) : ViewModel() {
    
    private val _uiState = MutableStateFlow(UsageStatsUiState())
    val uiState: StateFlow<UsageStatsUiState> = _uiState.asStateFlow()
    
    init {
        loadStats()
    }
    
    fun onEvent(event: UsageStatsUiEvent) {
        when (event) {
            is UsageStatsUiEvent.SwitchTab -> switchTab(event.tabIndex)
            is UsageStatsUiEvent.ClearHistory -> clearHistory()
            is UsageStatsUiEvent.Refresh -> loadStats()
        }
    }
    
    private fun loadStats() { /* å®ç° */ }
    private fun switchTab(tabIndex: Int) { /* å®ç° */ }
    private fun clearHistory() { /* å®ç° */ }
}
```


---

## 8. ç½‘ç»œå±‚é›†æˆ

### 8.1 ä»£ç†é…ç½®åº”ç”¨

**æ–‡ä»¶ä½ç½®**: `data/src/main/kotlin/com/empathy/ai/data/di/NetworkModule.kt`

åœ¨OkHttpClientæ„å»ºæ—¶åº”ç”¨ä»£ç†é…ç½®ï¼š

```kotlin
@Provides
@Singleton
fun provideOkHttpClient(
    proxyPreferences: ProxyPreferences
): OkHttpClient {
    val builder = OkHttpClient.Builder()
        .connectTimeout(30, TimeUnit.SECONDS)
        .readTimeout(30, TimeUnit.SECONDS)
        .writeTimeout(30, TimeUnit.SECONDS)
    
    // åº”ç”¨ä»£ç†é…ç½®
    val proxyConfig = proxyPreferences.getProxyConfig()
    if (proxyConfig.enabled && proxyConfig.isValid()) {
        val proxyType = when (proxyConfig.type) {
            ProxyType.HTTP, ProxyType.HTTPS -> Proxy.Type.HTTP
            ProxyType.SOCKS4, ProxyType.SOCKS5 -> Proxy.Type.SOCKS
        }
        val proxy = Proxy(proxyType, InetSocketAddress(proxyConfig.host, proxyConfig.port))
        builder.proxy(proxy)
        
        // ä»£ç†è®¤è¯
        if (!proxyConfig.username.isNullOrBlank()) {
            builder.proxyAuthenticator { _, response ->
                val credential = Credentials.basic(
                    proxyConfig.username,
                    proxyConfig.password ?: ""
                )
                response.request.newBuilder()
                    .header("Proxy-Authorization", credential)
                    .build()
            }
        }
    }
    
    return builder.build()
}
```

### 8.2 ç”¨é‡è®°å½•é›†æˆ

åœ¨ `AiRepositoryImpl` ä¸­é›†æˆç”¨é‡è®°å½•ï¼š

```kotlin
class AiRepositoryImpl @Inject constructor(
    private val api: OpenAiApi,
    private val recordApiUsageUseCase: RecordApiUsageUseCase
) : AiRepository {
    
    override suspend fun chat(
        provider: AiProvider,
        messages: List<ChatMessage>
    ): Result<AiResult> {
        val startTime = System.currentTimeMillis()
        
        return try {
            val response = api.chat(/* ... */)
            val endTime = System.currentTimeMillis()
            
            // è®°å½•ç”¨é‡
            recordApiUsageUseCase(
                providerId = provider.id,
                providerName = provider.name,
                modelId = provider.defaultModelId,
                modelName = provider.getDefaultModel()?.name ?: "",
                promptTokens = response.usage?.promptTokens ?: 0,
                completionTokens = response.usage?.completionTokens ?: 0,
                requestTimeMs = endTime - startTime,
                isSuccess = true
            )
            
            Result.success(/* ... */)
        } catch (e: Exception) {
            val endTime = System.currentTimeMillis()
            
            // è®°å½•å¤±è´¥
            recordApiUsageUseCase(
                providerId = provider.id,
                providerName = provider.name,
                modelId = provider.defaultModelId,
                modelName = provider.getDefaultModel()?.name ?: "",
                promptTokens = 0,
                completionTokens = 0,
                requestTimeMs = endTime - startTime,
                isSuccess = false,
                errorMessage = e.message
            )
            
            Result.failure(e)
        }
    }
}
```

---

## 9. å¯¼èˆªè®¾è®¡

### 9.1 æ–°å¢å¯¼èˆªè·¯ç”±

```kotlin
object NavRoutes {
    // ç°æœ‰è·¯ç”±...
    
    // ğŸ†• æ–°å¢
    const val USAGE_STATS = "usage_stats"
}
```

### 9.2 å¯¼èˆªæµç¨‹

```
AIé…ç½®é¡µé¢
    â”‚
    â”œâ”€â”€ ç‚¹å‡»"ç½‘ç»œä»£ç†" â”€â”€â”€â”€â”€â”€â†’ ProxySettingsDialogï¼ˆå¯¹è¯æ¡†ï¼‰
    â”‚
    â”œâ”€â”€ ç‚¹å‡»"ç”¨é‡ç»Ÿè®¡" â”€â”€â”€â”€â”€â”€â†’ UsageStatsScreenï¼ˆæ–°é¡µé¢ï¼‰
    â”‚
    â””â”€â”€ ç‚¹å‡»æœåŠ¡å•† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ AddProviderScreenï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰
            â”‚
            â””â”€â”€ é«˜çº§é€‰é¡¹åŒºåŸŸ
                â”œâ”€â”€ Temperatureæ»‘å—
                â””â”€â”€ æœ€å¤§Tokenè¾“å…¥
```

### 9.3 è¿”å›é”®å¤„ç†

ä¸ºç¡®ä¿ç”¨æˆ·ä½“éªŒä¸€è‡´ï¼Œå„é¡µé¢çš„è¿”å›é”®å¤„ç†å¦‚ä¸‹ï¼š

| é¡µé¢/å¯¹è¯æ¡† | è¿”å›é”®è¡Œä¸º | æ•°æ®å¤„ç† |
|-------------|------------|----------|
| AiConfigScreen | è¿”å›è®¾ç½®é¡µé¢ | æ— éœ€ä¿å­˜ |
| AddProviderScreen | æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†ï¼ˆå¦‚æœ‰æœªä¿å­˜æ›´æ”¹ï¼‰ | æç¤ºä¿å­˜æˆ–æ”¾å¼ƒ |
| ProxySettingsDialog | å…³é—­å¯¹è¯æ¡† | æ”¾å¼ƒæœªä¿å­˜æ›´æ”¹ |
| UsageStatsScreen | è¿”å›AIé…ç½®é¡µé¢ | æ— éœ€ä¿å­˜ |

```kotlin
// è¿”å›é”®å¤„ç†ç¤ºä¾‹
BackHandler(enabled = hasUnsavedChanges) {
    showDiscardDialog = true
}
```

---

## 10. å®æ–½è®¡åˆ’

### Phase 1: æ•°æ®å±‚å®ç°ï¼ˆ1å¤©ï¼‰

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | é¢„ä¼°æ—¶é—´ | ä¼˜å…ˆçº§ |
|--------|----------|----------|--------|
| T1-01 | æ‰©å±•AiProvideræ¨¡å‹ï¼Œæ·»åŠ temperatureå’ŒmaxTokenså­—æ®µ | 1h | P0 |
| T1-02 | åˆ›å»ºApiUsageRecordå’ŒApiUsageStatsæ¨¡å‹ | 1h | P0 |
| T1-03 | åˆ›å»ºProxyConfigæ¨¡å‹ | 0.5h | P0 |
| T1-04 | åˆ›å»ºApiUsageEntityå’Œæ•°æ®åº“è¿ç§» | 2h | P0 |
| T1-05 | åˆ›å»ºApiUsageDao | 1h | P0 |
| T1-06 | åˆ›å»ºProxyPreferences | 1h | P0 |
| T1-07 | åˆ›å»ºApiUsageRepositoryæ¥å£å’Œå®ç° | 2h | P0 |
| T1-08 | ç¼–å†™æ•°æ®å±‚å•å…ƒæµ‹è¯• | 1h | P0 |


### Phase 2: é¢†åŸŸå±‚å®ç°ï¼ˆ0.5å¤©ï¼‰

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | é¢„ä¼°æ—¶é—´ | ä¼˜å…ˆçº§ |
|--------|----------|----------|--------|
| T2-01 | åˆ›å»ºRecordApiUsageUseCase | 1h | P0 |
| T2-02 | åˆ›å»ºGetApiUsageStatsUseCase | 1h | P0 |
| T2-03 | æ‰©å±•AiProviderRepositoryæ¥å£ | 0.5h | P0 |
| T2-04 | ç¼–å†™UseCaseå•å…ƒæµ‹è¯• | 1h | P0 |

### Phase 3: é«˜çº§é€‰é¡¹UIå®ç°ï¼ˆ1å¤©ï¼‰

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | é¢„ä¼°æ—¶é—´ | ä¼˜å…ˆçº§ |
|--------|----------|----------|--------|
| T3-01 | åˆ›å»ºTemperatureSliderç»„ä»¶ | 1.5h | P0 |
| T3-02 | åˆ›å»ºTokenLimitInputç»„ä»¶ | 1.5h | P0 |
| T3-03 | åœ¨AddProviderScreenä¸­é›†æˆé«˜çº§é€‰é¡¹ | 2h | P0 |
| T3-04 | æ‰©å±•AiConfigUiStateå’ŒAiConfigUiEvent | 1h | P0 |
| T3-05 | æ›´æ–°AiConfigViewModelå¤„ç†é€»è¾‘ | 1h | P0 |
| T3-06 | ç¼–å†™é«˜çº§é€‰é¡¹UIæµ‹è¯• | 1h | P1 |

### Phase 4: æ¨¡å‹æ‹–æ‹½æ’åºå®ç°ï¼ˆ1å¤©ï¼‰

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | é¢„ä¼°æ—¶é—´ | ä¼˜å…ˆçº§ |
|--------|----------|----------|--------|
| T4-01 | åˆ›å»ºDraggableModelListç»„ä»¶ | 3h | P0 |
| T4-02 | å®ç°æ‹–æ‹½æ‰‹æŸ„å›¾æ ‡ | 0.5h | P0 |
| T4-03 | å®ç°æ‹–æ‹½åŠ¨ç”»æ•ˆæœ | 2h | P0 |
| T4-04 | é›†æˆåˆ°AddProviderScreen | 1h | P0 |
| T4-05 | ç¼–å†™æ‹–æ‹½æ’åºæµ‹è¯• | 1h | P1 |

### Phase 5: ç½‘ç»œä»£ç†å®ç°ï¼ˆ1å¤©ï¼‰

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | é¢„ä¼°æ—¶é—´ | ä¼˜å…ˆçº§ |
|--------|----------|----------|--------|
| T5-01 | åˆ›å»ºProxySettingsDialog | 2h | P0 |
| T5-02 | åˆ›å»ºProxyTypePickerç»„ä»¶ | 1h | P0 |
| T5-03 | å®ç°ä»£ç†æµ‹è¯•åŠŸèƒ½ | 1.5h | P0 |
| T5-04 | é›†æˆä»£ç†é…ç½®åˆ°NetworkModule | 2h | P0 |
| T5-05 | ç¼–å†™ä»£ç†è®¾ç½®æµ‹è¯• | 1h | P1 |

### Phase 6: ç”¨é‡ç»Ÿè®¡å®ç°ï¼ˆ1.5å¤©ï¼‰

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | é¢„ä¼°æ—¶é—´ | ä¼˜å…ˆçº§ |
|--------|----------|----------|--------|
| T6-01 | åˆ›å»ºUsageStatsScreen | 2h | P0 |
| T6-02 | åˆ›å»ºUsageOverviewCardç»„ä»¶ | 1.5h | P0 |
| T6-03 | åˆ›å»ºUsageListItemç»„ä»¶ | 1h | P0 |
| T6-04 | åˆ›å»ºUsageStatsViewModel | 2h | P0 |
| T6-05 | é›†æˆç”¨é‡è®°å½•åˆ°AiRepositoryImpl | 2h | P0 |
| T6-06 | æ·»åŠ å¯¼èˆªè·¯ç”± | 0.5h | P0 |
| T6-07 | ç¼–å†™ç”¨é‡ç»Ÿè®¡æµ‹è¯• | 1.5h | P1 |

### Phase 7: æ”¶å°¾ä¸ä¼˜åŒ–ï¼ˆ0.5å¤©ï¼‰

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | é¢„ä¼°æ—¶é—´ | ä¼˜å…ˆçº§ |
|--------|----------|----------|--------|
| T7-01 | æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ– | 1h | P0 |
| T7-02 | ä»£ç å®¡æŸ¥ä¸é‡æ„ | 1h | P0 |
| T7-03 | é›†æˆæµ‹è¯• | 1h | P0 |
| T7-04 | æ–‡æ¡£æ›´æ–° | 0.5h | P1 |
| T7-05 | éªŒæ”¶æ£€æŸ¥æ¸…å•ç¡®è®¤ | 0.5h | P0 |

### å…³é”®é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | å®Œæˆæ—¶é—´ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|--------|----------|--------|----------|
| **M1: æ•°æ®å±‚å®Œæˆ** | Day 1.5 | æ¨¡å‹ã€Entityã€DAOã€Repository | å•å…ƒæµ‹è¯•é€šè¿‡ï¼Œæ•°æ®åº“è¿ç§»æˆåŠŸ |
| **M2: é«˜çº§é€‰é¡¹å¯ç”¨** | Day 2.5 | Temperatureæ»‘å—ã€Tokenè¾“å…¥ | UIå¯äº¤äº’ï¼Œè®¾ç½®å¯ä¿å­˜ |
| **M3: æ‹–æ‹½æ’åºå¯ç”¨** | Day 3.5 | DraggableModelListç»„ä»¶ | æ‹–æ‹½æµç•…ï¼Œæ’åºæ­£ç¡®ä¿å­˜ |
| **M4: ä»£ç†åŠŸèƒ½å¯ç”¨** | Day 4.5 | ProxySettingsDialog | ä»£ç†é…ç½®ç”Ÿæ•ˆï¼Œæµ‹è¯•åŠŸèƒ½æ­£å¸¸ |
| **M5: ç”¨é‡ç»Ÿè®¡å¯ç”¨** | Day 6 | UsageStatsScreen | ç»Ÿè®¡æ•°æ®å‡†ç¡®ï¼ŒUIå±•ç¤ºæ­£å¸¸ |
| **M6: åŠŸèƒ½å®Œæˆ** | Day 6.5 | å…¨éƒ¨åŠŸèƒ½ | æ‰€æœ‰éªŒæ”¶æ ‡å‡†é€šè¿‡ |

### æŠ€æœ¯éªŒè¯è®¡åˆ’

åœ¨æ­£å¼å¼€å‘å‰ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æŠ€æœ¯éªŒè¯ï¼š

| éªŒè¯é¡¹ | éªŒè¯å†…å®¹ | éªŒè¯æ–¹æ³• | é¢„æœŸç»“æœ |
|--------|----------|----------|----------|
| æ‹–æ‹½æ’åºæ€§èƒ½ | åœ¨ä½ç«¯è®¾å¤‡ä¸Šçš„æ‹–æ‹½æµç•…åº¦ | åœ¨Android 7.0è®¾å¤‡ä¸Šæµ‹è¯• | å¸§ç‡â‰¥30fps |
| ä»£ç†è¿æ¥ | ä¸åŒä»£ç†ç±»å‹çš„è¿æ¥ç¨³å®šæ€§ | ä½¿ç”¨æµ‹è¯•ä»£ç†æœåŠ¡å™¨ | è¿æ¥æˆåŠŸç‡â‰¥95% |
| æ•°æ®åº“è¿ç§» | v11â†’v12è¿ç§»çš„æ•°æ®å®Œæ•´æ€§ | ä½¿ç”¨æµ‹è¯•æ•°æ®åº“ | æ•°æ®æ— ä¸¢å¤± |

---

## 11. æµ‹è¯•ç­–ç•¥

### 11.1 å•å…ƒæµ‹è¯•è¦†ç›–

| ç»„ä»¶/æ¨¡å— | æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•ç”¨ä¾‹ |
|-----------|----------|----------|
| ApiUsageRecord | ApiUsageRecordTest.kt | æ¨¡å‹åˆ›å»ºã€å­—æ®µéªŒè¯ |
| ProxyConfig | ProxyConfigTest.kt | é…ç½®éªŒè¯ã€ç±»å‹è½¬æ¢ |
| ApiUsageDao | ApiUsageDaoTest.kt | CRUDæ“ä½œã€ç»Ÿè®¡æŸ¥è¯¢ |
| RecordApiUsageUseCase | RecordApiUsageUseCaseTest.kt | è®°å½•åˆ›å»ºã€é”™è¯¯å¤„ç† |
| GetApiUsageStatsUseCase | GetApiUsageStatsUseCaseTest.kt | ç»Ÿè®¡è®¡ç®—ã€æ—¶é—´èŒƒå›´ |
| AiConfigViewModel | AiConfigViewModelTest.kt | é«˜çº§é€‰é¡¹ã€ä»£ç†è®¾ç½® |
| UsageStatsViewModel | UsageStatsViewModelTest.kt | ç»Ÿè®¡åŠ è½½ã€Tabåˆ‡æ¢ |

### 11.2 UIæµ‹è¯•è¦†ç›–

| é¡µé¢/ç»„ä»¶ | æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•åœºæ™¯ |
|-----------|----------|----------|
| TemperatureSlider | TemperatureSliderTest.kt | æ»‘åŠ¨ã€è¾¹ç•Œå€¼ |
| DraggableModelList | DraggableModelListTest.kt | æ‹–æ‹½ã€æ’åº |
| ProxySettingsDialog | ProxySettingsDialogTest.kt | è¡¨å•å¡«å†™ã€éªŒè¯ |
| UsageStatsScreen | UsageStatsScreenTest.kt | æ•°æ®æ˜¾ç¤ºã€Tabåˆ‡æ¢ |

---

## 12. éªŒæ”¶æ ‡å‡†

### 12.1 é«˜çº§é€‰é¡¹éªŒæ”¶

- [ ] Temperatureæ»‘å—å¯æ­£å¸¸æ‹–åŠ¨ï¼ŒèŒƒå›´0-2
- [ ] Temperatureå€¼å®æ—¶æ˜¾ç¤ºï¼Œç²¾åº¦0.1
- [ ] æœ€å¤§Tokenæ•°è¾“å…¥æ¡†å¯æ­£å¸¸è¾“å…¥
- [ ] å¿«æ·é€‰é¡¹å¯æ­£å¸¸é€‰æ‹©
- [ ] è®¾ç½®ä¿å­˜åé‡å¯åº”ç”¨ä¿æŒä¸å˜
- [ ] æ¯ä¸ªæœåŠ¡å•†ç‹¬ç«‹å­˜å‚¨è®¾ç½®

### 12.2 æµ‹è¯•è¿æ¥éªŒæ”¶

- [ ] æµ‹è¯•å‰æ˜¾ç¤ºé…é¢æ¶ˆè€—æç¤º
- [ ] æµ‹è¯•è¿‡ç¨‹æ˜¾ç¤ºåŠ è½½çŠ¶æ€
- [ ] æˆåŠŸæ—¶æ˜¾ç¤ºå“åº”æ—¶é—´
- [ ] å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯ç±»å‹
- [ ] æ”¯æŒç½‘ç»œé”™è¯¯ã€è®¤è¯å¤±è´¥ã€æœåŠ¡ä¸å¯ç”¨ç­‰é”™è¯¯ç±»å‹

### 12.3 æ¨¡å‹æ’åºéªŒæ”¶

- [ ] é•¿æŒ‰æ¨¡å‹é¡¹å¯å¼€å§‹æ‹–æ‹½
- [ ] æ‹–æ‹½é¡¹æ”¾å¤§æ˜¾ç¤ºï¼ˆ1.05å€ï¼‰
- [ ] å…¶ä»–é¡¹è‡ªåŠ¨è…¾å‡ºç©ºé—´
- [ ] æ˜¾ç¤ºä¸‰ä¸ªè“è‰²æ¨ªæ å›¾æ ‡
- [ ] å›¾æ ‡ä½äºåˆ—è¡¨é¡¹å³ä¾§
- [ ] æ’åºç»“æœæ­£ç¡®ä¿å­˜
- [ ] æ‹–æ‹½èŒƒå›´é™åˆ¶åœ¨åˆ—è¡¨å†…


### 12.4 ç½‘ç»œä»£ç†éªŒæ”¶

- [ ] ä»£ç†è®¾ç½®å¯¹è¯æ¡†å¯æ­£å¸¸æ‰“å¼€å’Œå…³é—­
- [ ] æ”¯æŒHTTP/HTTPS/SOCKSä»£ç†ç±»å‹é€‰æ‹©
- [ ] æœåŠ¡å™¨åœ°å€å’Œç«¯å£å¯æ­£å¸¸è¾“å…¥
- [ ] ç”¨æˆ·åå¯†ç è®¤è¯å¯é€‰å¡«å†™
- [ ] ä»£ç†æµ‹è¯•åŠŸèƒ½å¯æ­£å¸¸ä½¿ç”¨
- [ ] ä»£ç†é…ç½®ä¿å­˜ååœ¨APIè¯·æ±‚ä¸­ç”Ÿæ•ˆ
- [ ] ä»£ç†é…ç½®åŠ å¯†å­˜å‚¨

### 12.5 ç”¨é‡ç»Ÿè®¡éªŒæ”¶

- [ ] ç”¨é‡ç»Ÿè®¡é¡µé¢å¯æ­£å¸¸è®¿é—®
- [ ] æ˜¾ç¤ºæ€»è¯·æ±‚æ•°ã€æ€»Tokenæ•°ã€æˆåŠŸç‡
- [ ] æŒ‰æœåŠ¡å•†åˆ†ç±»ç»Ÿè®¡æ­£ç¡®
- [ ] æŒ‰æ¨¡å‹åˆ†ç±»ç»Ÿè®¡æ­£ç¡®
- [ ] å†å²è®°å½•ä¿ç•™æ­£ç¡®
- [ ] æ¸…é™¤å†å²æ•°æ®åŠŸèƒ½æ­£å¸¸
- [ ] ç»Ÿè®¡æ•°æ®åœ¨æ¯æ¬¡APIè°ƒç”¨åæ›´æ–°

### 12.6 æŠ€æœ¯éªŒæ”¶

- [ ] ä»£ç ç¬¦åˆClean Architectureè§„èŒƒ
- [ ] æ–°ç»„ä»¶æ”¾ç½®åœ¨æ­£ç¡®ç›®å½•
- [ ] æ•°æ®åº“è¿ç§»è„šæœ¬æ­£ç¡®æ‰§è¡Œ
- [ ] æ— ç¼–è¯‘é”™è¯¯å’Œè­¦å‘Š
- [ ] æ€§èƒ½ï¼šé¡µé¢åŠ è½½ < 500ms
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

---

## 13. é£é™©ä¸ç¼“è§£æªæ–½

### 13.1 æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| ä¸åŒæœåŠ¡å•†æµ‹è¯•æ¥å£ä¸ç»Ÿä¸€ | ä¸­ | ä¸­ | ä½¿ç”¨é€šç”¨çš„modelsç«¯ç‚¹ä½œä¸ºæµ‹è¯•æ¥å£ |
| ä»£ç†è®¾ç½®å½±å“æ­£å¸¸ç½‘ç»œè¯·æ±‚ | ä½ | é«˜ | æä¾›ä»£ç†æµ‹è¯•åŠŸèƒ½ï¼Œé…ç½®é”™è¯¯æ—¶è‡ªåŠ¨ç¦ç”¨ |
| ç”¨é‡ç»Ÿè®¡æ•°æ®é‡è¿‡å¤§ | ä½ | ä¸­ | å®šæœŸæ¸…ç†å†å²æ•°æ®ï¼Œé™åˆ¶ä¿ç•™å¤©æ•° |
| æ‹–æ‹½æ’åºåœ¨ä½ç«¯è®¾å¤‡å¡é¡¿ | ä¸­ | ä½ | ä½¿ç”¨LazyColumnä¼˜åŒ–ï¼Œé™åˆ¶åŠ¨ç”»å¤æ‚åº¦ |

### 13.2 ç”¨æˆ·ä½“éªŒé£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| é«˜çº§é€‰é¡¹è¿‡äºå¤æ‚ | ä¸­ | ä¸­ | æä¾›åˆç†é»˜è®¤å€¼ï¼Œæ·»åŠ è¯´æ˜æ–‡å­— |
| æµ‹è¯•è¿æ¥æ¶ˆè€—é…é¢ | é«˜ | ä½ | æµ‹è¯•å‰æ˜ç¡®æç¤ºï¼Œä½¿ç”¨æœ€å°è¯·æ±‚ |
| ä»£ç†é…ç½®é”™è¯¯å¯¼è‡´æ— æ³•ä½¿ç”¨ | ä¸­ | é«˜ | æä¾›æµ‹è¯•åŠŸèƒ½ï¼Œé…ç½®é”™è¯¯æ—¶æç¤º |

---

## 14. é™„å½•

### 14.1 è®¾è®¡ç¨¿ä½ç½®

```
HTML/è®¾ç½®/AIé…ç½®.html           # ç°æœ‰AIé…ç½®é¡µé¢è®¾è®¡ç¨¿
```

### 14.2 ç›¸å…³æ–‡æ¡£

- [PRD-00025-AIé…ç½®åŠŸèƒ½å®Œå–„.md](../PRD/PRD-00025-AIé…ç½®åŠŸèƒ½å®Œå–„.md)
- [FD-00021-è®¾ç½®ç•Œé¢UIä¼˜åŒ–åŠŸèƒ½è®¾è®¡.md](./FD-00021-è®¾ç½®ç•Œé¢UIä¼˜åŒ–åŠŸèƒ½è®¾è®¡.md)

### 14.3 ç°æœ‰ä»£ç å‚è€ƒ

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `domain/model/AiProvider.kt` | æœåŠ¡å•†æ¨¡å‹ï¼ˆéœ€æ‰©å±•ï¼‰ |
| `domain/repository/AiProviderRepository.kt` | æœåŠ¡å•†ä»“åº“æ¥å£ï¼ˆéœ€æ‰©å±•ï¼‰ |
| `domain/usecase/TestConnectionUseCase.kt` | æµ‹è¯•è¿æ¥ç”¨ä¾‹ï¼ˆå·²å®ç°ï¼‰ |
| `presentation/ui/screen/aiconfig/AiConfigScreen.kt` | AIé…ç½®é¡µé¢ï¼ˆéœ€ä¿®æ”¹ï¼‰ |
| `presentation/ui/screen/aiconfig/AiConfigUiState.kt` | UIçŠ¶æ€ï¼ˆéœ€æ‰©å±•ï¼‰ |
| `presentation/ui/screen/aiconfig/AiConfigUiEvent.kt` | UIäº‹ä»¶ï¼ˆéœ€æ‰©å±•ï¼‰ |

### 14.4 æœ¯è¯­è¡¨

| æœ¯è¯­ | è¯´æ˜ |
|------|------|
| Temperature | AIæ¨¡å‹ç”Ÿæˆæ–‡æœ¬çš„éšæœºæ€§æ§åˆ¶å‚æ•°ï¼Œå€¼è¶Šé«˜è¶Šéšæœºï¼ŒèŒƒå›´0-2 |
| Token | AIæ¨¡å‹å¤„ç†æ–‡æœ¬çš„åŸºæœ¬å•ä½ï¼Œä¸­æ–‡é€šå¸¸1ä¸ªå­—ç¬¦=1-2ä¸ªToken |
| APIé…é¢ | AIæœåŠ¡å•†æä¾›çš„APIè°ƒç”¨æ¬¡æ•°æˆ–Tokené™åˆ¶ |
| ä»£ç† | ç½‘ç»œä»£ç†æœåŠ¡å™¨ï¼Œç”¨äºè½¬å‘ç½‘ç»œè¯·æ±‚ |
| SOCKS | ä¸€ç§ç½‘ç»œä»£ç†åè®®ï¼Œæ”¯æŒTCPå’ŒUDP |

---

## 15. å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | å˜æ›´äºº |
|------|------|----------|--------|
| v1.0 | 2026-01-01 | åˆå§‹ç‰ˆæœ¬ | Kiro |
| v1.1 | 2026-01-01 | æ ¹æ®DR-00025å®¡æŸ¥æŠ¥å‘Šä¿®æ”¹ï¼šæ·»åŠ æ–‡æ¡£èƒŒæ™¯è¯´æ˜ã€å…³é”®é‡Œç¨‹ç¢‘ã€æŠ€æœ¯éªŒè¯è®¡åˆ’ã€æ•°æ®æ¸…ç†ç­–ç•¥ã€è¿”å›é”®å¤„ç†ã€æ•°æ®å¯¼å‡ºåŠŸèƒ½ | Kiro |

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.1
**æœ€åæ›´æ–°**: 2026-01-01
**æ–‡æ¡£çŠ¶æ€**: âœ… å®¡æŸ¥é€šè¿‡
