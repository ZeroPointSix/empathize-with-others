# FD-00037-联系人头像与联系方式功能设计

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档类型 | FD (Functional Document) |
| 文档编号 | FD-00037 |
| 功能名称 | 联系人头像与联系方式 |
| 版本 | 1.0 |
| 创建日期 | 2026-01-20 |
| 作者 | Codex |
| 审核人 | 待定 |
| 状态 | 草稿 |
| 优先级 | 中 |
| 关联PRD | PRD-00037-联系人头像与联系方式需求 |

## 版本历史

| 版本 | 日期 | 作者 | 变更说明 |
|------|------|------|----------|
| 1.0 | 2026-01-20 | Codex | 初始版本 |

## 1. 设计目标

1. 联系方式在新建/编辑联系人可输入，详情页基础信息区可展示  
2. 头像支持拍照/相册上传并可多次更换，显示为圆形  
3. 默认头像采用姓名首字 + 随机背景色  
4. 数据仅本地保存，不做云同步或导出  

## 2. 设计范围

### 2.1 包含范围

- 联系方式单行输入（自由文本、不校验格式）  
- 联系人详情页基础信息区展示联系方式  
- 头像上传：相册选择 + 拍照  
- 头像裁剪/缩放、圆形展示  
- 默认头像首字 + 随机色  
- 权限/上传失败提示原因  

### 2.2 不包含范围

- 联系方式点击跳转（电话/微信/邮箱等）  
- 云端同步/导出  
- 多条联系方式管理  

## 3. 功能设计

### 3.1 联系方式输入与展示

**输入位置**:
- 新建联系人页：单行输入框  
- 编辑联系人页：可修改  

**展示位置**:
- 联系人详情页基础信息区新增“联系方式”字段  
- 为空时显示占位文本（文案待定）  

**规则**:
- 不做格式校验  
- 不提供跳转/复制入口  

### 3.2 头像上传与展示

**默认头像**:
- 使用联系人姓名首字  
- 背景色随机生成并持久化  

**上传入口**:
- 联系人详情页点击“编辑”进入编辑页  
- 编辑页头像区域点击触发上传选项  

**上传方式**:
- 从相册选择  
- 拍照上传  

**裁剪与展示**:
- 支持裁剪/缩放  
- 头像统一圆形显示  

**失败处理**:
- 权限拒绝或上传失败时提示原因  

### 3.3 权限与异常处理

- 相机权限：首次触发拍照时申请  
- 相册权限：使用系统照片选择器或读权限  
- 权限拒绝/异常：提示原因并允许用户返回  

## 4. 交互流程

### 4.1 新建联系人
1. 进入新建联系人页  
2. 填写姓名、联系方式  
3. 未上传头像则展示默认头像  
4. 完成后保存联系人  

### 4.2 编辑联系人
1. 进入联系人详情页  
2. 点击“编辑”进入编辑页  
3. 修改联系方式或更换头像（相册/拍照 → 裁剪）  
4. 保存后返回详情页，显示更新内容  

### 4.3 详情展示
1. 基础信息区展示联系方式  
2. 无联系方式时显示占位文本  

## 5. UI 设计

### 5.1 详情页基础信息区

```
联系人信息卡片
┌────────────────────────────┐
│ 姓名     张三              │
│ 关系     朋友              │
│ 联系方式 13000000000       │
└────────────────────────────┘
```

**占位展示**: 为空时显示“未填写”（文案待定）  

### 5.2 编辑页头像区域

```
头像区域（圆形）
┌───────┐
│  张   │  ← 默认首字 + 随机色
└───────┘
[更换头像] (点击触发上传)
```

### 5.3 上传选项弹层

```
选择头像来源
 - 拍照
 - 从相册选择
 - 取消
```

## 6. 数据与模型设计

### 6.1 Domain 模型

`ContactProfile` 增加字段：
- `contactInfo: String?`（联系方式）  
- `avatarColorSeed: Int`（默认头像颜色索引）  

### 6.2 数据表（Room）

`profiles` 表新增字段：
- `contact_info` TEXT  
- `avatar_color_seed` INTEGER  

### 6.3 数据迁移

- 新增字段默认值：`contact_info = NULL`、`avatar_color_seed = 0`  
- 旧数据按默认头像规则渲染  

## 7. 技术实现方案

### 7.1 头像选择与裁剪

- 使用系统照片选择器/拍照 Intent  
- 选中后进入裁剪流程（裁剪库待定）  
- 输出本地 Uri，保存到 `ContactProfile.avatarUrl`  

### 7.2 默认头像渲染

- 优先显示 `avatarUrl`  
- 无头像时显示首字 + `avatarColorSeed` 对应色  

### 7.3 详情页展示

- 在基础信息区新增“联系方式”行  
- 空值展示占位文本  

## 8. 集成点

**UI**  
- `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/CreateContactScreen.kt`  
- `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/contact/ContactFormCard.kt`  
- `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/ContactDetailTabScreen.kt`  
- `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/overview/OverviewTab.kt`  
- `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/contact/AvatarPicker.kt`  

**ViewModel/State**  
- `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/ContactDetailUiState.kt`  
- `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/ContactDetailUiEvent.kt`  
- `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/ContactDetailViewModel.kt`  

**Domain**  
- `domain/src/main/kotlin/com/empathy/ai/domain/model/ContactProfile.kt`  
- `domain/src/main/kotlin/com/empathy/ai/domain/repository/ContactRepository.kt`  

**Data**  
- `data/src/main/kotlin/com/empathy/ai/data/local/entity/ContactProfileEntity.kt`  
- `data/src/main/kotlin/com/empathy/ai/data/local/dao/ContactDao.kt`  
- `data/src/main/kotlin/com/empathy/ai/data/repository/ContactRepositoryImpl.kt`  
- `data/src/main/kotlin/com/empathy/ai/data/local/AppDatabase.kt`（版本迁移）  

## 9. 验收标准

1. 新建联系人可填写联系方式，保存后详情页可见  
2. 联系方式为空时显示占位文本  
3. 头像支持相册/拍照上传，支持裁剪/缩放  
4. 头像可多次更换且立即生效  
5. 默认头像为姓名首字 + 随机背景色  
6. 权限拒绝/上传失败时提示原因  
7. 数据仅本地保存，无同步与导出  

## 10. 实施计划

**同一版本内交付，执行顺序**  
1. 先实现联系方式输入与详情页展示  
2. 再实现头像上传与更换  

## 11. 风险评估

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| 裁剪库兼容性 | 中 | 中 | 优先选成熟库或系统裁剪方案 |
| 权限拒绝导致流程中断 | 中 | 低 | 提示原因并保持现有头像 |
| 默认头像颜色不一致 | 低 | 中 | 颜色索引持久化 |

## 12. 待确认

- 占位文案最终文本  
- 头像裁剪方案（系统裁剪或第三方库）  

