# STAT-00002-代码统计工具使用指南

> 创建日期: 2025-12-29 | 创建者: Roo
> 最后更新: 2025-12-29 | 版本: v1.0

## 📋 概述

本文档介绍项目中用于统计代码行数的两个PowerShell脚本的使用方法和注意事项。这些脚本可以帮助开发团队定期跟踪项目代码规模、测试覆盖率和代码质量指标。

## 🔧 工具介绍

### 1. count_production_code.ps1 - 生产代码统计脚本

用于统计项目中生产代码（非测试代码）的行数和文件数量。

**功能特点:**
- 统计Kotlin和Java源代码文件
- 自动排除测试相关目录和文件
- 按模块分类统计（app、data、domain、presentation）
- 生成详细的生产代码报告
- 在控制台显示统计摘要和表格

**输出文件:** `production_code_stats.txt`（保存在项目根目录）

### 2. count_test_code.ps1 - 测试代码统计脚本

用于统计项目中测试代码的行数和文件数量，并分析测试代码与生产代码的比例。

**功能特点:**
- 统计单元测试和Android测试代码
- 区分单元测试和Android测试文件
- 自动读取生产代码统计结果进行对比分析
- 计算测试代码与生产代码的比例
- 生成详细的测试代码报告
- 在控制台显示统计摘要和表格

**输出文件:** `test_code_stats.txt`（保存在项目根目录）

## 🚀 使用方法

### 环境要求

- Windows操作系统
- PowerShell 5.0或更高版本
- 项目根目录结构符合标准Android项目布局

### 执行步骤

1. **打开PowerShell终端**
   ```powershell
   # 方法1: 在项目根目录右键选择"在此处打开PowerShell"
   # 方法2: 打开PowerShell后切换到项目根目录
   cd E:\hushaokang\Data-code\Love
   ```

2. **执行生产代码统计**
   ```powershell
   cd scripts
   powershell -ExecutionPolicy Bypass -File count_production_code.ps1
   ```
   
   执行完成后，将在项目根目录生成`production_code_stats.txt`文件。

3. **执行测试代码统计**
   ```powershell
   # 确保已执行生产代码统计（测试脚本会读取其结果）
   powershell -ExecutionPolicy Bypass -File count_test_code.ps1
   ```
   
   执行完成后，将在项目根目录生成`test_code_stats.txt`文件。

### 执行策略说明

由于PowerShell默认执行策略限制，需要使用`-ExecutionPolicy Bypass`参数临时绕过执行策略限制。这是安全的方式，不会影响系统全局的执行策略设置。

## 📊 输出报告说明

### 生产代码报告结构

```
========================================
项目生产代码统计报告
========================================
统计时间: yyyy-MM-dd HH:mm:ss
项目根目录: [项目路径]

模块统计:
  app: [文件数] 个文件, [行数] 行代码
  data: [文件数] 个文件, [行数] 行代码
  domain: [文件数] 个文件, [行数] 行代码
  presentation: [文件数] 个文件, [行数] 行代码

总计: [总文件数] 个文件, [总行数] 行代码

========================================
详细统计:
========================================

=== [模块名] 模块 ===
  [行数] 行: [相对文件路径]
  ...
```

### 测试代码报告结构

```
========================================
项目测试代码统计报告
========================================
统计时间: yyyy-MM-dd HH:mm:ss
项目根目录: [项目路径]

模块测试代码统计:
  [模块名]: [测试文件数] 个测试文件, [测试代码行数] 行测试代码
    单元测试: [单元测试文件数] 个文件, [单元测试行数] 行
    Android测试: [Android测试文件数] 个文件, [Android测试行数] 行

测试代码总计: [总测试文件数] 个文件, [总测试代码行数] 行代码
生产代码总计: [生产文件数] 个文件, [生产代码行数] 行代码
测试代码与生产代码比例:
  文件数比例: [比例]% (测试文件/生产文件)
  代码行数比例: [比例]% (测试代码/生产代码)

各模块测试代码与生产代码比例:
  [模块名]: 代码行数比例 [比例]%, 文件数比例 [比例]%
  ...

========================================
详细测试文件列表:
========================================

=== [模块名] 模块测试代码 ===
  [行数] 行 [测试类型]: [相对文件路径]
  ...
```

## 📈 统计指标解释

### 代码行数统计

- **生产代码**: 项目中的主要业务逻辑代码，不包括测试代码
- **测试代码**: 包括单元测试和Android测试代码
- **代码行数**: 使用PowerShell的`Get-Content`和`Measure-Object -Line`统计，不包括空行

### 比例分析

- **测试代码与生产代码比例**: 
  - 代码行数比例 = (测试代码行数 / 生产代码行数) × 100%
  - 文件数比例 = (测试文件数 / 生产文件数) × 100%
- **模块级比例**: 各模块独立计算比例，便于识别测试覆盖不均衡的模块

## ⚠️ 注意事项

### 执行顺序

1. **必须先执行生产代码统计脚本**，再执行测试代码统计脚本
2. 测试代码统计脚本会自动读取生产代码统计结果进行对比分析
3. 如果生产代码统计文件不存在，测试代码统计会显示警告但仍会继续执行

### 文件排除规则

**生产代码统计排除的目录:**
- 包含"test"、"androidTest"、"build"、".git"、"generated"、"intermediates"、"outputs"的路径

**测试代码统计包含的目录:**
- 包含"test"、"androidTest"的路径
- 排除"build"目录下的文件

### 统计范围

- **文件类型**: 仅统计`.kt`和`.java`文件
- **模块范围**: app、data、domain、presentation四个主要模块
- **路径处理**: 使用相对路径显示，便于阅读和比较

## 🔧 自定义配置

如需修改统计范围或排除规则，可以编辑脚本中的以下变量：

**生产代码脚本 (count_production_code.ps1):**
```powershell
# 要统计的模块列表
$Modules = @("app", "data", "domain", "presentation")

# 要统计的文件扩展名
$IncludeExtensions = @("*.kt", "*.java")

# 要排除的目录模式
$ExcludePatterns = @(
    "*test*", "*androidTest*", "*build*", "*.git*", 
    "*generated*", "*intermediates*", "*outputs*"
)
```

**测试代码脚本 (count_test_code.ps1):**
```powershell
# 要包含的目录模式（只统计测试代码）
$IncludePatterns = @("*test*", "*androidTest*")
```

## 📝 使用建议

1. **定期执行**: 建议在每次重要功能开发完成后执行统计，跟踪代码规模变化
2. **版本对比**: 保存不同版本的统计报告，便于对比分析项目发展趋势
3. **质量监控**: 关注测试代码与生产代码的比例，维持合理的测试覆盖率
4. **模块平衡**: 通过模块级统计识别代码分布不均衡的情况，及时调整

## 🔄 相关文档

- [STAT-00001-项目代码统计报告.md](STAT-00001-项目代码统计报告.md) - 最新的项目代码统计报告
- [WORKSPACE.md](../../WORKSPACE.md) - 项目工作空间状态和任务协调

---
*本指南随项目更新而维护，如有问题或建议请及时反馈。*