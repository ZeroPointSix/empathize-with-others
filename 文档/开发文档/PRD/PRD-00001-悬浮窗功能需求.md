# PRD-00001-悬浮窗功能需求

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 文档类型 | PRD (Product Requirements Document) |
| 文档编号 | PRD-00001 |
| 功能名称 | 悬浮窗功能 |
| 版本 | 1.0 |
| 创建日期 | 2025-12-12 |
| 作者 | Roo |
| 审核人 | 待定 |

## 2. 产品概述

### 2.1 功能描述
悬浮窗功能是共情AI助手的核心交互方式，允许用户在任何应用界面上快速访问AI分析和安全检查功能，无需切换应用。该功能通过系统级悬浮窗实现，提供始终可用的AI助手服务。

### 2.2 目标用户
- **主要用户**: 频繁进行社交沟通的用户
- **次要用户**: 需要实时AI辅助的专业人士
- **潜在用户**: 注重隐私和效率的移动设备用户

### 2.3 使用场景
1. **聊天分析**: 用户在微信、QQ等聊天应用中，需要AI分析对话内容
2. **内容检查**: 用户发送消息前，需要AI检查内容安全性
3. **快速访问**: 用户在任何界面，需要快速启动AI助手功能
4. **多任务处理**: 用户在使用其他应用时，需要AI在后台处理请求

## 3. 功能需求

### 3.1 核心功能

#### 3.1.1 悬浮按钮 (P0)
**需求描述**: 提供可拖动的悬浮按钮作为功能入口

**验收标准**:
- [ ] 按钮尺寸为56dp直径，符合Material Design规范
- [ ] 支持在屏幕任意位置拖动
- [ ] 点击按钮展开功能菜单
- [ ] 按钮具有适当的阴影和 elevation 效果
- [ ] 支持深色/浅色主题适配

#### 3.1.2 功能菜单 (P0)
**需求描述**: 点击悬浮按钮后展开功能选择菜单

**验收标准**:
- [ ] 菜单包含"帮我分析"和"帮我检查"两个选项
- [ ] 菜单展开动画流畅，时长200-300ms
- [ ] 点击菜单项或外部区域关闭菜单
- [ ] 菜单具有适当的圆角和阴影效果
- [ ] 支持图标和文字组合显示

#### 3.1.3 输入对话框 (P0)
**需求描述**: 提供联系人选择和文本输入界面

**验收标准**:
- [ ] 支持从联系人列表选择目标
- [ ] 文本输入框支持最多5000字符
- [ ] 实时显示字符计数
- [ ] 提供确认、取消、最小化三个操作按钮
- [ ] 对话框居中显示，响应键盘弹出
- [ ] 输入框自动聚焦并显示软键盘

#### 3.1.4 AI分析功能 (P0)
**需求描述**: 对用户输入的聊天内容进行AI分析

**验收标准**:
- [ ] 支持分析聊天内容的情感和意图
- [ ] 提供风险等级评估
- [ ] 生成策略分析建议
- [ ] 提供回复建议
- [ ] 分析结果支持复制到剪贴板
- [ ] 处理时间控制在10秒内

#### 3.1.5 安全检查功能 (P0)
**需求描述**: 对用户输入的内容进行安全性检查

**验收标准**:
- [ ] 检测内容中的敏感词汇和雷区
- [ ] 提供安全/不安全的明确判断
- [ ] 给出具体的修改建议
- [ ] 支持自定义安全规则
- [ ] 检查结果时间控制在5秒内

#### 3.1.6 最小化功能 (P1)
**需求描述**: 支持将输入对话框最小化为状态指示器

**验收标准**:
- [ ] 最小化动画流畅，时长300ms
- [ ] 指示器显示当前处理状态（加载/成功/失败）
- [ ] 点击指示器恢复输入对话框
- [ ] 最小化时保存用户输入内容
- [ ] 支持完成通知和状态恢复

### 3.2 辅助功能

#### 3.2.1 权限管理 (P0)
**需求描述**: 处理悬浮窗权限的获取和管理

**验收标准**:
- [ ] 启动前检查悬浮窗权限状态
- [ ] 权限不足时引导用户到设置页面
- [ ] 提供清晰的权限说明和引导
- [ ] 支持权限状态的实时检测
- [ ] 权限获取成功率≥80%

#### 3.2.2 状态持久化 (P1)
**需求描述**: 保存悬浮窗的状态和用户偏好

**验收标准**:
- [ ] 保存悬浮按钮的位置信息
- [ ] 保存悬浮窗的启用/禁用状态
- [ ] 应用重启后恢复上次状态
- [ ] 支持最小化请求信息的持久化
- [ ] 数据存储使用加密保护

#### 3.2.3 性能优化 (P1)
**需求描述**: 确保悬浮窗的性能表现

**验收标准**:
- [ ] 动画帧率保持55-60FPS
- [ ] 内存占用控制在5MB以内
- [ ] 触摸响应时间<300ms
- [ ] 支持硬件加速渲染
- [ ] 提供性能监控和报告

## 4. 非功能需求

### 4.1 性能需求
- **响应时间**: 所有交互响应时间<300ms
- **动画流畅度**: 动画帧率≥55FPS
- **内存占用**: 悬浮窗内存占用≤5MB
- **电池消耗**: 后台运行时电池消耗<2%/小时

### 4.2 兼容性需求
- **系统版本**: 支持Android 7.0 (API 24) 及以上
- **屏幕尺寸**: 支持屏幕宽度320dp-768dp
- **厂商适配**: 兼容主流厂商ROM（小米、华为、OPPO、VIVO）
- **分辨率**: 支持hdpi、xhdpi、xxhdpi、xxxhdpi

### 4.3 可用性需求
- **可访问性**: 支持TalkBack和键盘导航
- **多语言**: 支持中文简体、英文
- **主题适配**: 支持浅色/深色主题
- **字体缩放**: 支持系统字体大小设置

### 4.4 安全需求
- **数据加密**: 敏感数据使用AES加密存储
- **权限最小化**: 只请求必需的系统权限
- **隐私保护**: 用户数据不上传到服务器
- **安全通信**: API通信使用HTTPS加密

## 5. 用户故事

### 5.1 核心用户故事

#### 故事1: 聊天分析
**作为** 社交应用用户  
**我希望** 在聊天时快速获取AI分析  
**以便** 更好地理解对话内容并做出合适回应

**验收标准**:
- [ ] 我可以在任何应用界面点击悬浮按钮
- [ ] 我可以选择"帮我分析"功能
- [ ] 我可以选择联系人和输入聊天内容
- [ ] 我可以获得情感分析和策略建议
- [ ] 整个过程在10秒内完成

#### 故事2: 内容检查
**作为** 谨慎的沟通者  
**我希望** 发送消息前检查内容安全性  
**以便** 避免发送不合适的内容

**验收标准**:
- [ ] 我可以使用悬浮窗快速启动检查
- [ ] 我可以输入要发送的内容进行检查
- [ ] 我可以获得明确的安全/不安全判断
- [ ] 我可以获得具体的修改建议
- [ ] 检查结果在5秒内返回

#### 故事3: 多任务处理
**作为** 效率追求者  
**我希望** 在使用其他应用时AI能处理我的请求  
**以便** 不中断当前工作流程

**验收标准**:
- [ ] 我可以最小化AI请求对话框
- [ ] 我可以继续使用其他应用
- [ ] 我可以通过指示器了解处理状态
- [ ] AI处理完成后我可以收到通知
- [ ] 我可以点击指示器查看结果

## 6. 验收标准

### 6.1 功能验收
- [ ] 所有核心功能按照需求规范正常工作
- [ ] 用户可以完成完整的操作流程
- [ ] 异常情况下有适当的错误处理
- [ ] 功能在各种设备上表现一致

### 6.2 性能验收
- [ ] 所有交互响应时间<300ms
- [ ] 动画帧率≥55FPS
- [ ] 内存占用≤5MB
- [ ] 电池消耗符合要求

### 6.3 兼容性验收
- [ ] 支持Android 7.0及以上版本
- [ ] 兼容主流厂商设备
- [ ] 适配不同屏幕尺寸和密度
- [ ] 支持系统主题变化

## 7. 风险评估

### 7.1 技术风险
- **权限限制**: 部分厂商ROM限制悬浮窗权限
- **性能影响**: 悬浮窗可能影响系统性能
- **兼容性问题**: 不同Android版本的API差异

### 7.2 产品风险
- **用户接受度**: 用户可能对悬浮窗有隐私顾虑
- **使用频率**: 功能使用频率可能低于预期
- **竞品压力**: 类似功能可能被系统或竞品替代

### 7.3 风险缓解
- **权限引导**: 提供清晰的权限获取引导
- **性能优化**: 优化代码减少资源消耗
- **用户教育**: 通过引导说明功能价值

## 8. 成功指标

### 8.1 功能指标
- **功能使用率**: 日活跃用户中≥40%使用悬浮窗功能
- **任务完成率**: 悬浮窗启动的任务完成率≥85%
- **错误率**: 功能错误率≤5%

### 8.2 性能指标
- **响应时间**: 95%的交互响应时间<300ms
- **稳定性**: 崩溃率≤0.1%
- **资源占用**: 内存占用≤5MB，CPU占用≤5%

### 8.3 用户满意度
- **用户评分**: 应用商店评分≥4.0/5.0
- **NPS得分**: 净推荐值≥40
- **用户反馈**: 负面反馈比例≤20%