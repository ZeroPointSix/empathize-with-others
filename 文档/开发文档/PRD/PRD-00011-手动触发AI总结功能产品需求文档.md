# PRD-00011 手动触发AI总结功能产品需求文档

---
**文档类型**: PRD (Product Requirements Document) - 开发过程文档  
**存放规范**: 符合项目宪法第IV条 - 文档规范  
**版本控制**: Git管理，见.commit钩子  
---

## 1. 产品概述

### 1.1 功能背景
在现有的AI总结系统中，用户只能依赖每日自动总结功能，无法灵活地按需生成特定时间段的对话总结。通过用户调研和反馈分析，我们发现用户在查看特定联系人时，经常需要回顾某段时间的互动，但发现该时间段缺少总结，无法快速了解互动的关键信息和情感变化。

### 1.2 用户痛点
- **时间不灵活**：现有系统仅支持每日自动总结，无法满足用户回顾特定时间段的需求
- **历史数据空白**：早期对话记录可能因为各种原因缺少总结，形成数据空白
- **总结失败补救**：自动总结失败后，用户无法手动重新触发总结
- **个性化需求**：用户希望根据特定事件或时间点生成定制化总结

### 1.3 产品价值
通过提供手动触发AI总结功能，我们可以：
- **提升用户控制感**：让用户自主决定何时何地生成总结
- **填补数据空白**：补充历史对话中缺失的总结内容
- **增强产品灵活性**：适应不同用户的使用习惯和场景需求
- **提高用户满意度**：解决用户在实际使用中遇到的具体问题

## 2. 用户场景与画像

### 2.1 主要用户画像

#### 忙碌的职场人士
- **特征**：工作繁忙，时间宝贵，需要高效管理人际关系
- **需求**：快速回顾与重要客户或同事的互动历史，抓住关键信息
- **场景**：会议前快速了解与某位同事最近的沟通情况

#### 情感细腻的用户
- **特征**：重视人际关系的细节和情感变化
- **需求**：不遗漏任何重要的情感互动时刻
- **场景**：回顾与亲密关系的特定时期，了解关系发展轨迹

#### 数据驱动的用户
- **特征**：喜欢通过数据分析了解关系发展趋势
- **需求**：获取不同时间段的总结，进行对比分析
- **场景**：分析某段时间内沟通模式的变化和关系进展

### 2.2 核心使用场景

#### 场景一：补充历史总结
> 用户小王在查看与好友小李的互动历史时，发现上周的对话没有总结，他希望立即生成这段时期的总结，了解他们讨论的关键话题和情感变化。

#### 场景二：特定事件回顾
> 用户小张想回顾上个月与客户关于项目的讨论，他选择特定日期范围生成总结，快速了解项目讨论的要点和决策过程。

#### 场景三：总结失败补救
> 用户小刘发现某天的自动总结因为网络问题失败了，他希望通过手动触发重新生成该天的总结。

## 3. 功能需求

### 3.1 核心功能

#### 3.1.1 手动触发总结
- **功能描述**：用户可以在联系人详情页面手动触发AI总结功能
- **触发方式**：通过"生成总结"按钮进入总结流程
- **适用范围**：支持选择任意日期范围进行总结

#### 3.1.2 日期范围选择
- **功能描述**：提供灵活的日期范围选择界面
- **选择方式**：
  - 手动输入开始和结束日期
  - 快捷选择预设时间范围（最近7天、本月、上月等）
  - 一键选择未总结的时间段
- **智能提示**：显示该联系人已有总结的日期范围，避免重复

#### 3.1.3 总结生成管理
- **功能描述**：提供总结生成过程的可视化和控制
- **状态展示**：实时显示总结进度和当前处理步骤
- **操作控制**：支持取消正在进行的总结任务
- **错误处理**：提供友好的错误提示和重试机制

#### 3.1.4 结果展示与交互
- **功能描述**：优化总结结果的展示和后续操作
- **结果标识**：明确区分自动总结和手动生成的总结
- **结果编辑**：支持对总结内容进行编辑和完善
- **结果分享**：提供总结结果的分享和导出功能

### 3.2 辅助功能

#### 3.2.1 智能提醒
- **功能描述**：在适当时机提醒用户可能需要生成总结
- **提醒场景**：
  - 检测到长时间未总结的对话
  - 识别重要对话后的一段时间
  - 用户频繁查看某段历史对话时

#### 3.2.2 批量操作
- **功能描述**：支持对多个联系人或多个时间段进行批量总结
- **操作方式**：提供批量选择和批量触发功能
- **进度管理**：统一展示批量任务的进度和状态

#### 3.2.3 总结
- **功能描述**：提供不同类型的总结模板，满足不同需求
- **模板类型**：
  - 情感关系模板：强调情感变化和关系进展

## 4. 非功能性需求

### 4.1 性能需求
- **响应时间**：日期范围查询响应时间 < 500ms
- **处理速度**：总结生成启动时间 < 1秒
- **大数据处理**：30天对话总结时间 < 30秒
- **UI流畅度**：所有操作保持≥55fps的帧率
- **内存控制**：总结过程内存增量 < 10MB

### 4.2 可用性需求
- **操作简便**：从触发到生成总结不超过3次点击
- **反馈及时**：所有操作都有明确的视觉反馈
- **错误友好**：错误信息易于理解，提供解决建议
- **学习成本低**：新用户无需指导即可完成基本操作

### 4.3 可靠性需求
- **数据一致性**：确保总结数据与原始对话数据的一致性
- **异常处理**：网络中断等异常情况下保证数据完整性
- **并发处理**：支持多个总结任务并发执行
- **资源管理**：合理控制内存和CPU使用，避免影响其他功能

### 4.4 兼容性需求
- **版本兼容**：与现有总结系统完全兼容，不影响现有功能
- **数据兼容**：新格式总结数据向后兼容旧版本
- **平台兼容**：在不同设备和系统版本上表现一致

## 5. 用户体验设计

### 5.1 交互流程

#### 5.1.1 基本流程
1. 用户进入联系人详情页面
2. 点击"生成总结"按钮
3. 在日期范围选择器中选择时间段
4. 确认后开始生成总结
5. 查看生成进度
6. 总结完成后查看结果

#### 5.1.2 快捷流程
1. 系统检测到未总结的对话时间段
2. 显示"生成缺失总结"提示
3. 用户点击提示直接生成总结
4. 完成后自动跳转到结果页面

### 5.2 界面设计原则

#### 5.2.1 视觉层次
- **主要操作突出**：生成总结按钮使用主色调，位置明显
- **次要信息弱化**：辅助信息和选项使用中性色
- **状态区分明显**：不同状态使用不同的视觉表现

#### 5.2.2 信息密度
- **关键信息优先**：重要信息放在视觉焦点区域
- **信息分组**：相关信息组织在一起，减少认知负担
- **渐进披露**：复杂功能分层展示，避免界面拥挤

#### 5.2.3 反馈机制
- **即时反馈**：所有操作都有即时的视觉反馈
- **进度透明**：长时间操作提供明确的进度指示
- **状态明确**：不同状态使用不同的视觉和文字提示

### 5.3 错误处理设计

#### 5.3.1 预防性设计
- **输入验证**：实时验证用户输入，防止无效操作
- **冲突检测**：提前检测可能的冲突和问题
- **操作确认**：重要操作提供确认步骤

#### 5.3.2 恢复性设计
- **操作撤销**：支持撤销最近的操作
- **状态恢复**：异常中断后能够恢复到之前的状态
- **数据备份**：重要操作前自动备份相关数据

## 6. 数据设计

### 6.1 数据模型扩展

#### 6.1.1 总结模型
```kotlin
data class CustomSummary(
    val id: Long,
    val contactId: String,
    val startDate: String,
    val endDate: String,
    val content: String,
    val keyEvents: List<KeyEvent>,
    val newFacts: List<Fact>,
    val updatedTags: List<TagUpdate>,
    val relationshipScoreChange: Int,
    val relationshipTrend: RelationshipTrend,
    val summaryType: SummaryType, // DAILY, CUSTOM_RANGE
    val generationSource: GenerationSource, // AUTO, MANUAL
    val generatedAt: Long,
    val template: String? = null // 使用的总结模板
)
```

#### 6.1.2 任务模型
```kotlin
data class SummaryTask(
    val id: String,
    val contactId: String,
    val startDate: String,
    val endDate: String,
    val status: TaskStatus,
    val progress: Float,
    val currentStep: String,
    val createdAt: Long,
    val startedAt: Long?,
    val completedAt: Long?,
    val error: String?
)
```

### 6.2 数据存储策略

#### 6.2.1 存储结构
- **本地存储**：使用SQLite数据库存储总结数据和任务信息
- **缓存策略**：实现多级缓存，提高访问速度
- **数据同步**：确保本地数据与云端数据的一致性

#### 6.2.2 数据迁移
- **平滑迁移**：现有数据结构平滑升级到新结构
- **兼容性保证**：新版本能够读取旧版本数据
- **回滚支持**：支持版本回滚时的数据处理

## 7. 技术实现要点

### 7.1 架构设计

#### 7.1.1 模块划分
- **UI层**：负责用户界面和交互
- **业务层**：处理总结业务逻辑
- **数据层**：管理数据存储和访问
- **服务层**：协调各层之间的交互

#### 7.1.2 关键组件
- **ManualSummaryUseCase**：处理手动总结的核心逻辑
- **SummaryGenerationService**：管理总结任务的执行
- **DateRangePicker**：日期范围选择组件
- **SummaryProgressDialog**：进度显示对话框

### 7.2 性能优化

#### 7.2.1 数据处理优化
- **分批处理**：大量数据分批加载和处理
- **异步处理**：耗时操作使用协程异步执行
- **内存管理**：及时释放不需要的资源

#### 7.2.2 UI性能优化
- **状态提升**：合理管理Compose状态
- **懒加载**：按需加载UI组件
- **动画优化**：使用硬件加速的动画

### 7.3 错误处理

#### 7.3.1 错误分类
- **网络错误**：网络连接问题
- **数据错误**：数据格式或内容问题
- **业务错误**：业务逻辑冲突
- **系统错误**：系统资源不足

#### 7.3.2 处理策略
- **重试机制**：对临时性错误进行自动重试
- **降级处理**：核心功能不可用时提供替代方案
- **用户提示**：将技术错误转换为用户可理解的提示

## 8. 测试策略

### 8.1 功能测试

#### 8.1.1 基本功能测试
- 手动触发总结功能测试
- 日期范围选择测试
- 总结生成流程测试
- 结果展示测试

#### 8.1.2 边界条件测试
- 极端日期范围测试
- 大数据量测试
- 并发操作测试
- 异常情况测试

### 8.2 性能测试

#### 8.2.1 响应时间测试
- UI操作响应时间测试
- 数据查询响应时间测试
- 总结生成时间测试

#### 8.2.2 资源使用测试
- 内存使用测试
- CPU使用测试
- 电池消耗测试

### 8.3 兼容性测试

#### 8.3.1 设备兼容性
- 不同屏幕尺寸测试
- 不同系统版本测试
- 不同硬件配置测试

#### 8.3.2 数据兼容性
- 新旧数据格式兼容性测试
- 版本升级测试
- 版本回滚测试

## 9. 发布计划

### 9.1 开发阶段

#### 9.1.1 阶段一：基础功能（预计3天）
- 实现基本的日期范围选择
- 完成手动总结的核心逻辑
- 创建基础的UI组件

#### 9.1.2 阶段二：完整功能（预计4天）
- 实现进度显示和状态管理
- 完成错误处理和异常恢复
- 集成到现有系统

#### 9.1.3 阶段三：优化完善（预计3天）
- 性能优化和UI细节打磨
- 完成测试和问题修复
- 准备发布文档

### 9.2 测试阶段

#### 9.2.1 内部测试（预计2天）
- 功能测试和性能测试
- 兼容性测试和稳定性测试
- 问题修复和优化

#### 9.2.2 用户测试（预计2天）
- 小范围用户试用
- 收集反馈和问题
- 最终调整和优化

### 9.3 发布阶段

#### 9.3.1 灰度发布（预计1天）
- 小比例用户发布
- 监控性能和问题
- 收集使用数据

#### 9.3.2 全量发布（预计1天）
- 扩大发布范围
- 持续监控和优化
- 用户反馈处理

## 10. 成功指标

### 10.1 功能指标
- **功能完成度**：100%完成设计功能
- **稳定性**：崩溃率 < 0.1%
- **性能达标**：响应时间和处理速度达到设计要求

### 10.2 用户指标
- **使用率**：30%的活跃用户使用手动总结功能
- **满意度**：用户满意度评分 > 4.5/5
- **任务完成率**：总结任务完成率 > 95%

### 10.3 业务指标
- **用户留存**：提升用户留存率5%
- **使用时长**：增加用户平均使用时长10%
- **功能价值**：用户反馈功能价值评分 > 4.0/5

---

**文档版本**: 1.0  
**创建日期**: 2025-12-19  
**负责人**: 产品团队  
**审核人**: 技术负责人、设计负责人