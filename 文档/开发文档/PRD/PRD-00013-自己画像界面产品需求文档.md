# PRD-00013-自己画像界面产品需求文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档类型 | PRD (Product Requirements Document) |
| 文档编号 | PRD-00013 |
| 功能名称 | 自己画像界面 |
| 版本 | 1.1 |
| 创建日期 | 2025-12-21 |
| 作者 | PE |
| 审核人 | 待定 |
| 关联文档 | TDD-00013, FD-00013 |

---

## 1. 需求背景

### 1.1 项目背景

Empathy应用已经实现了完整的"联系人画像记忆系统"，能够记录和分析联系人的性格特点、兴趣爱好等信息。然而，在AI分析对话时，缺少对用户（应用使用者）自身特点的了解，导致AI无法提供更加个性化和贴合用户风格的建议。

### 1.2 问题陈述

1. **AI分析缺乏用户上下文**：AI在分析对话时只了解联系人信息，不了解用户的性格特点和沟通风格
2. **建议通用化**：由于不了解用户，AI提供的建议往往比较通用，缺乏个性化
3. **用户自我认知不足**：用户缺乏一个系统化的方式来了解和记录自己的社交特点
4. **画像对比缺失**：无法对比用户与联系人的性格差异，难以提供针对性的沟通建议

### 1.3 解决方案

创建一个"自己画像界面"，让用户主动填写自己的性格特点、价值观、兴趣爱好等信息，并将这些信息作为AI分析的上下文，提供更加个性化和精准的建议。

---

## 2. 产品目标

### 2.1 业务目标

- **提升AI分析质量**：通过提供用户画像信息，使AI分析更加准确和个性化
- **增强用户体验**：让用户感受到AI"了解"自己，提高应用粘性
- **差异化竞争优势**：通过个性化AI分析功能，建立产品差异化优势

### 2.2 用户目标

- **自我认知**：帮助用户系统化了解自己的社交特点和偏好
- **个性化建议**：获得更贴合自己风格的沟通建议
- **效率提升**：减少AI分析的试错成本，快速获得有用建议

### 2.3 技术目标

- **无缝集成**：与现有联系人画像记忆系统无缝集成
- **数据一致性**：确保用户画像数据与联系人画像数据结构一致
- **性能优化**：不影响现有功能的性能表现
- **隐私保护**：用户画像数据使用EncryptedSharedPreferences加密存储

---

## 3. 目标用户

### 3.1 主要用户群体

| 用户群体 | 特征 | 需求 | 使用场景 |
|---------|------|------|---------|
| 社交活跃用户 | 经常需要与不同类型人群沟通 | 个性化沟通建议 | 工作社交、朋友聚会、家庭沟通 |
| 自我提升用户 | 希望了解和改善自己的社交能力 | 自我认知和改进建议 | 个人成长、人际关系改善 |
| 效率导向用户 | 希望快速获得实用的沟通方案 | 快速精准的建议 | 商务谈判、重要会议、约会 |

### 3.2 用户画像

**典型用户：小张**
- 28岁，互联网公司产品经理
- 需要频繁与不同部门同事、客户、合作伙伴沟通
- 希望提高沟通效率，避免因沟通不当造成误解
- 对自我提升有强烈需求，愿意花时间完善个人资料

---

## 4. 功能需求

### 4.1 核心功能

#### 4.1.1 用户画像数据结构

**基础维度（必填项）**：
- **性格特点**：内向/外向、理性/感性、乐观/悲观等
- **价值观**：重视家庭、追求事业、注重健康等
- **兴趣爱好**：运动、阅读、旅行、音乐等
- **沟通风格**：直接委婉、严肃幽默、主动被动等
- **社交偏好**：大群体/小群体、线上/线下、深度/浅层交流

**自定义维度（可选项）**：
- 用户可以自由添加新的画像维度
- 支持标签形式的描述
- 每个维度可以添加多个标签

#### 4.1.2 用户画像界面

**入口位置**：
- 设置页面中的"个人画像"选项
- 支持从设置页面快速访问

**界面布局**：
- 采用标签页形式，分为"基础信息"和"自定义维度"
- 每个维度以卡片形式展示，支持展开/收起
- 支持标签的添加、编辑、删除操作

**交互设计**：
- 支持标签的快速添加（输入框+确认按钮）
- 支持标签的拖拽排序
- 支持标签的批量编辑
- 提供预设标签供用户选择

#### 4.1.3 AI上下文集成

**集成方式**：
- 在AI分析时自动将用户画像信息加入上下文
- 用户画像信息优先级高于联系人画像信息
- 支持用户画像的开关控制

**上下文构建**：
- 在现有ContextBuilder中添加用户画像构建逻辑
- 智能筛选相关的用户画像信息（避免信息过载）
- 支持用户画像与联系人画像的对比分析

### 4.2 辅助功能

#### 4.2.1 画像完整性提示

- 显示画像完整度百分比
- 提供完善建议（如"建议添加更多兴趣爱好"）
- 突出显示未填写的重要维度

#### 4.2.2 画像导出功能

- 支持将用户画像导出为JSON格式
- 支持画像数据的备份和恢复
- 提供画像分享功能（可选）

---

## 5. 非功能需求

### 5.1 性能需求

| 指标 | 要求 | 测量方法 |
|------|------|---------|
| 界面加载时间 | < 500ms | 从点击设置到界面完全加载 |
| 标签操作响应时间 | < 200ms | 从点击到界面反馈 |
| AI分析增加时间 | < 300ms | 与不使用用户画像的对比 |

### 5.2 可用性需求

- **易用性**：新用户能在3分钟内完成基础画像填写
- **一致性**：界面风格与现有应用保持一致
- **可访问性**：支持无障碍访问，适配不同屏幕尺寸

### 5.3 可靠性需求

- **数据安全**：用户画像数据使用EncryptedSharedPreferences加密存储，不上传服务器
- **数据完整性**：确保画像数据不丢失，支持自动备份
- **错误处理**：优雅处理各种异常情况，不影响主功能

### 5.4 兼容性需求

- **Android版本**：支持Android 7.0（API 24）及以上
- **设备兼容**：适配不同屏幕尺寸和分辨率
- **系统兼容**：与现有联系人画像系统完全兼容

---

## 6. 界面设计

### 6.1 信息架构

```
设置页面
└── 个人画像
    ├── 基础信息
    │   ├── 性格特点
    │   ├── 价值观
    │   ├── 兴趣爱好
    │   ├── 沟通风格
    │   └── 社交偏好
    └── 自定义维度
        ├── 维度1
        │   ├── 标签1
        │   ├── 标签2
        │   └── 添加标签
        └── 添加维度
```

### 6.2 页面布局

#### 6.2.1 主界面

- **顶部**：标题"个人画像" + 完整度指示器
- **中部**：标签页切换（基础信息/自定义维度）
- **底部**：保存按钮 + 重置按钮

#### 6.2.2 基础信息页

- 每个维度一个卡片，包含：
  - 维度名称
  - 已添加标签列表
  - 添加标签按钮
  - 预设标签建议

#### 6.2.3 自定义维度页

- 维度列表，每个维度包含：
  - 维度名称（可编辑）
  - 标签列表
  - 删除维度按钮
- 底部"添加维度"按钮

### 6.3 交互设计

#### 6.3.1 标签操作

- **添加标签**：点击"+"按钮 → 输入框 → 确认/取消
- **编辑标签**：长按标签 → 编辑模式 → 修改 → 确认/取消
- **删除标签**：长按标签 → 显示删除选项 → 确认删除
- **拖拽排序**：长按标签 → 拖拽到目标位置 → 释放

#### 6.3.2 维度操作

- **展开/收起**：点击维度标题 → 展开/收起标签列表
- **添加维度**：点击"添加维度" → 输入维度名称 → 确认
- **编辑维度**：点击维度名称 → 编辑模式 → 修改 → 确认
- **删除维度**：点击删除图标 → 确认对话框 → 确认删除

---

## 7. 数据设计

### 7.1 数据模型

#### 7.1.1 UserProfile领域模型

```kotlin
/**
 * 用户画像领域模型
 */
data class UserProfile(
    val id: String = "user_profile",
    val personalityTraits: List<String> = emptyList(),      // 性格特点
    val values: List<String> = emptyList(),                 // 价值观
    val interests: List<String> = emptyList(),              // 兴趣爱好
    val communicationStyle: List<String> = emptyList(),       // 沟通风格
    val socialPreferences: List<String> = emptyList(),        // 社交偏好
    val customDimensions: Map<String, List<String>> = emptyMap(), // 自定义维度
    val createdAt: Long = System.currentTimeMillis(),
    val updatedAt: Long = System.currentTimeMillis()
)
```

#### 7.1.2 UserFact领域模型

```kotlin
/**
 * 用户事实领域模型
 * 与联系人Fact模型保持一致
 */
data class UserFact(
    val key: String,           // 维度名称
    val value: String,         // 标签内容
    val timestamp: Long,       // 创建/更新时间
    val source: FactSource     // 来源：MANUAL
)
```

### 7.2 存储设计

#### 7.2.1 本地存储

- 使用EncryptedSharedPreferences存储用户画像数据，符合隐私优先原则
- 支持数据版本控制和迁移
- 定期自动备份到应用私有目录

#### 7.2.2 数据同步

- 与现有联系人画像系统保持数据结构一致性
- 支持数据导入导出功能
- 支持数据恢复和回滚

### 7.3 数据验证

#### 7.3.1 输入验证

- **标签长度**：1-50字符（调整为1-50字符，避免限制过严影响用户体验）
- **维度名称**：2-20字符
- **特殊字符过滤**：禁止<、>、&、'、"、/、\等HTML特殊字符，防止XSS和注入攻击
- **重复标签检测**：同一维度内标签不能重复，防止数据冗余
- **敏感词过滤**：禁止包含政治敏感、暴力、色情等不当内容，维护健康内容环境
- **标签数量限制**：单个维度最多20个标签，防止信息过载
- **自定义维度限制**：最多10个自定义维度，保持界面简洁性

#### 7.3.2 数据完整性

- 必填维度检查
- 数据格式验证
- 数据范围限制

---

## 8. 技术方案

### 8.1 架构设计

#### 8.1.1 整体架构

采用与现有联系人画像系统一致的Clean Architecture + MVVM架构：

```
Presentation Layer
├── UserProfileScreen
├── UserProfileViewModel
└── UserProfileUiState

Domain Layer
├── UserProfileRepository (接口)
├── UserProfileUseCase
└── UserProfile (领域模型)

Data Layer
├── UserProfileRepositoryImpl
├── UserProfilePreferences (EncryptedSharedPreferences)
└── UserProfileEntity
```

#### 8.1.2 集成方案

- **ContextBuilder扩展**：在现有ContextBuilder中添加用户画像构建逻辑
- **AI分析集成**：在AnalyzeChatUseCase中集成用户画像上下文
- **数据一致性**：复用现有的Fact相关类型和工具类

### 8.2 关键技术点

#### 8.2.1 上下文构建策略

```kotlin
/**
 * 扩展ContextBuilder，支持用户画像
 * 添加错误处理确保上下文构建的稳定性
 */
fun buildAnalysisContextWithUserProfile(
    contact: ContactProfile,
    userProfile: UserProfile,
    userInput: String
): Result<String> {
    return try {
        val sb = StringBuilder()
        
        // 1. 用户画像信息（优先级最高）
        if (!userProfile.isEmpty()) {
            sb.appendLine("【用户画像（你的特点）】")
            appendUserProfileFacts(sb, userProfile)
            sb.appendLine()
        }
        
        // 2. 联系人信息
        sb.appendLine("【联系人信息】")
        appendContactInfo(sb, contact)
        sb.appendLine()
        
        // 3. 用户输入
        sb.appendLine("【用户提供的聊天记录】")
        sb.appendLine(userInput)
        
        Result.success(sb.toString())
    } catch (e: Exception) {
        Result.failure(Exception("构建分析上下文失败: ${e.message}", e))
    }
}
```

#### 8.2.2 智能筛选算法

##### 筛选优先级
1. **高优先级**：与聊天内容直接相关的维度（如提到"工作"则优先展示职业相关）
2. **中优先级**：基础维度（性格、价值观）始终包含，确保AI了解用户基本特征
3. **低优先级**：自定义维度根据相关性动态筛选，避免无关信息干扰

##### 长度控制策略
- **总标签数量限制**：不超过30个（原50个调整为30个，避免信息过载影响AI分析效果）
- **每个维度限制**：每个维度最多展示5个标签，优先展示最重要的特征
- **时间权重**：优先展示最近更新的标签，确保信息时效性
- **相关性权重**：根据聊天内容关键词匹配度动态调整标签展示优先级

##### 匹配策略
- **关键词匹配**：识别聊天内容中的关键词，匹配相关维度
- **语义分析**：分析对话情感和主题，选择合适的画像信息
- **场景适配**：根据不同社交场景（工作、朋友、家庭等）调整画像信息展示

- 根据聊天内容智能筛选相关的用户画像信息
- 避免信息过载，提高AI分析效率
- 支持画像信息的权重调整

### 8.3 性能优化

#### 8.3.1 数据缓存

- 内存缓存用户画像数据
- 懒加载自定义维度数据
- 使用DiffUtil优化界面更新

#### 8.3.2 异步处理

- 画像数据读写使用IO调度器
- AI上下文构建在后台线程执行
- 界面操作响应优先级最高

---

## 9. 测试策略

### 9.1 测试范围

#### 9.1.1 功能测试

| 测试模块 | 测试重点 | 测试用例数 |
|---------|---------|-----------|
| 用户画像填写 | 数据输入、验证、保存 | 15 |
| 画像编辑 | 标签增删改、维度管理 | 20 |
| AI上下文集成 | 上下文构建、筛选逻辑 | 10 |
| 数据持久化 | 存储、读取、迁移 | 8 |
| 画像导出 | 导出流程、格式验证 | 6 |

#### 9.1.2 非功能测试

| 测试类型 | 测试指标 | 目标值 |
|---------|---------|-------|
| 性能测试 | 界面响应时间 | < 500ms |
| 兼容性测试 | 设备覆盖率 | 95% |
| 稳定性测试 | 连续使用时间 | > 24小时 |
| 内存测试 | 内存泄漏 | 无 |
| 数据安全测试 | 加密存储验证 | 通过 |

### 9.2 测试环境

#### 9.2.1 设备覆盖

- **高端设备**：Samsung Galaxy S21, Google Pixel 6
- **中端设备**：Samsung A53, Xiaomi Redmi Note 11
- **低端设备**：Samsung A12, Redmi 9

#### 9.2.2 系统版本

- **主要版本**：Android 12, 13
- **兼容版本**：Android 7.0-11
- **测试比例**：70%主要版本，30%兼容版本

---

## 10. 上线计划

### 10.1 开发阶段

| 阶段 | 内容 | 预计工期 | 交付物 |
|------|------|---------|-------|
| 阶段1：基础架构 | 数据模型、Repository、ViewModel | 3天 | 基础架构代码 |
| 阶段2：UI开发 | 用户画像界面、交互逻辑 | 4天 | 完整UI界面 |
| 阶段3：AI集成 | 上下文构建、AI分析集成 | 3天 | AI集成功能 |
| 阶段4：测试优化 | 功能测试、性能优化 | 2天 | 测试报告 |

### 10.2 发布计划

#### 10.2.1 内测阶段

- **时间**：开发完成后1周
- **范围**：内部测试团队
- **目标**：功能验证、bug修复

#### 10.2.2 公测阶段

- **时间**：内测完成后1周
- **范围**：种子用户群体
- **目标**：用户体验验证、性能测试

#### 10.2.3 正式发布

- **时间**：公测完成后
- **范围**：全量用户
- **目标**：功能上线、用户反馈收集

---

## 11. 风险评估

### 11.1 技术风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| AI上下文过长导致分析失败 | 中 | 高 | 实施智能筛选算法，限制上下文长度 |
| 数据迁移失败 | 低 | 高 | 完善迁移策略，提供回滚机制 |
| 性能影响 | 中 | 中 | 异步处理、缓存优化 |
| 与现有功能冲突 | 低 | 中 | 充分测试，渐进式发布 |

### 11.2 产品风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| 用户填写意愿低 | 中 | 高 | 简化填写流程，提供预设选项 |
| 画像质量不高 | 高 | 中 | 提供填写指导，质量提示 |
| 用户理解偏差 | 中 | 中 | 详细说明文档，示例引导 |

### 11.3 运营风险

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| 用户反馈负面 | 低 | 高 | 充分内测，快速响应机制 |
| 功能使用率低 | 中 | 中 | 用户引导，价值宣传 |
| 数据安全问题 | 低 | 高 | 加密存储，权限控制 |

---

## 12. 成功指标

### 12.1 业务指标

| 指标 | 目标值 | 测量周期 |
|------|-------|---------|
| 用户画像填写率 | > 60% | 上线后30天 |
| AI分析满意度提升 | > 20% | 上线后30天 |
| 功能使用频率 | > 3次/周 | 上线后30天 |

### 12.2 技术指标

| 指标 | 目标值 | 测量周期 |
|------|-------|---------|
| 界面加载时间 | < 500ms | 持续监控 |
| 崩溃率 | < 0.1% | 持续监控 |
| 内存占用增长 | < 10MB | 持续监控 |

### 12.3 用户体验指标

| 指标 | 目标值 | 测量周期 |
|------|-------|---------|
| 用户满意度评分 | > 4.0/5.0 | 上线后30天 |
| 任务完成率 | > 85% | 上线后30天 |
| 用户留存率 | > 70% | 上线后30天 |

---

## 13. 后续规划

### 13.1 短期优化（1-3个月）

- **智能推荐**：基于用户画像推荐预设标签
- **画像对比**：用户与联系人的画像对比分析
- **数据可视化**：画像数据的图表展示

### 13.2 中期扩展（3-6个月）

- **画像历史记录**：记录用户画像的修改历史，支持查看历史版本和回滚
- **AI画像生成**：通过AI分析用户行为自动生成画像
- **社交场景适配**：不同场景下的画像切换

### 13.3 长期愿景（6个月以上）

- **多维度分析**：结合时间、地点、对象的画像分析
- **预测模型**：基于画像预测沟通效果
- **个性化成长**：基于画像提供个人成长建议

---

## 14. 附录

### 14.1 术语表

| 术语 | 定义 |
|------|------|
| 用户画像 | 用户在社交互动中的性格特点、价值观等信息的集合 |
| 上下文构建 | 将用户画像信息整合到AI分析提示词中的过程 |
| 智能筛选 | 根据聊天内容自动筛选相关画像信息的算法 |
| 自定义维度 | 用户根据个人需求添加的画像维度 |
| 加密存储 | 使用EncryptedSharedPreferences对敏感数据进行加密存储 |

### 14.2 参考文档

- [TDD-00013-自己画像界面技术设计](../TDD/TDD-00013-自己画像界面技术设计.md)
- [FD-00013-自己画像界面功能设计](../FD/FD-00013-自己画像界面功能设计.md)
- [TDD-00003-联系人画像记忆系统架构设计](../TDD/TDD-00003-联系人画像记忆系统架构设计.md)
- [WORKSPACE.md](../../WORKSPACE.md)

### 14.3 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| v1.0 | 2025-12-21 | 初始版本 | PE |
| v1.1 | 2025-12-21 | 补充错误处理；将画像历史记录功能移至后续规划；更新存储设计为EncryptedSharedPreferences；统一架构描述 | PE |

---

**文档结束**