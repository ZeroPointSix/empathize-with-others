# PRD-00015 提示词设置优化需求

## 📋 需求概述

### 背景与问题
当前应用的提示词设置存在以下问题：
1. **场景与功能不匹配**：设置界面显示5个场景（聊天分析、安全检查、信息提取、每日总结、润色优化、生成回复），但实际用户只使用3个核心功能（分析、润色、回复）
2. **UI展示冗余**：设置界面展示了过多的提示词选项，造成用户困惑
3. **提示词内容重叠**：部分场景的提示词功能重叠，用户体验不一致

### 目标
优化提示词设置功能，使其与实际使用场景保持一致，提升用户体验和设置界面的清晰度。

## 🎯 核心需求

### 1. 场景简化
- 将当前的6个场景简化为4个核心场景：**分析、润色、回复、总结**
- 移除冗余的**安全检查**和**信息提取**场景
- 确保每个场景都有明确的功能定位和使用场景

### 2. UI界面优化
- 设置界面只显示4个核心场景的提示词设置选项
- 保持界面简洁，减少用户认知负担
- 提供清晰的场景描述和功能说明

### 3. 提示词内容优化
- 重新设计4个核心场景的默认提示词内容
- 确保提示词内容与实际功能需求匹配
- 优化提示词的表达效果和用户体验

## 📊 功能需求

### 场景定义

#### 1. 分析模式（ANALYZE）
- **功能定位**：分析聊天内容，提供沟通建议和策略分析
- **使用场景**：用户收到消息后，需要理解对方意图和情绪
- **变量支持**：contact_name, relationship_status, risk_tags, strategy_tags, facts_count
- **输出格式**：JSON格式，包含回复建议、策略分析、风险等级

#### 2. 润色模式（POLISH）
- **功能定位**：优化用户草稿，使表达更得体，包含风险检查功能
- **使用场景**：用户编辑回复内容时，需要优化表达和检查风险
- **变量支持**：contact_name, relationship_status, risk_tags
- **输出格式**：JSON格式，包含优化后文本、风险检测结果

#### 3. 回复模式（REPLY）
- **功能定位**：根据对方消息生成合适的回复内容
- **使用场景**：用户需要快速生成回复建议时
- **变量支持**：contact_name, relationship_status, risk_tags, strategy_tags
- **输出格式**：JSON格式，包含建议回复内容、策略说明

#### 4. 总结模式（SUMMARY）
- **功能定位**：生成每日对话总结，提取关键信息
- **使用场景**：用户需要回顾和总结当天的对话内容
- **变量支持**：contact_name, relationship_status, facts_count, today_date
- **输出格式**：JSON格式，包含新事实、更新事实、标签变化、关系评分等

### UI界面需求

#### 设置界面优化
```
提示词设置
├── 聊天分析指令
│   └── 自定义AI分析聊天内容时的行为
├── 润色优化指令  
│   └── 自定义AI优化表达时的行为
├── 生成回复指令
│   └── 自定义AI生成回复时的行为
└── 每日总结指令
    └── 自定义AI生成总结时的行为
```

#### 提示词编辑器
- 支持编辑4个核心场景的提示词
- 提供字符计数和限制提醒（最大1000字符）
- 支持重置为默认提示词
- 提供变量使用说明和示例

## 🔧 技术需求

### 数据模型变更

#### PromptScene枚举更新
```kotlin
enum class PromptScene(
    val displayName: String,
    val description: String,
    val availableVariables: List<String>
) {
    ANALYZE(
        displayName = "聊天分析",
        description = "分析聊天上下文，提供沟通建议",
        availableVariables = listOf("contact_name", "relationship_status", "risk_tags", "strategy_tags", "facts_count")
    ),
    
    POLISH(
        displayName = "润色优化", 
        description = "优化用户草稿，使表达更得体",
        availableVariables = listOf("contact_name", "relationship_status", "risk_tags")
    ),
    
    REPLY(
        displayName = "生成回复",
        description = "根据对方消息生成合适的回复", 
        availableVariables = listOf("contact_name", "relationship_status", "risk_tags", "strategy_tags")
    ),
    
    SUMMARY(
        displayName = "每日总结",
        description = "生成每日对话总结",
        availableVariables = listOf("contact_name", "relationship_status", "facts_count", "today_date")
    )
}
```

#### SystemPrompts优化
- 更新4个核心场景的系统提示词内容
- 移除废弃场景的提示词定义
- 确保提示词内容与功能需求匹配

### 兼容性处理
- 处理现有用户自定义提示词的迁移
- 确保废弃场景的数据不会导致应用崩溃
- 提供平滑的升级体验

## 📱 用户体验需求

### 界面交互
- 保持现有的设置界面布局风格
- 简化提示词选项展示，减少滚动
- 提供清晰的功能说明和帮助信息

### 操作流程
1. 用户进入设置页面
2. 点击"提示词设置"区域
3. 看到4个核心场景的设置选项
4. 点击任意选项进入提示词编辑器
5. 编辑完成后保存，返回设置页面

### 错误处理
- 提示词保存失败时的错误提示
- 网络异常时的本地保存机制
- 字符超限时的友好提醒

## 🧪 测试需求

### 功能测试
- 验证4个核心场景的提示词设置功能
- 测试提示词编辑器的保存和重置功能
- 验证变量替换和提示词生效机制

### 兼容性测试
- 测试从旧版本升级的用户数据迁移
- 验证废弃场景数据的处理
- 确保应用不会因数据变更而崩溃

### 用户体验测试
- 验证设置界面的简洁性和易用性
- 测试提示词编辑的交互体验
- 确认用户能够理解各场景的功能差异

## 📈 成功指标

### 用户体验指标
- 设置页面停留时间减少20%
- 提示词设置完成率提升15%
- 用户反馈满意度提升

### 技术指标
- 应用启动时间不受影响
- 数据迁移成功率100%
- 崩溃率保持0%

## 🚀 实施计划

### 第一阶段：数据层优化
1. 更新PromptScene枚举定义
2. 优化SystemPrompts提示词内容
3. 实现数据兼容性处理

### 第二阶段：UI界面更新
1. 更新设置界面的提示词选项展示
2. 优化提示词编辑器的场景支持
3. 完善错误处理和用户反馈

### 第三阶段：测试和验证
1. 功能测试和兼容性验证
2. 用户体验测试和优化
3. 文档更新和发布准备

## 📝 风险与限制

### 技术风险
- 数据迁移可能导致用户自定义提示词丢失
- 废弃场景的处理可能影响现有功能

### 缓解措施
- 实现完整的数据备份和恢复机制
- 提供详细的迁移日志和错误报告
- 设置灰度发布和回滚机制

## 📚 相关文档

- [PRD-00005 提示词管理系统需求](../PRD/PRD-00005-提示词管理系统需求.md)
- [PRD-00006 提示词编辑界面需求](../PRD/PRD-00006-提示词编辑界面需求.md)
- [TDD-00006 提示词编辑界面技术设计](../TDD/TDD-00006-提示词编辑界面技术设计.md)

---

**文档状态**: 草稿  
**创建日期**: 2025-12-22  
**负责人**: 架构师  
**审核状态**: 待审核