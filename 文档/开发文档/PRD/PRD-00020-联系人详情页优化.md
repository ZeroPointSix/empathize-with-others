# PRD-00020-联系人界面UI优化

## 1. 需求概述

### 1.1 需求背景
基于现有的联系人界面HTML设计稿，需要对联系人相关界面进行全面的UI优化，提升用户体验和视觉一致性。联系人列表已在PRD19中完成优化，本次优化重点为联系人详情页及其他相关界面。

### 1.2 需求目标
- 提升联系人界面的视觉一致性和美观度
- 优化用户交互体验，提高操作流畅性
- 改善信息架构，使信息展示更加清晰有序
- 保持现有iOS设计风格，在细节上进行优化提升
- **完全重写现有UI代码**，确保最终效果与设计稿完全一致

### 1.3 优化范围
按照用户使用的先后顺序，依次优化以下界面：
1. 概览页.html（联系人详情页 - OverviewTab）
2. 事实流页.html（FactStreamTab）
3. 画像库页.html（PersonaTab）
4. 资料库页.html（DataVaultTab）
5. 新建联系人页.html（CreateContactScreen）

---

## 🔴 2. 设计稿强制引用规范

> **⚠️ 重要提示：本节内容为强制性要求，所有后续任务（TD、TDD、FD、代码实现）必须严格遵守！**

### 2.1 设计稿文件位置

**所有UI优化工作必须严格参考以下HTML设计文件：**

| 页面 | 设计稿路径 | 对应组件 |
|------|-----------|----------|
| 概览页 | `文档/开发文档/UI-原型/PRD20/联系人详情/概览页.html` | OverviewTab.kt |
| 事实流页 | `文档/开发文档/UI-原型/PRD20/联系人详情/事实流页.html` | FactStreamTab.kt |
| 画像库页 | `文档/开发文档/UI-原型/PRD20/联系人详情/画像库页.html` | PersonaTab.kt |
| 资料库页 | `文档/开发文档/UI-原型/PRD20/联系人详情/资料库页.html` | DataVaultTab.kt |
| 新建联系人页 | `文档/开发文档/UI-原型/PRD20/联系人详情/新建联系人页.html` | CreateContactScreen.kt |

**设计规范文档**: `文档/开发文档/UI-原型/PRD20/联系人详情/README.md`

### 2.2 强制性要求

**在编写任何后续文档或代码时，必须：**

1. **先阅读对应的HTML设计稿**，理解设计意图和视觉效果
2. **严格按照设计稿中的布局、样式和交互效果进行实现**
3. **色彩、字体、间距、圆角等视觉参数必须与设计稿保持一致**
4. **交互效果和动画必须与设计稿中的表现保持一致**
5. **每个HTML文件底部都包含详细的代码映射注释，必须参考**

### 2.3 设计稿引用格式

在后续文档中引用设计稿时，使用以下格式：

```markdown
**设计稿参考**: #[[file:文档/开发文档/UI-原型/PRD20/联系人详情/概览页.html]]
```

---

## 3. 现状分析

### 3.1 界面现状

#### 3.1.1 概览页.html（OverviewTab）
**设计稿**: `文档/开发文档/UI-原型/PRD20/联系人详情/概览页.html`

- 采用iOS设计风格，使用系统字体和标准控件
- iOS分段控制器（Segmented Control）替代传统标签页
- 大头像设计（60x60pt），带有状态指示器
- Apple Health风格关系分数环形图表（双层圆环+Sparkline趋势图）
- 核心标签采用Emoji+马卡龙色胶囊样式
- 最新动态卡片（微信朋友圈/通知样式）
- 专属AI指令入口（iOS设置项风格）

#### 3.1.2 事实流页.html（FactStreamTab）
**设计稿**: `文档/开发文档/UI-原型/PRD20/联系人详情/事实流页.html`

- iOS风格头部导航，包含返回、标题和操作按钮
- 时光轴/清单双视图切换（分段控制器）
- 情绪类型筛选胶囊（全部/甜蜜/冲突/约会/AI总结）
- 时光轴视图：情绪节点+连接线+对话卡片
- 清单视图：日期分组+列表项
- 手动触发AI总结悬浮按钮

#### 3.1.3 画像库页.html（PersonaTab）
**设计稿**: `文档/开发文档/UI-原型/PRD20/联系人详情/画像库页.html`

- 白色背景的头部导航栏
- 四个标签页的段控件设计
- 搜索栏设计简洁
- 分类卡片（左侧色条区分）：兴趣爱好、工作信息、沟通策略
- 雷区标签区域（高/中/低风险）
- 策略标签区域（推荐操作）
- AI自动推测区域（采纳/拒绝操作）
- 添加标签悬浮按钮

#### 3.1.4 资料库页.html（DataVaultTab）
**设计稿**: `文档/开发文档/UI-原型/PRD20/联系人详情/资料库页.html`

- 统一背景色#F2F2F7
- 数据统计卡片带有装饰性背景
- 数据网格使用彩色图标区分不同类型（2列网格）
- 6种数据来源：聊天记录、AI总结、图片、语音、视频、文件
- 状态角标指示数据可用性
- 功能说明区域（媒体功能开发中提示）

#### 3.1.5 新建联系人页.html（CreateContactScreen）
**设计稿**: `文档/开发文档/UI-原型/PRD20/联系人详情/新建联系人页.html`

- 标准iOS导航栏设计（取消/完成）
- 圆形头像占位符（100x100pt）
- 表单采用分组样式（姓名、沟通目标）
- 添加画像事实按钮（绿色圆形图标）

### 3.2 存在问题
1. **视觉不一致性**：各界面间背景色、控件风格存在差异
2. **交互反馈不足**：缺乏适当的过渡动画和状态反馈
3. **信息层次不清晰**：重要信息与次要信息区分不明显
4. **图标风格不统一**：部分界面使用Material Symbols，部分使用Lucide
5. **色彩运用不协调**：各界面色彩体系不统一
6. **现有代码与设计稿差距大**：需要完全重写UI代码

---

## 4. 优化需求

### 4.1 概览页.html（OverviewTab）优化

**设计稿参考**: `文档/开发文档/UI-原型/PRD20/联系人详情/概览页.html`

#### 4.1.1 视觉优化
- **统一背景色**：#F2F2F7（iOS System Grouped Background）
- **iOS分段控制器**：替代传统标签页，参考设计稿第58-78行
- **个人信息卡片**：微信名片式设计，参考设计稿第83-108行
- **关系分数卡片**：Apple Health风格双层圆环，参考设计稿第111-165行
- **核心标签卡片**：Emoji+马卡龙色胶囊，参考设计稿第168-195行
- **最新动态卡片**：微信朋友圈/通知样式，参考设计稿第198-238行
- **专属指令卡片**：iOS设置项风格，参考设计稿第241-260行

#### 4.1.2 交互优化
- 分段控制器滑块平滑过渡动画
- 卡片点击反馈效果（active:scale-[0.98]）
- 淡入动画（fadeInUp，错落延迟）

#### 4.1.3 代码映射
- ContactDetailTabScreen.kt: 四标签页主容器
- OverviewTab.kt: 概览标签页
- DynamicEmotionalHeader.kt: 动态情感头部
- TopTagsSection.kt: 核心标签区域
- LatestFactHookCard.kt: 最新动态卡片
- CustomPromptCard.kt: 专属指令卡片

### 4.2 事实流页.html（FactStreamTab）优化

**设计稿参考**: `文档/开发文档/UI-原型/PRD20/联系人详情/事实流页.html`

#### 4.2.1 视觉优化
- **统一图标库**：Material Symbols Outlined
- **时光轴视图**：情绪节点+连接线，参考设计稿第100-200行
- **清单视图**：日期分组+列表项，参考设计稿第350-450行
- **情绪节点颜色**：6种EmotionType枚举，参考设计稿第35-40行
- **筛选胶囊**：激活/未激活状态，参考设计稿第55-70行

#### 4.2.2 交互优化
- 视图切换动画（时光轴/清单）
- 列表项进入动画（fadeIn + animation-delay）
- 筛选胶囊点击反馈

#### 4.2.3 代码映射
- FactStreamTab.kt: 事实流标签页
- TimelineView.kt: 时光轴视图
- ListView.kt: 清单视图
- EmotionNode.kt: 情绪节点组件
- FactCard.kt: 事实卡片组件

### 4.3 画像库页.html（PersonaTab）优化

**设计稿参考**: `文档/开发文档/UI-原型/PRD20/联系人详情/画像库页.html`

#### 4.3.1 视觉优化
- **统一背景色**：#F5F5F7
- **分类卡片**：左侧4px色条，参考设计稿第80-130行
- **标签胶囊**：莫兰迪色系，参考设计稿第95-110行
- **雷区/策略标签**：带图标和描述的列表项，参考设计稿第150-220行
- **AI推测区域**：列表样式+确认/拒绝按钮，参考设计稿第230-290行

#### 4.3.2 交互优化
- 分类卡片折叠/展开动画
- AI推测标签采纳/拒绝反馈
- 标签添加/删除动画

#### 4.3.3 代码映射
- PersonaTab.kt: 画像标签页
- CategoryCard.kt: 分类卡片组件
- TagChip.kt: 标签胶囊组件
- RiskTagItem.kt: 雷区标签项
- StrategyTagItem.kt: 策略标签项
- AiInferenceSection.kt: AI推测区域

### 4.4 资料库页.html（DataVaultTab）优化

**设计稿参考**: `文档/开发文档/UI-原型/PRD20/联系人详情/资料库页.html`

#### 4.4.1 视觉优化
- **统一背景色**：#F2F2F7
- **数据统计卡片**：装饰性背景+数字展示，参考设计稿第45-65行
- **数据网格**：2列网格布局，参考设计稿第70-150行
- **状态角标**：4种DataStatus枚举，参考设计稿第155-180行

#### 4.4.2 交互优化
- 卡片悬停和点击效果（hover:border-xxx-200 hover:shadow-lg）
- 数据加载状态提示

#### 4.4.3 代码映射
- DataVaultTab.kt: 资料库标签页
- DataSourceCard.kt: 数据来源卡片组件
- StatusBadge.kt: 状态角标组件

### 4.5 新建联系人页.html（CreateContactScreen）优化

**设计稿参考**: `文档/开发文档/UI-原型/PRD20/联系人详情/新建联系人页.html`

#### 4.5.1 视觉优化
- **导航栏**：iOS标准样式（取消/完成），参考设计稿第20-25行
- **头像区域**：圆形占位符+添加照片按钮，参考设计稿第30-45行
- **表单卡片**：分组样式+输入框，参考设计稿第50-75行
- **添加事实按钮**：绿色圆形图标，参考设计稿第80-90行

#### 4.5.2 交互优化
- 表单输入实时反馈
- 头像上传交互流程
- 保存操作反馈机制

#### 4.5.3 代码映射
- CreateContactScreen.kt: 新建联系人页面
- AvatarPicker.kt: 头像选择组件
- ContactForm.kt: 联系人表单组件

---

## 5. 设计原则

### 5.1 视觉设计原则
- **一致性**：保持各界面间的视觉风格统一，使用相同的色彩、字体和间距
- **层次性**：通过色彩、大小、间距建立清晰的信息层次
- **简洁性**：去除不必要的视觉元素，突出核心内容
- **美观性**：在保持功能性的基础上提升视觉美感

### 5.2 交互设计原则
- **反馈性**：为所有交互操作提供适当的视觉反馈
- **流畅性**：添加过渡动画，提升操作体验的流畅度
- **直观性**：保持交互逻辑的简单和直观
- **可达性**：确保所有用户都能轻松使用界面功能

### 5.3 技术实现原则
- **性能优先**：确保优化不会影响界面加载和响应性能
- **兼容性**：保持与现有技术架构的兼容
- **可维护性**：使用标准化的设计规范，便于后续维护
- **扩展性**：为未来功能扩展预留设计空间

---

## 6. 具体优化细节

### 6.1 色彩统一
- 主背景色：#F2F2F7（iOS System Grouped Background）
- 卡片背景：#FFFFFF（纯白）
- 主要文字：#1C1C1E / #000000（深灰/黑色）
- 次要文字：#8E8E93（中灰）
- 分割线：#C6C6C8 / #E5E5EA（浅灰）
- 品牌色：#007AFF（iOS蓝）
- 成功色：#34C759（iOS绿）
- 警告色：#FF9500（iOS橙）
- 错误色：#FF3B30（iOS红）

### 6.2 间距统一
- 页面边距：16px
- 卡片间距：16px（space-y-4）
- 卡片内边距：16px
- 元素间距：8px
- 文字行高：1.4倍
- 按钮高度：44px（符合iOS触摸标准）

### 6.3 字体统一
- 主要字体：-apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif
- 标题字重：600-700（semibold/bold）
- 正文字重：400（normal）
- 辅助文字字重：400-500（normal/medium）

### 6.4 图标统一
- 统一使用Material Symbols Outlined
- 图标尺寸：16px、18px、20px、22px、24px
- 图标颜色：跟随文字颜色或使用品牌色
- 填充图标：font-variation-settings: 'FILL' 1

### 6.5 圆角统一
- iOS卡片：14px（ios-card）
- 大卡片：16px-20px（card-elevated）
- 胶囊标签：完全圆润（rounded-full）
- 分段控制器：8px-10px
- 图标容器：7px-14px

### 6.6 动画统一
- 过渡时间：0.2s（快速）、0.3s（标准）、0.4s（慢速）
- 缓动函数：ease-out / cubic-bezier(0.4, 0, 0.2, 1)
- 淡入动画：fadeInUp（opacity + translateY）
- 点击反馈：active:scale-[0.98] / active:scale-95

---

## 7. 验收标准

### 7.1 视觉验收标准
- [ ] 所有界面使用统一的背景色#F2F2F7
- [ ] 所有卡片使用统一的白色背景和圆角
- [ ] 文字颜色、大小、字重符合设计规范
- [ ] 图标风格统一，全部使用Material Symbols
- [ ] 间距和对齐符合设计规范
- [ ] 适配不同屏幕尺寸，响应式布局正确
- [ ] **视觉效果与HTML设计文件完全一致**

### 7.2 交互验收标准
- [ ] 所有交互操作都有适当的视觉反馈
- [ ] 过渡动画流畅自然，时长符合规范
- [ ] 操作逻辑简单直观，易于理解
- [ ] 交互元素尺寸符合iOS触摸标准（44pt）
- [ ] 手势操作响应准确，无延迟
- [ ] **交互效果与HTML设计文件完全一致**

### 7.3 功能验收标准
- [ ] 所有原有功能正常工作
- [ ] 信息展示准确，层次清晰
- [ ] 搜索、筛选等功能响应及时
- [ ] 表单验证逻辑正确，提示明确
- [ ] 数据加载状态显示准确
- [ ] **功能表现与HTML设计文件完全一致**

### 7.4 设计一致性指标
- 与HTML设计文件的视觉匹配度达到**100%**
- 交互效果与设计稿的一致性达到**100%**
- 跨界面设计元素统一性达到**100%**

---

## 8. 风险评估

### 8.1 技术风险
- **兼容性风险**：新UI可能与旧版本系统存在兼容性问题
- **性能风险**：复杂动画可能影响低端设备的性能表现
- **实现风险**：部分设计效果可能难以在Compose中完美还原

### 8.2 用户体验风险
- **学习成本**：界面变化可能增加用户的学习成本
- **习惯改变**：交互流程的改变可能影响用户习惯
- **期望落差**：优化效果可能达不到用户期望

### 8.3 风险缓解措施
- 分阶段实施，逐步验证优化效果
- 保留用户反馈渠道，及时调整优化方向
- 进行充分的兼容性测试，确保稳定性
- 提供用户引导，降低学习成本

---

## 9. 实施计划

### 9.1 开发阶段
1. **第一阶段**：概览页.html（OverviewTab）优化
2. **第二阶段**：事实流页.html（FactStreamTab）优化
3. **第三阶段**：画像库页.html（PersonaTab）优化
4. **第四阶段**：资料库页.html（DataVaultTab）优化
5. **第五阶段**：新建联系人页.html（CreateContactScreen）优化

### 9.2 测试阶段
1. **单元测试**：各界面组件功能测试
2. **集成测试**：界面间交互和数据流测试
3. **兼容性测试**：不同设备和系统版本测试
4. **用户体验测试**：真实用户使用场景测试
5. **设计一致性测试**：与HTML设计文件的对比验证

### 9.3 发布阶段
1. **内部测试**：团队内部全面测试
2. **灰度发布**：小范围用户测试
3. **全量发布**：全面上线推广
4. **效果评估**：收集用户反馈，持续优化

---

## 10. 成功指标

### 10.1 用户体验指标
- 用户满意度评分提升20%
- 界面操作完成率提升15%
- 用户停留时长增加10%
- 用户反馈问题数量减少30%

### 10.2 技术性能指标
- 界面加载时间不超过2秒
- 动画帧率保持在60fps
- 内存占用增加不超过10%
- 崩溃率降低至0.1%以下

### 10.3 业务价值指标
- 用户活跃度提升15%
- 功能使用率提升20%
- 用户留存率提升10%
- 应用评分提升0.5分

---

## 11. 关联文档

### 11.1 设计稿文件
- `文档/开发文档/UI-原型/PRD20/联系人详情/README.md` - 设计规范说明
- `文档/开发文档/UI-原型/PRD20/联系人详情/概览页.html` - 概览页设计稿
- `文档/开发文档/UI-原型/PRD20/联系人详情/事实流页.html` - 事实流页设计稿
- `文档/开发文档/UI-原型/PRD20/联系人详情/画像库页.html` - 画像库页设计稿
- `文档/开发文档/UI-原型/PRD20/联系人详情/资料库页.html` - 资料库页设计稿
- `文档/开发文档/UI-原型/PRD20/联系人详情/新建联系人页.html` - 新建联系人页设计稿

### 11.2 相关PRD
- PRD-00019 - 联系人列表页优化

### 11.3 代码文件
- `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/` - 联系人相关UI

---

**文档版本**: 2.0  
**创建日期**: 2025-12-25  
**最后更新**: 2025-12-25  
**负责人**: 产品团队  
**审核人**: 设计团队、开发团队
