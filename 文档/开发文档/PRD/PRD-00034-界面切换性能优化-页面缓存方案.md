# PRD-00034ï¼šç•Œé¢åˆ‡æ¢æ€§èƒ½ä¼˜åŒ– - é¡µé¢ç¼“å­˜æ–¹æ¡ˆ

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| æ–‡æ¡£ç¼–å· | PRD-00034 |
| åˆ›å»ºæ—¥æœŸ | 2026-01-10 |
| å…³è”BUG | BUG-00060 |
| ä¼˜å…ˆçº§ | P0 (æœ€é«˜) |
| çŠ¶æ€ | ğŸ“‹ å¾…å®ç° |
| é¢„ä¼°å·¥æ—¶ | 2-3å¤© |

---

## 1. é—®é¢˜èƒŒæ™¯

### 1.1 ç°è±¡æè¿°

ç”¨æˆ·åœ¨åº”ç”¨å†…è¿›è¡Œç•Œé¢åˆ‡æ¢æ—¶ï¼Œä¼šå‡ºç°æ˜æ˜¾çš„**é»‘å±é—ªåŠ¨**ç°è±¡ï¼š

1. ç‚¹å‡»åº•éƒ¨å¯¼èˆªåˆ‡æ¢Tabæ—¶ï¼Œå±å¹•çŸ­æš‚é»‘å±
2. è¿›å…¥å¤æ‚é¡µé¢ï¼ˆå¦‚ã€Œè®¾ç½®ã€ï¼‰æ—¶ï¼Œé»‘å±æ›´ä¸¥é‡
3. æ•´ä½“åˆ‡æ¢ä¸æµç•…ï¼Œæœ‰æ˜æ˜¾å¡é¡¿å’Œé—ªçƒ

### 1.2 æ ¹å› åˆ†æ

ç»è¿‡æ·±åº¦è°ƒç ”ï¼Œé—®é¢˜ç”±ä»¥ä¸‹åŸå› é€ æˆï¼š

| åŸå›  | å½±å“ç¨‹åº¦ | è¯´æ˜ |
|------|----------|------|
| **Navigation Compose é»˜è®¤è¡Œä¸º** | é«˜ | NavHoståœ¨åˆ‡æ¢æ—¶è§¦å‘é¡µé¢é‡å»ºä¸é»˜è®¤æ·¡å…¥æ·¡å‡ºå åŠ  |
| **é¡µé¢æ¯æ¬¡é‡å»º** | é«˜ | åº•éƒ¨å¯¼èˆªåˆ‡æ¢æ—¶ï¼Œé¡µé¢è¢«é”€æ¯å†é‡å»º |
| **fadeIn/fadeOutåŠ¨ç”»** | ä¸­ | æ·¡å…¥æ·¡å‡ºæ—¶éœ²å‡ºé»‘è‰²èƒŒæ™¯ |
| **å¤æ‚é¡µé¢é¦–å¸§æ¸²æŸ“æ…¢** | ä¸­ | ViewModelåˆ›å»ºã€æ•°æ®åŠ è½½é˜»å¡æ¸²æŸ“ |

> è¯´æ˜ï¼šé¡¹ç›®å½“å‰ `navigation-compose` ç‰ˆæœ¬ä¸º 2.8.5ï¼Œéœ€ä»¥ç°æœ‰ç‰ˆæœ¬è¡Œä¸ºä¸ºå‡†éªŒè¯åŠ¨ç”»è¦†ç›–ä¸é‡å»ºç»†èŠ‚ã€‚

### 1.3 å‚è€ƒèµ„æ–™

- [Compose Navigation 2.7.3 åŠ¨ç”»ä¿®å¤](https://openillumi.com/en/en-compose-navigation-273-animation-fix/)
- [StackOverflow: åº•éƒ¨å¯¼èˆªå¡é¡¿é—®é¢˜](https://stackoverflow.com/questions/69806098/)
- å¾®ä¿¡ã€æ”¯ä»˜å®ç­‰æˆç†Ÿåº”ç”¨çš„åˆ‡æ¢ä½“éªŒ

---

## 2. è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ

### 2.1 æ–¹æ¡ˆæ€»è§ˆ

| ä¼˜åŒ–é¡¹ | ä¼˜å…ˆçº§ | æ•ˆæœ | å¤æ‚åº¦ | é˜¶æ®µ |
|--------|--------|------|--------|------|
| ä¿®å¤NavHoståŠ¨ç”»é…ç½® | P0 | æ¶ˆé™¤é»˜è®¤æ·¡å…¥æ·¡å‡ºå¯¼è‡´çš„é—ªçƒ | ä½ | Phase 1 |
| åº•éƒ¨å¯¼èˆªé¡µé¢ç¼“å­˜ | P0 | æ¶ˆé™¤Tabåˆ‡æ¢æ—¶çš„é‡å»ºé»‘å± | ä¸­ | Phase 2 |
| ä¼˜åŒ–åŠ¨ç”»æ—¶é•¿å’Œæ›²çº¿ | P1 | è®©åˆ‡æ¢æ›´æµç•… | ä½ | Phase 1 |
Â·| æ·»åŠ é¡µé¢éª¨æ¶å± | P2 | å¤æ‚é¡µé¢é¦–æ¬¡åŠ è½½ä½“éªŒ | ä¸­ | Phase 3 |

### 2.2 èŒƒå›´ç¡®è®¤

å½“å‰åº•éƒ¨å¯¼èˆªTabèŒƒå›´ä»¥ç°æœ‰å®ç°ä¸ºå‡†ï¼š

- è”ç³»äººï¼ˆCONTACT_LISTï¼‰
- AIå†›å¸ˆï¼ˆAI_ADVISORï¼‰
- è®¾ç½®ï¼ˆSETTINGSï¼‰

å¦‚éœ€å°† BrainTag çº³å…¥åº•éƒ¨Tabï¼Œéœ€å¦è¡Œäº§å“ç¡®è®¤å¹¶è°ƒæ•´å¯¼èˆªç»“æ„ã€‚

### 2.3 é¢„æœŸæ•ˆæœ

- **åˆ‡æ¢å»¶è¿Ÿ**: ä» 300-500ms é™ä½åˆ° < 100ms
- **é»‘å±ç°è±¡**: å®Œå…¨æ¶ˆé™¤
- **ç”¨æˆ·ä½“éªŒ**: è¾¾åˆ°å¾®ä¿¡çº§åˆ«çš„æµç•…åº¦

---

## 3. Phase 1ï¼šä¿®å¤åŠ¨ç”»é…ç½®ï¼ˆå¿«é€Ÿä¿®å¤ï¼‰

### 3.1 é—®é¢˜ä»£ç 

å½“å‰ `AnimationSpec.kt` ä½¿ç”¨äº† `slideInHorizontally + fadeIn` ç»„åˆï¼š

```kotlin
// å½“å‰ä»£ç  - æœ‰é—®é¢˜
val PageEnterTransition = slideInHorizontally(...) + fadeIn(...)
val PageExitTransition = slideOutHorizontally(...) + fadeOut(...)
```

**é—®é¢˜**ï¼š`fadeIn/fadeOut` ä¼šå¯¼è‡´èƒŒæ™¯éœ²å‡ºï¼Œäº§ç”Ÿé»‘å±ã€‚

### 3.2 ä¿®å¤æ–¹æ¡ˆ

**ä¿®æ”¹æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/theme/AnimationSpec.kt`

```kotlin
object AnimationSpec {
    // ç¼©çŸ­åŠ¨ç”»æ—¶é•¿
    const val DurationPageEnter = 200  // åŸ300ms
    const val DurationPageExit = 150   // åŸ250ms

    /**
     * é¡µé¢è¿›å…¥è½¬åœº - åªç”¨æ»‘åŠ¨ï¼Œç§»é™¤æ·¡å…¥
     */
    val PageEnterTransition = androidx.compose.animation.slideInHorizontally(
        initialOffsetX = { fullWidth -> fullWidth },
        animationSpec = tween(DurationPageEnter, easing = FastOutSlowInEasing)
    )

    /**
     * é¡µé¢é€€å‡ºè½¬åœº - åªæ»‘å‡º1/4ï¼Œç§»é™¤æ·¡å‡º
     */
    val PageExitTransition = androidx.compose.animation.slideOutHorizontally(
        targetOffsetX = { fullWidth -> -fullWidth / 4 },
        animationSpec = tween(DurationPageExit, easing = FastOutSlowInEasing)
    )

    /**
     * è¿”å›è¿›å…¥è½¬åœº
     */
    val PagePopEnterTransition = androidx.compose.animation.slideInHorizontally(
        initialOffsetX = { fullWidth -> -fullWidth / 4 },
        animationSpec = tween(DurationPageEnter, easing = FastOutSlowInEasing)
    )

    /**
     * è¿”å›é€€å‡ºè½¬åœº
     */
    val PagePopExitTransition = androidx.compose.animation.slideOutHorizontally(
        targetOffsetX = { fullWidth -> fullWidth },
        animationSpec = tween(DurationPageExit, easing = FastOutSlowInEasing)
    )
}
```

### 3.3 å…³é”®æ”¹åŠ¨

1. **ç§»é™¤ `fadeIn()` å’Œ `fadeOut()`** - è¿™æ˜¯é»‘å±çš„ä¸»è¦åŸå› 
2. **ç¼©çŸ­åŠ¨ç”»æ—¶é•¿** - 200ms/150ms æ›´æµç•…
3. **é€€å‡ºæ—¶åªæ»‘åŠ¨1/4** - æ¨¡æ‹ŸiOSçš„å±‚å æ•ˆæœ

---

## 4. Phase 2ï¼šåº•éƒ¨å¯¼èˆªé¡µé¢ç¼“å­˜ï¼ˆæ ¸å¿ƒä¼˜åŒ–ï¼‰

### 4.1 æ ¸å¿ƒæ€è·¯

å½“å‰é—®é¢˜ï¼šæ¯æ¬¡åˆ‡æ¢åº•éƒ¨Tabï¼Œé¡µé¢éƒ½ä¼šè¢«**é”€æ¯é‡å»º**ï¼Œå¯¼è‡´ï¼š
- ViewModelé‡æ–°åˆ›å»º
- æ•°æ®é‡æ–°åŠ è½½
- Composeæ ‘é‡æ–°æ„å»º
- é»‘å±ç­‰å¾…æ¸²æŸ“å®Œæˆ

è§£å†³æ–¹æ¡ˆï¼š**è®©åº•éƒ¨Tabé¡µé¢ä¿æŒåœ¨å†…å­˜ä¸­ï¼Œåªåˆ‡æ¢å¯è§æ€§**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BottomNavScaffold                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚Contacts â”‚ â”‚Advisor  â”‚ â”‚Settings â”‚                     â”‚
â”‚  â”‚(visible)â”‚ â”‚(hidden) â”‚ â”‚(hidden) â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                          â”‚
â”‚  æ‰€æœ‰é¡µé¢éƒ½åœ¨å†…å­˜ä¸­ï¼Œåªåˆ‡æ¢ visible çŠ¶æ€                  â”‚
â”‚  åˆ‡æ¢æ—¶ä¸é‡å»ºï¼Œç¬é—´å®Œæˆ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 é¡µé¢ç¼“å­˜å®ç°åŸåˆ™

1. **ä¿æŒç»„åˆ**ï¼šéšè—é¡µé¢æ—¶ä¸ç§»å‡ºç»„åˆæ ‘
2. **æ— æ·¡å…¥æ·¡å‡º**ï¼šé¿å…é»‘å±æš´éœ²
3. **æ‡’åŠ è½½**ï¼šæœªè®¿é—®é¡µé¢ä¸åˆ›å»º
4. **çŠ¶æ€æ¢å¤**ï¼šä½¿ç”¨ `SaveableStateHolder` ä¿æŒUIçŠ¶æ€
5. **è®¿é—®è®°å½•**ï¼š`visitedTabs` ä½¿ç”¨ `List<String>`ï¼ˆä¾¿äº `rememberSaveable` ä¿å­˜ï¼‰

### 4.3 æ–°å¢æ–‡ä»¶

**æ–‡ä»¶è·¯å¾„**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/navigation/BottomNavScaffold.kt`

æ ¸å¿ƒç­–ç•¥ï¼š

- ä½¿ç”¨ `SaveableStateHolder` ä¿å­˜é¡µé¢çŠ¶æ€
- ç”¨ `alpha`/`graphicsLayer` æ§åˆ¶å¯è§æ€§
- å±è”½ä¸å¯è§é¡µé¢çš„è§¦æ‘¸äº‹ä»¶
- å¯è§é¡µé¢æå‡å±‚çº§ï¼ˆ`zIndex`ï¼‰é¿å…éšè—é¡µé¢é®æŒ¡ç‚¹å‡»

ç¤ºä¾‹ç»“æ„ï¼ˆç¤ºæ„ï¼‰ï¼š

```kotlin
@Composable
private fun TabContentHost(
    route: String,
    visible: Boolean,
    content: @Composable () -> Unit
) {
    Box(
        modifier = Modifier
            .fillMaxSize()
            .alpha(if (visible) 1f else 0f)
    ) {
        content()
    }
}
```

---

### 4.4 æ¶æ„æ‹†åˆ†ï¼ˆç»“æ„åŒ–ä¼˜åŒ–ï¼‰

ä¸ºé¿å… NavHost æœªæŒ‚è½½å¯¼è‡´çš„å¯¼èˆªå¼‚å¸¸ï¼Œå¹¶å‡å°‘ Tab è·¯ç”±é‡å¤æ¸²æŸ“ï¼Œæ‹†åˆ†ä¸ºï¼š

- `NavGraph`ï¼šå®Œæ•´è·¯ç”±ï¼ˆä¿ç•™ startDestinationï¼‰
- `NonTabNavGraph`ï¼šåªæ‰¿è½½é Tab è·¯ç”±ï¼ŒTab è·¯ç”±æ¸²æŸ“å ä½

ä¸»æµç¨‹ï¼š

1. ä¸»ç•Œé¢å§‹ç»ˆæŒ‚è½½ `NonTabNavGraph`ï¼Œä¿è¯ `navigate(...)` å¯ç”¨  
2. ä¸» Tab åŒºåŸŸç”± `BottomNavScaffold` æ‰¿è½½  
3. Tab è·¯ç”±åœ¨é Tab å›¾ä¸­æ¸²æŸ“ç©ºå†…å®¹ï¼Œé¿å…é‡å¤ UI

---

## 5. Phase 2ï¼šé‡æ„ MainActivity

### 5.1 æ¶æ„å˜æ›´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MainActivity                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  isInMainTab == true?                                   â”‚
â”‚       â”‚                                                  â”‚
â”‚       â”œâ”€â”€ YES â”€â”€â†’ BottomNavScaffold (é¡µé¢ç¼“å­˜)          â”‚
â”‚       â”‚           â”œâ”€â”€ ContactListScreen                 â”‚
â”‚       â”‚           â”œâ”€â”€ AiAdvisorScreen                   â”‚
â”‚       â”‚           â””â”€â”€ SettingsScreen                    â”‚
â”‚       â”‚                                                  â”‚
â”‚       â””â”€â”€ NO â”€â”€â”€â†’ NonTabNavGraph (éTabå¯¼èˆª)            â”‚
â”‚                   â”œâ”€â”€ ContactDetailTabScreen            â”‚
â”‚                   â”œâ”€â”€ AiAdvisorChatScreen               â”‚
â”‚                   â”œâ”€â”€ AiConfigScreen                    â”‚
â”‚                   â””â”€â”€ ...å…¶ä»–é¡µé¢                        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ä¿®æ”¹æ–‡ä»¶

**æ–‡ä»¶è·¯å¾„**: `app/src/main/java/com/empathy/ai/ui/MainActivity.kt`

æ ¸å¿ƒåŸåˆ™ï¼š

- åº•éƒ¨Tabç”± `BottomNavScaffold` æ‰¿è½½
- éTabé¡µé¢ä½¿ç”¨ `NonTabNavGraph`
- Tabåˆ‡æ¢åªä¿®æ”¹ `currentTab`

---

## 6. ä»»åŠ¡æ¸…å•

### 6.1 Phase 1 ä»»åŠ¡ï¼ˆå¿«é€Ÿä¿®å¤ï¼‰

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | æ–‡ä»¶ | é¢„ä¼°æ—¶é—´ |
|--------|----------|------|----------|
| T1-01 | ä¿®æ”¹åŠ¨ç”»æ—¶é•¿å¸¸é‡ | AnimationSpec.kt | 5min |
| T1-02 | ç§»é™¤fadeIn/fadeOut | AnimationSpec.kt | 10min |
| T1-03 | è°ƒæ•´æ»‘åŠ¨åç§»é‡ | AnimationSpec.kt | 5min |
| T1-04 | æµ‹è¯•éªŒè¯ | - | 15min |

### 6.2 Phase 2 ä»»åŠ¡ï¼ˆé¡µé¢ç¼“å­˜ï¼‰

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | æ–‡ä»¶ | é¢„ä¼°æ—¶é—´ |
|--------|----------|------|----------|
| T2-01 | åˆ›å»ºBottomNavTabæšä¸¾ | BottomNavTab.kt | 10min |
| T2-02 | å®ç°BottomNavScaffold | BottomNavScaffold.kt | 30min |
| T2-03 | å®ç°TabContentç»„ä»¶ | BottomNavScaffold.kt | 15min |
| T2-04 | é‡æ„MainActivity | MainActivity.kt | 45min |
| T2-05 | è°ƒæ•´ContactList/Settingsåº•éƒ¨å¯¼èˆª | å¤šä¸ªScreenæ–‡ä»¶ | 30min |
| T2-06 | é›†æˆæµ‹è¯• | - | 30min |

### 6.3 Phase 3 ä»»åŠ¡ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | æ–‡ä»¶ | é¢„ä¼°æ—¶é—´ |
|--------|----------|------|----------|
| T3-01 | è®¾è®¡éª¨æ¶å±ç»„ä»¶ | SkeletonScreen.kt | 30min |
| T3-02 | ä¸ºSettingsScreenæ·»åŠ éª¨æ¶å± | SettingsScreen.kt | 20min |
| T3-03 | ä¸ºContactListScreenæ·»åŠ éª¨æ¶å± | ContactListScreen.kt | 20min |

---

## 7. æµ‹è¯•ç”¨ä¾‹

### 7.1 TC-001: åº•éƒ¨Tabåˆ‡æ¢æ— é»‘å±

**å‰ç½®æ¡ä»¶**: åº”ç”¨å·²å¯åŠ¨ï¼Œåœ¨è”ç³»äººåˆ—è¡¨é¡µ

**æ­¥éª¤**:
1. ç‚¹å‡»åº•éƒ¨ã€ŒAIå†›å¸ˆã€Tab
2. ç‚¹å‡»åº•éƒ¨ã€Œè®¾ç½®ã€Tab
3. ç‚¹å‡»åº•éƒ¨ã€Œè”ç³»äººã€Tab

**é¢„æœŸç»“æœ**:
- æ¯æ¬¡åˆ‡æ¢éƒ½åº”è¯¥ç¬é—´å®Œæˆï¼ˆ< 100msï¼‰
- ä¸åº”è¯¥å‡ºç°ä»»ä½•é»‘å±é—ªçƒ
- é¡µé¢çŠ¶æ€åº”è¯¥ä¿æŒï¼ˆå¦‚æ»šåŠ¨ä½ç½®ï¼‰

### 7.2 TC-002: é¡µé¢çŠ¶æ€ä¿æŒ

**å‰ç½®æ¡ä»¶**: åº”ç”¨å·²å¯åŠ¨

**æ­¥éª¤**:
1. åœ¨è”ç³»äººåˆ—è¡¨æ»šåŠ¨åˆ°ä¸­é—´ä½ç½®
2. åˆ‡æ¢åˆ°è®¾ç½®Tab
3. åˆ‡æ¢å›è”ç³»äººTab

**é¢„æœŸç»“æœ**:
- è”ç³»äººåˆ—è¡¨åº”è¯¥ä¿æŒåœ¨ä¹‹å‰çš„æ»šåŠ¨ä½ç½®
- ä¸åº”è¯¥é‡æ–°åŠ è½½æ•°æ®

### 7.3 TC-003: æ‡’åŠ è½½éªŒè¯

**å‰ç½®æ¡ä»¶**: åº”ç”¨åˆšå¯åŠ¨

**æ­¥éª¤**:
1. è§‚å¯Ÿå†…å­˜ä½¿ç”¨
2. åˆ‡æ¢åˆ°è®¾ç½®Tab
3. å†æ¬¡è§‚å¯Ÿå†…å­˜ä½¿ç”¨

**é¢„æœŸç»“æœ**:
- å¯åŠ¨æ—¶åªåŠ è½½è”ç³»äººé¡µé¢
- åˆ‡æ¢åˆ°è®¾ç½®æ—¶æ‰åŠ è½½è®¾ç½®é¡µé¢
- å†…å­˜ä½¿ç”¨åˆç†å¢é•¿

### 7.4 TC-004: éTabé¡µé¢å¯¼èˆªæ­£å¸¸

**å‰ç½®æ¡ä»¶**: åº”ç”¨å·²å¯åŠ¨

**æ­¥éª¤**:
1. ç‚¹å‡»æŸä¸ªè”ç³»äººè¿›å…¥è¯¦æƒ…é¡µ
2. ç‚¹å‡»è¿”å›
3. è¿›å…¥è®¾ç½® â†’ AIé…ç½®

**é¢„æœŸç»“æœ**:
- éTabé¡µé¢ä½¿ç”¨æ ‡å‡†å¯¼èˆªåŠ¨ç”»
- è¿”å›æ—¶åº•éƒ¨TabçŠ¶æ€æ­£ç¡®
- å¯¼èˆªæ ˆæ­£å¸¸å·¥ä½œ

### 7.5 TC-005: é…ç½®å˜æ›´åçŠ¶æ€æ¢å¤

**å‰ç½®æ¡ä»¶**: åº”ç”¨å·²å¯åŠ¨ï¼Œåˆ‡æ¢è¿‡å¤šä¸ªTab

**æ­¥éª¤**:
1. æ—‹è½¬å±å¹•ï¼ˆæˆ–åˆ‡æ¢æ·±è‰²æ¨¡å¼ï¼‰
2. è§‚å¯Ÿå½“å‰TabçŠ¶æ€

**é¢„æœŸç»“æœ**:
- å½“å‰é€‰ä¸­çš„Tabåº”è¯¥ä¿æŒ
- å·²è®¿é—®çš„TabçŠ¶æ€åº”è¯¥æ¢å¤

---

## 8. é£é™©è¯„ä¼°

| é£é™©é¡¹ | ç­‰çº§ | è¯´æ˜ | ç¼“è§£æªæ–½ |
|--------|------|------|----------|
| å†…å­˜å ç”¨å¢åŠ  | ä¸­ | 3ä¸ªTabé¡µé¢éƒ½åœ¨å†…å­˜ä¸­ | ä½¿ç”¨æ‡’åŠ è½½ï¼Œåªæ¸²æŸ“è®¿é—®è¿‡çš„Tab |
| å¯¼èˆªé€»è¾‘å¤æ‚åŒ– | ä¸­ | ä¸¤å¥—å¯¼èˆªé€»è¾‘å¹¶å­˜ | æ¸…æ™°çš„isInMainTabåˆ¤æ–­ |
| ViewModelä½œç”¨åŸŸå˜åŒ– | ä¸­ | Tabè¿ç§»åç”Ÿå‘½å‘¨æœŸå˜é•¿ | è¯„ä¼°ä¾èµ–å¹¶å¿…è¦æ—¶ç‹¬ç«‹Store |
| æµ‹è¯•è¦†ç›– | ä½ | éœ€è¦æ–°å¢æµ‹è¯•ç”¨ä¾‹ | æŒ‰æµ‹è¯•ç”¨ä¾‹é€ä¸€éªŒè¯ |

---

## 9. ç›¸å…³æ–‡ä»¶æ¸…å•

### 9.1 éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹ç±»å‹ | è¯´æ˜ |
|----------|----------|------|
| `presentation/.../theme/AnimationSpec.kt` | ä¿®æ”¹ | ä¼˜åŒ–åŠ¨ç”»é…ç½® |
| `app/.../ui/MainActivity.kt` | é‡æ„ | å®ç°é¡µé¢ç¼“å­˜æ¶æ„ |

### 9.2 éœ€è¦æ–°å¢çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|----------|------|
| `presentation/.../navigation/BottomNavTab.kt` | åº•éƒ¨å¯¼èˆªæšä¸¾ |
| `presentation/.../navigation/BottomNavScaffold.kt` | é¡µé¢ç¼“å­˜Scaffoldç»„ä»¶ |
| `presentation/.../navigation/NonTabNavGraph.kt` | éTabå¯¼èˆªå›¾ |

### 9.3 å¯èƒ½éœ€è¦è°ƒæ•´çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|----------|------|
| `presentation/.../screen/contact/ContactListScreen.kt` | è°ƒæ•´åº•éƒ¨å¯¼èˆªæ¸²æŸ“ |
| `presentation/.../screen/settings/SettingsScreen.kt` | è°ƒæ•´åº•éƒ¨å¯¼èˆªæ¸²æŸ“ |

---

## 10. éªŒæ”¶æ ‡å‡†

### 10.1 åŠŸèƒ½éªŒæ”¶

- [ ] åº•éƒ¨Tabåˆ‡æ¢æ— é»‘å±é—ªçƒ
- [ ] åˆ‡æ¢å»¶è¿Ÿ < 100ms
- [ ] é¡µé¢çŠ¶æ€æ­£ç¡®ä¿æŒ
- [ ] éTabé¡µé¢å¯¼èˆªæ­£å¸¸
- [ ] é…ç½®å˜æ›´åçŠ¶æ€æ¢å¤

### 10.2 æ€§èƒ½éªŒæ”¶

- [ ] å†…å­˜å ç”¨å¢åŠ  < 20MB
- [ ] é¦–æ¬¡å¯åŠ¨æ—¶é—´æ— æ˜æ˜¾å¢åŠ 
- [ ] æ— å†…å­˜æ³„æ¼

### 10.3 å…¼å®¹æ€§éªŒæ”¶

- [ ] Android 7.0+ æ­£å¸¸è¿è¡Œ
- [ ] ä¸åŒå±å¹•å°ºå¯¸æ­£å¸¸æ˜¾ç¤º
- [ ] æ·±è‰²/æµ…è‰²æ¨¡å¼æ­£å¸¸åˆ‡æ¢

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.2
**æœ€åæ›´æ–°**: 2026-01-10
**æ›´æ–°å†…å®¹**: å¢åŠ NonTabNavGraphç»“æ„åŒ–ä¼˜åŒ–ä¸è§¦æ§å±‚çº§ç­–ç•¥


---

## 11. è¡¥å……ä¼˜åŒ–ç­–ç•¥ï¼ˆåŸºäº2026å¹´ç ”ç©¶æŠ¥å‘Šï¼‰

> ä»¥ä¸‹å†…å®¹åŸºäºã€Š2026å¹´ Android Compose Navigation æ€§èƒ½ä¼˜åŒ–ä¸æ¶æ„æ¼”è¿›æ·±åº¦ç ”ç©¶æŠ¥å‘Šã€‹

### 11.1 ä¼˜åŒ–ä¼˜å…ˆçº§çŸ©é˜µ

| ä¼˜åŒ–é¡¹ | æ”¶ç›Š | é£é™© | å·¥æ—¶ | å»ºè®®ä¼˜å…ˆçº§ |
|--------|------|------|------|------------|
| åŠ¨ç”»Lambda Modifiers | é«˜ | ä½ | 2h | **P0 - ç«‹å³** |
| LazyColumn Keyæ£€æŸ¥ | é«˜ | ä½ | 1h | **P0 - ç«‹å³** |
| ç§»é™¤fadeIn/fadeOut | é«˜ | ä½ | 30min | **P0 - ç«‹å³** |
| Baseline Profiles | å¾ˆé«˜ | ä½ | 1å¤© | **P1 - æœ¬å‘¨** |
| åº•éƒ¨å¯¼èˆªé¡µé¢ç¼“å­˜ | å¾ˆé«˜ | ä¸­ | 2-3å¤© | **P1 - æœ¬å‘¨** |
| ç±»å‹å®‰å…¨è·¯ç”± | ä¸­ | ä¸­ | 3-5å¤© | **P2 - ä¸‹å‘¨** |
| è¿ç§»Nav3 | å¾ˆé«˜ | é«˜ | 2å‘¨+ | **P3 - é•¿æœŸ** |
| å…±äº«å…ƒç´ è½¬åœº | ä¸­ | ä¸­ | 3å¤© | **P3 - é•¿æœŸ** |

### 11.2 P0çº§ä¼˜åŒ–ï¼šLambda Modifiers

**é—®é¢˜**ï¼šåœ¨åŠ¨ç”»æœŸé—´ï¼Œå¦‚æœåœ¨ç»„åˆé˜¶æ®µè¯»å–çŠ¶æ€ï¼Œä¼šå¯¼è‡´æ¯å¸§éƒ½é‡ç»„ã€‚

**ä¿®å¤æ–¹å¼**ï¼š
```kotlin
// âŒ é”™è¯¯ - æ¯å¸§éƒ½é‡ç»„
Box(modifier = Modifier.offset(x = animatedOffset.dp, y = 0.dp))

// âœ… æ­£ç¡® - åªåœ¨å¸ƒå±€é˜¶æ®µè¯»å–
Box(modifier = Modifier.offset { IntOffset(animatedOffset.roundToInt(), 0) })

// âœ… æ›´ä¼˜ - ä½¿ç”¨ graphicsLayerï¼ˆGPUåŠ é€Ÿï¼‰
Box(modifier = Modifier.graphicsLayer {
    translationX = animatedOffset
    alpha = animatedAlpha
})
```

**æ”¶ç›Š**ï¼šå‡å°‘åŠ¨ç”»æœŸé—´çš„é‡ç»„æ¬¡æ•°ï¼Œå¸§ç‡æå‡ 20-30%

### 11.3 P0çº§ä¼˜åŒ–ï¼šLazyColumn Key

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] ContactListScreen çš„è”ç³»äººåˆ—è¡¨
- [ ] SessionHistoryScreen çš„ä¼šè¯åˆ—è¡¨
- [ ] AiAdvisorChatScreen çš„æ¶ˆæ¯åˆ—è¡¨
- [ ] SettingsScreen çš„è®¾ç½®é¡¹åˆ—è¡¨

**æ­£ç¡®ç¤ºä¾‹**ï¼š
```kotlin
LazyColumn {
    items(
        items = contacts,
        key = { contact -> contact.id }  // å¿…é¡»æŒ‡å®š
    ) { contact ->
        ContactItem(contact)
    }
}
```

### 11.4 P1çº§ä¼˜åŒ–ï¼šBaseline Profiles

**å®æ–½æ­¥éª¤**ï¼š

1. æ·»åŠ  benchmark æ¨¡å—åˆ° `settings.gradle.kts`
2. åˆ›å»º `BaselineProfileGenerator.kt`
3. è¦†ç›–æ ¸å¿ƒå¯¼èˆªè·¯å¾„ï¼š
   - å¯åŠ¨ â†’ è”ç³»äººåˆ—è¡¨
   - è”ç³»äººåˆ—è¡¨ â†’ è”ç³»äººè¯¦æƒ…
   - åº•éƒ¨Tabåˆ‡æ¢
   - è®¾ç½® â†’ AIé…ç½®
4. ç”Ÿæˆ `baseline-prof.txt`
5. æ‰“åŒ…è¿› Release APK

**é¢„æœŸæ”¶ç›Š**ï¼šé¦–æ¬¡å¯¼èˆª TTID é™ä½ 30-40%

### 11.5 é•¿æœŸè§„åˆ’ï¼šNavigation 3 è¿ç§»è·¯å¾„

**Phase 1 - ç±»å‹å®‰å…¨åŒ–**ï¼ˆå¯å…ˆè¡Œï¼‰
```kotlin
// å½“å‰æ–¹å¼
navController.navigate("contact_detail_tab/$contactId")

// ç›®æ ‡æ–¹å¼
@Serializable
data class ContactDetailTab(val contactId: String)
navController.navigate(ContactDetailTab(contactId))
```

**Phase 2 - çŠ¶æ€ä¸Šæ**
- å°†å¯¼èˆªé€»è¾‘ä» UI å±‚ç§»åˆ° ViewModel æˆ– AppState

**Phase 3 - æ›¿æ¢å¼•æ“**
- `NavHost` â†’ `NavDisplay`
- `NavController` â†’ `SnapshotStateList<NavKey>`

### 11.6 æ€§èƒ½ç›‘æ§æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡é˜ˆå€¼ | è¯´æ˜ |
|------|----------|------|
| TTID (é¦–å¸§è€—æ—¶) | < 500ms | ä»ç‚¹å‡»åˆ°é¦–å¸§æ˜¾ç¤º |
| TTFD (å…¨å±è€—æ—¶) | < 1s | å†…å®¹å®Œå…¨åŠ è½½ |
| FrameDuration P99 | < 8ms (120Hz) | åŠ¨ç”»æµç•…åº¦ |
| FrameOverrun | < 0ms | è´Ÿå€¼=ä¼˜ç§€ï¼Œæ­£å€¼=ä¸¢å¸§ |

---

## 12. å®æ–½è·¯çº¿å›¾

### æœ¬å‘¨ï¼ˆPhase 1ï¼‰
- [ ] T1-01: ä¿®æ”¹ AnimationSpec.ktï¼Œç§»é™¤ fadeIn/fadeOut
- [ ] T1-02: æ£€æŸ¥æ‰€æœ‰ LazyColumn çš„ key å‚æ•°
- [ ] T1-03: å°†åŠ¨ç”»å±æ€§æ”¹ä¸º Lambda Modifiers

### ä¸‹å‘¨ï¼ˆPhase 2ï¼‰
- [ ] T2-01~T2-06: å®æ–½åº•éƒ¨å¯¼èˆªé¡µé¢ç¼“å­˜æ–¹æ¡ˆ
- [ ] T2-07: æ·»åŠ  Baseline Profiles

### åç»­ï¼ˆPhase 3ï¼‰
- [ ] ç±»å‹å®‰å…¨è·¯ç”±æ”¹é€ 
- [ ] å…³æ³¨ Nav3 ç¨³å®šç‰ˆå‘å¸ƒ
- [ ] è§„åˆ’ Nav3 è¿ç§»

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.2
**æœ€åæ›´æ–°**: 2026-01-10
**æ›´æ–°å†…å®¹**: è¡¥å……åŸºäº2026å¹´ç ”ç©¶æŠ¥å‘Šçš„ä¼˜åŒ–ç­–ç•¥
