# PRD-00036-区域截图功能需求

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 文档类型 | PRD (Product Requirements Document) |
| 文档编号 | PRD-00036 |
| 功能名称 | 悬浮窗区域截图输入 |
| 版本 | 1.3 |
| 创建日期 | 2026-01-12 |
| 作者 | Codex |
| 审核人 | 待定 |
| 关联文档 | PRD-00009-悬浮窗功能重构需求，PRD-00026-AI军师对话功能需求 |

## 2. 产品概述

### 2.1 背景

用户在第三方聊天应用中需要快速补充上下文，让 AI 理解对话内容。对方发来图片或视频时，用户希望通过截图把关键画面快速传给 AI。

### 2.2 目标

1. 支持在任意 App 中通过悬浮窗快速截取指定区域并插入当前会话输入框  
2. 降低操作成本，避免跳转系统截图或相册  
3. 保证截图为临时附件，发送后自动清理，降低隐私风险  

### 2.3 目标用户

- 在微信/QQ/短信等应用中频繁需要 AI 辅助的用户  
- 需要对图片或视频画面进行描述/分析的用户  

### 2.4 使用场景

- 对方发来图片，用户截取关键区域给 AI 说明  
- 对方发来视频，用户截取单帧画面给 AI 说明  

## 3. 功能需求

### 3.1 入口与权限（P0）

**入口**：悬浮窗新增“区域截图”图标  

**权限**：
- 需要系统截图/录屏权限（MediaProjection）  
- 首次启用提示用户进入设置页授权  
- 允许系统限制导致“每次截图都需弹窗确认”的降级体验  

### 3.2 区域截图交互（P0）

1. 触发截图后，悬浮窗自动隐藏  
2. 全屏半透明遮罩覆盖，用户拖拽空白区域生成矩形取景框  
3. 拖拽过程中实时确定取景框大小，松手即截图  
4. 不记忆上次取景框位置/大小  

### 3.3 连续截屏（P1）

- 设置项：**连续截屏**（默认关闭）  
- 开启后：截图完成后遮罩保留 1.5s，允许再次拖拽截取  
- 超时 1.5s 无操作自动退出截图模式  
- 多次截图全部追加到输入框缩略图列表  

### 3.4 输入框插入与展示（P0）

- 截图完成后直接插入当前悬浮窗会话输入框  
- 输入框上方展示可删除的缩略图列表  
- 单次消息最多 5 张截图  
- 超过上限时自动丢弃最新截图  
- 用户可删除任意截图  

### 3.5 模型兼容与降级（P0）

- 用户可选择模型  
- 本地判断所选模型是否支持图片理解  
- 不支持图片时：发送请求不包含截图附件  
- 需要给出明确提示，避免用户误以为图片已发送  
- 提示文案：当前模型不支持图片理解，已仅发送文字内容  

### 3.6 发送与清理（P0）

- 截图仅作为当前消息的临时附件  
- 消息发送成功后自动清理本地截图文件  
- 不进入事实流，不做长期保存  

### 3.7 图片压缩策略（P1）

- 截图上传前做压缩处理  
- 长边限制 1280px  
- 质量 0.85，目标体积 <= 1MB  
- 若仍超标，质量降到 0.7  

### 3.8 取消与退出（P0）

- 未完成拖拽时，截图模式在 1.5s 内无操作自动退出  
- 退出后悬浮窗恢复显示  

## 4. 用户流程

1. 用户点击悬浮窗“区域截图”图标  
2. 弹出授权提示（首次）→ 允许截图  
3. 屏幕半透明遮罩 → 拖拽框选 → 松手截图  
4. 截图自动插入输入框缩略图列表  
5. 用户补充文字并发送  
6. 发送成功，截图文件自动清理  

## 5. UI 设计

### 5.1 截图遮罩示意

```
┌─────────────────────────────────────────┐
│ ██████████████████████████████████████ │
│ ████████  ┌──────────────────────┐ ███ │
│ ████████  │      取景框区域       │ ███ │
│ ████████  └──────────────────────┘ ███ │
│ ██████████████████████████████████████ │
└─────────────────────────────────────────┘
说明：全屏半透明遮罩，取景框区域挖空
```

### 5.2 输入框缩略图列表

```
┌─────────────────────────────────────────┐
│ [缩略图1][缩略图2][缩略图3]  (×可删)    │
├─────────────────────────────────────────┤
│  输入框（用户补充文字）                 │
└─────────────────────────────────────────┘
```

## 6. 规则与边界

- 仅支持截图图片，不支持录屏或视频上传  
- 不提供图片编辑/裁剪/标注  
- 截图上传前进行压缩（长边 1280px，质量 0.85，目标 <= 1MB，超标降至 0.7）  
- 不自动发送，必须用户补充文字后手动发送  
- 若权限不足或系统限制，每次截图允许弹窗确认  
- 模型不支持图片时不发送截图，并提示用户  

## 7. 风险与隐私

- 截图可能包含敏感信息 → 必须作为临时文件处理  
- 发送后清理本地缓存，避免长期留存  
- 若模型不支持图片输入，需要在后续技术设计中确定降级策略  

## 8. 验收标准

### 8.1 功能验收

- [ ] 悬浮窗入口可触发区域截图  
- [ ] 拖拽框选松手即截图并插入输入框  
- [ ] 缩略图列表可删除  
- [ ] 单次最多 5 张，超出丢弃最新  
- [ ] 发送后自动清理截图文件  
- [ ] 连续截屏开启后 1.5s 内可多次截图  

### 8.2 体验验收

- [ ] 截图时悬浮窗自动隐藏  
- [ ] 退出截图后悬浮窗自动恢复  
- [ ] 权限引导清晰可理解  

### 8.3 兼容性验收

- [ ] Android 10+ 可用  
- [ ] 任意 App 界面均可触发截图  

## 9. 开发计划（建议）

1. 悬浮窗入口与权限引导  
2. 区域截图遮罩与拖拽交互  
3. 输入框缩略图列表与删除  
4. 发送时附件上传与本地清理  
5. 连续截屏设置项与 1.5s 逻辑  

## 10. 待确认

- 模型对图片输入的支持范围与降级提示文案  
