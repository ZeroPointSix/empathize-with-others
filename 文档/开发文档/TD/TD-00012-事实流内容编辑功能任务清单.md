# TD-00012: 事实流内容编辑功能任务清单

---
**文档类型**: TD (Task Document) - 开发过程文档  
**存放规范**: 符合项目宪法第IV条 - 文档规范  
**版本控制**: Git管理，见.commit钩子  
---

## 1. 文档信息

| 项目 | 内容 |
|------|------|
| 文档类型 | TD (Task Document) |
| 文档编号 | TD-00012 |
| 功能名称 | 事实流内容编辑功能 |
| 版本 | 1.0 |
| 创建日期 | 2025-12-20 |
| 作者 | Kiro |
| 关联文档 | PRD-00012, FD-00012, TDD-00012 |

---

## 2. 任务概览

| 阶段 | 任务数 | 预计工时 | 状态 |
|------|--------|----------|------|
| 阶段一：数据模型扩展 | 5 | 4h | ⬜ 待开始 |
| 阶段二：数据库迁移 | 4 | 3h | ⬜ 待开始 |
| 阶段三：UseCase实现 | 6 | 6h | ⬜ 待开始 |
| 阶段四：UI组件开发 | 8 | 8h | ⬜ 待开始 |
| 阶段五：ViewModel集成 | 4 | 4h | ⬜ 待开始 |
| 阶段六：依赖注入配置 | 2 | 1h | ⬜ 待开始 |
| 阶段七：单元测试 | 6 | 6h | ⬜ 待开始 |
| 阶段八：集成测试与UI测试 | 6 | 6h | ⬜ 待开始 |
| **总计** | **41** | **38h (约5天)** | **0/41 完成** |

---

## 3. 阶段一：数据模型扩展（4h）

### 任务 1.1：扩展 Fact 模型添加编辑字段
- **文件**：`domain/model/Fact.kt`
- **内容**：
  - 新增字段：isUserModified, lastModifiedTime, originalKey, originalValue
  - 实现 copyWithEdit() 方法
  - 实现 hasChanges() 方法
  - 实现 formatLastModifiedTime() 方法
- **验收标准**：
  - [ ] 字段定义完整，默认值正确
  - [ ] copyWithEdit() 首次编辑保存原始值，再次编辑保留首次原始值
  - [ ] hasChanges() 正确判断内容变化
  - [ ] 单元测试通过
- **状态**：⬜ 待开始

### 任务 1.2：扩展 ConversationLog 模型添加编辑字段
- **文件**：`domain/model/ConversationLog.kt`
- **内容**：
  - 新增字段：isUserModified, lastModifiedTime, originalUserInput
  - 实现 copyWithEdit() 方法
  - 实现 hasChanges() 方法
  - 实现 formatLastModifiedTime() 方法
- **验收标准**：
  - [ ] 字段定义完整，默认值正确
  - [ ] copyWithEdit() 逻辑正确
  - [ ] 单元测试通过
- **状态**：⬜ 待开始

### 任务 1.3：扩展 DailySummary 模型添加编辑字段
- **文件**：`domain/model/DailySummary.kt`
- **内容**：
  - 新增字段：isUserModified, lastModifiedTime, originalContent
  - 实现 copyWithEdit() 方法
  - 实现 hasChanges() 方法
  - 实现 formatLastModifiedTime() 方法
- **验收标准**：
  - [ ] 字段定义完整，默认值正确
  - [ ] copyWithEdit() 逻辑正确
  - [ ] 单元测试通过
- **状态**：⬜ 待开始

### 任务 1.4：扩展 ContactProfile 模型添加编辑字段
- **文件**：`domain/model/ContactProfile.kt`
- **内容**：
  - 新增字段：isNameUserModified, isGoalUserModified, nameLastModifiedTime, goalLastModifiedTime, originalName, originalGoal
  - 实现 copyWithNameEdit() 方法
  - 实现 copyWithGoalEdit() 方法
  - 实现 hasNameChanges() 和 hasGoalChanges() 方法
- **验收标准**：
  - [ ] 字段定义完整，默认值正确
  - [ ] 姓名和目标分别追踪编辑状态
  - [ ] 单元测试通过
- **状态**：⬜ 待开始

### 任务 1.5：创建 EditResult 密封类
- **文件**：`domain/model/EditResult.kt`
- **内容**：
  - 定义五种结果：Success, ValidationError, DatabaseError, NotFound, NoChanges
  - 实现 isSuccess() 方法
  - 实现 getErrorMessage() 方法
- **验收标准**：
  - [ ] 密封类定义完整
  - [ ] 错误消息用户友好
  - [ ] 单元测试通过
- **状态**：⬜ 待开始

---

## 4. 阶段二：数据库迁移（3h）

### 任务 2.1：扩展 ContactProfileEntity
- **文件**：`data/local/entity/ContactProfileEntity.kt`
- **内容**：
  - 新增字段：is_name_user_modified, is_goal_user_modified, name_last_modified_time, goal_last_modified_time, original_name, original_goal
  - 设置默认值
- **验收标准**：
  - [ ] 字段定义正确
  - [ ] 默认值设置正确（Boolean默认0，Long默认0，String默认NULL）
- **状态**：⬜ 待开始

### 任务 2.2：扩展 ConversationLogEntity 和 DailySummaryEntity
- **文件**：`data/local/entity/ConversationLogEntity.kt`, `data/local/entity/DailySummaryEntity.kt`
- **内容**：
  - ConversationLogEntity：新增 is_user_modified, last_modified_time, original_user_input
  - DailySummaryEntity：新增 is_user_modified, last_modified_time, original_content
  - 设置默认值
- **验收标准**：
  - [ ] 字段定义正确
  - [ ] 默认值设置正确
- **状态**：⬜ 待开始

### 任务 2.3：创建 Migration 9→10
- **文件**：`data/local/AppDatabase.kt`
- **内容**：
  - 实现 MIGRATION_9_10
  - 为 contact_profiles 表添加6个新字段
  - 为 conversation_logs 表添加3个新字段
  - 为 daily_summaries 表添加3个新字段
  - 更新数据库版本号为10
- **验收标准**：
  - [ ] Migration 脚本正确
  - [ ] 现有数据不丢失
  - [ ] 新字段有正确默认值
- **状态**：⬜ 待开始

### 任务 2.4：扩展 DAO 添加更新方法
- **文件**：`data/local/dao/ContactDao.kt`, `data/local/dao/ConversationLogDao.kt`, `data/local/dao/DailySummaryDao.kt`
- **内容**：
  - ContactDao：新增 updateName(), updateGoal() 方法
  - ConversationLogDao：新增 updateUserInput(), getById() 方法
  - DailySummaryDao：新增 updateContent(), getById() 方法
  - 使用部分更新SQL，仅更新必要字段
- **验收标准**：
  - [ ] SQL语句正确
  - [ ] 使用CASE WHEN保留首次原始值
  - [ ] 返回受影响行数
- **状态**：⬜ 待开始

---

## 5. 阶段三：UseCase实现（6h）

### 任务 3.1：创建 ContentValidator 内容验证服务
- **文件**：`domain/util/ContentValidator.kt`
- **内容**：
  - 实现 validateFactKey() - 最大50字，不能为空
  - 实现 validateFactValue() - 最大500字，不能为空
  - 实现 validateConversation() - 最大1000字，不能为空
  - 实现 validateSummary() - 最大2000字，不能为空
  - 实现 validateContactName() - 最大50字，不能为空
  - 实现 validateContactGoal() - 最大200字，不能为空
  - 定义 ValidationResult 密封类
- **验收标准**：
  - [ ] 所有验证方法正确
  - [ ] 错误消息用户友好
  - [ ] 单元测试覆盖所有边界情况
- **状态**：⬜ 待开始

### 任务 3.2：创建 EditFactUseCase
- **文件**：`domain/usecase/EditFactUseCase.kt`
- **内容**：
  - 注入 ContactRepository, ContentValidator, IoDispatcher
  - 实现 invoke(contactId, factId, newKey, newValue) 方法
  - 流程：验证输入 → 获取联系人 → 查找事实 → 检查变化 → 创建副本 → 保存
  - 返回 Result<EditResult>
- **验收标准**：
  - [ ] 完整流程正确执行
  - [ ] 验证失败返回 ValidationError
  - [ ] 数据不存在返回 NotFound
  - [ ] 无变化返回 NoChanges
  - [ ] 单元测试通过
- **状态**：⬜ 待开始

### 任务 3.3：创建 EditConversationUseCase
- **文件**：`domain/usecase/EditConversationUseCase.kt`
- **内容**：
  - 注入 ConversationRepository, ContentValidator, IoDispatcher
  - 实现 invoke(logId, newContent) 方法
  - 使用 IdentityPrefixHelper.parse() 解析身份前缀
  - 流程：解析前缀 → 验证内容 → 获取记录 → 检查变化 → 更新
  - 返回 Result<EditResult>
- **验收标准**：
  - [ ] 正确处理身份前缀
  - [ ] 完整流程正确执行
  - [ ] 单元测试通过
- **状态**：⬜ 待开始

### 任务 3.4：创建 EditSummaryUseCase
- **文件**：`domain/usecase/EditSummaryUseCase.kt`
- **内容**：
  - 注入 DailySummaryRepository, ContentValidator, IoDispatcher
  - 实现 invoke(summaryId, newContent) 方法
  - 流程：验证内容 → 获取总结 → 检查变化 → 更新
  - 返回 Result<EditResult>
- **验收标准**：
  - [ ] 完整流程正确执行
  - [ ] 单元测试通过
- **状态**：⬜ 待开始

### 任务 3.5：创建 EditContactInfoUseCase
- **文件**：`domain/usecase/EditContactInfoUseCase.kt`
- **内容**：
  - 注入 ContactRepository, ContentValidator, IoDispatcher
  - 实现 editName(contactId, newName) 方法
  - 实现 editGoal(contactId, newGoal) 方法
  - 返回 Result<EditResult>
- **验收标准**：
  - [ ] 姓名和目标分别编辑
  - [ ] 完整流程正确执行
  - [ ] 单元测试通过
- **状态**：⬜ 待开始

### 任务 3.6：扩展 Repository 接口和实现
- **文件**：`domain/repository/ContactRepository.kt`, `domain/repository/ConversationRepository.kt`, `domain/repository/DailySummaryRepository.kt` 及其实现
- **内容**：
  - ContactRepository：新增 updateName(), updateGoal() 方法
  - ConversationRepository：新增 updateUserInput(), getById() 方法
  - DailySummaryRepository：新增 updateContent(), getById() 方法
  - 实现类中添加对应实现
- **验收标准**：
  - [ ] 接口方法定义完整
  - [ ] 实现类正确调用DAO
  - [ ] Entity ↔ Domain 映射正确
- **状态**：⬜ 待开始

---

## 6. 阶段四：UI组件开发（8h）

### 任务 4.1：创建 EditFactDialog 事实编辑对话框
- **文件**：`presentation/ui/component/dialog/EditFactDialog.kt`
- **内容**：
  - 显示事实来源和时间信息
  - 事实类型下拉选择（预设类型 + 自定义输入）
  - 事实内容多行输入（最多500字）
  - 字符计数显示
  - 实时验证和错误提示
  - 查看原始内容功能（已编辑时）
  - 删除按钮（带二次确认）
  - 保存和取消按钮
- **验收标准**：
  - [ ] 预设类型：性格特点、兴趣爱好、工作信息、家庭情况、重要日期、禁忌话题、沟通策略、其他
  - [ ] 验证错误时保存按钮禁用
  - [ ] 原始内容可展开/收起
  - [ ] 删除有二次确认
- **状态**：⬜ 待开始

### 任务 4.2：扩展 EditConversationDialog 对话编辑对话框
- **文件**：`presentation/ui/component/dialog/EditConversationDialog.kt`
- **内容**：
  - 扩展现有对话框
  - 显示对话时间信息
  - 保留身份前缀（"我："或"对方："）
  - 内容多行输入（最多1000字）
  - 字符计数显示
  - 实时验证和错误提示
  - 查看原始内容功能（已编辑时）
  - 删除按钮（带二次确认）
- **验收标准**：
  - [ ] 身份前缀正确保留
  - [ ] 验证错误时保存按钮禁用
  - [ ] 原始内容可展开/收起
- **状态**：⬜ 待开始

### 任务 4.3：创建 EditSummaryDialog 总结编辑对话框
- **文件**：`presentation/ui/component/dialog/EditSummaryDialog.kt`
- **内容**：
  - 显示日期范围和来源标识
  - 显示对话数量统计
  - 内容多行输入（最多2000字）
  - 字符计数显示
  - 实时验证和错误提示
  - 查看原始内容功能（已编辑时）
  - 保存和取消按钮
- **验收标准**：
  - [ ] 日期范围正确显示
  - [ ] 来源标识（AI生成/手动编辑）正确
  - [ ] 验证错误时保存按钮禁用
- **状态**：⬜ 待开始

### 任务 4.4：创建 EditContactNameDialog 联系人姓名编辑对话框
- **文件**：`presentation/ui/component/dialog/EditContactNameDialog.kt`
- **内容**：
  - 单行输入（最多50字）
  - 字符计数显示
  - 实时验证和错误提示
  - 保存和取消按钮
- **验收标准**：
  - [ ] 单行输入
  - [ ] 验证错误时保存按钮禁用
- **状态**：⬜ 待开始

### 任务 4.5：创建 EditContactGoalDialog 联系人目标编辑对话框
- **文件**：`presentation/ui/component/dialog/EditContactGoalDialog.kt`
- **内容**：
  - 多行输入（最多200字）
  - 字符计数显示
  - 实时验证和错误提示
  - 保存和取消按钮
- **验收标准**：
  - [ ] 多行输入
  - [ ] 验证错误时保存按钮禁用
- **状态**：⬜ 待开始

### 任务 4.6：创建 EditedBadge 已编辑标识徽章
- **文件**：`presentation/ui/component/state/EditedBadge.kt`
- **内容**：
  - 显示编辑图标和"已编辑"文字
  - 显示相对时间（刚刚、X分钟前、X小时前、X天前、MM-dd）
  - 样式：labelSmall，onSurfaceVariant颜色
- **验收标准**：
  - [ ] 相对时间计算正确
  - [ ] 样式符合设计规范
- **状态**：⬜ 待开始

### 任务 4.7：创建 DeleteConfirmDialog 删除确认对话框
- **文件**：`presentation/ui/component/dialog/DeleteConfirmDialog.kt`
- **内容**：
  - 显示警告图标
  - 显示标题和提示消息
  - 删除按钮（红色）和取消按钮
- **验收标准**：
  - [ ] 警告图标显示
  - [ ] 删除按钮为error颜色
- **状态**：⬜ 待开始

### 任务 4.8：集成编辑功能到现有UI组件
- **文件**：`presentation/ui/component/relationship/FactItem.kt`, `presentation/ui/screen/contact/factstream/ListViewRow.kt`, `presentation/ui/component/card/AiSummaryCard.kt`, `presentation/ui/screen/contact/overview/OverviewTab.kt`
- **内容**：
  - FactItem：添加点击编辑功能，显示EditedBadge
  - ListViewRow：对话项添加点击编辑功能，显示EditedBadge
  - AiSummaryCard：添加点击编辑功能，显示EditedBadge
  - OverviewTab：姓名和目标添加点击编辑功能
- **验收标准**：
  - [ ] 点击可编辑内容弹出对应编辑对话框
  - [ ] 已编辑内容显示EditedBadge
  - [ ] 编辑成功后UI自动刷新
- **状态**：⬜ 待开始

---

## 7. 阶段五：ViewModel集成（4h）

### 任务 5.1：扩展 ContactDetailUiEvent 添加编辑事件
- **文件**：`presentation/ui/screen/contact/ContactDetailUiEvent.kt`
- **内容**：
  - 事实编辑事件：StartEditFact, ConfirmEditFact, CancelEditFact, DeleteFact
  - 对话编辑事件：StartEditConversation, ConfirmEditConversation, CancelEditConversation, DeleteConversation
  - 总结编辑事件：StartEditSummary, ConfirmEditSummary, CancelEditSummary
  - 联系人信息编辑事件：StartEditContactName, ConfirmEditContactName, CancelEditContactName, StartEditContactGoal, ConfirmEditContactGoal, CancelEditContactGoal
  - 错误处理事件：ClearEditError, ClearEditSuccess
- **验收标准**：
  - [ ] 所有事件定义完整
  - [ ] 参数类型正确
- **状态**：⬜ 待开始

### 任务 5.2：扩展 ContactDetailTabViewModel 添加编辑状态
- **文件**：`presentation/viewmodel/ContactDetailTabViewModel.kt`
- **内容**：
  - 新增状态：editingFact, editingConversation, editingSummary, editingContactName, editingContactGoal, editError, editSuccess
  - 注入编辑相关UseCase
- **验收标准**：
  - [ ] 状态定义完整
  - [ ] UseCase正确注入
- **状态**：⬜ 待开始

### 任务 5.3：实现 ContactDetailTabViewModel 编辑事件处理
- **文件**：`presentation/viewmodel/ContactDetailTabViewModel.kt`
- **内容**：
  - 实现 onEvent() 中所有编辑事件的处理
  - 实现 editFact(), editConversation(), editSummary(), editContactName(), editContactGoal() 私有方法
  - 实现 handleEditResult() 统一处理编辑结果
  - 实现 deleteFact(), deleteConversation() 删除方法
  - 编辑成功后调用 refreshData() 刷新数据
- **验收标准**：
  - [ ] 所有事件处理正确
  - [ ] 编辑结果正确处理
  - [ ] 成功后UI自动刷新
  - [ ] 错误正确显示
- **状态**：⬜ 待开始

### 任务 5.4：集成编辑对话框到 ContactDetailTabScreen
- **文件**：`presentation/ui/screen/contact/ContactDetailTabScreen.kt`
- **内容**：
  - 根据ViewModel状态显示/隐藏编辑对话框
  - 传递事件给ViewModel
  - 显示编辑成功/失败提示（Snackbar）
- **验收标准**：
  - [ ] 对话框根据状态正确显示/隐藏
  - [ ] 事件正确传递
  - [ ] 成功/失败提示正确显示
- **状态**：⬜ 待开始

---

## 8. 阶段六：依赖注入配置（1h）

### 任务 6.1：创建 EditModule
- **文件**：`di/EditModule.kt`
- **内容**：
  - 提供 ContentValidator 单例
  - 提供 EditFactUseCase 单例
  - 提供 EditConversationUseCase 单例
  - 提供 EditSummaryUseCase 单例
  - 提供 EditContactInfoUseCase 单例
- **验收标准**：
  - [ ] 依赖注入配置正确
  - [ ] 单例作用域正确
- **状态**：⬜ 待开始

### 任务 6.2：更新 AppDatabase 配置
- **文件**：`data/local/AppDatabase.kt`
- **内容**：
  - 更新数据库版本号为 10
  - 添加 MIGRATION_9_10 到迁移列表
- **验收标准**：
  - [ ] 版本号正确
  - [ ] 迁移配置正确
- **状态**：⬜ 待开始

---

## 9. 阶段七：单元测试（6h）

### 任务 7.1：编写 ContentValidator 测试
- **文件**：`test/domain/util/ContentValidatorTest.kt`
- **内容**：
  - 测试所有验证方法的正常情况
  - 测试空字符串、超长字符串边界情况
  - 测试空白字符串（只有空格）
- **验收标准**：
  - [ ] 测试覆盖率 > 95%
  - [ ] 所有边界情况覆盖
- **状态**：⬜ 待开始

### 任务 7.2：编写 EditFactUseCase 测试
- **文件**：`test/domain/usecase/EditFactUseCaseTest.kt`
- **内容**：
  - 测试验证失败场景
  - 测试联系人不存在场景
  - 测试事实不存在场景
  - 测试内容无变化场景
  - 测试编辑成功场景
  - 测试数据库错误场景
- **验收标准**：
  - [x] 测试覆盖率 > 90%
  - [x] 所有分支覆盖
- **状态**：✅ 已完成
- **完成日期**：2025-12-20
- **测试数量**：31个测试全部通过

### 任务 7.3：编写 EditConversationUseCase 测试
- **文件**：`test/domain/usecase/EditConversationUseCaseTest.kt`
- **内容**：
  - 测试身份前缀解析
  - 测试验证失败场景
  - 测试记录不存在场景
  - 测试编辑成功场景
- **验收标准**：
  - [ ] 测试覆盖率 > 90%
- **状态**：⬜ 待开始

### 任务 7.4：编写 EditSummaryUseCase 测试
- **文件**：`test/domain/usecase/EditSummaryUseCaseTest.kt`
- **内容**：
  - 测试验证失败场景
  - 测试总结不存在场景
  - 测试编辑成功场景
- **验收标准**：
  - [ ] 测试覆盖率 > 90%
- **状态**：⬜ 待开始

### 任务 7.5：编写模型扩展方法测试
- **文件**：`test/domain/model/FactEditTest.kt`, `test/domain/model/ConversationLogEditTest.kt`, `test/domain/model/DailySummaryEditTest.kt`, `test/domain/model/ContactProfileEditTest.kt`
- **内容**：
  - 测试 copyWithEdit() 首次编辑保存原始值
  - 测试 copyWithEdit() 再次编辑保留首次原始值
  - 测试 hasChanges() 各种情况
- **验收标准**：
  - [ ] 测试覆盖率 100%
- **状态**：⬜ 待开始

### 任务 7.6：编写 EditResult 测试
- **文件**：`test/domain/model/EditResultTest.kt`
- **内容**：
  - 测试 isSuccess() 方法
  - 测试 getErrorMessage() 方法
- **验收标准**：
  - [ ] 测试覆盖率 100%
- **状态**：⬜ 待开始

---

## 10. 阶段八：集成测试与UI测试（6h）

### 任务 8.1：编写数据库迁移测试
- **文件**：`androidTest/data/local/DatabaseMigration9To10Test.kt`
- **内容**：
  - 测试 Migration 9→10 正确执行
  - 测试 contact_profiles 表新字段
  - 测试 conversation_logs 表新字段
  - 测试 daily_summaries 表新字段
  - 测试现有数据保留
  - 测试新字段默认值
- **验收标准**：
  - [ ] 迁移测试通过
  - [ ] 数据完整性验证
- **状态**：⬜ 待开始

### 任务 8.2：编写 EditFactDialog UI测试
- **文件**：`androidTest/presentation/ui/component/dialog/EditFactDialogTest.kt`
- **内容**：
  - 测试对话框正确显示事实信息
  - 测试空键显示错误
  - 测试空值显示错误
  - 测试超长输入显示错误
  - 测试验证错误时保存按钮禁用
  - 测试删除确认对话框
- **验收标准**：
  - [ ] UI测试通过
  - [ ] 交互测试覆盖
- **状态**：⬜ 待开始

### 任务 8.3：编写 EditSummaryDialog UI测试
- **文件**：`androidTest/presentation/ui/component/dialog/EditSummaryDialogTest.kt`
- **内容**：
  - 测试对话框正确显示总结信息
  - 测试空内容显示错误
  - 测试超长输入显示错误
  - 测试原始内容展开/收起
- **验收标准**：
  - [ ] UI测试通过
- **状态**：⬜ 待开始

### 任务 8.4：编写编辑流程端到端测试
- **文件**：`androidTest/presentation/ui/screen/contact/EditFlowIntegrationTest.kt`
- **内容**：
  - 测试点击事实 → 编辑 → 保存 → UI刷新完整流程
  - 测试点击对话 → 编辑 → 保存 → UI刷新完整流程
  - 测试点击总结 → 编辑 → 保存 → UI刷新完整流程
  - 测试编辑后显示EditedBadge
- **验收标准**：
  - [ ] 端到端流程验证
  - [ ] 状态正确更新
- **状态**：⬜ 待开始

### 任务 8.5：编写性能监控测试
- **文件**：`test/domain/util/EditPerformanceMonitorTest.kt`
- **内容**：
  - 测试编辑对话框打开时间 < 100ms
  - 测试保存操作响应时间 < 200ms
  - 测试数据库操作时间 < 50ms
  - 测试内存增量 < 5MB
  - 使用 PerformanceMonitor 记录性能指标
- **验收标准**：
  - [ ] 所有性能指标达标
  - [ ] 性能数据可追踪
- **状态**：⬜ 待开始

### 任务 8.6：编写错误恢复测试
- **文件**：`test/domain/usecase/EditErrorRecoveryTest.kt`
- **内容**：
  - 测试数据库写入失败后的恢复机制
  - 测试网络中断时的本地缓存保护
  - 测试并发编辑冲突的处理
  - 测试验证失败后的状态回滚
  - 测试异常情况下的用户提示
- **验收标准**：
  - [ ] 错误恢复机制正确
  - [ ] 数据一致性保证
  - [ ] 用户体验不受影响
- **状态**：⬜ 待开始

---

## 11. 开发注意事项

### 11.1 核心原则

1. **最小侵入**：扩展现有模型，不破坏已有功能
2. **单一职责**：每个UseCase只负责一种内容类型的编辑
3. **状态不可变**：使用data class的copy方法更新状态
4. **向后兼容**：新增字段使用默认值，旧数据正常显示

### 11.2 关键依赖

- 依赖 TDD-00003 的 Fact、ConversationLog、DailySummary、ContactProfile 模型
- 依赖 TDD-00008 的 IdentityPrefixHelper 处理对话编辑
- 复用现有的 EditConversationDialog 组件

### 11.3 性能要求

| 指标 | 目标值 |
|------|--------|
| 编辑对话框打开时间 | < 100ms |
| 保存操作响应时间 | < 200ms |
| 内存增量 | < 5MB |
| 数据库操作时间 | < 50ms |

### 11.4 验证规则汇总

| 内容类型 | 字段 | 最大长度 | 必填 |
|---------|------|---------|------|
| 事实 | key | 50 | 是 |
| 事实 | value | 500 | 是 |
| 对话 | userInput | 1000 | 是 |
| 总结 | content | 2000 | 是 |
| 联系人 | name | 50 | 是 |
| 联系人 | targetGoal | 200 | 是 |

---

## 12. 相关文档

- [PRD-00012-事实流内容编辑功能需求](../PRD/PRD-00012-事实流内容编辑功能需求.md)
- [FD-00012-事实流内容编辑功能设计](../FD/FD-00012-事实流内容编辑功能设计.md)
- [TDD-00012-事实流内容编辑功能技术设计](../TDD/TDD-00012-事实流内容编辑功能技术设计.md)

---

## 13. 修订历史

| 版本 | 日期 | 作者 | 修改内容 |
|------|------|------|----------|
| 1.0 | 2025-12-20 | Kiro | 初始版本 |
