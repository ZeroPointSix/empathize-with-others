# TD-00016: å¯¹è¯ä¸»é¢˜åŠŸèƒ½ä»»åŠ¡æ¸…å•

## æ–‡æ¡£ä¿¡æ¯

**æ–‡æ¡£ç¼–å·**: TD-00016  
**ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-12-22  
**æœ€åæ›´æ–°**: 2025-12-22  
**éœ€æ±‚æ–‡æ¡£**: `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/PRD/PRD-00016-å¯¹è¯ä¸»é¢˜åŠŸèƒ½éœ€æ±‚.md` (v1.0)  
**åŠŸèƒ½è®¾è®¡**: `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/FD/FD-00016-å¯¹è¯ä¸»é¢˜åŠŸèƒ½è®¾è®¡.md` (v1.1)  
**æŠ€æœ¯è®¾è®¡**: `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/TDD/TDD-00016-å¯¹è¯ä¸»é¢˜åŠŸèƒ½æŠ€æœ¯è®¾è®¡.md` (v1.0)  
**çŠ¶æ€**: â¬œ å¾…å¼€å§‹  
**è´Ÿè´£äºº**: Kiro  
**é¢„è®¡å·¥ä½œé‡**: 3ä¸ªå·¥ä½œæ—¥  
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­  
**å®é™…è¿›åº¦**: 0/27 ä»»åŠ¡å®Œæˆ (0%)

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´è¯´æ˜ |
|------|------|------|----------|
| 1.0 | 2025-12-22 | Kiro | åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºäºTDD-00016 v1.0 |

---

## å¼€å‘é˜¶æ®µæ˜ å°„

æ ¹æ®TDD-00016 v1.0ï¼Œæœ¬åŠŸèƒ½åˆ†ä¸º5ä¸ªå¼€å‘é˜¶æ®µï¼š

- **é˜¶æ®µ1**: æ•°æ®å±‚å®ç°ï¼ˆ4hï¼‰â¬œ å¾…å¼€å§‹
- **é˜¶æ®µ2**: é¢†åŸŸå±‚å®ç°ï¼ˆ3hï¼‰â¬œ å¾…å¼€å§‹
- **é˜¶æ®µ3**: è¡¨ç°å±‚å®ç°ï¼ˆ5hï¼‰â¬œ å¾…å¼€å§‹
- **é˜¶æ®µ4**: ç³»ç»Ÿé›†æˆï¼ˆ3hï¼‰â¬œ å¾…å¼€å§‹
- **é˜¶æ®µ5**: æµ‹è¯•å®Œå–„ï¼ˆ4hï¼‰â¬œ å¾…å¼€å§‹

**æ€»å·¥æœŸ**: 19å°æ—¶ï¼ˆçº¦3ä¸ªå·¥ä½œæ—¥ï¼‰

---

## å…³é”®è·¯å¾„

```
T1.1 â†’ T1.2 â†’ T1.3 â†’ T1.5 â†’ T2.1 â†’ T2.2 â†’ T2.3 â†’ T3.2 â†’ T4.1 â†’ T4.2
  â†“
æ•°æ®åº“å®ä½“ â†’ DAO â†’ AppDatabase â†’ Repository â†’ é¢†åŸŸæ¨¡å‹ â†’ ä»“åº“æ¥å£ â†’ UseCase â†’ ViewModel â†’ PromptBuilder â†’ UseCaseé›†æˆ
```

**å…³é”®ä»»åŠ¡æ ‡è®°**: ğŸ”‘ è¡¨ç¤ºå…³é”®è·¯å¾„ä¸Šçš„ä»»åŠ¡

---

## é˜¶æ®µ1: æ•°æ®å±‚å®ç° â¬œ å¾…å¼€å§‹

### 1.1 æ•°æ®åº“å®ä½“

- [ ] T1.1 [P0] [ğŸ”‘] åˆ›å»ºConversationTopicEntityå®ä½“ç±»
  - æ–‡ä»¶: `data/local/entity/ConversationTopicEntity.kt`
  - éªŒæ”¶: å®ä½“ç±»åŒ…å«æ‰€æœ‰å­—æ®µï¼Œæ”¯æŒä¸é¢†åŸŸæ¨¡å‹äº’è½¬

- [ ] T1.2 [P0] [ğŸ”‘] åˆ›å»ºConversationTopicDaoæ¥å£
  - æ–‡ä»¶: `data/local/dao/ConversationTopicDao.kt`
  - éªŒæ”¶: åŒ…å«insertã€updateã€deleteã€queryç­‰æ–¹æ³•

### 1.2 æ•°æ®åº“é…ç½®

- [ ] T1.3 [P0] [ğŸ”‘] æ›´æ–°AppDatabaseæ·»åŠ æ–°å®ä½“å’ŒDAO
  - æ–‡ä»¶: `data/local/AppDatabase.kt`
  - éªŒæ”¶: entitiesæ•°ç»„åŒ…å«ConversationTopicEntityï¼Œversionå‡çº§åˆ°11

- [ ] T1.4 [P0] [ğŸ”‘] ç¼–å†™MIGRATION_10_11è¿ç§»è„šæœ¬
  - æ–‡ä»¶: `data/local/AppDatabase.kt`
  - éªŒæ”¶: è¿ç§»è„šæœ¬åˆ›å»ºconversation_topicsè¡¨å’Œç´¢å¼•

### 1.3 ä»“åº“å®ç°

- [ ] T1.5 [P0] [ğŸ”‘] åˆ›å»ºTopicRepositoryImplå®ç°ç±»
  - æ–‡ä»¶: `data/repository/TopicRepositoryImpl.kt`
  - éªŒæ”¶: å®ç°TopicRepositoryæ¥å£æ‰€æœ‰æ–¹æ³•

- [ ] T1.6 [P1] æ›´æ–°DatabaseModuleæ·»åŠ DAOæä¾›æ–¹æ³•
  - æ–‡ä»¶: `di/DatabaseModule.kt`
  - éªŒæ”¶: æ·»åŠ provideConversationTopicDaoæ–¹æ³•å’Œè¿ç§»é…ç½®

### 1.4 é˜¶æ®µ1æµ‹è¯•

- [ ] T1.7 [P0] ç¼–å†™æ•°æ®åº“è¿ç§»æµ‹è¯•
  - æ–‡ä»¶: `test/.../data/local/Migration10To11Test.kt`
  - éªŒæ”¶: è¿ç§»æµ‹è¯•é€šè¿‡ï¼Œè¡¨ç»“æ„æ­£ç¡®

---

## é˜¶æ®µ2: é¢†åŸŸå±‚å®ç° â¬œ å¾…å¼€å§‹

### 2.1 é¢†åŸŸæ¨¡å‹

- [ ] T2.1 [P0] [ğŸ”‘] åˆ›å»ºConversationTopicé¢†åŸŸæ¨¡å‹
  - æ–‡ä»¶: `domain/model/ConversationTopic.kt`
  - éªŒæ”¶: åŒ…å«æ‰€æœ‰å±æ€§ã€éªŒè¯æ–¹æ³•å’Œé¢„è§ˆæ–¹æ³•

### 2.2 ä»“åº“æ¥å£

- [ ] T2.2 [P0] [ğŸ”‘] åˆ›å»ºTopicRepositoryæ¥å£
  - æ–‡ä»¶: `domain/repository/TopicRepository.kt`
  - éªŒæ”¶: å®šä¹‰æ‰€æœ‰æ•°æ®è®¿é—®æ–¹æ³•

### 2.3 ä¸šåŠ¡ç”¨ä¾‹

- [ ] T2.3 [P0] [ğŸ”‘] åˆ›å»ºSetTopicUseCase
  - æ–‡ä»¶: `domain/usecase/SetTopicUseCase.kt`
  - éªŒæ”¶: åŒ…å«è¾“å…¥éªŒè¯å’Œä¿å­˜é€»è¾‘

- [ ] T2.4 [P0] åˆ›å»ºGetTopicUseCase
  - æ–‡ä»¶: `domain/usecase/GetTopicUseCase.kt`
  - éªŒæ”¶: æ”¯æŒå•æ¬¡è·å–å’ŒFlowè§‚å¯Ÿ

- [ ] T2.5 [P0] åˆ›å»ºClearTopicUseCase
  - æ–‡ä»¶: `domain/usecase/ClearTopicUseCase.kt`
  - éªŒæ”¶: æ¸…é™¤æŒ‡å®šè”ç³»äººçš„æ´»è·ƒä¸»é¢˜

### 2.4 ä¾èµ–æ³¨å…¥

- [ ] T2.6 [P1] åˆ›å»ºTopicModuleä¾èµ–æ³¨å…¥æ¨¡å—
  - æ–‡ä»¶: `di/TopicModule.kt`
  - éªŒæ”¶: æä¾›Repositoryå’ŒUseCaseçš„ä¾èµ–

### 2.5 é˜¶æ®µ2æµ‹è¯•

- [ ] T2.7 [P0] ç¼–å†™UseCaseå•å…ƒæµ‹è¯•
  - æ–‡ä»¶: `test/.../domain/usecase/SetTopicUseCaseTest.kt`
  - æ–‡ä»¶: `test/.../domain/usecase/GetTopicUseCaseTest.kt`
  - æ–‡ä»¶: `test/.../domain/usecase/ClearTopicUseCaseTest.kt`
  - éªŒæ”¶: æ‰€æœ‰UseCaseæµ‹è¯•é€šè¿‡

---

## é˜¶æ®µ3: è¡¨ç°å±‚å®ç° â¬œ å¾…å¼€å§‹

### 3.1 çŠ¶æ€å®šä¹‰

- [ ] T3.1 [P0] åˆ›å»ºTopicUiStateå’ŒTopicUiEvent
  - æ–‡ä»¶: `presentation/viewmodel/TopicUiState.kt`
  - æ–‡ä»¶: `presentation/viewmodel/TopicUiEvent.kt`
  - éªŒæ”¶: çŠ¶æ€å’Œäº‹ä»¶å®šä¹‰å®Œæ•´

### 3.2 ViewModel

- [ ] T3.2 [P0] [ğŸ”‘] åˆ›å»ºTopicViewModel
  - æ–‡ä»¶: `presentation/viewmodel/TopicViewModel.kt`
  - éªŒæ”¶: å¤„ç†æ‰€æœ‰UIäº‹ä»¶ï¼Œç®¡ç†çŠ¶æ€

### 3.3 UIç»„ä»¶

- [ ] T3.3 [P0] åˆ›å»ºTopicSettingDialogç»„ä»¶
  - æ–‡ä»¶: `presentation/ui/component/topic/TopicSettingDialog.kt`
  - éªŒæ”¶: å¯¹è¯æ¡†UIå®Œæ•´ï¼Œæ”¯æŒä¿å­˜å’Œæ¸…é™¤

- [ ] T3.4 [P1] åˆ›å»ºTopicInputFieldç»„ä»¶
  - æ–‡ä»¶: `presentation/ui/component/topic/TopicInputField.kt`
  - éªŒæ”¶: è¾“å…¥æ¡†æ”¯æŒå­—ç¬¦è®¡æ•°å’Œé”™è¯¯æç¤º

- [ ] T3.5 [P1] åˆ›å»ºTopicBadgeç»„ä»¶
  - æ–‡ä»¶: `presentation/ui/component/topic/TopicBadge.kt`
  - éªŒæ”¶: å¾½ç« æ˜¾ç¤ºä¸»é¢˜çŠ¶æ€

- [ ] T3.6 [P2] åˆ›å»ºTopicHistorySectionç»„ä»¶
  - æ–‡ä»¶: `presentation/ui/component/topic/TopicHistorySection.kt`
  - éªŒæ”¶: æ˜¾ç¤ºå†å²ä¸»é¢˜åˆ—è¡¨

### 3.4 é˜¶æ®µ3æµ‹è¯•

- [ ] T3.7 [P1] ç¼–å†™ViewModelå•å…ƒæµ‹è¯•
  - æ–‡ä»¶: `test/.../presentation/viewmodel/TopicViewModelTest.kt`
  - éªŒæ”¶: ViewModelæµ‹è¯•é€šè¿‡

---

## é˜¶æ®µ4: ç³»ç»Ÿé›†æˆ â¬œ å¾…å¼€å§‹

### 4.1 æç¤ºè¯é›†æˆ

- [ ] T4.1 [P0] [ğŸ”‘] æ›´æ–°PromptBuilderæ·»åŠ buildWithTopicæ–¹æ³•
  - æ–‡ä»¶: `domain/util/PromptBuilder.kt`
  - éªŒæ”¶: æ”¯æŒå°†ä¸»é¢˜æ³¨å…¥ç³»ç»Ÿæç¤ºè¯

### 4.2 UseCaseé›†æˆ

- [ ] T4.2 [P0] [ğŸ”‘] æ›´æ–°AnalyzeChatUseCaseé›†æˆä¸»é¢˜
  - æ–‡ä»¶: `domain/usecase/AnalyzeChatUseCase.kt`
  - éªŒæ”¶: åˆ†ææ—¶è‡ªåŠ¨è·å–å¹¶ä½¿ç”¨ä¸»é¢˜

- [ ] T4.3 [P0] æ›´æ–°PolishDraftUseCaseé›†æˆä¸»é¢˜
  - æ–‡ä»¶: `domain/usecase/PolishDraftUseCase.kt`
  - éªŒæ”¶: æ¶¦è‰²æ—¶è‡ªåŠ¨è·å–å¹¶ä½¿ç”¨ä¸»é¢˜

- [ ] T4.4 [P0] æ›´æ–°GenerateReplyUseCaseé›†æˆä¸»é¢˜
  - æ–‡ä»¶: `domain/usecase/GenerateReplyUseCase.kt`
  - éªŒæ”¶: ç”Ÿæˆå›å¤æ—¶è‡ªåŠ¨è·å–å¹¶ä½¿ç”¨ä¸»é¢˜

### 4.3 UIé›†æˆ

- [ ] T4.5 [P0] æ›´æ–°ContactDetailScreenæ·»åŠ ä¸»é¢˜å…¥å£
  - æ–‡ä»¶: `presentation/ui/screen/contact/ContactDetailScreen.kt`
  - éªŒæ”¶: é¡¶éƒ¨å·¥å…·æ æ˜¾ç¤ºä¸»é¢˜å›¾æ ‡

- [ ] T4.6 [P1] æ›´æ–°FloatingViewV2æ·»åŠ ä¸»é¢˜æ˜¾ç¤º
  - æ–‡ä»¶: `presentation/ui/floating/FloatingViewV2.kt`
  - éªŒæ”¶: æ‚¬æµ®çª—æ˜¾ç¤ºä¸»é¢˜å¾½ç« 

### 4.4 ä¾èµ–æ³¨å…¥æ›´æ–°

- [ ] T4.7 [P1] æ›´æ–°FloatingWindowModuleä¾èµ–æ³¨å…¥
  - æ–‡ä»¶: `di/FloatingWindowModule.kt`
  - éªŒæ”¶: UseCaseæ³¨å…¥TopicRepositoryä¾èµ–

---

## é˜¶æ®µ5: æµ‹è¯•å®Œå–„ â¬œ å¾…å¼€å§‹

### 5.1 å•å…ƒæµ‹è¯•

- [ ] T5.1 [P0] ç¼–å†™TopicRepositoryImplTest
  - æ–‡ä»¶: `test/.../data/repository/TopicRepositoryImplTest.kt`
  - éªŒæ”¶: Repositoryæµ‹è¯•é€šè¿‡

- [ ] T5.2 [P1] ç¼–å†™ConversationTopicTest
  - æ–‡ä»¶: `test/.../domain/model/ConversationTopicTest.kt`
  - éªŒæ”¶: é¢†åŸŸæ¨¡å‹æµ‹è¯•é€šè¿‡

### 5.2 é›†æˆæµ‹è¯•

- [ ] T5.3 [P0] ç¼–å†™TopicIntegrationTesté›†æˆæµ‹è¯•
  - æ–‡ä»¶: `test/.../integration/TopicIntegrationTest.kt`
  - éªŒæ”¶: ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•é€šè¿‡

### 5.3 éªŒè¯æµ‹è¯•

- [ ] T5.4 [P1] æ‰§è¡Œå…¨é‡æµ‹è¯•å¹¶ä¿®å¤é—®é¢˜
  - éªŒæ”¶: æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæ— å›å½’é—®é¢˜

---

## ä»»åŠ¡ç»Ÿè®¡

| é˜¶æ®µ | ä»»åŠ¡æ•° | å®Œæˆæ•° | è¿›åº¦ |
|------|--------|--------|------|
| é˜¶æ®µ1: æ•°æ®å±‚å®ç° | 7 | 0 | 0% |
| é˜¶æ®µ2: é¢†åŸŸå±‚å®ç° | 7 | 0 | 0% |
| é˜¶æ®µ3: è¡¨ç°å±‚å®ç° | 7 | 0 | 0% |
| é˜¶æ®µ4: ç³»ç»Ÿé›†æˆ | 7 | 0 | 0% |
| é˜¶æ®µ5: æµ‹è¯•å®Œå–„ | 4 | 0 | 0% |
| **æ€»è®¡** | **32** | **0** | **0%** |

---

## ä¼˜å…ˆçº§è¯´æ˜

- **P0**: å…³é”®ä»»åŠ¡ï¼Œå¿…é¡»å®Œæˆï¼Œé˜»å¡åç»­ä»»åŠ¡
- **P1**: é‡è¦ä»»åŠ¡ï¼Œåº”è¯¥å®Œæˆï¼Œå½±å“åŠŸèƒ½å®Œæ•´æ€§
- **P2**: æ¬¡è¦ä»»åŠ¡ï¼Œå¯ä»¥å»¶åï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

---

## å›æ»šè®¡åˆ’

### æ•°æ®åº“å›æ»š
å¦‚æœè¿ç§»å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å›æ»šï¼š
1. åˆ é™¤conversation_topicsè¡¨
2. å°†æ•°æ®åº“ç‰ˆæœ¬å›é€€åˆ°10

```kotlin
val MIGRATION_11_10 = object : Migration(11, 10) {
    override fun migrate(database: SupportSQLiteDatabase) {
        database.execSQL("DROP TABLE IF EXISTS conversation_topics")
    }
}
```

### ä»£ç å›æ»š
å¦‚æœåŠŸèƒ½å‡ºç°ä¸¥é‡é—®é¢˜ï¼š
1. å›é€€TopicModuleçš„æ³¨å†Œ
2. ç§»é™¤UseCaseä¸­çš„TopicRepositoryä¾èµ–
3. éšè—UIå…¥å£ç‚¹

---
