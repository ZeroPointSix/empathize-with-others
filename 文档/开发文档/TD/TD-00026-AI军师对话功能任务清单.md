# TD-00026: AIå†›å¸ˆå¯¹è¯åŠŸèƒ½ä»»åŠ¡æ¸…å•

## æ–‡æ¡£ä¿¡æ¯

**æ–‡æ¡£ç¼–å·**: TD-00026  
**ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-01  
**æœ€åæ›´æ–°**: 2026-01-01  
**éœ€æ±‚æ–‡æ¡£**: `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/PRD/PRD-00026-AIå†›å¸ˆå¯¹è¯åŠŸèƒ½éœ€æ±‚.md` (v1.0)  
**åŠŸèƒ½è®¾è®¡**: `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/FD/FD-00026-AIå†›å¸ˆå¯¹è¯åŠŸèƒ½è®¾è®¡.md` (v1.1)  
**æŠ€æœ¯è®¾è®¡**: `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/TDD/TDD-00026-AIå†›å¸ˆå¯¹è¯åŠŸèƒ½æŠ€æœ¯è®¾è®¡.md` (v1.1)  
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**è´Ÿè´£äºº**: Kiro  
**é¢„è®¡å·¥ä½œé‡**: 4ä¸ªå·¥ä½œæ—¥  
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´è¯´æ˜ |
|------|------|------|----------|
| 1.0 | 2026-01-01 | Kiro | åˆå§‹ç‰ˆæœ¬ |

---

## ä»»åŠ¡æ ¼å¼è¯´æ˜

- **[P]**: å¯å¹¶è¡Œæ‰§è¡Œï¼ˆä¸åŒæ–‡ä»¶ï¼Œæ— ä¾èµ–ï¼‰
- **[é˜¶æ®µX]**: æ‰€å±å¼€å‘é˜¶æ®µï¼ˆé˜¶æ®µ1-4ï¼‰
- **[ä¾èµ–]**: ä¾èµ–å…¶ä»–ä»»åŠ¡å®Œæˆ
- æè¿°ä¸­åŒ…å«ç¡®åˆ‡çš„æ–‡ä»¶è·¯å¾„

---

## è·¯å¾„çº¦å®š

åŸºäºé¡¹ç›®å¤šæ¨¡å—ç»“æ„ï¼š
- **é¢†åŸŸå±‚**: `domain/src/main/kotlin/com/empathy/ai/domain/`
- **æ•°æ®å±‚**: `data/src/main/kotlin/com/empathy/ai/data/`
- **è¡¨ç°å±‚**: `presentation/src/main/kotlin/com/empathy/ai/presentation/`
- **åº”ç”¨å±‚**: `app/src/main/java/com/empathy/ai/`
- **æµ‹è¯•**: `*/src/test/`, `*/src/androidTest/`

---

## å¼€å‘é˜¶æ®µæ˜ å°„

æ ¹æ®TDD-00026ï¼Œæœ¬åŠŸèƒ½åˆ†ä¸º4ä¸ªå¼€å‘é˜¶æ®µï¼š

- **é˜¶æ®µ1**: æ•°æ®å±‚å®ç° - é¢†åŸŸæ¨¡å‹ã€æ•°æ®åº“å®ä½“ã€DAOã€Repositoryã€è¿ç§»è„šæœ¬ï¼ˆ1å¤©ï¼‰ğŸ¯ åŸºç¡€
- **é˜¶æ®µ2**: é¢†åŸŸå±‚å®ç° - UseCaseã€SystemPromptsæ‰©å±•ï¼ˆ1å¤©ï¼‰
- **é˜¶æ®µ3**: ç•Œé¢å±‚å®ç° - Screenã€ViewModelã€ç»„ä»¶ï¼ˆ1.5å¤©ï¼‰
- **é˜¶æ®µ4**: é›†æˆæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ0.5å¤©ï¼‰

**æ€»å·¥æœŸ**: 4ä¸ªå·¥ä½œæ—¥

---

## æ€»ä½“è¿›åº¦

| é˜¶æ®µ | ä»»åŠ¡æ•° | å·²å®Œæˆ | è¿›åº¦ |
|------|--------|--------|------|
| é˜¶æ®µ1: æ•°æ®å±‚å®ç° | 14 | 0 | 0% |
| é˜¶æ®µ2: é¢†åŸŸå±‚å®ç° | 10 | 0 | 0% |
| é˜¶æ®µ3: ç•Œé¢å±‚å®ç° | 16 | 0 | 0% |
| é˜¶æ®µ4: é›†æˆæµ‹è¯•ä¸ä¼˜åŒ– | 8 | 0 | 0% |
| **æ€»è®¡** | **48** | **0** | **0%** |

---

## é˜¶æ®µ1: æ•°æ®å±‚å®ç°ï¼ˆ1å¤©ï¼‰

**ç›®æ ‡**: å»ºç«‹æ•°æ®æ¨¡å‹ã€æ•°æ®åº“è¡¨ã€DAOã€Repositoryï¼Œå®Œæˆæ•°æ®åº“è¿ç§»

**é‡Œç¨‹ç¢‘**: M1 - æ•°æ®å±‚å®Œæˆï¼ŒRepositoryå¯ç‹¬ç«‹è¿è¡Œ

### 1.1 é¢†åŸŸæ¨¡å‹ï¼ˆDomain Layerï¼‰

- [ ] T001 [P] åˆ›å»ºAiAdvisorSessionä¼šè¯æ¨¡å‹
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/model/AiAdvisorSession.kt`
  - å†…å®¹: idã€contactIdã€titleã€createdAtã€updatedAtã€messageCountã€isActive
  - åŒ…å«: create()å·¥å‚æ–¹æ³•

- [ ] T002 [P] åˆ›å»ºAiAdvisorConversationå¯¹è¯è®°å½•æ¨¡å‹
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/model/AiAdvisorConversation.kt`
  - å†…å®¹: idã€contactIdã€sessionIdã€messageTypeã€contentã€timestampã€createdAtã€sendStatus
  - åŒ…å«: createUserMessage()ã€createAiMessage()å·¥å‚æ–¹æ³•

- [ ] T003 [P] åˆ›å»ºMessageTypeæ¶ˆæ¯ç±»å‹æšä¸¾
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/model/MessageType.kt`
  - å†…å®¹: USERã€AIä¸¤ç§ç±»å‹

- [ ] T004 [P] åˆ›å»ºSendStatuså‘é€çŠ¶æ€æšä¸¾
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/model/SendStatus.kt`
  - å†…å®¹: PENDINGã€SUCCESSã€FAILEDä¸‰ç§çŠ¶æ€

- [ ] T005 [P] åˆ›å»ºAiAdvisorErroré”™è¯¯ç±»å‹
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/model/AiAdvisorError.kt`
  - å†…å®¹: NetworkErrorã€ApiErrorã€ConfigErrorã€TimeoutErrorã€DatabaseErrorã€ContactNotFoundErrorã€UnknownError
  - åŒ…å«: fromException()å·¥å‚æ–¹æ³•

### 1.2 æ•°æ®åº“å®ä½“ï¼ˆData Layerï¼‰

- [ ] T006 [ä¾èµ–T001] åˆ›å»ºAiAdvisorSessionEntityæ•°æ®åº“å®ä½“
  - æ–‡ä»¶: `data/src/main/kotlin/com/empathy/ai/data/local/entity/AiAdvisorSessionEntity.kt`
  - è¡¨å: ai_advisor_sessions
  - å¤–é”®: contact_id â†’ contact_profiles(id) ON DELETE CASCADE
  - ç´¢å¼•: contact_idã€created_atã€updated_at
  - åŒ…å«: toDomain()ã€fromDomain()è½¬æ¢æ–¹æ³•

- [ ] T007 [ä¾èµ–T002,T003,T004] åˆ›å»ºAiAdvisorConversationEntityæ•°æ®åº“å®ä½“
  - æ–‡ä»¶: `data/src/main/kotlin/com/empathy/ai/data/local/entity/AiAdvisorConversationEntity.kt`
  - è¡¨å: ai_advisor_conversations
  - å¤–é”®: contact_id â†’ contact_profiles(id)ã€session_id â†’ ai_advisor_sessions(id) ON DELETE CASCADE
  - ç´¢å¼•: contact_idã€session_idã€timestamp
  - åŒ…å«: toDomain()ã€fromDomain()è½¬æ¢æ–¹æ³•

### 1.3 DAOè®¾è®¡

- [ ] T008 [ä¾èµ–T006,T007] åˆ›å»ºAiAdvisorDao
  - æ–‡ä»¶: `data/src/main/kotlin/com/empathy/ai/data/local/dao/AiAdvisorDao.kt`
  - ä¼šè¯æ“ä½œ: insertSessionã€getSessionsByContactã€getActiveSessionã€getSessionByIdã€updateSessionTitleã€incrementMessageCountã€deleteSessionã€deleteSessionsByContact
  - å¯¹è¯æ“ä½œ: insertConversationã€getConversationsBySessionã€getConversationsBySessionFlowã€getRecentConversationsã€deleteConversationã€clearSessionConversationsã€getConversationCount

### 1.4 æ•°æ®åº“è¿ç§»

- [ ] T009 [ä¾èµ–T006,T007] å®ç°æ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆv12â†’v13ï¼‰
  - æ–‡ä»¶: `data/src/main/kotlin/com/empathy/ai/data/local/DatabaseMigrations.kt`
  - å†…å®¹: MIGRATION_12_13
  - æ“ä½œ: åˆ›å»ºai_advisor_sessionsè¡¨ã€åˆ›å»ºai_advisor_conversationsè¡¨ã€åˆ›å»ºç´¢å¼•

- [ ] T010 [ä¾èµ–T008,T009] æ›´æ–°AppDatabase
  - æ–‡ä»¶: `data/src/main/kotlin/com/empathy/ai/data/local/AppDatabase.kt`
  - ä¿®æ”¹: ç‰ˆæœ¬å·12â†’13ã€æ·»åŠ AiAdvisorSessionEntityå’ŒAiAdvisorConversationEntityåˆ°entitiesã€æ·»åŠ AiAdvisorDaoæŠ½è±¡æ–¹æ³•ã€æ·»åŠ MIGRATION_12_13åˆ°migrations

### 1.5 Repositoryå®ç°

- [ ] T011 [ä¾èµ–T001,T002] åˆ›å»ºAiAdvisorRepositoryæ¥å£
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/repository/AiAdvisorRepository.kt`
  - ä¼šè¯ç®¡ç†: createSessionã€getSessionsã€getActiveSessionã€getOrCreateActiveSessionã€updateSessionTitleã€deleteSession
  - å¯¹è¯ç®¡ç†: saveMessageã€getConversationsã€getConversationsFlowã€deleteConversationã€clearSession

- [ ] T012 [ä¾èµ–T008,T011] åˆ›å»ºAiAdvisorRepositoryImplå®ç°
  - æ–‡ä»¶: `data/src/main/kotlin/com/empathy/ai/data/repository/AiAdvisorRepositoryImpl.kt`
  - ä¾èµ–æ³¨å…¥: AiAdvisorDaoã€IoDispatcher
  - å®ç°: æ‰€æœ‰AiAdvisorRepositoryæ¥å£æ–¹æ³•

### 1.6 é˜¶æ®µ1å•å…ƒæµ‹è¯•

- [ ] T013 [P][ä¾èµ–T001] åˆ›å»ºAiAdvisorSessionTest
  - æ–‡ä»¶: `domain/src/test/kotlin/com/empathy/ai/domain/model/AiAdvisorSessionTest.kt`
  - æµ‹è¯•: create()å·¥å‚æ–¹æ³•ã€å±æ€§é»˜è®¤å€¼

- [ ] T014 [P][ä¾èµ–T002] åˆ›å»ºAiAdvisorConversationTest
  - æ–‡ä»¶: `domain/src/test/kotlin/com/empathy/ai/domain/model/AiAdvisorConversationTest.kt`
  - æµ‹è¯•: createUserMessage()ã€createAiMessage()å·¥å‚æ–¹æ³•

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ‰€æœ‰æ•°æ®æ¨¡å‹å¯æ­£ç¡®åˆ›å»ºå’Œè½¬æ¢
- [ ] æ•°æ®åº“è¿ç§»è„šæœ¬å¯æ­£ç¡®æ‰§è¡Œ
- [ ] DAOæ–¹æ³•å¯æ­£ç¡®æ“ä½œæ•°æ®åº“
- [ ] Repositoryå¯ç‹¬ç«‹è¿è¡Œå¹¶è¿”å›æ­£ç¡®ç»“æœ
- [ ] é˜¶æ®µ1å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## é˜¶æ®µ2: é¢†åŸŸå±‚å®ç°ï¼ˆ1å¤©ï¼‰

**ç›®æ ‡**: å®ç°æ ¸å¿ƒUseCaseã€æ‰©å±•SystemPrompts

**é‡Œç¨‹ç¢‘**: M2 - é¢†åŸŸå±‚å®Œæˆï¼Œæ‰€æœ‰UseCaseå¯ç‹¬ç«‹è¿è¡Œ

### 2.1 UseCaseå®ç°

- [ ] T015 [ä¾èµ–T011] åˆ›å»ºCreateAdvisorSessionUseCase
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/usecase/CreateAdvisorSessionUseCase.kt`
  - åŠŸèƒ½: åˆ›å»ºæ–°çš„AIå†›å¸ˆä¼šè¯
  - ä¾èµ–æ³¨å…¥: AiAdvisorRepository

- [ ] T016 [ä¾èµ–T011] åˆ›å»ºGetAdvisorSessionsUseCase
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/usecase/GetAdvisorSessionsUseCase.kt`
  - åŠŸèƒ½: è·å–è”ç³»äººçš„æ‰€æœ‰ä¼šè¯åˆ—è¡¨
  - ä¾èµ–æ³¨å…¥: AiAdvisorRepository

- [ ] T017 [ä¾èµ–T011] åˆ›å»ºGetAdvisorConversationsUseCase
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/usecase/GetAdvisorConversationsUseCase.kt`
  - åŠŸèƒ½: è·å–ä¼šè¯çš„å¯¹è¯è®°å½•æµï¼ˆå“åº”å¼ï¼‰
  - ä¾èµ–æ³¨å…¥: AiAdvisorRepository

- [ ] T018 [ä¾èµ–T011] åˆ›å»ºDeleteAdvisorConversationUseCase
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/usecase/DeleteAdvisorConversationUseCase.kt`
  - åŠŸèƒ½: åˆ é™¤å•æ¡å¯¹è¯è®°å½•
  - ä¾èµ–æ³¨å…¥: AiAdvisorRepository

- [ ] T019 [ä¾èµ–T011,T012] åˆ›å»ºSendAdvisorMessageUseCaseï¼ˆæ ¸å¿ƒï¼‰
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/usecase/SendAdvisorMessageUseCase.kt`
  - åŠŸèƒ½: å‘é€æ¶ˆæ¯å¹¶è·å–AIå›å¤
  - ä¾èµ–æ³¨å…¥: AiAdvisorRepositoryã€AiRepositoryã€ContactRepositoryã€ConversationRepositoryã€AiProviderRepository
  - æµç¨‹: ä¿å­˜ç”¨æˆ·æ¶ˆæ¯â†’è·å–è”ç³»äººç”»åƒâ†’è·å–å¯¹è¯å†å²â†’æ„å»ºæç¤ºè¯â†’è°ƒç”¨AIâ†’ä¿å­˜AIå›å¤
  - å¸¸é‡: HISTORY_LIMIT=20ã€SESSION_CONTEXT_LIMIT=10

### 2.2 æç¤ºè¯æ‰©å±•

- [ ] T020 [P] æ‰©å±•SystemPromptsæ·»åŠ AIå†›å¸ˆæç¤ºè¯
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/util/SystemPrompts.kt`
  - æ·»åŠ : AI_ADVISOR_HEADERï¼ˆè§’è‰²å®šä¹‰ã€åˆ†æåŸåˆ™ã€åˆ†æç»´åº¦ã€äººè®¾ï¼‰
  - æ·»åŠ : AI_ADVISOR_FOOTERï¼ˆè¾“å‡ºè¦æ±‚ã€ç¦æ­¢äº‹é¡¹ï¼‰

### 2.3 ä¾èµ–æ³¨å…¥

- [ ] T021 [ä¾èµ–T015-T019] åˆ›å»ºAiAdvisorModule
  - æ–‡ä»¶: `app/src/main/java/com/empathy/ai/di/AiAdvisorModule.kt`
  - æä¾›: AiAdvisorRepositoryç»‘å®š
  - æ³¨è§£: @Moduleã€@InstallIn(SingletonComponent::class)

### 2.4 é˜¶æ®µ2å•å…ƒæµ‹è¯•

- [ ] T022 [ä¾èµ–T019] åˆ›å»ºSendAdvisorMessageUseCaseTest
  - æ–‡ä»¶: `domain/src/test/kotlin/com/empathy/ai/domain/usecase/SendAdvisorMessageUseCaseTest.kt`
  - æµ‹è¯•: å‘é€æ¶ˆæ¯æˆåŠŸè¿”å›AIå›å¤
  - æµ‹è¯•: æœªé…ç½®AIæœåŠ¡å•†æ—¶è¿”å›é”™è¯¯
  - æµ‹è¯•: è”ç³»äººç”»åƒæ­£ç¡®ä¼ é€’
  - æµ‹è¯•: å¯¹è¯å†å²æ­£ç¡®æ„å»º
  - æµ‹è¯•: å†å²è®°å½•é™åˆ¶ä¸º20æ¡

- [ ] T023 [ä¾èµ–T015] åˆ›å»ºCreateAdvisorSessionUseCaseTest
  - æ–‡ä»¶: `domain/src/test/kotlin/com/empathy/ai/domain/usecase/CreateAdvisorSessionUseCaseTest.kt`
  - æµ‹è¯•: åˆ›å»ºä¼šè¯æˆåŠŸ
  - æµ‹è¯•: è‡ªå®šä¹‰æ ‡é¢˜

- [ ] T024 [ä¾èµ–T016] åˆ›å»ºGetAdvisorSessionsUseCaseTest
  - æ–‡ä»¶: `domain/src/test/kotlin/com/empathy/ai/domain/usecase/GetAdvisorSessionsUseCaseTest.kt`
  - æµ‹è¯•: è·å–ä¼šè¯åˆ—è¡¨æˆåŠŸ
  - æµ‹è¯•: ç©ºåˆ—è¡¨å¤„ç†

**éªŒæ”¶æ ‡å‡†**:
- [ ] SendAdvisorMessageUseCaseå¯æ­£ç¡®å‘é€æ¶ˆæ¯å¹¶è·å–AIå›å¤
- [ ] å†å²å¯¹è¯è®°å½•é™åˆ¶ä¸º20æ¡
- [ ] ä¼šè¯ä¸Šä¸‹æ–‡é™åˆ¶ä¸º10æ¡
- [ ] SystemPromptsåŒ…å«å®Œæ•´çš„AIå†›å¸ˆæç¤ºè¯
- [ ] é˜¶æ®µ2å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## é˜¶æ®µ3: ç•Œé¢å±‚å®ç°ï¼ˆ1.5å¤©ï¼‰

**ç›®æ ‡**: å®ç°AIå†›å¸ˆä¸»ç•Œé¢ã€å¯¹è¯ç•Œé¢ã€å„UIç»„ä»¶ï¼Œé›†æˆåˆ°åº•éƒ¨å¯¼èˆªæ 

**é‡Œç¨‹ç¢‘**: M3 - ç•Œé¢å±‚å®Œæˆï¼Œå®Œæ•´çš„ç”¨æˆ·äº¤äº’æµç¨‹å¯ç”¨

### 3.1 å¯¼èˆªé…ç½®

- [ ] T025 [P] æ‰©å±•NavRoutesæ·»åŠ AIå†›å¸ˆè·¯ç”±
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/navigation/NavRoutes.kt`
  - æ·»åŠ : AI_ADVISORã€AI_ADVISOR_CHATè·¯ç”±
  - æ·»åŠ : aiAdvisorChat(contactId)è·¯ç”±æ„å»ºæ–¹æ³•

- [ ] T026 [P] æ‰©å±•BottomNavItemæ·»åŠ AIå†›å¸ˆå¯¼èˆªé¡¹
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/navigation/BottomNavItem.kt`
  - æ·»åŠ : AIAdvisorå¯¼èˆªé¡¹ï¼ˆå›¾æ ‡ï¼šPsychologyï¼‰

- [ ] T027 [ä¾èµ–T025,T026] æ›´æ–°NavGraphæ·»åŠ AIå†›å¸ˆå¯¼èˆª
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/navigation/NavGraph.kt`
  - æ·»åŠ : aiAdvisorScreen composable
  - æ·»åŠ : aiAdvisorChatScreen composableï¼ˆå¸¦contactIdå‚æ•°ï¼‰

### 3.2 ViewModelå®ç°

- [ ] T028 [ä¾èµ–T016] åˆ›å»ºAiAdvisorViewModelï¼ˆä¸»ç•Œé¢ï¼‰
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/viewmodel/AiAdvisorViewModel.kt`
  - ä¾èµ–æ³¨å…¥: GetContactsUseCaseã€GetAdvisorSessionsUseCase
  - çŠ¶æ€: AiAdvisorUiStateï¼ˆisLoadingã€contactsã€recentSessionsã€errorï¼‰
  - æ–¹æ³•: loadContacts()ã€refresh()ã€clearError()

- [ ] T029 [ä¾èµ–T015-T019] åˆ›å»ºAiAdvisorChatViewModelï¼ˆå¯¹è¯ç•Œé¢ï¼‰
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/viewmodel/AiAdvisorChatViewModel.kt`
  - ä¾èµ–æ³¨å…¥: GetContactByIdUseCaseã€GetContactsUseCaseã€CreateAdvisorSessionUseCaseã€GetAdvisorSessionsUseCaseã€GetAdvisorConversationsUseCaseã€SendAdvisorMessageUseCaseã€DeleteAdvisorConversationUseCase
  - çŠ¶æ€: AiAdvisorChatUiStateï¼ˆisLoadingã€isSendingã€contactNameã€inputTextã€currentSessionIdã€sessionsã€conversationsã€allContactsã€showContactSelectorã€showSwitchConfirmDialogã€pendingContactIdã€errorï¼‰
  - æ–¹æ³•: loadContact()ã€updateInput()ã€sendMessage()ã€retryMessage()ã€switchSession()ã€createNewSession()ã€showContactSelector()ã€hideContactSelector()ã€switchContact()ã€confirmSwitch()ã€cancelSwitch()ã€deleteMessage()ã€clearError()

### 3.3 ä¸»ç•Œé¢ç»„ä»¶

- [ ] T030 [ä¾èµ–T028] åˆ›å»ºAiAdvisorScreenä¸»ç•Œé¢
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/AiAdvisorScreen.kt`
  - å†…å®¹: TopAppBarã€è”ç³»äººåˆ—è¡¨ï¼ˆå¸¦æœ€è¿‘ä¼šè¯ä¿¡æ¯ï¼‰
  - çŠ¶æ€: åŠ è½½ä¸­ã€é”™è¯¯ã€ç©ºçŠ¶æ€ã€æ­£å¸¸åˆ—è¡¨
  - å›è°ƒ: onNavigateToChat

- [ ] T031 [P] åˆ›å»ºContactListWithSessionsç»„ä»¶
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/component/ContactListWithSessions.kt`
  - å†…å®¹: è”ç³»äººå¡ç‰‡åˆ—è¡¨ï¼Œæ˜¾ç¤ºæœ€è¿‘ä¼šè¯ä¿¡æ¯
  - å›è°ƒ: onContactClick

### 3.4 å¯¹è¯ç•Œé¢ç»„ä»¶

- [ ] T032 [ä¾èµ–T029] åˆ›å»ºAiAdvisorChatScreenå¯¹è¯ç•Œé¢
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/AiAdvisorChatScreen.kt`
  - å†…å®¹: TopBarã€ä¼šè¯é€‰æ‹©å™¨ã€å¯¹è¯åˆ—è¡¨ã€è¾“å…¥æ 
  - çŠ¶æ€: åŠ è½½ä¸­ã€å‘é€ä¸­ã€é”™è¯¯æç¤º
  - å¯¹è¯æ¡†: è”ç³»äººé€‰æ‹©ã€åˆ‡æ¢ç¡®è®¤

- [ ] T033 [P] åˆ›å»ºAiAdvisorTopBarç»„ä»¶
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/component/AiAdvisorTopBar.kt`
  - å†…å®¹: è¿”å›æŒ‰é’®ã€è”ç³»äººåç§°ã€è”ç³»äººé€‰æ‹©æŒ‰é’®
  - å›è°ƒ: onNavigateBackã€onContactSelect

- [ ] T034 [P] åˆ›å»ºAdvisorMessageBubbleæ¶ˆæ¯æ°”æ³¡ç»„ä»¶
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/component/AdvisorMessageBubble.kt`
  - å†…å®¹: ç”¨æˆ·æ¶ˆæ¯ï¼ˆå³ä¾§è“è‰²ï¼‰ã€AIæ¶ˆæ¯ï¼ˆå·¦ä¾§ç°è‰²ï¼‰ã€è§’è‰²æ ‡ç­¾ã€æ—¶é—´æˆ³
  - æ”¯æŒ: æ–‡æœ¬é€‰æ‹©ã€é•¿æŒ‰èœå•
  - å›è°ƒ: onRetryã€onDelete

- [ ] T035 [P] åˆ›å»ºFailedMessageBubbleå¤±è´¥æ¶ˆæ¯ç»„ä»¶
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/component/FailedMessageBubble.kt`
  - å†…å®¹: å¤±è´¥çŠ¶æ€æ ·å¼ã€é‡è¯•æŒ‰é’®ã€åˆ é™¤æŒ‰é’®
  - å›è°ƒ: onRetryã€onDelete

- [ ] T036 [P] åˆ›å»ºSessionSelectorä¼šè¯é€‰æ‹©å™¨ç»„ä»¶
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/component/SessionSelector.kt`
  - å†…å®¹: æ°´å¹³æ»šåŠ¨çš„ä¼šè¯æ ‡ç­¾ã€æ–°å»ºä¼šè¯æŒ‰é’®
  - å›è°ƒ: onSessionSelectã€onNewSession

- [ ] T037 [P] åˆ›å»ºContactSelectorDialogè”ç³»äººé€‰æ‹©å¯¹è¯æ¡†
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/component/ContactSelectorDialog.kt`
  - å†…å®¹: è”ç³»äººåˆ—è¡¨ã€å½“å‰é€‰ä¸­æ ‡è®°
  - å›è°ƒ: onSelectã€onDismiss

- [ ] T038 [P] åˆ›å»ºAiAdvisorInputBarè¾“å…¥æ ç»„ä»¶
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/component/AiAdvisorInputBar.kt`
  - å†…å®¹: è¾“å…¥æ¡†ã€å‘é€æŒ‰é’®ã€åŠ è½½æŒ‡ç¤ºå™¨
  - çŠ¶æ€: æ­£å¸¸ã€å‘é€ä¸­ã€ç¦ç”¨
  - å›è°ƒ: onInputChangeã€onSend

- [ ] T039 [ä¾èµ–T005] åˆ›å»ºErrorStateViewé”™è¯¯çŠ¶æ€ç»„ä»¶
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/component/ErrorStateView.kt`
  - å†…å®¹: é”™è¯¯å›¾æ ‡ã€é”™è¯¯æ¶ˆæ¯ã€é‡è¯•æŒ‰é’®ã€å»é…ç½®æŒ‰é’®ï¼ˆé’ˆå¯¹ConfigErrorï¼‰
  - å›è°ƒ: onRetryã€onNavigateToSettings

- [ ] T040 [P] åˆ›å»ºSwitchConfirmDialogåˆ‡æ¢ç¡®è®¤å¯¹è¯æ¡†
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/component/SwitchConfirmDialog.kt`
  - å†…å®¹: ç¡®è®¤æç¤ºã€ç¡®å®šæŒ‰é’®ã€å–æ¶ˆæŒ‰é’®
  - å›è°ƒ: onConfirmã€onDismiss

**éªŒæ”¶æ ‡å‡†**:
- [ ] AIå†›å¸ˆå…¥å£åœ¨åº•éƒ¨å¯¼èˆªæ æ­£ç¡®æ˜¾ç¤º
- [ ] ä¸»ç•Œé¢æ­£ç¡®æ˜¾ç¤ºè”ç³»äººåˆ—è¡¨å’Œæœ€è¿‘ä¼šè¯
- [ ] ç‚¹å‡»è”ç³»äººå¯è¿›å…¥å¯¹è¯ç•Œé¢
- [ ] å¯¹è¯ç•Œé¢å¯æ­£å¸¸å‘é€æ¶ˆæ¯å’Œæ˜¾ç¤ºAIå›å¤
- [ ] ä¼šè¯é€‰æ‹©å™¨å¯æ­£å¸¸åˆ‡æ¢ä¼šè¯
- [ ] è”ç³»äººé€‰æ‹©å¯¹è¯æ¡†å¯æ­£å¸¸åˆ‡æ¢è”ç³»äºº
- [ ] é”™è¯¯çŠ¶æ€æ­£ç¡®æ˜¾ç¤ºå¹¶æ”¯æŒé‡è¯•

---

## é˜¶æ®µ4: é›†æˆæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ0.5å¤©ï¼‰

**ç›®æ ‡**: å®Œæˆç«¯åˆ°ç«¯æµ‹è¯•ã€æ•°æ®åº“è¿ç§»æµ‹è¯•ã€æ€§èƒ½ä¼˜åŒ–

**é‡Œç¨‹ç¢‘**: M4 - æµ‹è¯•å®Œæˆï¼ŒåŠŸèƒ½ç¨³å®šå¯å‘å¸ƒ

### 4.1 æ•°æ®åº“è¿ç§»æµ‹è¯•

- [ ] T041 [ä¾èµ–T009] åˆ›å»ºMigration12To13Test
  - æ–‡ä»¶: `data/src/androidTest/kotlin/com/empathy/ai/data/local/Migration12To13Test.kt`
  - æµ‹è¯•: ai_advisor_sessionsè¡¨åˆ›å»ºæˆåŠŸ
  - æµ‹è¯•: ai_advisor_conversationsè¡¨åˆ›å»ºæˆåŠŸ
  - æµ‹è¯•: ç´¢å¼•åˆ›å»ºæˆåŠŸ
  - æµ‹è¯•: å¤–é”®çº¦æŸæ­£ç¡®

### 4.2 Repositoryé›†æˆæµ‹è¯•

- [ ] T042 [ä¾èµ–T012] åˆ›å»ºAiAdvisorRepositoryImplTest
  - æ–‡ä»¶: `data/src/test/kotlin/com/empathy/ai/data/repository/AiAdvisorRepositoryImplTest.kt`
  - æµ‹è¯•: createSessionæ­£ç¡®åˆ›å»ºä¼šè¯
  - æµ‹è¯•: getSessionsè¿”å›æ­£ç¡®åˆ—è¡¨
  - æµ‹è¯•: saveMessageæ­£ç¡®ä¿å­˜æ¶ˆæ¯
  - æµ‹è¯•: getConversationsFlowå“åº”å¼æ›´æ–°
  - æµ‹è¯•: deleteSessionçº§è”åˆ é™¤å¯¹è¯

### 4.3 ViewModelå•å…ƒæµ‹è¯•

- [ ] T043 [ä¾èµ–T028] åˆ›å»ºAiAdvisorViewModelTest
  - æ–‡ä»¶: `presentation/src/test/kotlin/com/empathy/ai/presentation/viewmodel/AiAdvisorViewModelTest.kt`
  - æµ‹è¯•: loadContactsæˆåŠŸåŠ è½½è”ç³»äºº
  - æµ‹è¯•: é”™è¯¯çŠ¶æ€æ­£ç¡®å¤„ç†
  - æµ‹è¯•: refreshé‡æ–°åŠ è½½

- [ ] T044 [ä¾èµ–T029] åˆ›å»ºAiAdvisorChatViewModelTest
  - æ–‡ä»¶: `presentation/src/test/kotlin/com/empathy/ai/presentation/viewmodel/AiAdvisorChatViewModelTest.kt`
  - æµ‹è¯•: loadContactæ­£ç¡®åŠ è½½è”ç³»äººå’Œä¼šè¯
  - æµ‹è¯•: sendMessageå‘é€æˆåŠŸ
  - æµ‹è¯•: sendMessageå‘é€å¤±è´¥å¤„ç†
  - æµ‹è¯•: switchSessionæ­£ç¡®åˆ‡æ¢
  - æµ‹è¯•: createNewSessionåˆ›å»ºæ–°ä¼šè¯

### 4.4 ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•

- [ ] T045 [ä¾èµ–é˜¶æ®µ3] åˆ›å»ºAiAdvisorE2ETest
  - æ–‡ä»¶: `app/src/androidTest/kotlin/com/empathy/ai/AiAdvisorE2ETest.kt`
  - æµ‹è¯•: å®Œæ•´å¯¹è¯æµç¨‹ï¼ˆé€‰æ‹©è”ç³»äººâ†’å‘é€æ¶ˆæ¯â†’æ”¶åˆ°å›å¤ï¼‰
  - æµ‹è¯•: ä¼šè¯åˆ‡æ¢æµç¨‹
  - æµ‹è¯•: è”ç³»äººåˆ‡æ¢æµç¨‹
  - æµ‹è¯•: é”™è¯¯é‡è¯•æµç¨‹

### 4.5 æ€§èƒ½ä¼˜åŒ–

- [ ] T046 [ä¾èµ–é˜¶æ®µ3] æ€§èƒ½ä¼˜åŒ–_å¯¹è¯åˆ—è¡¨
  - æ–‡ä»¶: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/advisor/AiAdvisorChatScreen.kt`
  - ä¼˜åŒ–: LazyColumnä½¿ç”¨keyæå‡æ€§èƒ½
  - ä¼˜åŒ–: æ¶ˆæ¯æ°”æ³¡ä½¿ç”¨rememberç¼“å­˜è®¡ç®—

- [ ] T047 [ä¾èµ–T019] æ€§èƒ½ä¼˜åŒ–_AIè°ƒç”¨
  - æ–‡ä»¶: `domain/src/main/kotlin/com/empathy/ai/domain/usecase/SendAdvisorMessageUseCase.kt`
  - ä¼˜åŒ–: å†å²è®°å½•é™åˆ¶ä¸º20æ¡
  - ä¼˜åŒ–: ä¼šè¯ä¸Šä¸‹æ–‡é™åˆ¶ä¸º10æ¡
  - éªŒè¯: æç¤ºè¯é•¿åº¦ä¸è¶…è¿‡AIæ¨¡å‹é™åˆ¶

### 4.6 Bugä¿®å¤é¢„ç•™

- [ ] T048 [ä¾èµ–é˜¶æ®µ3] Bugä¿®å¤é¢„ç•™
  - é¢„ç•™æ—¶é—´: 2å°æ—¶
  - ç”¨é€”: ä¿®å¤é›†æˆæµ‹è¯•å‘ç°çš„é—®é¢˜
  - èŒƒå›´: P0å’ŒP1çº§åˆ«Bug

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ•°æ®åº“è¿ç§»æµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] Repositoryé›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] ViewModelå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] å¯¹è¯åˆ—è¡¨æ»šåŠ¨æµç•…
- [ ] AIå“åº”æ—¶é—´åˆç†ï¼ˆ<30ç§’ï¼‰
- [ ] æ— P0çº§åˆ«Bug

---

## é£é™©ä¸ç¼“è§£æªæ–½

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| AIå“åº”æ—¶é—´è¿‡é•¿ | ä¸­ | ä¸­ | æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼Œæ”¯æŒå–æ¶ˆæ“ä½œ |
| å†å²è®°å½•è¿‡å¤šå¯¼è‡´æç¤ºè¯è¶…é™ | é«˜ | ä¸­ | é™åˆ¶å†å²è®°å½•ä¸º20æ¡ï¼Œåç»­å¼•å…¥RAG |
| æ•°æ®åº“è¿ç§»å¤±è´¥ | é«˜ | ä½ | å®Œæ•´çš„è¿ç§»æµ‹è¯•ï¼Œå›æ»šæœºåˆ¶ |
| è”ç³»äººç”»åƒä¿¡æ¯ä¸å®Œæ•´ | ä½ | ä¸­ | ä¼˜é›…é™çº§ï¼Œç¼ºå°‘ä¿¡æ¯æ—¶ä»å¯å¯¹è¯ |
| ç½‘ç»œé”™è¯¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤± | ä¸­ | ä¸­ | æœ¬åœ°ä¿å­˜ç”¨æˆ·æ¶ˆæ¯ï¼Œæ”¯æŒé‡è¯• |

---

## ä¾èµ–å…³ç³»å›¾

```
é˜¶æ®µ1: æ•°æ®å±‚å®ç°
â”œâ”€â”€ T001-T005 [P] é¢†åŸŸæ¨¡å‹ï¼ˆå¯å¹¶è¡Œï¼‰
â”œâ”€â”€ T001 â†’ T006 AiAdvisorSessionEntity
â”œâ”€â”€ T002,T003,T004 â†’ T007 AiAdvisorConversationEntity
â”œâ”€â”€ T006,T007 â†’ T008 AiAdvisorDao
â”œâ”€â”€ T006,T007 â†’ T009 æ•°æ®åº“è¿ç§»
â”œâ”€â”€ T008,T009 â†’ T010 AppDatabaseæ›´æ–°
â”œâ”€â”€ T001,T002 â†’ T011 AiAdvisorRepositoryæ¥å£
â””â”€â”€ T008,T011 â†’ T012 AiAdvisorRepositoryImpl

é˜¶æ®µ2: é¢†åŸŸå±‚å®ç°
â”œâ”€â”€ T011 â†’ T015-T018 åŸºç¡€UseCase
â”œâ”€â”€ T011,T012 â†’ T019 SendAdvisorMessageUseCaseï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ T020 [P] SystemPromptsæ‰©å±•
â””â”€â”€ T015-T019 â†’ T021 AiAdvisorModule

é˜¶æ®µ3: ç•Œé¢å±‚å®ç°
â”œâ”€â”€ T025,T026 [P] å¯¼èˆªé…ç½®
â”œâ”€â”€ T025,T026 â†’ T027 NavGraphæ›´æ–°
â”œâ”€â”€ T016 â†’ T028 AiAdvisorViewModel
â”œâ”€â”€ T015-T019 â†’ T029 AiAdvisorChatViewModel
â”œâ”€â”€ T028 â†’ T030 AiAdvisorScreen
â”œâ”€â”€ T029 â†’ T032 AiAdvisorChatScreen
â””â”€â”€ T031,T033-T040 [P] UIç»„ä»¶ï¼ˆå¯å¹¶è¡Œï¼‰

é˜¶æ®µ4: é›†æˆæµ‹è¯•ä¸ä¼˜åŒ–
â”œâ”€â”€ T009 â†’ T041 æ•°æ®åº“è¿ç§»æµ‹è¯•
â”œâ”€â”€ T012 â†’ T042 Repositoryæµ‹è¯•
â”œâ”€â”€ T028 â†’ T043 AiAdvisorViewModelTest
â”œâ”€â”€ T029 â†’ T044 AiAdvisorChatViewModelTest
â””â”€â”€ é˜¶æ®µ3 â†’ T045-T048 ç«¯åˆ°ç«¯æµ‹è¯•å’Œä¼˜åŒ–
```

---

## é™„å½•

### A. ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [PRD-00026](../PRD/PRD-00026-AIå†›å¸ˆå¯¹è¯åŠŸèƒ½éœ€æ±‚.md) | éœ€æ±‚æ–‡æ¡£ |
| [FD-00026](../FD/FD-00026-AIå†›å¸ˆå¯¹è¯åŠŸèƒ½è®¾è®¡.md) | åŠŸèƒ½è®¾è®¡æ–‡æ¡£ |
| [TDD-00026](../TDD/TDD-00026-AIå†›å¸ˆå¯¹è¯åŠŸèƒ½æŠ€æœ¯è®¾è®¡.md) | æŠ€æœ¯è®¾è®¡æ–‡æ¡£ |
| [DR-00026](../DR/DR-00026-FD00026AIå†›å¸ˆå¯¹è¯åŠŸèƒ½è®¾è®¡å®¡æŸ¥æŠ¥å‘Š.md) | è®¾è®¡å®¡æŸ¥æŠ¥å‘Š |

### B. æµ‹è¯•è¦†ç›–ç‡æ ‡å‡†

| æ¨¡å— | ç›®æ ‡è¦†ç›–ç‡ | é‡ç‚¹æµ‹è¯•é¡¹ |
|------|-----------|-----------|
| SendAdvisorMessageUseCase | â‰¥90% | æ­£å¸¸æµç¨‹ã€é”™è¯¯å¤„ç†ã€å†å²é™åˆ¶ |
| AiAdvisorRepositoryImpl | â‰¥85% | CRUDæ“ä½œã€çº§è”åˆ é™¤ã€Flowå“åº” |
| AiAdvisorChatViewModel | â‰¥80% | çŠ¶æ€ç®¡ç†ã€å‘é€æµç¨‹ã€é”™è¯¯å¤„ç† |
| æ•°æ®åº“è¿ç§» | 100% | è¡¨åˆ›å»ºã€ç´¢å¼•ã€å¤–é”® |

### C. éªŒæ”¶æ£€æŸ¥æ¸…å•

#### åŠŸèƒ½éªŒæ”¶
- [ ] AIå†›å¸ˆå…¥å£åœ¨åº•éƒ¨å¯¼èˆªæ æ­£ç¡®æ˜¾ç¤º
- [ ] ä¸»ç•Œé¢æ­£ç¡®æ˜¾ç¤ºè”ç³»äººåˆ—è¡¨
- [ ] ç‚¹å‡»è”ç³»äººå¯è¿›å…¥å¯¹è¯ç•Œé¢
- [ ] å¯æ­£å¸¸å‘é€æ¶ˆæ¯å¹¶æ”¶åˆ°AIå›å¤
- [ ] ä¼šè¯é€‰æ‹©å™¨å¯æ­£å¸¸åˆ‡æ¢ä¼šè¯
- [ ] å¯åˆ›å»ºæ–°ä¼šè¯
- [ ] è”ç³»äººé€‰æ‹©å¯¹è¯æ¡†å¯æ­£å¸¸åˆ‡æ¢è”ç³»äºº
- [ ] åˆ‡æ¢è”ç³»äººæœ‰ç¡®è®¤æç¤º
- [ ] å‘é€å¤±è´¥çš„æ¶ˆæ¯å¯é‡è¯•
- [ ] é”™è¯¯çŠ¶æ€æ­£ç¡®æ˜¾ç¤º

#### æ€§èƒ½éªŒæ”¶
- [ ] å¯¹è¯åˆ—è¡¨æ»šåŠ¨æµç•…ï¼ˆ60fpsï¼‰
- [ ] AIå“åº”æ—¶é—´<30ç§’
- [ ] å†å²è®°å½•é™åˆ¶ä¸º20æ¡
- [ ] ä¼šè¯ä¸Šä¸‹æ–‡é™åˆ¶ä¸º10æ¡

#### è´¨é‡éªŒæ”¶
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥80%
- [ ] æ— P0çº§åˆ«Bug
- [ ] ä»£ç é€šè¿‡Lintæ£€æŸ¥
- [ ] æ— å†…å­˜æ³„æ¼

### D. æ•°æ®åº“ç‰ˆæœ¬è¯´æ˜

| ç‰ˆæœ¬ | å˜æ›´å†…å®¹ | ç›¸å…³ä»»åŠ¡ |
|------|----------|----------|
| v11 | å½“å‰ç‰ˆæœ¬ | - |
| v12 | é¢„ç•™ï¼ˆå¦‚æœ‰å…¶ä»–åŠŸèƒ½ï¼‰ | - |
| v13 | AIå†›å¸ˆåŠŸèƒ½è¡¨ | T009 |

**æ³¨æ„**: æ ¹æ®TDD-00026ï¼Œæ•°æ®åº“ä»v12è¿ç§»åˆ°v13ã€‚å¦‚æœå½“å‰ç‰ˆæœ¬ä¸ºv11ï¼Œéœ€è¦å…ˆç¡®è®¤æ˜¯å¦æœ‰v11â†’v12çš„è¿ç§»ï¼Œæˆ–ç›´æ¥å®ç°v11â†’v13çš„è¿ç§»ã€‚

---

## å˜æ›´è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|----------|------|
| 2026-01-01 | 1.0 | åˆå§‹ç‰ˆæœ¬ | Kiro |
