# TDD-00006: æç¤ºè¯ç¼–è¾‘ç•Œé¢æŠ€æœ¯è®¾è®¡

## 1. æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| æ–‡æ¡£ç±»å‹ | TDD (Technical Design Document) |
| æ–‡æ¡£ç¼–å· | TDD-00006 |
| åŠŸèƒ½åç§° | æç¤ºè¯ç¼–è¾‘ç•Œé¢æŠ€æœ¯è®¾è®¡ |
| ç‰ˆæœ¬ | 1.0 |
| åˆ›å»ºæ—¥æœŸ | 2025-12-16 |
| æœ€åæ›´æ–° | 2025-12-16 |
| ä½œè€… | Kiro |
| å®¡æ ¸äºº | å¾…å®¡æ ¸ |
| å®¡æ ¸çŠ¶æ€ | âœ… å®¡æŸ¥é€šè¿‡ |
| å…³è”æ–‡æ¡£ | PRD-00006, FD-00006, TDD-00005 |

### 1.1 ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´è¯´æ˜ |
|------|------|------|----------|
| 1.0 | 2025-12-16 | Kiro | åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«å®Œæ•´æŠ€æœ¯æ¶æ„è®¾è®¡ |
| 1.1 | 2025-12-16 | Kiro | ä¼˜åŒ–é˜²æŠ–å®ç°ï¼ˆViewModelå±‚Channel+debounceï¼‰ã€æ–°å¢é”™è¯¯å¤„ç†UIè®¾è®¡ã€æ·»åŠ å¤§æ–‡æœ¬è¾“å…¥ä¿æŠ¤ |

### 1.2 æŠ€æœ¯æ ˆ

| æŠ€æœ¯é¢†åŸŸ | æŠ€æœ¯é€‰æ‹© | ç‰ˆæœ¬ | ç”¨é€” |
|---------|----------|------|------|
| UIæ¡†æ¶ | Jetpack Compose | BOM 2024.12.01 | å£°æ˜å¼UI |
| è®¾è®¡ç³»ç»Ÿ | Material 3 | 1.3.1 | UIç»„ä»¶å’Œä¸»é¢˜ |
| å¯¼èˆª | Navigation Compose | 2.8.5 | é¡µé¢å¯¼èˆª |
| ä¾èµ–æ³¨å…¥ | Hilt | 2.52 | ä¾èµ–ç®¡ç† |
| çŠ¶æ€ç®¡ç† | StateFlow | Coroutines 1.9.0 | å“åº”å¼çŠ¶æ€ |
| ç”Ÿå‘½å‘¨æœŸ | Lifecycle | 2.8.7 | ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ |

---

## 2. æ¶æ„æ¦‚è¿°

### 2.1 æ¶æ„ç›®æ ‡

æç¤ºè¯ç¼–è¾‘ç•Œé¢é‡‡ç”¨ MVVM æ¶æ„æ¨¡å¼ï¼Œå®ç°æç®€ã€èšç„¦çš„ç¼–è¾‘ä½“éªŒã€‚

**æ ¸å¿ƒç›®æ ‡**ï¼š
- æ‰“é€ ç¬¦åˆäº§å“è°ƒæ€§çš„æƒ…æ„ŸåŒ–ç¼–è¾‘ç•Œé¢
- ç¡®ä¿é”®ç›˜å¼¹èµ·æ—¶çš„è‰¯å¥½äº¤äº’ä½“éªŒ
- æ”¯æŒå…¨å±€æç¤ºè¯å’Œè”ç³»äººæç¤ºè¯ä¸¤ç§ç¼–è¾‘æ¨¡å¼
- å®ç°å“ç‰Œè‰²è§†è§‰ä¸€è‡´æ€§

### 2.2 è®¾è®¡åŸåˆ™

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **çŠ¶æ€æå‡**ï¼šUIçŠ¶æ€ç»Ÿä¸€ç”±ViewModelç®¡ç†
- **ç»„åˆä¼˜äºç»§æ‰¿**ï¼šä½¿ç”¨Composeç»„åˆæ¨¡å¼
- **æ€§èƒ½ä¼˜å…ˆ**ï¼šé¿å…ä¸å¿…è¦çš„é‡ç»„


---

## 3. æ•´ä½“æ¶æ„è®¾è®¡

### 3.1 åˆ†å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              PromptEditorScreen                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚           EmotionalBackground                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚         GlassmorphicCard                 â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚      PromptEditorTopBar            â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚      PromptInputField              â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”‚      CharacterCounter              â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â†“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           PromptEditorViewModel                       â”‚  â”‚
â”‚  â”‚      (StateFlow + UiState + UiEvent)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Domain Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚PromptRepositoryâ”‚ â”‚PromptValidatorâ”‚ â”‚    PromptScene   â”‚  â”‚
â”‚  â”‚   (æ¥å£)      â”‚  â”‚  (éªŒè¯å™¨)    â”‚  â”‚    (åœºæ™¯æšä¸¾)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Data Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚PromptRepositoryImplâ”‚ â”‚     PromptFileStorage       â”‚    â”‚
â”‚  â”‚    (å®ç°)        â”‚  â”‚      (JSONæ–‡ä»¶å­˜å‚¨)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¨¡å—ä¾èµ–å…³ç³»

```
PromptEditorScreen
    â”‚
    â”œâ”€â”€ PromptEditorViewModel
    â”‚       â”‚
    â”‚       â”œâ”€â”€ PromptRepository (æ¥å£)
    â”‚       â”‚       â”‚
    â”‚       â”‚       â””â”€â”€ PromptRepositoryImpl
    â”‚       â”‚               â”‚
    â”‚       â”‚               â”œâ”€â”€ PromptFileStorage
    â”‚       â”‚               â””â”€â”€ ContactDao
    â”‚       â”‚
    â”‚       â””â”€â”€ PromptValidator
    â”‚
    â”œâ”€â”€ EmotionalBackground (å¤ç”¨)
    â”œâ”€â”€ GlassmorphicCard (å¤ç”¨)
    â””â”€â”€ Navigation Component
```

---

## 4. è¯¦ç»†è®¾è®¡

### 4.1 æ•°æ®æ¨¡å‹

#### 4.1.1 PromptEditorUiState

```kotlin
/**
 * æç¤ºè¯ç¼–è¾‘å™¨UIçŠ¶æ€
 * 
 * @property editMode ç¼–è¾‘æ¨¡å¼ï¼ˆå…¨å±€åœºæ™¯/è”ç³»äººä¸“å±ï¼‰
 * @property originalPrompt åŸå§‹æç¤ºè¯ï¼ˆç”¨äºæ£€æµ‹ä¿®æ”¹ï¼‰
 * @property currentPrompt å½“å‰ç¼–è¾‘çš„æç¤ºè¯
 * @property placeholderText åŠ¨æ€å ä½ç¬¦æ–‡æ¡ˆ
 * @property isLoading åˆå§‹åŠ è½½çŠ¶æ€
 * @property isSaving ä¿å­˜çŠ¶æ€
 * @property showDiscardDialog æ˜¾ç¤ºæ”¾å¼ƒä¿®æ”¹å¯¹è¯æ¡†
 * @property errorMessage é”™è¯¯ä¿¡æ¯
 */
data class PromptEditorUiState(
    val editMode: PromptEditMode = PromptEditMode.GlobalScene(PromptScene.ANALYZE),
    val originalPrompt: String = "",
    val currentPrompt: String = "",
    val placeholderText: String = "",
    val isLoading: Boolean = false,
    val isSaving: Boolean = false,
    val showDiscardDialog: Boolean = false,
    val errorMessage: String? = null
) {
    companion object {
        const val MAX_PROMPT_LENGTH = 1000
        const val WARN_PROMPT_LENGTH = 800
    }
    
    // è®¡ç®—å±æ€§
    val charCount: Int get() = currentPrompt.length
    val isOverLimit: Boolean get() = charCount > MAX_PROMPT_LENGTH
    val isNearLimit: Boolean get() = charCount > WARN_PROMPT_LENGTH
    val hasUnsavedChanges: Boolean get() = currentPrompt != originalPrompt
    val canSave: Boolean get() = !isOverLimit && !isSaving && !isLoading
    
    val titleText: String get() = when (editMode) {
        is PromptEditMode.GlobalScene -> "ç¼–è¾‘æŒ‡ä»¤"
        is PromptEditMode.ContactCustom -> "ç¼–è¾‘ä¸“å±æŒ‡ä»¤"
    }
}
```

#### 4.1.2 PromptEditMode

```kotlin
/**
 * ç¼–è¾‘æ¨¡å¼å¯†å°ç±»
 */
sealed class PromptEditMode {
    /**
     * å…¨å±€åœºæ™¯æç¤ºè¯ç¼–è¾‘
     */
    data class GlobalScene(val scene: PromptScene) : PromptEditMode()
    
    /**
     * è”ç³»äººä¸“å±æç¤ºè¯ç¼–è¾‘
     */
    data class ContactCustom(
        val contactId: String,
        val contactName: String
    ) : PromptEditMode()
}
```

#### 4.1.3 PromptEditorUiEvent

```kotlin
/**
 * UIäº‹ä»¶å¯†å°ç±»
 */
sealed class PromptEditorUiEvent {
    data class UpdatePrompt(val text: String) : PromptEditorUiEvent()
    object SavePrompt : PromptEditorUiEvent()
    object CancelEdit : PromptEditorUiEvent()
    object ConfirmDiscard : PromptEditorUiEvent()
    object DismissDiscardDialog : PromptEditorUiEvent()
    object ClearError : PromptEditorUiEvent()
}
```

#### 4.1.4 PromptEditorResult

```kotlin
/**
 * ç¼–è¾‘ç»“æœå¯†å°ç±»
 */
sealed class PromptEditorResult {
    object Saved : PromptEditorResult()
    object Cancelled : PromptEditorResult()
}
```


### 4.2 ViewModel è®¾è®¡

#### 4.2.1 PromptEditorViewModel

```kotlin
@HiltViewModel
class PromptEditorViewModel @Inject constructor(
    private val promptRepository: PromptRepository,
    private val promptValidator: PromptValidator,
    savedStateHandle: SavedStateHandle
) : ViewModel() {

    private val editMode: PromptEditMode = parseEditMode(savedStateHandle)
    
    private val _uiState = MutableStateFlow(
        PromptEditorUiState(
            editMode = editMode,
            placeholderText = getPlaceholderText(editMode)
        )
    )
    val uiState: StateFlow<PromptEditorUiState> = _uiState.asStateFlow()
    
    private val _result = MutableSharedFlow<PromptEditorResult>()
    val result: SharedFlow<PromptEditorResult> = _result.asSharedFlow()
    
    // ========== é˜²æŠ–å¤„ç†ï¼šä½¿ç”¨Channelåœ¨ViewModelå±‚å¤„ç† ==========
    private val promptInputChannel = Channel<String>(Channel.CONFLATED)
    
    init {
        loadPrompt()
        setupInputDebounce()
    }
    
    /**
     * è®¾ç½®è¾“å…¥é˜²æŠ–å¤„ç†
     * 
     * è®¾è®¡è¯´æ˜ï¼š
     * - UIå±‚ç›´æ¥å‘é€UpdatePromptäº‹ä»¶ï¼Œä¿æŒUIé€»è¾‘çº¯ç²¹
     * - ViewModelå±‚ä½¿ç”¨Channel+debounceå¤„ç†é˜²æŠ–
     * - ä¾¿äºå•å…ƒæµ‹è¯•ï¼Œå¯ç‹¬ç«‹æµ‹è¯•é˜²æŠ–é€»è¾‘
     */
    private fun setupInputDebounce() {
        viewModelScope.launch {
            promptInputChannel.receiveAsFlow()
                .debounce(DEBOUNCE_DELAY_MS)
                .collect { text ->
                    // é˜²æŠ–åçš„å®é™…çŠ¶æ€æ›´æ–°
                    _uiState.update { it.copy(currentPrompt = text) }
                }
        }
    }
    
    fun onEvent(event: PromptEditorUiEvent) {
        when (event) {
            is PromptEditorUiEvent.UpdatePrompt -> handlePromptInput(event.text)
            is PromptEditorUiEvent.SavePrompt -> savePrompt()
            is PromptEditorUiEvent.CancelEdit -> handleCancel()
            is PromptEditorUiEvent.ConfirmDiscard -> confirmDiscard()
            is PromptEditorUiEvent.DismissDiscardDialog -> dismissDiscardDialog()
            is PromptEditorUiEvent.ClearError -> clearError()
        }
    }
    
    /**
     * å¤„ç†æç¤ºè¯è¾“å…¥
     * 
     * å®‰å…¨æªæ–½ï¼š
     * 1. å…ˆæˆªæ–­è¶…å¤§æ–‡æœ¬ï¼ˆé˜²æ­¢ç²˜è´´10ä¸‡å­—å¡æ­»ä¸»çº¿ç¨‹ï¼‰
     * 2. ç«‹å³æ›´æ–°UIæ˜¾ç¤ºï¼ˆä¿è¯è¾“å…¥å“åº”ï¼‰
     * 3. é€šè¿‡Channelå‘é€é˜²æŠ–å¤„ç†
     */
    private fun handlePromptInput(text: String) {
        // ğŸ›¡ï¸ å¤§æ–‡æœ¬ä¿æŠ¤ï¼šå…ˆæˆªæ–­å†å¤„ç†ï¼Œé˜²æ­¢ç²˜è´´è¶…å¤§æ–‡æœ¬å¡æ­»
        val safeText = text.take(PromptEditorUiState.MAX_PROMPT_LENGTH)
        
        // ç«‹å³æ›´æ–°UIï¼ˆä¿è¯è¾“å…¥å“åº”æ€§ï¼‰
        _uiState.update { it.copy(currentPrompt = safeText) }
        
        // å‘é€åˆ°Channelè¿›è¡Œé˜²æŠ–å¤„ç†ï¼ˆç”¨äºåç»­éªŒè¯ç­‰æ“ä½œï¼‰
        viewModelScope.launch {
            promptInputChannel.send(safeText)
        }
    }
    
    private fun loadPrompt() {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }
            
            try {
                val prompt = when (val mode = editMode) {
                    is PromptEditMode.GlobalScene -> 
                        promptRepository.getGlobalPrompt(mode.scene)
                    is PromptEditMode.ContactCustom -> 
                        promptRepository.getContactPrompt(mode.contactId) ?: ""
                }
                
                _uiState.update { 
                    it.copy(
                        originalPrompt = prompt,
                        currentPrompt = prompt,
                        isLoading = false
                    )
                }
            } catch (e: Exception) {
                _uiState.update { 
                    it.copy(
                        isLoading = false,
                        errorMessage = "åŠ è½½å¤±è´¥: ${e.message}"
                    )
                }
            }
        }
    }
    
    private fun savePrompt() {
        val currentState = _uiState.value
        if (!currentState.canSave) return
        
        viewModelScope.launch {
            _uiState.update { it.copy(isSaving = true) }
            
            try {
                val result = when (val mode = editMode) {
                    is PromptEditMode.GlobalScene -> 
                        promptRepository.saveGlobalPrompt(mode.scene, currentState.currentPrompt)
                    is PromptEditMode.ContactCustom -> 
                        promptRepository.saveContactPrompt(
                            mode.contactId, 
                            currentState.currentPrompt.ifBlank { null }
                        )
                }
                
                result.fold(
                    onSuccess = {
                        _result.emit(PromptEditorResult.Saved)
                    },
                    onFailure = { e ->
                        _uiState.update { 
                            it.copy(
                                isSaving = false,
                                errorMessage = "ä¿å­˜å¤±è´¥: ${e.message}"
                            )
                        }
                    }
                )
            } catch (e: Exception) {
                _uiState.update { 
                    it.copy(
                        isSaving = false,
                        errorMessage = "ä¿å­˜å¤±è´¥: ${e.message}"
                    )
                }
            }
        }
    }
    
    private fun handleCancel() {
        if (_uiState.value.hasUnsavedChanges) {
            _uiState.update { it.copy(showDiscardDialog = true) }
        } else {
            viewModelScope.launch {
                _result.emit(PromptEditorResult.Cancelled)
            }
        }
    }
    
    private fun confirmDiscard() {
        viewModelScope.launch {
            _uiState.update { it.copy(showDiscardDialog = false) }
            _result.emit(PromptEditorResult.Cancelled)
        }
    }
    
    private fun dismissDiscardDialog() {
        _uiState.update { it.copy(showDiscardDialog = false) }
    }
    
    private fun clearError() {
        _uiState.update { it.copy(errorMessage = null) }
    }
    
    companion object {
        /** é˜²æŠ–å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ */
        private const val DEBOUNCE_DELAY_MS = 100L
        
        fun getPlaceholderText(editMode: PromptEditMode): String {
            return when (editMode) {
                is PromptEditMode.ContactCustom -> 
                    "ä¾‹å¦‚ï¼šå’Œå¥¹èŠå¤©æ—¶è¦æ³¨æ„é¿å¼€å‰ä»»è¯é¢˜..."
                is PromptEditMode.GlobalScene -> when (editMode.scene) {
                    PromptScene.ANALYZE -> "ä¾‹å¦‚ï¼šè¯·å¸®æˆ‘åˆ†æå¥¹è¿™å¥è¯çš„æ½œå°è¯..."
                    PromptScene.CHECK -> "ä¾‹å¦‚ï¼šæ£€æŸ¥æ—¶è¦ç‰¹åˆ«æ³¨æ„å·¥ä½œç›¸å…³è¯é¢˜..."
                    PromptScene.EXTRACT -> "ä¾‹å¦‚ï¼šé‡ç‚¹å…³æ³¨å¯¹æ–¹æåˆ°çš„å…´è¶£çˆ±å¥½..."
                    PromptScene.SUMMARY -> "ä¾‹å¦‚ï¼šæ€»ç»“ä»Šå¤©çš„å¯¹è¯äº®ç‚¹å’Œéœ€è¦æ³¨æ„çš„åœ°æ–¹..."
                }
            }
        }
        
        private fun parseEditMode(savedStateHandle: SavedStateHandle): PromptEditMode {
            val mode = savedStateHandle.get<String>("mode") ?: "global"
            
            return when (mode) {
                "global" -> {
                    val sceneName = savedStateHandle.get<String>("scene")
                        ?: PromptScene.ANALYZE.name
                    val scene = PromptScene.valueOf(sceneName)
                    PromptEditMode.GlobalScene(scene)
                }
                "contact" -> {
                    val contactId = savedStateHandle.get<String>("contactId")
                        ?: throw IllegalArgumentException("contactId is required")
                    val contactName = savedStateHandle.get<String>("contactName")
                        ?.let { URLDecoder.decode(it, "UTF-8") }
                        ?: "è”ç³»äºº"
                    PromptEditMode.ContactCustom(contactId, contactName)
                }
                else -> PromptEditMode.GlobalScene(PromptScene.ANALYZE)
            }
        }
    }
}
```


### 4.3 å¯¼èˆªè®¾è®¡

#### 4.3.1 è·¯ç”±å®šä¹‰

```kotlin
object PromptEditorRoutes {
    const val ROUTE = "prompt_editor"
    const val ARG_MODE = "mode"
    const val ARG_SCENE = "scene"
    const val ARG_CONTACT_ID = "contactId"
    const val ARG_CONTACT_NAME = "contactName"
    
    val FULL_ROUTE = "$ROUTE?$ARG_MODE={$ARG_MODE}&$ARG_SCENE={$ARG_SCENE}&$ARG_CONTACT_ID={$ARG_CONTACT_ID}&$ARG_CONTACT_NAME={$ARG_CONTACT_NAME}"
    
    fun globalScene(scene: PromptScene): String {
        return "$ROUTE?$ARG_MODE=global&$ARG_SCENE=${scene.name}"
    }
    
    fun contactCustom(contactId: String, contactName: String): String {
        val encodedName = URLEncoder.encode(contactName, "UTF-8")
        return "$ROUTE?$ARG_MODE=contact&$ARG_CONTACT_ID=$contactId&$ARG_CONTACT_NAME=$encodedName"
    }
}
```

#### 4.3.2 å¯¼èˆªå›¾é…ç½®

```kotlin
fun NavGraphBuilder.promptEditorNavigation(
    navController: NavController
) {
    composable(
        route = PromptEditorRoutes.FULL_ROUTE,
        arguments = listOf(
            navArgument(PromptEditorRoutes.ARG_MODE) {
                type = NavType.StringType
                defaultValue = "global"
            },
            navArgument(PromptEditorRoutes.ARG_SCENE) {
                type = NavType.StringType
                nullable = true
                defaultValue = null
            },
            navArgument(PromptEditorRoutes.ARG_CONTACT_ID) {
                type = NavType.StringType
                nullable = true
                defaultValue = null
            },
            navArgument(PromptEditorRoutes.ARG_CONTACT_NAME) {
                type = NavType.StringType
                nullable = true
                defaultValue = null
            }
        )
    ) {
        PromptEditorScreen(
            onNavigateBack = { navController.popBackStack() }
        )
    }
}
```

---

## 5. UIç»„ä»¶è®¾è®¡

### 5.1 ç»„ä»¶å±‚æ¬¡ç»“æ„

```
PromptEditorScreen
â”œâ”€â”€ EmotionalBackground (å¤ç”¨ç°æœ‰ç»„ä»¶)
â”œâ”€â”€ GlassmorphicCard (å¤ç”¨ç°æœ‰ç»„ä»¶)
â”‚   â”œâ”€â”€ PromptEditorTopBar
â”‚   â”‚   â”œâ”€â”€ CancelButton
â”‚   â”‚   â”œâ”€â”€ TitleText
â”‚   â”‚   â””â”€â”€ SaveButton / LoadingIndicator
â”‚   â”œâ”€â”€ PromptInputField
â”‚   â”‚   â”œâ”€â”€ BasicTextField
â”‚   â”‚   â””â”€â”€ PlaceholderText
â”‚   â””â”€â”€ CharacterCounter
â””â”€â”€ DiscardConfirmDialog
```

### 5.2 å…³é”®ç»„ä»¶è§„æ ¼

#### 5.2.1 PromptEditorTopBar

| å±æ€§ | è§„æ ¼ |
|------|------|
| é«˜åº¦ | 44.dp |
| å¸ƒå±€ | Row, SpaceBetween |
| å–æ¶ˆæŒ‰é’® | TextButton, bodyLarge, alpha 0.8 |
| æ ‡é¢˜ | titleMedium, SemiBold |
| å®ŒæˆæŒ‰é’® | TextButton, bodyLarge, SemiBold, BrandWarmGold |
| åŠ è½½åœˆ | CircularProgressIndicator, 20.dp, strokeWidth 2.dp |

#### 5.2.2 PromptInputField

| å±æ€§ | è§„æ ¼ |
|------|------|
| ç±»å‹ | BasicTextField |
| æœ€å°é«˜åº¦ | 200.dp |
| æ–‡å­—æ ·å¼ | bodyLarge, lineHeight 24.sp |
| å…‰æ ‡é¢œè‰² | BrandWarmGold |
| é€‰ä¸­æ‰‹æŸ„ | BrandWarmGold |
| å ä½ç¬¦é¢œè‰² | onSurface.copy(alpha = 0.4f) |

#### 5.2.3 CharacterCounter

| å±æ€§ | è§„æ ¼ |
|------|------|
| æ ·å¼ | bodySmall |
| æ­£å¸¸é¢œè‰² | onSurface.copy(alpha = 0.5f) |
| è­¦å‘Šé¢œè‰² | BrandWarmOrange (>800å­—) |
| è¶…é™é¢œè‰² | Color.Red (>1000å­—) |

### 5.3 å“ç‰Œè‰²å®šä¹‰

```kotlin
// presentation/theme/BrandColors.kt
val BrandWarmGold = Color(0xFFF5A623)      // æš–é‡‘è‰²
val BrandWarmOrange = Color(0xFFFF9500)    // æš–æ©™è‰²
val BrandWarmAmber = Color(0xFFFFCC00)     // ç¥ç€è‰²
```

---

## 6. é”®ç›˜é¿è®©è®¾è®¡

### 6.1 IME Insets å¤„ç†

```kotlin
@Composable
fun PromptEditorScreen(...) {
    Box(
        modifier = Modifier
            .fillMaxSize()
            .imePadding()           // é”®ç›˜é¿è®©
            .navigationBarsPadding() // å¯¼èˆªæ é¿è®©
    ) {
        // å†…å®¹
    }
}
```

### 6.2 å…‰æ ‡è·Ÿéšæ–¹æ¡ˆ

#### æ–¹æ¡ˆAï¼šBringIntoViewRequesterï¼ˆæ¨èï¼‰

```kotlin
val bringIntoViewRequester = remember { BringIntoViewRequester() }
val coroutineScope = rememberCoroutineScope()

BasicTextField(
    modifier = Modifier.bringIntoViewRequester(bringIntoViewRequester),
    onValueChange = { newText ->
        onValueChange(newText)
        coroutineScope.launch {
            bringIntoViewRequester.bringIntoView()
        }
    }
)
```

#### æ–¹æ¡ˆBï¼šonTextLayout ç²¾å‡†å®šä½ï¼ˆå¤‡é€‰ï¼‰

```kotlin
BasicTextField(
    onTextLayout = { textLayoutResult ->
        val cursorOffset = textFieldValue.selection.start
        val cursorRect = textLayoutResult.getCursorRect(cursorOffset)
        // æ ¹æ®å…‰æ ‡ä½ç½®è®¡ç®—æ»šåŠ¨
    }
)
```

---

## 7. é”™è¯¯å¤„ç†UIè®¾è®¡

### 7.1 è®¾è®¡å†³ç­–

**é—®é¢˜åˆ†æ**ï¼š
- å…¨å±æ²‰æµ¸å¼è®¾è®¡ + é”®ç›˜å¼¹èµ·æ—¶ï¼Œåº•éƒ¨Snackbarä¼šè¢«é”®ç›˜é®æŒ¡
- ä¼ ç»ŸToastä½ç½®ä¸å¯æ§ï¼Œå¯èƒ½ä¸è¾“å…¥åŒºåŸŸé‡å 

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨TopBarä¸‹æ–¹çš„InlineErrorBanner

### 7.2 InlineErrorBannerç»„ä»¶

```kotlin
/**
 * å†…è”é”™è¯¯æç¤ºæ¡
 * 
 * è®¾è®¡è¯´æ˜ï¼š
 * - ä½äºTopBarä¸‹æ–¹ï¼Œä¸ä¼šè¢«é”®ç›˜é®æŒ¡
 * - ä½¿ç”¨AnimatedVisibilityå®ç°å¹³æ»‘æ˜¾ç¤º/éšè—
 * - è‡ªåŠ¨3ç§’åæ¶ˆå¤±ï¼Œä¹Ÿå¯æ‰‹åŠ¨å…³é—­
 */
@Composable
fun InlineErrorBanner(
    errorMessage: String?,
    onDismiss: () -> Unit,
    modifier: Modifier = Modifier
) {
    AnimatedVisibility(
        visible = errorMessage != null,
        enter = slideInVertically(initialOffsetY = { -it }) + fadeIn(),
        exit = slideOutVertically(targetOffsetY = { -it }) + fadeOut(),
        modifier = modifier
    ) {
        errorMessage?.let { message ->
            // è‡ªåŠ¨æ¶ˆå¤±
            LaunchedEffect(message) {
                delay(ERROR_DISPLAY_DURATION_MS)
                onDismiss()
            }
            
            Surface(
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(horizontal = 16.dp),
                shape = RoundedCornerShape(8.dp),
                color = MaterialTheme.colorScheme.errorContainer,
                tonalElevation = 2.dp
            ) {
                Row(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(12.dp),
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    Icon(
                        imageVector = Icons.Rounded.Warning,
                        contentDescription = null,
                        tint = MaterialTheme.colorScheme.error,
                        modifier = Modifier.size(20.dp)
                    )
                    Spacer(modifier = Modifier.width(8.dp))
                    Text(
                        text = message,
                        style = MaterialTheme.typography.bodyMedium,
                        color = MaterialTheme.colorScheme.onErrorContainer,
                        modifier = Modifier.weight(1f)
                    )
                    IconButton(
                        onClick = onDismiss,
                        modifier = Modifier.size(24.dp)
                    ) {
                        Icon(
                            imageVector = Icons.Rounded.Close,
                            contentDescription = "å…³é—­",
                            tint = MaterialTheme.colorScheme.onErrorContainer,
                            modifier = Modifier.size(16.dp)
                        )
                    }
                }
            }
        }
    }
}

private const val ERROR_DISPLAY_DURATION_MS = 3000L
```

### 7.3 åœ¨PromptEditorScreenä¸­é›†æˆ

```kotlin
@Composable
fun PromptEditorScreen(
    viewModel: PromptEditorViewModel = hiltViewModel(),
    onNavigateBack: () -> Unit
) {
    val uiState by viewModel.uiState.collectAsStateWithLifecycle()
    
    Box(
        modifier = Modifier
            .fillMaxSize()
            .imePadding()
            .navigationBarsPadding()
    ) {
        EmotionalBackground(...)
        
        GlassmorphicCard(...) {
            Column {
                // é¡¶éƒ¨å¯¼èˆªæ 
                PromptEditorTopBar(...)
                
                // ğŸ†• é”™è¯¯æç¤ºæ¡ï¼ˆTopBarä¸‹æ–¹ï¼‰
                InlineErrorBanner(
                    errorMessage = uiState.errorMessage,
                    onDismiss = { viewModel.onEvent(PromptEditorUiEvent.ClearError) }
                )
                
                // è¾“å…¥åŒºåŸŸ
                PromptInputField(...)
                
                // å­—ç¬¦è®¡æ•°
                CharacterCounter(...)
            }
        }
    }
}
```

### 7.4 é”™è¯¯ç±»å‹ä¸å±•ç¤º

| é”™è¯¯ç±»å‹ | å±•ç¤ºæ–¹å¼ | è‡ªåŠ¨æ¶ˆå¤± |
|---------|---------|---------|
| åŠ è½½å¤±è´¥ | InlineErrorBanner | å¦ï¼ˆéœ€æ‰‹åŠ¨å…³é—­ï¼‰ |
| ä¿å­˜å¤±è´¥ | InlineErrorBanner | 3ç§’åè‡ªåŠ¨æ¶ˆå¤± |
| ç½‘ç»œé”™è¯¯ | InlineErrorBanner | 3ç§’åè‡ªåŠ¨æ¶ˆå¤± |
| å­—æ•°è¶…é™ | CharacterCounterå˜çº¢ | å¦ï¼ˆå®æ—¶æ˜¾ç¤ºï¼‰ |

---

## 8. æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 8.1 é‡ç»„ä¼˜åŒ–

```kotlin
// ä½¿ç”¨ derivedStateOf å‡å°‘é‡ç»„
val charCount by remember(value) {
    derivedStateOf { value.length }
}

// ä½¿ç”¨ remember ç¼“å­˜è®¡ç®—ç»“æœ
val charCountColor = remember(isOverLimit, isNearLimit) {
    when {
        isOverLimit -> Color.Red
        isNearLimit -> BrandWarmOrange
        else -> Color.Gray
    }
}
```

### 8.2 è¾“å…¥é˜²æŠ–ï¼ˆViewModelå±‚å®ç°ï¼‰

**è®¾è®¡åŸåˆ™**ï¼š
- UIå±‚ä¿æŒçº¯ç²¹ï¼Œåªè´Ÿè´£åˆ†å‘äº‹ä»¶
- ViewModelå±‚å¤„ç†é˜²æŠ–é€»è¾‘ï¼Œä¾¿äºå•å…ƒæµ‹è¯•
- ä½¿ç”¨Channel + debounceæ“ä½œç¬¦

```kotlin
// ========== ViewModelå±‚é˜²æŠ–å®ç° ==========

// 1. å®šä¹‰Channelæ¥æ”¶è¾“å…¥
private val promptInputChannel = Channel<String>(Channel.CONFLATED)

// 2. åœ¨initä¸­è®¾ç½®é˜²æŠ–å¤„ç†
init {
    setupInputDebounce()
}

private fun setupInputDebounce() {
    viewModelScope.launch {
        promptInputChannel.receiveAsFlow()
            .debounce(100L)  // 100msé˜²æŠ–
            .collect { text ->
                // é˜²æŠ–åæ‰§è¡ŒéªŒè¯ç­‰æ“ä½œ
                validatePrompt(text)
            }
    }
}

// 3. äº‹ä»¶å¤„ç†ï¼šç«‹å³æ›´æ–°UI + å‘é€åˆ°Channel
private fun handlePromptInput(text: String) {
    // ç«‹å³æ›´æ–°UIï¼ˆä¿è¯è¾“å…¥å“åº”æ€§ï¼‰
    _uiState.update { it.copy(currentPrompt = text) }
    
    // å‘é€åˆ°Channelè¿›è¡Œé˜²æŠ–å¤„ç†
    viewModelScope.launch {
        promptInputChannel.send(text)
    }
}
```

**UIå±‚ä»£ç ï¼ˆä¿æŒçº¯ç²¹ï¼‰**ï¼š

```kotlin
// UIå±‚åªè´Ÿè´£åˆ†å‘äº‹ä»¶ï¼Œä¸å¤„ç†é˜²æŠ–
BasicTextField(
    value = uiState.currentPrompt,
    onValueChange = { newText ->
        // ç›´æ¥å‘é€äº‹ä»¶ï¼Œé˜²æŠ–ç”±ViewModelå¤„ç†
        viewModel.onEvent(PromptEditorUiEvent.UpdatePrompt(newText))
    }
)
```

### 8.3 å¤§æ–‡æœ¬è¾“å…¥ä¿æŠ¤

**é—®é¢˜**ï¼šç”¨æˆ·ç²˜è´´è¶…å¤§æ–‡æœ¬ï¼ˆå¦‚10ä¸‡å­—ï¼‰å¯èƒ½ç¬é—´å¡æ­»ä¸»çº¿ç¨‹

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨onValueChangeä¸­å…ˆæˆªæ–­å†æ›´æ–°

```kotlin
private fun handlePromptInput(text: String) {
    // ğŸ›¡ï¸ å¤§æ–‡æœ¬ä¿æŠ¤ï¼šå…ˆæˆªæ–­å†å¤„ç†
    // é˜²æ­¢ç²˜è´´è¶…å¤§æ–‡æœ¬ï¼ˆå¦‚10ä¸‡å­—ï¼‰å¡æ­»ä¸»çº¿ç¨‹
    val safeText = text.take(PromptEditorUiState.MAX_PROMPT_LENGTH)
    
    // æˆªæ–­åå†æ›´æ–°çŠ¶æ€
    _uiState.update { it.copy(currentPrompt = safeText) }
    
    // å‘é€åˆ°Channelè¿›è¡Œåç»­å¤„ç†
    viewModelScope.launch {
        promptInputChannel.send(safeText)
    }
}
```

**å…³é”®ç‚¹**ï¼š
- `take(1000)` åœ¨æ›´æ–°çŠ¶æ€å‰æ‰§è¡Œï¼Œé¿å…å¤§æ–‡æœ¬è¿›å…¥StateFlow
- æˆªæ–­æ“ä½œæ˜¯O(n)ä½†nè¢«é™åˆ¶ä¸º1000ï¼Œæ€§èƒ½å¯æ§
- ç”¨æˆ·ç²˜è´´è¶…é•¿æ–‡æœ¬æ—¶ï¼Œåªä¿ç•™å‰1000å­—

### 8.4 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| é¦–æ¬¡æ¸²æŸ“ | < 100ms | åŒ…å«èƒŒæ™¯åŠ¨ç”»åˆå§‹åŒ– |
| è¾“å…¥å“åº” | < 16ms | ä¿è¯60fpsæµç•…è¾“å…¥ |
| å†…å­˜å ç”¨ | < 50MB | åŒ…å«èƒŒæ™¯æ¸²æŸ“ç¼“å­˜ |
| æ»šåŠ¨å¸§ç‡ | 60fps | é•¿æ–‡æœ¬æ»šåŠ¨æµç•… |
| é˜²æŠ–å»¶è¿Ÿ | 100ms | å¹³è¡¡å“åº”æ€§å’Œæ€§èƒ½ |
| æœ€å¤§æ–‡æœ¬ | 1000å­— | ç¡¬æ€§æˆªæ–­ä¿æŠ¤ |

---

## 9. æµ‹è¯•ç­–ç•¥

### 9.1 å•å…ƒæµ‹è¯•

| æµ‹è¯•ç±» | æµ‹è¯•å†…å®¹ |
|--------|---------|
| PromptEditorViewModelTest | çŠ¶æ€ç®¡ç†ã€äº‹ä»¶å¤„ç†ã€æ•°æ®åŠ è½½/ä¿å­˜ã€é˜²æŠ–é€»è¾‘ |
| PromptEditModeTest | ç¼–è¾‘æ¨¡å¼è§£æ |
| PromptEditorUiStateTest | è®¡ç®—å±æ€§éªŒè¯ |

**é˜²æŠ–é€»è¾‘æµ‹è¯•ç¤ºä¾‹**ï¼š

```kotlin
@Test
fun `å¤§æ–‡æœ¬è¾“å…¥åº”è¢«æˆªæ–­åˆ°1000å­—`() = runTest {
    // Given
    val viewModel = createViewModel()
    val largeText = "a".repeat(5000)  // 5000å­—
    
    // When
    viewModel.onEvent(PromptEditorUiEvent.UpdatePrompt(largeText))
    
    // Then
    assertEquals(1000, viewModel.uiState.value.currentPrompt.length)
}

@Test
fun `è¾“å…¥é˜²æŠ–åº”åœ¨100msåè§¦å‘éªŒè¯`() = runTest {
    // Given
    val viewModel = createViewModel()
    
    // When - å¿«é€Ÿè¿ç»­è¾“å…¥
    viewModel.onEvent(PromptEditorUiEvent.UpdatePrompt("a"))
    viewModel.onEvent(PromptEditorUiEvent.UpdatePrompt("ab"))
    viewModel.onEvent(PromptEditorUiEvent.UpdatePrompt("abc"))
    
    // Then - åªæœ‰æœ€åä¸€æ¬¡è¾“å…¥è¢«å¤„ç†
    advanceTimeBy(150)
    // éªŒè¯åªè§¦å‘ä¸€æ¬¡éªŒè¯
}
```

### 9.2 UIæµ‹è¯•

| æµ‹è¯•ç±» | æµ‹è¯•å†…å®¹ |
|--------|---------|
| PromptEditorScreenTest | ç•Œé¢æ¸²æŸ“ã€äº¤äº’å“åº” |
| PromptInputFieldTest | è¾“å…¥ã€å…‰æ ‡ã€å ä½ç¬¦ |
| CharacterCounterTest | è®¡æ•°æ˜¾ç¤ºã€é¢œè‰²å˜åŒ– |
| InlineErrorBannerTest | é”™è¯¯æç¤ºæ˜¾ç¤º/éšè—ã€è‡ªåŠ¨æ¶ˆå¤± |

**é”™è¯¯æç¤ºæµ‹è¯•ç¤ºä¾‹**ï¼š

```kotlin
@Test
fun `é”™è¯¯æç¤ºåº”åœ¨TopBarä¸‹æ–¹æ˜¾ç¤º`() {
    composeTestRule.setContent {
        PromptEditorScreen(
            uiState = PromptEditorUiState(errorMessage = "ä¿å­˜å¤±è´¥"),
            onEvent = {}
        )
    }
    
    // éªŒè¯é”™è¯¯æç¤ºå¯è§
    composeTestRule.onNodeWithText("ä¿å­˜å¤±è´¥").assertIsDisplayed()
}

@Test
fun `é”™è¯¯æç¤ºåº”åœ¨3ç§’åè‡ªåŠ¨æ¶ˆå¤±`() {
    // ä½¿ç”¨TestCoroutineDispatcheræ§åˆ¶æ—¶é—´
}
```

### 9.3 é›†æˆæµ‹è¯•

| æµ‹è¯•ç±» | æµ‹è¯•å†…å®¹ |
|--------|---------|
| PromptEditorIntegrationTest | å®Œæ•´ç¼–è¾‘æµç¨‹ã€å¯¼èˆªã€æ•°æ®æŒä¹…åŒ– |

---

## 10. æ–‡ä»¶æ¸…å•

### 10.1 æ–°å¢æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `presentation/ui/screen/prompt/PromptEditorScreen.kt` | ä¸»ç•Œé¢ |
| `presentation/ui/screen/prompt/PromptEditorUiState.kt` | UIçŠ¶æ€ |
| `presentation/ui/screen/prompt/PromptEditorUiEvent.kt` | UIäº‹ä»¶ |
| `presentation/ui/screen/prompt/component/PromptEditorTopBar.kt` | é¡¶éƒ¨å¯¼èˆªæ  |
| `presentation/ui/screen/prompt/component/PromptInputField.kt` | è¾“å…¥æ¡† |
| `presentation/ui/screen/prompt/component/CharacterCounter.kt` | å­—ç¬¦è®¡æ•°å™¨ |
| `presentation/ui/screen/prompt/component/DiscardConfirmDialog.kt` | ç¡®è®¤å¯¹è¯æ¡† |
| `presentation/ui/screen/prompt/component/InlineErrorBanner.kt` | é”™è¯¯æç¤ºæ¡ |
| `presentation/viewmodel/PromptEditorViewModel.kt` | ViewModel |
| `presentation/navigation/PromptEditorNavigation.kt` | å¯¼èˆªé…ç½® |

### 10.2 ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ |
|---------|---------|
| `presentation/theme/Color.kt` | æ·»åŠ å“ç‰Œè‰²å®šä¹‰ |
| `presentation/navigation/NavGraph.kt` | æ·»åŠ ç¼–è¾‘å™¨è·¯ç”± |
| `res/values/strings.xml` | æ·»åŠ å­—ç¬¦ä¸²èµ„æº |
| `res/values-en/strings.xml` | æ·»åŠ è‹±æ–‡å­—ç¬¦ä¸² |

---

## 11. ç›¸å…³æ–‡æ¡£

- [PRD-00006-æç¤ºè¯ç¼–è¾‘ç•Œé¢éœ€æ±‚](../PRD/PRD-00006-æç¤ºè¯ç¼–è¾‘ç•Œé¢éœ€æ±‚.md)
- [FD-00006-æç¤ºè¯ç¼–è¾‘ç•Œé¢åŠŸèƒ½è®¾è®¡](../FD/FD-00006-æç¤ºè¯ç¼–è¾‘ç•Œé¢åŠŸèƒ½è®¾è®¡.md)
- [TDD-00005-æç¤ºè¯ç®¡ç†ç³»ç»ŸæŠ€æœ¯è®¾è®¡](TDD-00005-æç¤ºè¯ç®¡ç†ç³»ç»ŸæŠ€æœ¯è®¾è®¡.md)
