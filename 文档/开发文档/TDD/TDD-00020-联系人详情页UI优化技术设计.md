# TDD-00020: è”ç³»äººè¯¦æƒ…é¡µUIä¼˜åŒ–æŠ€æœ¯è®¾è®¡

> **æ–‡æ¡£ç±»å‹**: æŠ€æœ¯è®¾è®¡æ–‡æ¡£ (TDD)
> **ç‰ˆæœ¬**: 1.1
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-26
> **æœ€åæ›´æ–°**: 2025-12-26
> **è´Ÿè´£äºº**: Kiro
> **çŠ¶æ€**: âœ… å®¡æŸ¥ä¿®è®¢å®Œæˆ
> **ä¼˜å…ˆçº§**: ğŸ”´ é«˜
> **å…³è”PRD**: PRD-00020
> **å…³è”FD**: FD-00020
> **å…³è”è°ƒç ”**: RESEARCH-00053
> **å…³è”å®¡æŸ¥**: DR-00020

---

## ğŸ“œ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹å†…å®¹ | ä¿®æ”¹äºº |
|------|------|----------|--------|
| 1.0 | 2025-12-26 | åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«å®Œæ•´æŠ€æœ¯å®ç°æ–¹æ¡ˆ | Kiro |
| 1.1 | 2025-12-26 | æ ¹æ®DR-00020å®¡æŸ¥æŠ¥å‘Šè¡¥å……ï¼šç³»ç»Ÿé›†æˆç« èŠ‚ã€é”™è¯¯å¤„ç†ç­–ç•¥ã€é›†æˆç­–ç•¥ | Kiro |

---

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

### è®¾è®¡ç›®æ ‡
åŸºäºFD-00020åŠŸèƒ½è®¾è®¡æ–‡æ¡£ï¼Œæä¾›è”ç³»äººè¯¦æƒ…é¡µ5ä¸ªé¡µé¢UIä¼˜åŒ–çš„è¯¦ç»†æŠ€æœ¯å®ç°æ–¹æ¡ˆï¼ŒåŒ…æ‹¬iOSé£æ ¼ç»„ä»¶åº“ã€Canvasç»‘åˆ¶ä¼˜åŒ–ã€åŠ¨ç”»ç³»ç»Ÿã€çŠ¶æ€ç®¡ç†ç­‰æŠ€æœ¯æ¶æ„å’Œå®ç°ç»†èŠ‚ã€‚

### æŠ€æœ¯åŸåˆ™
- **å®Œå…¨é‡å†™** - ä¸ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œå…¨éƒ¨é‡æ–°å®ç°æ–°ç»„ä»¶
- **iOSåŸç”Ÿé£æ ¼** - ä¸¥æ ¼éµå¾ªiOS Human Interface Guidelines
- **æ€§èƒ½ä¼˜å…ˆ** - Canvasç¼“å­˜ã€åŠ¨ç”»ä¼˜åŒ–ã€åˆ—è¡¨è™šæ‹ŸåŒ–
- **å¯å¤ç”¨æ€§** - ç»„ä»¶è®¾è®¡æ”¯æŒè·¨é¡µé¢å¤ç”¨

### å…³è”æ–‡æ¡£
- [PRD-00020-è”ç³»äººè¯¦æƒ…é¡µä¼˜åŒ–](../PRD/PRD-00020-è”ç³»äººè¯¦æƒ…é¡µä¼˜åŒ–.md)
- [FD-00020-è”ç³»äººè¯¦æƒ…é¡µUIä¼˜åŒ–åŠŸèƒ½è®¾è®¡](../FD/FD-00020-è”ç³»äººè¯¦æƒ…é¡µUIä¼˜åŒ–åŠŸèƒ½è®¾è®¡.md)
- [RESEARCH-00053-å‰ç½®è°ƒç ”æŠ¥å‘Š](../RE/RESEARCH-00053-PRD00020è”ç³»äººè¯¦æƒ…é¡µUIä¼˜åŒ–å‰ç½®è°ƒç ”æŠ¥å‘Š.md)
- [CR-00020-åŠŸèƒ½è®¾è®¡å®¡æŸ¥æŠ¥å‘Š](../CR/CR-00020-FD00020è”ç³»äººè¯¦æƒ…é¡µUIä¼˜åŒ–åŠŸèƒ½è®¾è®¡å®¡æŸ¥æŠ¥å‘Š.md)


### ğŸ”´ è®¾è®¡ç¨¿å¼ºåˆ¶å¼•ç”¨

| é¡µé¢ | è®¾è®¡ç¨¿è·¯å¾„ |
|------|-----------|
| æ¦‚è§ˆé¡µ | `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/UI-åŸå‹/PRD20/è”ç³»äººè¯¦æƒ…/æ¦‚è§ˆé¡µ.html` |
| äº‹å®æµé¡µ | `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/UI-åŸå‹/PRD20/è”ç³»äººè¯¦æƒ…/äº‹å®æµé¡µ.html` |
| ç”»åƒåº“é¡µ | `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/UI-åŸå‹/PRD20/è”ç³»äººè¯¦æƒ…/ç”»åƒåº“é¡µ.html` |
| èµ„æ–™åº“é¡µ | `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/UI-åŸå‹/PRD20/è”ç³»äººè¯¦æƒ…/èµ„æ–™åº“é¡µ.html` |
| æ–°å»ºè”ç³»äººé¡µ | `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/UI-åŸå‹/PRD20/è”ç³»äººè¯¦æƒ…/æ–°å»ºè”ç³»äººé¡µ.html` |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è®¾è®¡

### 1.1 æ¨¡å—æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        :presentation æ¨¡å—                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      theme/                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Color.kt   â”‚  â”‚EmotionColorsâ”‚  â”‚MacaronTagColors â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ (iOSç³»ç»Ÿè‰²) â”‚  â”‚    .kt      â”‚  â”‚     .kt         â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   ui/component/                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  ios/   â”‚  â”‚ chart/  â”‚  â”‚timeline/â”‚  â”‚  persona/ â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ filter/ â”‚  â”‚  tag/   â”‚  â”‚  vault/ â”‚  â”‚  contact/ â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     ui/screen/contact/                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ overview/ â”‚  â”‚factstream/â”‚  â”‚  persona/ â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚  â”‚   vault/  â”‚  â”‚CreateContactScreen.kt   â”‚             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç»„ä»¶ä¾èµ–å…³ç³»

```
Color.kt (iOSç³»ç»Ÿè‰² + æƒ…ç»ªè‰² + é©¬å¡é¾™è‰²)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é€šç”¨ç»„ä»¶å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IOSSegmentedControl â† HealthRingChart â† SparklineChart   â”‚
â”‚ EmotionNode â† EmotionTimelineView â† FilterChipRow        â”‚
â”‚ CategoryCard â† MacaronTagChip â† RiskTagItem              â”‚
â”‚ DataStatisticsCard â† DataSourceGridCard â† StatusBadge    â”‚
â”‚ IOSNavigationBar â† AvatarPicker â† ContactFormCard        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é¡µé¢ç»„ä»¶å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OverviewTab â† FactStreamTab â† PersonaTab â† DataVaultTab  â”‚
â”‚ CreateContactScreen â† ContactDetailTabScreen             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ•°æ®æµè®¾è®¡

```
ç”¨æˆ·æ“ä½œ â†’ Screen â†’ ViewModel â†’ UseCase â†’ Repository
    â†‘                   â†“
    â””â”€â”€â”€ UiState â†â”€â”€â”€â”€â”€â”€â”˜

Tabåˆ‡æ¢æµç¨‹:
Tabç‚¹å‡» â†’ IOSSegmentedControl.onTabSelected()
       â†’ ContactDetailTabViewModel.selectTab()
       â†’ UiStateæ›´æ–°
       â†’ å¯¹åº”Tabå†…å®¹æ¸²æŸ“
```


---

## ğŸ¨ æ¨¡å—1ï¼šè‰²å½©ç³»ç»ŸæŠ€æœ¯å®ç°

### 2.1 iOSç³»ç»Ÿè‰²å¸¸é‡æ‰©å±•

**ä¿®æ”¹æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/theme/Color.kt`

```kotlin
// ========== iOSç³»ç»ŸèƒŒæ™¯è‰² ==========
/** iOSåˆ†ç»„èƒŒæ™¯è‰² - ç”¨äºé¡µé¢èƒŒæ™¯ */
val iOSSystemGroupedBackground = Color(0xFFF2F2F7)

/** iOSæµ…ç°èƒŒæ™¯è‰² - ç”¨äºå¡ç‰‡å¤–èƒŒæ™¯ */
val iOSLightGrayBackground = Color(0xFFF5F5F7)

/** iOSå¡ç‰‡èƒŒæ™¯è‰² - çº¯ç™½ */
val iOSCardBackground = Color(0xFFFFFFFF)

// ========== iOSç³»ç»Ÿè‰² ==========
/** iOSè“ - é“¾æ¥ã€æŒ‰é’®ã€åˆ†æ®µæ§åˆ¶å™¨æ¿€æ´»æ€ */
val iOSBlue = Color(0xFF007AFF)

/** iOSç»¿ - æˆåŠŸã€å¼€å…³æ¿€æ´»æ€ */
val iOSGreen = Color(0xFF34C759)

/** iOSçº¢ - åˆ é™¤ã€è­¦å‘Šã€é«˜é£é™© */
val iOSRed = Color(0xFFFF3B30)

/** iOSæ©™ - ä¸­é£é™© */
val iOSOrange = Color(0xFFFF9500)

/** iOSç´« - AIåŠŸèƒ½ã€ç‰¹æ®Šæ ‡è¯† */
val iOSPurple = Color(0xFFAF52DE)

/** iOSé›è“ - èµ„æ–™åº“å›¾æ ‡ */
val iOSIndigo = Color(0xFF5856D6)

// ========== iOSæ–‡å­—è‰² ==========
/** ä¸»è¦æ–‡å­— - é»‘è‰² */
val iOSTextPrimary = Color(0xFF000000)

/** æ¬¡è¦æ–‡å­— - ç°è‰² */
val iOSTextSecondary = Color(0xFF8E8E93)

/** ç¬¬ä¸‰çº§æ–‡å­— - æµ…ç° */
val iOSTextTertiary = Color(0xFFC7C7CC)

// ========== iOSåˆ†éš”çº¿ ==========
/** iOSåˆ†éš”çº¿é¢œè‰² */
val iOSSeparator = Color(0xFFE5E5EA)
```

### 2.2 æƒ…ç»ªç±»å‹é¢œè‰²ç³»ç»Ÿ

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/theme/EmotionColors.kt`

```kotlin
package com.empathy.ai.presentation.theme

import androidx.compose.ui.graphics.Color

/**
 * æƒ…ç»ªç±»å‹é¢œè‰²ç³»ç»Ÿ
 * ç”¨äºäº‹å®æµé¡µé¢çš„æƒ…ç»ªèŠ‚ç‚¹æ¸å˜èƒŒæ™¯
 */
object EmotionColors {
    /** ç”œèœœ - ç²‰çº¢æ¸å˜ */
    val Sweet = listOf(Color(0xFFFFB6C1), Color(0xFFFF69B4))
    
    /** å†²çª - æ©™çº¢æ¸å˜ */
    val Conflict = listOf(Color(0xFFFFA07A), Color(0xFFFF6347))
    
    /** ä¸­æ€§ - è“ç°æ¸å˜ */
    val Neutral = listOf(Color(0xFFB0C4DE), Color(0xFF87CEEB))
    
    /** ç¤¼ç‰© - é‡‘é»„æ¸å˜ */
    val Gift = listOf(Color(0xFFFFD700), Color(0xFFFFA500))
    
    /** çº¦ä¼š - ç´«ç²‰æ¸å˜ */
    val Date = listOf(Color(0xFFDDA0DD), Color(0xFFBA55D3))
    
    /** æ·±è°ˆ - é’ç»¿æ¸å˜ */
    val DeepTalk = listOf(Color(0xFF98D8C8), Color(0xFF20B2AA))
    
    /**
     * æ ¹æ®æƒ…ç»ªç±»å‹è·å–æ¸å˜è‰²åˆ—è¡¨
     */
    fun getGradient(emotionType: EmotionType): List<Color> {
        return when (emotionType) {
            EmotionType.SWEET -> Sweet
            EmotionType.CONFLICT -> Conflict
            EmotionType.NEUTRAL -> Neutral
            EmotionType.GIFT -> Gift
            EmotionType.DATE -> Date
            EmotionType.DEEP_TALK -> DeepTalk
        }
    }
}

/**
 * æƒ…ç»ªç±»å‹æšä¸¾
 */
enum class EmotionType(
    val emoji: String,
    val displayName: String
) {
    SWEET("â¤ï¸", "ç”œèœœ"),
    CONFLICT("â›ˆï¸", "å†²çª"),
    NEUTRAL("ğŸ’­", "ä¸­æ€§"),
    GIFT("ğŸ", "ç¤¼ç‰©"),
    DATE("ğŸ½ï¸", "çº¦ä¼š"),
    DEEP_TALK("ğŸ’¬", "æ·±è°ˆ")
}
```

### 2.3 é©¬å¡é¾™è‰²ç³»æ ‡ç­¾

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/theme/MacaronTagColors.kt`

```kotlin
package com.empathy.ai.presentation.theme

import androidx.compose.ui.graphics.Color

/**
 * é©¬å¡é¾™è‰²ç³»æ ‡ç­¾é…è‰²
 * ç”¨äºç”»åƒåº“é¡µé¢çš„æ ‡ç­¾èƒ¶å›Š
 */
object MacaronTagColors {
    /** ç²‰è‰²ç³» - èƒŒæ™¯è‰² to æ–‡å­—è‰² */
    val Pink = Color(0xFFFFF0F3) to Color(0xFFC41E3A)
    
    /** é»„è‰²ç³» */
    val Yellow = Color(0xFFFFF8E1) to Color(0xFFB8860B)
    
    /** é’è‰²ç³» */
    val Cyan = Color(0xFFE0F7FA) to Color(0xFF00838F)
    
    /** ç´«è‰²ç³» */
    val Purple = Color(0xFFF3E5F5) to Color(0xFF7B1FA2)
    
    /** ç»¿è‰²ç³» */
    val Green = Color(0xFFE8F5E9) to Color(0xFF2E7D32)
    
    /** è“è‰²ç³» */
    val Blue = Color(0xFFE3F2FD) to Color(0xFF1565C0)
    
    private val colorPairs = listOf(Pink, Yellow, Cyan, Purple, Green, Blue)
    
    /**
     * æ ¹æ®æ ‡ç­¾åè·å–é¢œè‰²å¯¹
     * @param tagName æ ‡ç­¾åç§°
     * @return Pair<èƒŒæ™¯è‰², æ–‡å­—è‰²>
     */
    fun getColorPair(tagName: String): Pair<Color, Color> {
        val index = tagName.hashCode().let { 
            if (it < 0) -it else it 
        } % colorPairs.size
        return colorPairs[index]
    }
}
```

### 2.4 åˆ†ç±»å¡ç‰‡è‰²æ¡é¢œè‰²

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/theme/CategoryBarColors.kt`

```kotlin
package com.empathy.ai.presentation.theme

import androidx.compose.ui.graphics.Color

/**
 * åˆ†ç±»å¡ç‰‡å·¦ä¾§è‰²æ¡é¢œè‰²
 * ç”¨äºç”»åƒåº“é¡µé¢çš„åˆ†ç±»å¡ç‰‡
 */
object CategoryBarColors {
    /** å…´è¶£çˆ±å¥½ - æ©™è‰² */
    val Interests = Color(0xFFF97316)
    
    /** å·¥ä½œä¿¡æ¯ - è“è‰² */
    val Work = Color(0xFF3B82F6)
    
    /** æ²Ÿé€šç­–ç•¥ - ç»¿è‰² */
    val Strategy = Color(0xFF10B981)
    
    /** é›·åŒºæ ‡ç­¾ - çº¢è‰² */
    val Risk = Color(0xFFEF4444)
    
    /**
     * æ ¹æ®åˆ†ç±»ç±»å‹è·å–è‰²æ¡é¢œè‰²
     */
    fun getBarColor(category: TagCategory): Color {
        return when (category) {
            TagCategory.INTERESTS -> Interests
            TagCategory.WORK -> Work
            TagCategory.STRATEGY -> Strategy
            TagCategory.RISK -> Risk
        }
    }
}

/**
 * æ ‡ç­¾åˆ†ç±»æšä¸¾
 */
enum class TagCategory(val displayName: String) {
    INTERESTS("å…´è¶£çˆ±å¥½"),
    WORK("å·¥ä½œä¿¡æ¯"),
    STRATEGY("æ²Ÿé€šç­–ç•¥"),
    RISK("é›·åŒºæ ‡ç­¾")
}
```


---

## ğŸ“¦ æ¨¡å—2ï¼šiOSé£æ ¼ç»„ä»¶åº“æŠ€æœ¯å®ç°

### 3.1 IOSSegmentedControlåˆ†æ®µæ§åˆ¶å™¨

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/ios/IOSSegmentedControl.kt`

**æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨`animateDpAsState`å®ç°æ»‘å—å¹³æ»‘ç§»åŠ¨
- æ»‘å—ä½¿ç”¨ç™½è‰²èƒŒæ™¯+æŠ•å½±ï¼Œåœ†è§’7dp
- åŠ¨ç”»æ—¶é•¿250msï¼Œä½¿ç”¨`FastOutSlowInEasing`

```kotlin
package com.empathy.ai.presentation.ui.component.ios

import androidx.compose.animation.core.FastOutSlowInEasing
import androidx.compose.animation.core.animateDpAsState
import androidx.compose.animation.core.tween
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.Dp
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp

/**
 * iOSé£æ ¼åˆ†æ®µæ§åˆ¶å™¨
 * 
 * @param tabs æ ‡ç­¾é¡µåˆ—è¡¨
 * @param selectedIndex å½“å‰é€‰ä¸­ç´¢å¼•
 * @param onTabSelected æ ‡ç­¾é€‰ä¸­å›è°ƒ
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun IOSSegmentedControl(
    tabs: List<String>,
    selectedIndex: Int,
    onTabSelected: (Int) -> Unit,
    modifier: Modifier = Modifier
) {
    val tabCount = tabs.size
    
    BoxWithConstraints(
        modifier = modifier
            .fillMaxWidth()
            .height(32.dp)
            .clip(RoundedCornerShape(8.dp))
            .background(Color(0x1F767680)) // rgba(118, 118, 128, 0.12)
            .padding(2.dp)
    ) {
        val tabWidth = (maxWidth - 4.dp) / tabCount
        
        // æ»‘å—ä½ç½®åŠ¨ç”»
        val sliderOffset by animateDpAsState(
            targetValue = tabWidth * selectedIndex,
            animationSpec = tween(250, easing = FastOutSlowInEasing),
            label = "sliderOffset"
        )
        
        // ç™½è‰²æ»‘å—
        Box(
            modifier = Modifier
                .offset(x = sliderOffset)
                .width(tabWidth)
                .fillMaxHeight()
                .shadow(2.dp, RoundedCornerShape(7.dp))
                .background(Color.White, RoundedCornerShape(7.dp))
        )
        
        // æ ‡ç­¾æ–‡å­—
        Row(modifier = Modifier.fillMaxSize()) {
            tabs.forEachIndexed { index, tab ->
                Box(
                    modifier = Modifier
                        .weight(1f)
                        .fillMaxHeight()
                        .clickable { onTabSelected(index) },
                    contentAlignment = Alignment.Center
                ) {
                    Text(
                        text = tab,
                        fontSize = 13.sp,
                        fontWeight = if (index == selectedIndex) 
                            FontWeight.SemiBold else FontWeight.Normal,
                        color = Color.Black
                    )
                }
            }
        }
    }
}
```

### 3.2 HealthRingChartåœ†ç¯å›¾

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/chart/HealthRingChart.kt`

**æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨`Canvas`ç»‘åˆ¶æ¸å˜åœ†å¼§
- ä½¿ç”¨`remember`ç¼“å­˜`Brush`å¯¹è±¡é¿å…é‡å¤åˆ›å»º
- ä½¿ç”¨`animateFloatAsState`å®ç°è¿›åº¦åŠ¨ç”»
- åœ†å¤´æœ«ç«¯ä½¿ç”¨`StrokeCap.Round`

```kotlin
package com.empathy.ai.presentation.ui.component.chart

import androidx.compose.animation.core.FastOutSlowInEasing
import androidx.compose.animation.core.animateFloatAsState
import androidx.compose.animation.core.tween
import androidx.compose.foundation.Canvas
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.size
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.geometry.Offset
import androidx.compose.ui.geometry.Size
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.graphics.StrokeCap
import androidx.compose.ui.graphics.drawscope.Stroke
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp

/**
 * Apple Healthé£æ ¼åœ†ç¯å›¾
 * 
 * @param progress è¿›åº¦å€¼ (0f-1f)
 * @param score æ˜¾ç¤ºçš„åˆ†æ•°
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun HealthRingChart(
    progress: Float,
    score: Int,
    modifier: Modifier = Modifier
) {
    // ç¼“å­˜æ¸å˜Brush
    val gradientBrush = remember {
        Brush.sweepGradient(
            colors = listOf(
                Color(0xFFFF6B9D),  // ç²‰çº¢
                Color(0xFFFF8A80),  // çŠç‘š
                Color(0xFFFFC371)   // é‡‘é»„
            )
        )
    }
    
    // è¿›åº¦åŠ¨ç”»
    val animatedProgress by animateFloatAsState(
        targetValue = progress,
        animationSpec = tween(1000, easing = FastOutSlowInEasing),
        label = "progress"
    )
    
    Box(
        modifier = modifier.size(72.dp),
        contentAlignment = Alignment.Center
    ) {
        Canvas(modifier = Modifier.size(72.dp)) {
            val strokeWidth = 8.dp.toPx()
            val radius = (size.minDimension - strokeWidth) / 2
            val topLeft = Offset(strokeWidth / 2, strokeWidth / 2)
            val arcSize = Size(radius * 2, radius * 2)
            
            // èƒŒæ™¯è½¨é“
            drawArc(
                color = Color(0xFFE5E5EA),
                startAngle = -90f,
                sweepAngle = 360f,
                useCenter = false,
                topLeft = topLeft,
                size = arcSize,
                style = Stroke(width = strokeWidth, cap = StrokeCap.Round)
            )
            
            // è¿›åº¦åœ†å¼§
            drawArc(
                brush = gradientBrush,
                startAngle = -90f,
                sweepAngle = 360f * animatedProgress,
                useCenter = false,
                topLeft = topLeft,
                size = arcSize,
                style = Stroke(width = strokeWidth, cap = StrokeCap.Round)
            )
        }
        
        // ä¸­å¿ƒåˆ†æ•°
        Text(
            text = score.toString(),
            fontSize = 20.sp,
            fontWeight = FontWeight.Bold,
            color = Color.Black
        )
    }
}
```

### 3.3 SparklineChartè¶‹åŠ¿å›¾

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/chart/SparklineChart.kt`

**æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨`Path`ç»˜åˆ¶å¹³æ»‘æ›²çº¿
- ä½¿ç”¨`quadraticBezierTo`å®ç°äºŒæ¬¡è´å¡å°”æ›²çº¿
- ç¼“å­˜`Path`å¯¹è±¡é¿å…é‡å¤åˆ›å»º

```kotlin
package com.empathy.ai.presentation.ui.component.chart

import androidx.compose.foundation.Canvas
import androidx.compose.foundation.layout.size
import androidx.compose.runtime.Composable
import androidx.compose.runtime.remember
import androidx.compose.ui.Modifier
import androidx.compose.ui.geometry.Offset
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.graphics.Path
import androidx.compose.ui.graphics.StrokeCap
import androidx.compose.ui.graphics.drawscope.Stroke
import androidx.compose.ui.unit.dp
import com.empathy.ai.presentation.theme.iOSGreen

/**
 * Sparklineè¶‹åŠ¿å›¾
 * 
 * @param data æ•°æ®ç‚¹åˆ—è¡¨
 * @param modifier ä¿®é¥°ç¬¦
 * @param lineColor çº¿æ¡é¢œè‰²
 */
@Composable
fun SparklineChart(
    data: List<Float>,
    modifier: Modifier = Modifier,
    lineColor: Color = iOSGreen
) {
    // ç¼“å­˜Pathå¯¹è±¡
    val path = remember { Path() }
    
    // å½’ä¸€åŒ–æ•°æ®
    val normalizedData = remember(data) {
        if (data.isEmpty()) return@remember emptyList()
        val max = data.maxOrNull() ?: 1f
        val min = data.minOrNull() ?: 0f
        val range = (max - min).coerceAtLeast(1f)
        data.map { (it - min) / range }
    }
    
    Canvas(modifier = modifier.size(60.dp, 28.dp)) {
        if (normalizedData.size < 2) return@Canvas
        
        path.reset()
        
        val stepX = size.width / (normalizedData.size - 1)
        val points = normalizedData.mapIndexed { index, value ->
            Offset(
                x = index * stepX,
                y = size.height * (1 - value)
            )
        }
        
        // ç»˜åˆ¶å¹³æ»‘æ›²çº¿
        path.moveTo(points.first().x, points.first().y)
        
        for (i in 1 until points.size) {
            val prev = points[i - 1]
            val curr = points[i]
            val midX = (prev.x + curr.x) / 2
            
            path.quadraticBezierTo(
                prev.x + (midX - prev.x) * 0.5f, prev.y,
                midX, (prev.y + curr.y) / 2
            )
            path.quadraticBezierTo(
                midX + (curr.x - midX) * 0.5f, curr.y,
                curr.x, curr.y
            )
        }
        
        // ç»˜åˆ¶æ›²çº¿
        drawPath(
            path = path,
            color = lineColor,
            style = Stroke(width = 2.dp.toPx(), cap = StrokeCap.Round)
        )
        
        // ç»˜åˆ¶ç»ˆç‚¹åœ†ç‚¹
        drawCircle(
            color = lineColor,
            radius = 3.dp.toPx(),
            center = points.last()
        )
    }
}
```


---

## ğŸ“¦ æ¨¡å—3ï¼šæ—¶å…‰è½´ç»„ä»¶æŠ€æœ¯å®ç°

### 4.1 EmotionNodeæƒ…ç»ªèŠ‚ç‚¹

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/timeline/EmotionNode.kt`

**æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨`Brush.linearGradient`åˆ›å»ºæ¸å˜èƒŒæ™¯
- ç™½è‰²ç¯å½¢è¾¹æ¡†4dp
- å¤–å±‚æŠ•å½±ä½¿ç”¨`shadow`ä¿®é¥°ç¬¦

```kotlin
package com.empathy.ai.presentation.ui.component.timeline

import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.EmotionColors
import com.empathy.ai.presentation.theme.EmotionType

/**
 * æƒ…ç»ªèŠ‚ç‚¹ç»„ä»¶
 * 
 * @param emotionType æƒ…ç»ªç±»å‹
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun EmotionNode(
    emotionType: EmotionType,
    modifier: Modifier = Modifier
) {
    val gradientColors = EmotionColors.getGradient(emotionType)
    
    Box(
        modifier = modifier
            .size(40.dp)
            .shadow(8.dp, CircleShape)
            .background(
                brush = Brush.linearGradient(gradientColors),
                shape = CircleShape
            )
            .border(4.dp, Color.White, CircleShape),
        contentAlignment = Alignment.Center
    ) {
        Text(
            text = emotionType.emoji,
            fontSize = 16.sp
        )
    }
}
```

### 4.2 TimelineLineè¿æ¥çº¿

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/timeline/TimelineLine.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.timeline

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.fillMaxHeight
import androidx.compose.foundation.layout.width
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import com.empathy.ai.presentation.theme.iOSSeparator

/**
 * æ—¶å…‰è½´è¿æ¥çº¿
 */
@Composable
fun TimelineLine(
    modifier: Modifier = Modifier
) {
    Box(
        modifier = modifier
            .width(2.dp)
            .fillMaxHeight()
            .background(iOSSeparator)
    )
}
```

### 4.3 EmotionTimelineViewæ—¶å…‰è½´è§†å›¾

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/timeline/EmotionTimelineView.kt`

**æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨`LazyColumn`å®ç°è™šæ‹ŸåŒ–åˆ—è¡¨
- æä¾›ç¨³å®šçš„`key`ä¼˜åŒ–diffç®—æ³•
- ä½¿ç”¨`AnimatedVisibility`å®ç°æ·¡å…¥åŠ¨ç”»

```kotlin
package com.empathy.ai.presentation.ui.component.timeline

import androidx.compose.animation.AnimatedVisibility
import androidx.compose.animation.core.tween
import androidx.compose.animation.fadeIn
import androidx.compose.animation.slideInVertically
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.itemsIndexed
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import com.empathy.ai.presentation.theme.EmotionType
import kotlinx.coroutines.delay

/**
 * æ—¶å…‰è½´æ•°æ®é¡¹
 */
data class TimelineItem(
    val id: String,
    val emotionType: EmotionType,
    val timestamp: String,
    val content: String,
    val aiSuggestion: String? = null,
    val isAiSummary: Boolean = false,
    val scoreChange: Int? = null,
    val tags: List<String> = emptyList()
)

/**
 * æƒ…ç»ªæ—¶å…‰è½´è§†å›¾
 * 
 * @param items æ—¶å…‰è½´æ•°æ®åˆ—è¡¨
 * @param modifier ä¿®é¥°ç¬¦
 * @param onItemClick é¡¹ç›®ç‚¹å‡»å›è°ƒ
 */
@Composable
fun EmotionTimelineView(
    items: List<TimelineItem>,
    modifier: Modifier = Modifier,
    onItemClick: (TimelineItem) -> Unit = {}
) {
    LazyColumn(
        modifier = modifier.fillMaxSize(),
        contentPadding = PaddingValues(vertical = 16.dp),
        verticalArrangement = Arrangement.spacedBy(0.dp)
    ) {
        itemsIndexed(
            items = items,
            key = { _, item -> item.id }
        ) { index, item ->
            // æ·¡å…¥åŠ¨ç”»çŠ¶æ€
            var visible by remember { mutableStateOf(false) }
            
            LaunchedEffect(Unit) {
                delay(index * 50L) // é”™è½å»¶è¿Ÿ
                visible = true
            }
            
            AnimatedVisibility(
                visible = visible,
                enter = fadeIn(animationSpec = tween(400)) +
                        slideInVertically(initialOffsetY = { 20 })
            ) {
                Row(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(horizontal = 16.dp)
                ) {
                    // å·¦ä¾§ï¼šæƒ…ç»ªèŠ‚ç‚¹ + è¿æ¥çº¿
                    Column(
                        modifier = Modifier.width(48.dp),
                        horizontalAlignment = Alignment.CenterHorizontally
                    ) {
                        EmotionNode(emotionType = item.emotionType)
                        
                        if (index < items.lastIndex) {
                            TimelineLine(
                                modifier = Modifier.height(80.dp)
                            )
                        }
                    }
                    
                    Spacer(modifier = Modifier.width(12.dp))
                    
                    // å³ä¾§ï¼šå†…å®¹å¡ç‰‡
                    TimelineCard(
                        item = item,
                        onClick = { onItemClick(item) },
                        modifier = Modifier.weight(1f)
                    )
                }
            }
        }
    }
}
```

### 4.4 TimelineCardæ—¶å…‰è½´å¡ç‰‡

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/timeline/TimelineCard.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.timeline

import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.*

/**
 * æ—¶å…‰è½´å¡ç‰‡ç»„ä»¶
 */
@Composable
fun TimelineCard(
    item: TimelineItem,
    onClick: () -> Unit,
    modifier: Modifier = Modifier
) {
    val cardModifier = if (item.isAiSummary) {
        modifier.border(1.dp, iOSPurple.copy(alpha = 0.3f), RoundedCornerShape(16.dp))
    } else {
        modifier
    }
    
    Card(
        modifier = cardModifier
            .fillMaxWidth()
            .clickable(onClick = onClick),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(containerColor = iOSCardBackground),
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            // æ—¶é—´æˆ³
            Text(
                text = item.timestamp,
                fontSize = 12.sp,
                color = iOSTextSecondary
            )
            
            Spacer(modifier = Modifier.height(8.dp))
            
            // å†…å®¹
            Text(
                text = item.content,
                fontSize = 15.sp,
                color = iOSTextPrimary,
                lineHeight = 22.sp
            )
            
            // AIå»ºè®®ï¼ˆå¦‚æœæœ‰ï¼‰
            if (item.aiSuggestion != null) {
                Spacer(modifier = Modifier.height(12.dp))
                
                Box(
                    modifier = Modifier
                        .fillMaxWidth()
                        .background(
                            iOSPurple.copy(alpha = 0.08f),
                            RoundedCornerShape(8.dp)
                        )
                        .padding(12.dp)
                ) {
                    Column {
                        Text(
                            text = "AI å»ºè®®",
                            fontSize = 12.sp,
                            fontWeight = FontWeight.SemiBold,
                            color = iOSPurple
                        )
                        Spacer(modifier = Modifier.height(4.dp))
                        Text(
                            text = item.aiSuggestion,
                            fontSize = 14.sp,
                            color = iOSTextPrimary
                        )
                    }
                }
            }
            
            // å…³ç³»åˆ†æ•°å˜åŒ–ï¼ˆå¦‚æœæœ‰ï¼‰
            if (item.scoreChange != null) {
                Spacer(modifier = Modifier.height(8.dp))
                Text(
                    text = "å…³ç³»åˆ†æ•° ${if (item.scoreChange > 0) "+" else ""}${item.scoreChange}",
                    fontSize = 13.sp,
                    fontWeight = FontWeight.Medium,
                    color = if (item.scoreChange > 0) iOSGreen else iOSRed
                )
            }
            
            // æ ‡ç­¾ï¼ˆå¦‚æœæœ‰ï¼‰
            if (item.tags.isNotEmpty()) {
                Spacer(modifier = Modifier.height(8.dp))
                Row(
                    horizontalArrangement = Arrangement.spacedBy(8.dp)
                ) {
                    item.tags.forEach { tag ->
                        TagChip(text = tag)
                    }
                }
            }
        }
    }
}

@Composable
private fun TagChip(text: String) {
    Box(
        modifier = Modifier
            .background(
                iOSBlue.copy(alpha = 0.1f),
                RoundedCornerShape(12.dp)
            )
            .padding(horizontal = 10.dp, vertical = 4.dp)
    ) {
        Text(
            text = text,
            fontSize = 12.sp,
            color = iOSBlue
        )
    }
}
```


---

## ğŸ“¦ æ¨¡å—4ï¼šç”»åƒåº“ç»„ä»¶æŠ€æœ¯å®ç°

### 5.1 CategoryCardåˆ†ç±»å¡ç‰‡

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/persona/CategoryCard.kt`

**æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨`drawBehind`ç»˜åˆ¶å·¦ä¾§4pxè‰²æ¡
- ä½¿ç”¨`AnimatedVisibility`å®ç°æŠ˜å /å±•å¼€åŠ¨ç”»
- æ”¯æŒæ ‡ç­¾åˆ—è¡¨å’Œæ·»åŠ æŒ‰é’®

```kotlin
package com.empathy.ai.presentation.ui.component.persona

import androidx.compose.animation.AnimatedVisibility
import androidx.compose.animation.expandVertically
import androidx.compose.animation.shrinkVertically
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.ExpandLess
import androidx.compose.material.icons.filled.ExpandMore
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.draw.drawBehind
import androidx.compose.ui.geometry.Offset
import androidx.compose.ui.geometry.Size
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.*

/**
 * åˆ†ç±»å¡ç‰‡ç»„ä»¶
 * 
 * @param category åˆ†ç±»ç±»å‹
 * @param tags æ ‡ç­¾åˆ—è¡¨
 * @param isExpanded æ˜¯å¦å±•å¼€
 * @param onToggle æŠ˜å /å±•å¼€å›è°ƒ
 * @param onAddTag æ·»åŠ æ ‡ç­¾å›è°ƒ
 * @param onTagClick æ ‡ç­¾ç‚¹å‡»å›è°ƒ
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun CategoryCard(
    category: TagCategory,
    tags: List<String>,
    isExpanded: Boolean,
    onToggle: () -> Unit,
    onAddTag: () -> Unit,
    onTagClick: (String) -> Unit,
    modifier: Modifier = Modifier
) {
    val barColor = CategoryBarColors.getBarColor(category)
    
    Card(
        modifier = modifier
            .fillMaxWidth()
            .clip(RoundedCornerShape(16.dp))
            .drawBehind {
                // å·¦ä¾§4pxè‰²æ¡
                drawRect(
                    color = barColor,
                    topLeft = Offset.Zero,
                    size = Size(4.dp.toPx(), size.height)
                )
            },
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(containerColor = iOSCardBackground),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column {
            // å¤´éƒ¨ï¼šåˆ†ç±»å + æ•°é‡ + æŠ˜å å›¾æ ‡
            Row(
                modifier = Modifier
                    .fillMaxWidth()
                    .clickable(onClick = onToggle)
                    .padding(16.dp),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Row(verticalAlignment = Alignment.CenterVertically) {
                    Text(
                        text = category.displayName,
                        fontSize = 17.sp,
                        fontWeight = FontWeight.SemiBold,
                        color = iOSTextPrimary
                    )
                    Spacer(modifier = Modifier.width(8.dp))
                    Text(
                        text = "${tags.size}ä¸ª",
                        fontSize = 14.sp,
                        color = iOSTextSecondary
                    )
                }
                
                Icon(
                    imageVector = if (isExpanded) 
                        Icons.Default.ExpandLess else Icons.Default.ExpandMore,
                    contentDescription = if (isExpanded) "æ”¶èµ·" else "å±•å¼€",
                    tint = iOSTextSecondary
                )
            }
            
            // å†…å®¹ï¼šæ ‡ç­¾åˆ—è¡¨
            AnimatedVisibility(
                visible = isExpanded,
                enter = expandVertically(),
                exit = shrinkVertically()
            ) {
                FlowRow(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(start = 16.dp, end = 16.dp, bottom = 16.dp),
                    horizontalArrangement = Arrangement.spacedBy(8.dp),
                    verticalArrangement = Arrangement.spacedBy(8.dp)
                ) {
                    tags.forEach { tag ->
                        MacaronTagChip(
                            text = tag,
                            onClick = { onTagClick(tag) }
                        )
                    }
                    
                    // æ·»åŠ æŒ‰é’®
                    AddTagButton(onClick = onAddTag)
                }
            }
        }
    }
}
```

### 5.2 MacaronTagChipé©¬å¡é¾™æ ‡ç­¾

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/tag/MacaronTagChip.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.tag

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.MacaronTagColors

/**
 * é©¬å¡é¾™è‰²æ ‡ç­¾èƒ¶å›Š
 * 
 * @param text æ ‡ç­¾æ–‡å­—
 * @param onClick ç‚¹å‡»å›è°ƒ
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun MacaronTagChip(
    text: String,
    onClick: () -> Unit,
    modifier: Modifier = Modifier
) {
    val (bgColor, textColor) = MacaronTagColors.getColorPair(text)
    
    Text(
        text = text,
        fontSize = 14.sp,
        color = textColor,
        modifier = modifier
            .clip(RoundedCornerShape(20.dp))
            .background(bgColor)
            .clickable(onClick = onClick)
            .padding(horizontal = 14.dp, vertical = 8.dp)
    )
}
```

### 5.3 RiskTagItemé›·åŒºæ ‡ç­¾é¡¹

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/persona/RiskTagItem.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.persona

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Warning
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.*

/**
 * é£é™©ç­‰çº§æšä¸¾
 */
enum class RiskLevel(
    val displayName: String,
    val color: Color
) {
    HIGH("é«˜é£é™©", Color(0xFFEF4444)),
    MEDIUM("ä¸­é£é™©", Color(0xFFF97316)),
    LOW("ä½é£é™©", Color(0xFFFBBF24))
}

/**
 * é›·åŒºæ ‡ç­¾é¡¹ç»„ä»¶
 * 
 * @param title æ ‡ç­¾æ ‡é¢˜
 * @param description æè¿°
 * @param riskLevel é£é™©ç­‰çº§
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun RiskTagItem(
    title: String,
    description: String,
    riskLevel: RiskLevel,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier.fillMaxWidth(),
        shape = RoundedCornerShape(12.dp),
        colors = CardDefaults.cardColors(
            containerColor = riskLevel.color.copy(alpha = 0.08f)
        ),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Row(
            modifier = Modifier
                .fillMaxWidth()
                .padding(12.dp),
            verticalAlignment = Alignment.Top
        ) {
            // å·¦ä¾§å›¾æ ‡
            Box(
                modifier = Modifier
                    .size(36.dp)
                    .background(riskLevel.color.copy(alpha = 0.2f), CircleShape),
                contentAlignment = Alignment.Center
            ) {
                Icon(
                    imageVector = Icons.Default.Warning,
                    contentDescription = null,
                    tint = riskLevel.color,
                    modifier = Modifier.size(20.dp)
                )
            }
            
            Spacer(modifier = Modifier.width(12.dp))
            
            // å†…å®¹
            Column(modifier = Modifier.weight(1f)) {
                Row(
                    verticalAlignment = Alignment.CenterVertically
                ) {
                    Text(
                        text = title,
                        fontSize = 15.sp,
                        fontWeight = FontWeight.Medium,
                        color = iOSTextPrimary
                    )
                    Spacer(modifier = Modifier.width(8.dp))
                    // é£é™©ç­‰çº§å¾½æ ‡
                    Text(
                        text = riskLevel.displayName,
                        fontSize = 11.sp,
                        color = Color.White,
                        modifier = Modifier
                            .background(riskLevel.color, RoundedCornerShape(4.dp))
                            .padding(horizontal = 6.dp, vertical = 2.dp)
                    )
                }
                
                Spacer(modifier = Modifier.height(4.dp))
                
                Text(
                    text = description,
                    fontSize = 13.sp,
                    color = iOSTextSecondary,
                    lineHeight = 18.sp
                )
            }
        }
    }
}
```

### 5.4 AiInferenceSection AIæ¨æµ‹åŒºåŸŸ

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/persona/AiInferenceSection.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.persona

import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Check
import androidx.compose.material.icons.filled.Close
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.*

/**
 * AIæ¨æµ‹æ ‡ç­¾æ•°æ®
 */
data class InferredTag(
    val id: String,
    val name: String,
    val source: String // æ¨æµ‹æ¥æº
)

/**
 * AIæ¨æµ‹åŒºåŸŸç»„ä»¶
 * 
 * @param tags æ¨æµ‹æ ‡ç­¾åˆ—è¡¨
 * @param onAccept ç¡®è®¤å›è°ƒ
 * @param onReject æ‹’ç»å›è°ƒ
 * @param onAcceptAll å…¨éƒ¨é‡‡çº³å›è°ƒ
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun AiInferenceSection(
    tags: List<InferredTag>,
    onAccept: (InferredTag) -> Unit,
    onReject: (InferredTag) -> Unit,
    onAcceptAll: () -> Unit,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(containerColor = iOSCardBackground),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column {
            // å¤´éƒ¨
            Row(
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(16.dp),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Row(verticalAlignment = Alignment.CenterVertically) {
                    Text(
                        text = "ğŸ§ ",
                        fontSize = 18.sp
                    )
                    Spacer(modifier = Modifier.width(8.dp))
                    Text(
                        text = "AI è‡ªåŠ¨æ¨æµ‹",
                        fontSize = 17.sp,
                        fontWeight = FontWeight.SemiBold,
                        color = iOSTextPrimary
                    )
                }
                
                TextButton(onClick = onAcceptAll) {
                    Text(
                        text = "å…¨éƒ¨é‡‡çº³",
                        fontSize = 14.sp,
                        color = iOSBlue
                    )
                }
            }
            
            // æ¨æµ‹åˆ—è¡¨
            tags.forEachIndexed { index, tag ->
                if (index > 0) {
                    Divider(
                        modifier = Modifier.padding(start = 16.dp),
                        color = iOSSeparator,
                        thickness = 0.5.dp
                    )
                }
                
                InferredTagItem(
                    tag = tag,
                    onAccept = { onAccept(tag) },
                    onReject = { onReject(tag) }
                )
            }
        }
    }
}

@Composable
private fun InferredTagItem(
    tag: InferredTag,
    onAccept: () -> Unit,
    onReject: () -> Unit
) {
    Row(
        modifier = Modifier
            .fillMaxWidth()
            .padding(horizontal = 16.dp, vertical = 12.dp),
        horizontalArrangement = Arrangement.SpaceBetween,
        verticalAlignment = Alignment.CenterVertically
    ) {
        Column(modifier = Modifier.weight(1f)) {
            Text(
                text = tag.name,
                fontSize = 15.sp,
                color = iOSTextPrimary
            )
            Text(
                text = "åŸºäº${tag.source}æ¨æµ‹",
                fontSize = 12.sp,
                color = iOSTextSecondary
            )
        }
        
        Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {
            // æ‹’ç»æŒ‰é’®
            IconButton(
                onClick = onReject,
                modifier = Modifier
                    .size(32.dp)
                    .background(Color(0xFFE5E5EA), CircleShape)
            ) {
                Icon(
                    imageVector = Icons.Default.Close,
                    contentDescription = "æ‹’ç»",
                    tint = iOSTextSecondary,
                    modifier = Modifier.size(18.dp)
                )
            }
            
            // ç¡®è®¤æŒ‰é’®
            IconButton(
                onClick = onAccept,
                modifier = Modifier
                    .size(32.dp)
                    .background(iOSGreen, CircleShape)
            ) {
                Icon(
                    imageVector = Icons.Default.Check,
                    contentDescription = "ç¡®è®¤",
                    tint = Color.White,
                    modifier = Modifier.size(18.dp)
                )
            }
        }
    }
}
```


---

## ğŸ“¦ æ¨¡å—5ï¼šèµ„æ–™åº“ç»„ä»¶æŠ€æœ¯å®ç°

### 6.1 DataStatisticsCardç»Ÿè®¡å¡ç‰‡

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/vault/DataStatisticsCard.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.vault

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.BarChart
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.blur
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.*

/**
 * æ•°æ®ç»Ÿè®¡å¡ç‰‡
 * 
 * @param totalCount æ•°æ®æ€»é‡
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun DataStatisticsCard(
    totalCount: Int,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier.fillMaxWidth(),
        shape = RoundedCornerShape(20.dp),
        colors = CardDefaults.cardColors(containerColor = iOSCardBackground),
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Box(
            modifier = Modifier
                .fillMaxWidth()
                .padding(20.dp)
        ) {
            // è£…é¥°æ€§èƒŒæ™¯åœ†å½¢ï¼ˆæ¨¡ç³Šæ•ˆæœï¼‰
            Box(
                modifier = Modifier
                    .size(80.dp)
                    .align(Alignment.TopEnd)
                    .offset(x = 20.dp, y = (-20).dp)
                    .blur(40.dp)
                    .background(
                        brush = Brush.radialGradient(
                            colors = listOf(
                                iOSBlue.copy(alpha = 0.3f),
                                Color.Transparent
                            )
                        ),
                        shape = CircleShape
                    )
            )
            
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Column {
                    Text(
                        text = "æ•°æ®æ€»é‡",
                        fontSize = 14.sp,
                        color = iOSTextSecondary
                    )
                    Spacer(modifier = Modifier.height(4.dp))
                    Row(
                        verticalAlignment = Alignment.Bottom
                    ) {
                        Text(
                            text = totalCount.toString(),
                            fontSize = 32.sp,
                            fontWeight = FontWeight.Bold,
                            color = iOSTextPrimary
                        )
                        Spacer(modifier = Modifier.width(4.dp))
                        Text(
                            text = "æ¡",
                            fontSize = 16.sp,
                            color = iOSTextSecondary,
                            modifier = Modifier.padding(bottom = 4.dp)
                        )
                    }
                }
                
                // å›¾æ ‡
                Box(
                    modifier = Modifier
                        .size(48.dp)
                        .background(
                            iOSBlue.copy(alpha = 0.1f),
                            CircleShape
                        ),
                    contentAlignment = Alignment.Center
                ) {
                    Icon(
                        imageVector = Icons.Default.BarChart,
                        contentDescription = null,
                        tint = iOSBlue,
                        modifier = Modifier.size(24.dp)
                    )
                }
            }
        }
    }
}
```

### 6.2 DataSourceGridCardæ•°æ®æ¥æºå¡ç‰‡

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/vault/DataSourceGridCard.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.vault

import androidx.compose.animation.core.animateFloatAsState
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.interaction.MutableInteractionSource
import androidx.compose.foundation.interaction.collectIsPressedAsState
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.scale
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.graphics.vector.ImageVector
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.*

/**
 * æ•°æ®çŠ¶æ€æšä¸¾
 */
enum class DataStatus(
    val color: Color,
    val displayName: String
) {
    COMPLETED(Color(0xFF10B981), "å·²å®Œæˆ"),
    PROCESSING(Color(0xFF3B82F6), "å¤„ç†ä¸­"),
    NOT_AVAILABLE(Color(0xFFD1D5DB), "ä¸å¯ç”¨"),
    FAILED(Color(0xFFEF4444), "å¤±è´¥")
}

/**
 * æ•°æ®æ¥æºç½‘æ ¼å¡ç‰‡
 * 
 * @param icon å›¾æ ‡
 * @param iconColor å›¾æ ‡é¢œè‰²
 * @param iconBgColor å›¾æ ‡èƒŒæ™¯è‰²
 * @param count æ•°é‡
 * @param title æ ‡é¢˜
 * @param subtitle å‰¯æ ‡é¢˜
 * @param status çŠ¶æ€
 * @param onClick ç‚¹å‡»å›è°ƒ
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun DataSourceGridCard(
    icon: ImageVector,
    iconColor: Color,
    iconBgColor: Color,
    count: Int,
    title: String,
    subtitle: String,
    status: DataStatus,
    onClick: () -> Unit,
    modifier: Modifier = Modifier
) {
    val interactionSource = remember { MutableInteractionSource() }
    val isPressed by interactionSource.collectIsPressedAsState()
    
    // æŒ‰å‹ç¼©æ”¾åŠ¨ç”»
    val scale by animateFloatAsState(
        targetValue = if (isPressed) 0.98f else 1f,
        label = "scale"
    )
    
    Card(
        modifier = modifier
            .scale(scale)
            .clickable(
                interactionSource = interactionSource,
                indication = null,
                enabled = status != DataStatus.NOT_AVAILABLE,
                onClick = onClick
            ),
        shape = RoundedCornerShape(20.dp),
        colors = CardDefaults.cardColors(containerColor = iOSCardBackground),
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Box(modifier = Modifier.fillMaxSize()) {
            Column(
                modifier = Modifier
                    .fillMaxSize()
                    .padding(16.dp)
            ) {
                // å›¾æ ‡ + æ•°é‡
                Row(
                    modifier = Modifier.fillMaxWidth(),
                    horizontalArrangement = Arrangement.SpaceBetween,
                    verticalAlignment = Alignment.Top
                ) {
                    Box(
                        modifier = Modifier
                            .size(44.dp)
                            .background(iconBgColor, RoundedCornerShape(12.dp)),
                        contentAlignment = Alignment.Center
                    ) {
                        Icon(
                            imageVector = icon,
                            contentDescription = null,
                            tint = iconColor,
                            modifier = Modifier.size(24.dp)
                        )
                    }
                    
                    Text(
                        text = count.toString(),
                        fontSize = 20.sp,
                        fontWeight = FontWeight.Bold,
                        color = iOSTextPrimary
                    )
                }
                
                Spacer(modifier = Modifier.weight(1f))
                
                // æ ‡é¢˜ + å‰¯æ ‡é¢˜
                Text(
                    text = title,
                    fontSize = 15.sp,
                    fontWeight = FontWeight.Medium,
                    color = iOSTextPrimary
                )
                Text(
                    text = subtitle,
                    fontSize = 12.sp,
                    color = iOSTextSecondary
                )
            }
            
            // çŠ¶æ€è§’æ ‡
            StatusBadge(
                status = status,
                modifier = Modifier
                    .align(Alignment.TopEnd)
                    .padding(12.dp)
            )
        }
    }
}

/**
 * çŠ¶æ€è§’æ ‡
 */
@Composable
fun StatusBadge(
    status: DataStatus,
    modifier: Modifier = Modifier
) {
    Box(
        modifier = modifier
            .size(8.dp)
            .background(status.color, CircleShape)
    )
}
```

### 6.3 DataSourceGridæ•°æ®ç½‘æ ¼

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/vault/DataSourceGrid.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.vault

import androidx.compose.foundation.layout.*
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.unit.dp

/**
 * æ•°æ®æ¥æºé…ç½®
 */
data class DataSourceConfig(
    val id: String,
    val icon: androidx.compose.ui.graphics.vector.ImageVector,
    val iconColor: Color,
    val iconBgColor: Color,
    val title: String,
    val subtitle: String
)

/**
 * æ•°æ®æ¥æºç½‘æ ¼
 * 
 * @param chatCount èŠå¤©è®°å½•æ•°
 * @param summaryCount AIæ€»ç»“æ•°
 * @param imageCount å›¾ç‰‡æ•°
 * @param voiceCount è¯­éŸ³æ•°
 * @param videoCount è§†é¢‘æ•°
 * @param fileCount æ–‡ä»¶æ•°
 * @param onSourceClick æ•°æ®æºç‚¹å‡»å›è°ƒ
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun DataSourceGrid(
    chatCount: Int,
    summaryCount: Int,
    imageCount: Int = 0,
    voiceCount: Int = 0,
    videoCount: Int = 0,
    fileCount: Int = 0,
    onSourceClick: (String) -> Unit,
    modifier: Modifier = Modifier
) {
    val sources = listOf(
        Triple(
            DataSourceConfig(
                id = "chat",
                icon = Icons.Default.ChatBubble,
                iconColor = Color(0xFF3B82F6),
                iconBgColor = Color(0xFFDBEAFE),
                title = "èŠå¤©è®°å½•",
                subtitle = "å¯¹è¯å†å²"
            ),
            chatCount,
            if (chatCount > 0) DataStatus.COMPLETED else DataStatus.NOT_AVAILABLE
        ),
        Triple(
            DataSourceConfig(
                id = "summary",
                icon = Icons.Default.AutoAwesome,
                iconColor = Color(0xFF8B5CF6),
                iconBgColor = Color(0xFFEDE9FE),
                title = "AI æ€»ç»“",
                subtitle = "æ™ºèƒ½åˆ†æ"
            ),
            summaryCount,
            if (summaryCount > 0) DataStatus.COMPLETED else DataStatus.NOT_AVAILABLE
        ),
        Triple(
            DataSourceConfig(
                id = "image",
                icon = Icons.Default.Image,
                iconColor = Color(0xFFEC4899),
                iconBgColor = Color(0xFFFCE7F3),
                title = "å›¾ç‰‡",
                subtitle = "åª’ä½“æ–‡ä»¶"
            ),
            imageCount,
            DataStatus.NOT_AVAILABLE
        ),
        Triple(
            DataSourceConfig(
                id = "voice",
                icon = Icons.Default.Mic,
                iconColor = Color(0xFF06B6D4),
                iconBgColor = Color(0xFFCFFAFE),
                title = "è¯­éŸ³æ¶ˆæ¯",
                subtitle = "éŸ³é¢‘è®°å½•"
            ),
            voiceCount,
            DataStatus.NOT_AVAILABLE
        ),
        Triple(
            DataSourceConfig(
                id = "video",
                icon = Icons.Default.Videocam,
                iconColor = Color(0xFFF97316),
                iconBgColor = Color(0xFFFFEDD5),
                title = "è§†é¢‘",
                subtitle = "è§†é¢‘åŠ¨æ€"
            ),
            videoCount,
            DataStatus.NOT_AVAILABLE
        ),
        Triple(
            DataSourceConfig(
                id = "file",
                icon = Icons.Default.Folder,
                iconColor = Color(0xFF10B981),
                iconBgColor = Color(0xFFD1FAE5),
                title = "æ–‡ä»¶",
                subtitle = "å…¶ä»–æ–‡æ¡£"
            ),
            fileCount,
            DataStatus.NOT_AVAILABLE
        )
    )
    
    Column(
        modifier = modifier.fillMaxWidth(),
        verticalArrangement = Arrangement.spacedBy(12.dp)
    ) {
        sources.chunked(2).forEach { row ->
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.spacedBy(12.dp)
            ) {
                row.forEach { (config, count, status) ->
                    DataSourceGridCard(
                        icon = config.icon,
                        iconColor = config.iconColor,
                        iconBgColor = config.iconBgColor,
                        count = count,
                        title = config.title,
                        subtitle = config.subtitle,
                        status = status,
                        onClick = { onSourceClick(config.id) },
                        modifier = Modifier
                            .weight(1f)
                            .aspectRatio(1f)
                    )
                }
                
                // å¦‚æœæ˜¯å¥‡æ•°ä¸ªï¼Œè¡¥ä¸€ä¸ªç©ºç™½
                if (row.size == 1) {
                    Spacer(modifier = Modifier.weight(1f))
                }
            }
        }
    }
}
```


---

## ğŸ“¦ æ¨¡å—6ï¼šæ–°å»ºè”ç³»äººç»„ä»¶æŠ€æœ¯å®ç°

### 7.1 IOSNavigationBarå¯¼èˆªæ 

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/ios/IOSNavigationBar.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.ios

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.material3.Text
import androidx.compose.material3.TextButton
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.*

/**
 * iOSé£æ ¼å¯¼èˆªæ 
 * 
 * @param title æ ‡é¢˜
 * @param onCancel å–æ¶ˆå›è°ƒ
 * @param onDone å®Œæˆå›è°ƒ
 * @param isDoneEnabled å®ŒæˆæŒ‰é’®æ˜¯å¦å¯ç”¨
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun IOSNavigationBar(
    title: String,
    onCancel: () -> Unit,
    onDone: () -> Unit,
    isDoneEnabled: Boolean = true,
    modifier: Modifier = Modifier
) {
    Row(
        modifier = modifier
            .fillMaxWidth()
            .height(52.dp)
            .background(iOSLightGrayBackground.copy(alpha = 0.95f))
            .padding(horizontal = 16.dp),
        horizontalArrangement = Arrangement.SpaceBetween,
        verticalAlignment = Alignment.CenterVertically
    ) {
        // å–æ¶ˆæŒ‰é’®
        TextButton(onClick = onCancel) {
            Text(
                text = "å–æ¶ˆ",
                fontSize = 17.sp,
                color = iOSBlue
            )
        }
        
        // æ ‡é¢˜
        Text(
            text = title,
            fontSize = 17.sp,
            fontWeight = FontWeight.Bold,
            color = iOSTextPrimary
        )
        
        // å®ŒæˆæŒ‰é’®
        TextButton(
            onClick = onDone,
            enabled = isDoneEnabled
        ) {
            Text(
                text = "å®Œæˆ",
                fontSize = 17.sp,
                fontWeight = FontWeight.SemiBold,
                color = if (isDoneEnabled) iOSBlue else iOSTextSecondary
            )
        }
    }
}
```

### 7.2 AvatarPickerå¤´åƒé€‰æ‹©å™¨

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/contact/AvatarPicker.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.contact

import androidx.compose.foundation.background
import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Person
import androidx.compose.material3.Icon
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.draw.shadow
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import coil.compose.AsyncImage
import com.empathy.ai.presentation.theme.*

/**
 * å¤´åƒé€‰æ‹©å™¨ç»„ä»¶
 * 
 * @param avatarUrl å¤´åƒURLï¼ˆå¯é€‰ï¼‰
 * @param onClick ç‚¹å‡»å›è°ƒ
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun AvatarPicker(
    avatarUrl: String?,
    onClick: () -> Unit,
    modifier: Modifier = Modifier
) {
    Column(
        modifier = modifier,
        horizontalAlignment = Alignment.CenterHorizontally
    ) {
        Box(
            modifier = Modifier
                .size(100.dp)
                .shadow(8.dp, CircleShape)
                .clip(CircleShape)
                .border(3.dp, Color.White, CircleShape)
                .clickable(onClick = onClick),
            contentAlignment = Alignment.Center
        ) {
            if (avatarUrl != null) {
                // æ˜¾ç¤ºå¤´åƒå›¾ç‰‡
                AsyncImage(
                    model = avatarUrl,
                    contentDescription = "å¤´åƒ",
                    modifier = Modifier.fillMaxSize(),
                    contentScale = ContentScale.Crop
                )
            } else {
                // å ä½ç¬¦ï¼šæ¸å˜èƒŒæ™¯ + äººç‰©å›¾æ ‡
                Box(
                    modifier = Modifier
                        .fillMaxSize()
                        .background(
                            brush = Brush.linearGradient(
                                colors = listOf(
                                    Color(0xFFE5E5EA),
                                    Color(0xFFC7C7CC)
                                )
                            )
                        ),
                    contentAlignment = Alignment.Center
                ) {
                    Icon(
                        imageVector = Icons.Default.Person,
                        contentDescription = null,
                        tint = Color.White,
                        modifier = Modifier.size(48.dp)
                    )
                }
            }
        }
        
        Spacer(modifier = Modifier.height(8.dp))
        
        Text(
            text = "æ·»åŠ ç…§ç‰‡",
            fontSize = 14.sp,
            color = iOSBlue
        )
    }
}
```

### 7.3 ContactFormCardè¡¨å•å¡ç‰‡

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/contact/ContactFormCard.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.contact

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.foundation.text.BasicTextField
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.text.TextStyle
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.*

/**
 * è”ç³»äººè¡¨å•å¡ç‰‡
 * 
 * @param name å§“å
 * @param onNameChange å§“åå˜åŒ–å›è°ƒ
 * @param goal æ²Ÿé€šç›®æ ‡
 * @param onGoalChange ç›®æ ‡å˜åŒ–å›è°ƒ
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun ContactFormCard(
    name: String,
    onNameChange: (String) -> Unit,
    goal: String,
    onGoalChange: (String) -> Unit,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier.fillMaxWidth(),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(containerColor = iOSCardBackground),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            // å§“åè¾“å…¥
            FormField(
                label = "å§“å",
                value = name,
                onValueChange = onNameChange,
                placeholder = "è¾“å…¥å§“å"
            )
            
            Spacer(modifier = Modifier.height(16.dp))
            
            // æ²Ÿé€šç›®æ ‡è¾“å…¥
            FormField(
                label = "æ²Ÿé€šç›®æ ‡",
                value = goal,
                onValueChange = onGoalChange,
                placeholder = "ä¾‹å¦‚ï¼šå»ºç«‹åˆæ­¥ä¿¡ä»»"
            )
        }
    }
}

@Composable
private fun FormField(
    label: String,
    value: String,
    onValueChange: (String) -> Unit,
    placeholder: String
) {
    Column {
        Text(
            text = label,
            fontSize = 13.sp,
            color = iOSTextSecondary
        )
        
        Spacer(modifier = Modifier.height(8.dp))
        
        BasicTextField(
            value = value,
            onValueChange = onValueChange,
            textStyle = TextStyle(
                fontSize = 17.sp,
                color = iOSTextPrimary
            ),
            modifier = Modifier
                .fillMaxWidth()
                .background(
                    Color(0xFFF8F8FA),
                    RoundedCornerShape(10.dp)
                )
                .padding(12.dp),
            decorationBox = { innerTextField ->
                Box {
                    if (value.isEmpty()) {
                        Text(
                            text = placeholder,
                            fontSize = 17.sp,
                            color = iOSTextTertiary
                        )
                    }
                    innerTextField()
                }
            }
        )
    }
}
```

### 7.4 AddFactButtonæ·»åŠ äº‹å®æŒ‰é’®

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/component/contact/AddFactButton.kt`

```kotlin
package com.empathy.ai.presentation.ui.component.contact

import androidx.compose.foundation.border
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Add
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.graphics.PathEffect
import androidx.compose.ui.graphics.drawscope.Stroke
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.*

/**
 * æ·»åŠ äº‹å®æŒ‰é’®ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
 * 
 * @param onClick ç‚¹å‡»å›è°ƒ
 * @param modifier ä¿®é¥°ç¬¦
 */
@Composable
fun AddFactButton(
    onClick: () -> Unit,
    modifier: Modifier = Modifier
) {
    Card(
        modifier = modifier
            .fillMaxWidth()
            .border(
                width = 1.dp,
                color = iOSTextTertiary,
                shape = RoundedCornerShape(16.dp)
            )
            .clickable(onClick = onClick),
        shape = RoundedCornerShape(16.dp),
        colors = CardDefaults.cardColors(containerColor = iOSCardBackground),
        elevation = CardDefaults.cardElevation(defaultElevation = 0.dp)
    ) {
        Row(
            modifier = Modifier
                .fillMaxWidth()
                .padding(16.dp),
            horizontalArrangement = Arrangement.Center,
            verticalAlignment = Alignment.CenterVertically
        ) {
            Icon(
                imageVector = Icons.Default.Add,
                contentDescription = null,
                tint = iOSBlue,
                modifier = Modifier.size(20.dp)
            )
            Spacer(modifier = Modifier.width(8.dp))
            Text(
                text = "æ·»åŠ ç”»åƒäº‹å®",
                fontSize = 15.sp,
                color = iOSBlue
            )
        }
    }
}
```


---

## ğŸ“¦ æ¨¡å—7ï¼šé¡µé¢é‡å†™æŠ€æœ¯å®ç°

### 8.1 OverviewTabæ¦‚è§ˆé¡µé‡å†™

**ä¿®æ”¹æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/overview/OverviewTab.kt`

**æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨`LazyColumn`å®ç°æ»šåŠ¨å¸ƒå±€
- é›†æˆ`HealthRingChart`å’Œ`SparklineChart`
- ä½¿ç”¨`remember`ç¼“å­˜è®¡ç®—ç»“æœ

```kotlin
package com.empathy.ai.presentation.ui.screen.contact.overview

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import com.empathy.ai.presentation.theme.*
import com.empathy.ai.presentation.ui.component.chart.HealthRingChart
import com.empathy.ai.presentation.ui.component.chart.SparklineChart
import com.empathy.ai.presentation.ui.component.tag.MacaronTagChip

/**
 * æ¦‚è§ˆé¡µTab
 */
@Composable
fun OverviewTab(
    uiState: OverviewUiState,
    onNavigateToFactStream: () -> Unit,
    onNavigateToPromptEditor: () -> Unit,
    modifier: Modifier = Modifier
) {
    LazyColumn(
        modifier = modifier
            .fillMaxSize()
            .background(iOSSystemGroupedBackground),
        contentPadding = PaddingValues(16.dp),
        verticalArrangement = Arrangement.spacedBy(16.dp)
    ) {
        // ä¸ªäººä¿¡æ¯å¡ç‰‡
        item {
            ProfileInfoCard(
                name = uiState.contactName,
                relationship = uiState.relationshipLabel,
                location = uiState.location,
                daysKnown = uiState.daysKnown,
                avatarUrl = uiState.avatarUrl
            )
        }
        
        // å…³ç³»åˆ†æ•°å¡ç‰‡
        item {
            RelationshipScoreCard(
                score = uiState.relationshipScore,
                progress = uiState.relationshipScore / 100f,
                statusText = uiState.relationshipStatus,
                trendData = uiState.scoreTrend,
                trendText = uiState.trendText
            )
        }
        
        // æ ¸å¿ƒæ ‡ç­¾å¡ç‰‡
        item {
            CoreTagsCard(
                tags = uiState.coreTags,
                onTagClick = { /* å¤„ç†æ ‡ç­¾ç‚¹å‡» */ }
            )
        }
        
        // æœ€æ–°åŠ¨æ€å¡ç‰‡
        item {
            LatestDiscoveryCard(
                discovery = uiState.latestDiscovery,
                onClick = onNavigateToFactStream
            )
        }
        
        // ä¸“å±æŒ‡ä»¤å¡ç‰‡
        item {
            CustomPromptCard(
                contactName = uiState.contactName,
                onClick = onNavigateToPromptEditor
            )
        }
    }
}

/**
 * æ¦‚è§ˆé¡µUIçŠ¶æ€
 */
data class OverviewUiState(
    val contactName: String = "",
    val relationshipLabel: String = "",
    val location: String = "",
    val daysKnown: Int = 0,
    val avatarUrl: String? = null,
    val relationshipScore: Int = 0,
    val relationshipStatus: String = "",
    val scoreTrend: List<Float> = emptyList(),
    val trendText: String = "",
    val coreTags: List<CoreTag> = emptyList(),
    val latestDiscovery: String? = null
)

data class CoreTag(
    val emoji: String,
    val text: String
)
```

### 8.2 FactStreamTabäº‹å®æµé¡µé‡å†™

**ä¿®æ”¹æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/factstream/FactStreamTab.kt`

```kotlin
package com.empathy.ai.presentation.ui.screen.contact.factstream

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import com.empathy.ai.presentation.theme.*
import com.empathy.ai.presentation.ui.component.filter.FilterChipRow
import com.empathy.ai.presentation.ui.component.timeline.EmotionTimelineView
import com.empathy.ai.presentation.ui.component.timeline.TimelineItem

/**
 * äº‹å®æµé¡µTab
 */
@Composable
fun FactStreamTab(
    uiState: FactStreamUiState,
    onViewModeChange: (ViewMode) -> Unit,
    onFilterChange: (EmotionFilter) -> Unit,
    onManualSummary: () -> Unit,
    onItemClick: (TimelineItem) -> Unit,
    modifier: Modifier = Modifier
) {
    Box(
        modifier = modifier
            .fillMaxSize()
            .background(iOSLightGrayBackground)
    ) {
        Column(modifier = Modifier.fillMaxSize()) {
            // è§†å›¾åˆ‡æ¢å™¨
            ViewModeSwitcher(
                currentMode = uiState.viewMode,
                onModeChange = onViewModeChange,
                modifier = Modifier.padding(16.dp)
            )
            
            // ç­›é€‰èƒ¶å›Š
            FilterChipRow(
                filters = EmotionFilter.values().toList(),
                selectedFilter = uiState.selectedFilter,
                onFilterSelected = onFilterChange,
                modifier = Modifier.padding(horizontal = 16.dp)
            )
            
            Spacer(modifier = Modifier.height(16.dp))
            
            // å†…å®¹åŒºåŸŸ
            when (uiState.viewMode) {
                ViewMode.TIMELINE -> {
                    EmotionTimelineView(
                        items = uiState.timelineItems,
                        onItemClick = onItemClick,
                        modifier = Modifier.weight(1f)
                    )
                }
                ViewMode.LIST -> {
                    FactListView(
                        items = uiState.timelineItems,
                        onItemClick = onItemClick,
                        modifier = Modifier.weight(1f)
                    )
                }
            }
        }
        
        // æ‰‹åŠ¨æ€»ç»“æ‚¬æµ®æŒ‰é’®
        ManualSummaryFab(
            onClick = onManualSummary,
            modifier = Modifier
                .align(Alignment.BottomEnd)
                .padding(16.dp)
        )
    }
}

enum class ViewMode { TIMELINE, LIST }

enum class EmotionFilter(val displayName: String, val emoji: String) {
    ALL("å…¨éƒ¨", ""),
    SWEET("ç”œèœœ", "â¤ï¸"),
    CONFLICT("å†²çª", "â›ˆï¸"),
    DATE("çº¦ä¼š", "ğŸ½ï¸"),
    AI_SUMMARY("AIæ€»ç»“", "ğŸ§ ")
}

data class FactStreamUiState(
    val viewMode: ViewMode = ViewMode.TIMELINE,
    val selectedFilter: EmotionFilter = EmotionFilter.ALL,
    val timelineItems: List<TimelineItem> = emptyList(),
    val isLoading: Boolean = false
)
```

### 8.3 PersonaTabç”»åƒåº“é¡µé‡å†™

**ä¿®æ”¹æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/persona/PersonaTab.kt`

```kotlin
package com.empathy.ai.presentation.ui.screen.contact.persona

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.items
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.Add
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import com.empathy.ai.presentation.theme.*
import com.empathy.ai.presentation.ui.component.persona.*

/**
 * ç”»åƒåº“é¡µTab
 */
@Composable
fun PersonaTab(
    uiState: PersonaUiState,
    onCategoryToggle: (TagCategory) -> Unit,
    onAddTag: (TagCategory) -> Unit,
    onTagClick: (String) -> Unit,
    onAcceptInference: (InferredTag) -> Unit,
    onRejectInference: (InferredTag) -> Unit,
    onAcceptAllInferences: () -> Unit,
    modifier: Modifier = Modifier
) {
    Box(
        modifier = modifier
            .fillMaxSize()
            .background(iOSLightGrayBackground)
    ) {
        LazyColumn(
            modifier = Modifier.fillMaxSize(),
            contentPadding = PaddingValues(16.dp),
            verticalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            // æœç´¢æ 
            item {
                SearchBar(
                    query = uiState.searchQuery,
                    onQueryChange = { /* å¤„ç†æœç´¢ */ },
                    placeholder = "æœç´¢æ ‡ç­¾æˆ–åˆ†ç±»..."
                )
            }
            
            // åˆ†ç±»å¡ç‰‡åˆ—è¡¨
            items(uiState.categories) { categoryData ->
                CategoryCard(
                    category = categoryData.category,
                    tags = categoryData.tags,
                    isExpanded = categoryData.isExpanded,
                    onToggle = { onCategoryToggle(categoryData.category) },
                    onAddTag = { onAddTag(categoryData.category) },
                    onTagClick = onTagClick
                )
            }
            
            // é›·åŒºæ ‡ç­¾ï¼ˆç‰¹æ®Šå±•ç¤ºï¼‰
            if (uiState.riskTags.isNotEmpty()) {
                item {
                    RiskTagsSection(
                        tags = uiState.riskTags
                    )
                }
            }
            
            // AIæ¨æµ‹åŒºåŸŸ
            if (uiState.inferredTags.isNotEmpty()) {
                item {
                    AiInferenceSection(
                        tags = uiState.inferredTags,
                        onAccept = onAcceptInference,
                        onReject = onRejectInference,
                        onAcceptAll = onAcceptAllInferences
                    )
                }
            }
            
            // åº•éƒ¨æç¤º
            item {
                AiLearningHint()
            }
        }
        
        // æ·»åŠ æ ‡ç­¾æ‚¬æµ®æŒ‰é’®
        FloatingActionButton(
            onClick = { /* æ‰“å¼€æ·»åŠ æ ‡ç­¾å¯¹è¯æ¡† */ },
            modifier = Modifier
                .align(Alignment.BottomEnd)
                .padding(16.dp),
            containerColor = iOSGreen
        ) {
            Icon(
                imageVector = Icons.Default.Add,
                contentDescription = "æ·»åŠ æ ‡ç­¾",
                tint = iOSCardBackground
            )
        }
    }
}

data class CategoryData(
    val category: TagCategory,
    val tags: List<String>,
    val isExpanded: Boolean
)

data class RiskTagData(
    val title: String,
    val description: String,
    val riskLevel: RiskLevel
)

data class PersonaUiState(
    val searchQuery: String = "",
    val categories: List<CategoryData> = emptyList(),
    val riskTags: List<RiskTagData> = emptyList(),
    val inferredTags: List<InferredTag> = emptyList(),
    val isLoading: Boolean = false
)
```

### 8.4 DataVaultTabèµ„æ–™åº“é¡µé‡å†™

**ä¿®æ”¹æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/vault/DataVaultTab.kt`

```kotlin
package com.empathy.ai.presentation.ui.screen.contact.vault

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import com.empathy.ai.presentation.theme.*
import com.empathy.ai.presentation.ui.component.vault.*

/**
 * èµ„æ–™åº“é¡µTab
 */
@Composable
fun DataVaultTab(
    uiState: DataVaultUiState,
    onSourceClick: (String) -> Unit,
    modifier: Modifier = Modifier
) {
    LazyColumn(
        modifier = modifier
            .fillMaxSize()
            .background(iOSSystemGroupedBackground),
        contentPadding = PaddingValues(16.dp),
        verticalArrangement = Arrangement.spacedBy(16.dp)
    ) {
        // æ ‡é¢˜åŒºåŸŸ
        item {
            Column {
                Text(
                    text = "æ•°æ®æ¥æº",
                    fontSize = 22.sp,
                    fontWeight = androidx.compose.ui.text.font.FontWeight.Bold,
                    color = iOSTextPrimary
                )
                Text(
                    text = "ç®¡ç†ä¸è¯¥è”ç³»äººç›¸å…³çš„æ‰€æœ‰æ•°æ®",
                    fontSize = 14.sp,
                    color = iOSTextSecondary
                )
            }
        }
        
        // ç»Ÿè®¡å¡ç‰‡
        item {
            DataStatisticsCard(
                totalCount = uiState.totalCount
            )
        }
        
        // æ•°æ®ç½‘æ ¼
        item {
            DataSourceGrid(
                chatCount = uiState.chatCount,
                summaryCount = uiState.summaryCount,
                imageCount = uiState.imageCount,
                voiceCount = uiState.voiceCount,
                videoCount = uiState.videoCount,
                fileCount = uiState.fileCount,
                onSourceClick = onSourceClick
            )
        }
        
        // å¼€å‘ä¸­æç¤º
        item {
            DevelopmentHintCard()
        }
        
        // çŠ¶æ€è¯´æ˜
        item {
            StatusLegendCard()
        }
    }
}

data class DataVaultUiState(
    val totalCount: Int = 0,
    val chatCount: Int = 0,
    val summaryCount: Int = 0,
    val imageCount: Int = 0,
    val voiceCount: Int = 0,
    val videoCount: Int = 0,
    val fileCount: Int = 0,
    val isLoading: Boolean = false
)
```

### 8.5 CreateContactScreenæ–°å»ºè”ç³»äººé¡µé‡å†™

**ä¿®æ”¹æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/CreateContactScreen.kt`

```kotlin
package com.empathy.ai.presentation.ui.screen.contact

import androidx.compose.foundation.background
import androidx.compose.foundation.layout.*
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.verticalScroll
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import androidx.hilt.navigation.compose.hiltViewModel
import com.empathy.ai.presentation.theme.*
import com.empathy.ai.presentation.ui.component.contact.*
import com.empathy.ai.presentation.ui.component.ios.IOSNavigationBar

/**
 * æ–°å»ºè”ç³»äººé¡µé¢
 */
@Composable
fun CreateContactScreen(
    onCancel: () -> Unit,
    onDone: () -> Unit,
    onAddFact: () -> Unit,
    viewModel: CreateContactViewModel = hiltViewModel()
) {
    val uiState by viewModel.uiState.collectAsState()
    
    Column(
        modifier = Modifier
            .fillMaxSize()
            .background(iOSLightGrayBackground)
    ) {
        // iOSå¯¼èˆªæ 
        IOSNavigationBar(
            title = "æ–°å»ºè”ç³»äºº",
            onCancel = onCancel,
            onDone = {
                viewModel.saveContact()
                onDone()
            },
            isDoneEnabled = uiState.isValid
        )
        
        // å†…å®¹åŒºåŸŸ
        Column(
            modifier = Modifier
                .fillMaxSize()
                .verticalScroll(rememberScrollState())
                .padding(16.dp),
            horizontalAlignment = Alignment.CenterHorizontally
        ) {
            Spacer(modifier = Modifier.height(24.dp))
            
            // å¤´åƒé€‰æ‹©å™¨
            AvatarPicker(
                avatarUrl = uiState.avatarUrl,
                onClick = { viewModel.pickAvatar() }
            )
            
            Spacer(modifier = Modifier.height(32.dp))
            
            // è¡¨å•å¡ç‰‡
            ContactFormCard(
                name = uiState.name,
                onNameChange = { viewModel.updateName(it) },
                goal = uiState.goal,
                onGoalChange = { viewModel.updateGoal(it) }
            )
            
            // æç¤ºæ–‡å­—
            Text(
                text = "è®¾å®šæ˜ç¡®çš„æ²Ÿé€šç›®æ ‡æœ‰åŠ©äº AI æä¾›æ›´ç²¾å‡†çš„å»ºè®®ã€‚",
                fontSize = 13.sp,
                color = iOSTextSecondary,
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(top = 8.dp, start = 4.dp)
            )
            
            Spacer(modifier = Modifier.height(24.dp))
            
            // æ·»åŠ äº‹å®æŒ‰é’®
            AddFactButton(onClick = onAddFact)
            
            // æç¤ºæ–‡å­—
            Text(
                text = "æ·»åŠ å…³äºæ­¤è”ç³»äººçš„äº‹å®ï¼Œå¸®åŠ© AI æ›´å¥½åœ°ç†è§£ä½ ä»¬çš„å…³ç³»ã€‚",
                fontSize = 13.sp,
                color = iOSTextSecondary,
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(top = 8.dp, start = 4.dp)
            )
        }
    }
}

data class CreateContactUiState(
    val name: String = "",
    val goal: String = "",
    val avatarUrl: String? = null,
    val isValid: Boolean = false,
    val isSaving: Boolean = false
)
```


---

## ğŸ”— æ¨¡å—8ï¼šç³»ç»Ÿé›†æˆæŠ€æœ¯å®ç°

> **æœ¬ç« èŠ‚æ ¹æ®DR-00020å®¡æŸ¥æŠ¥å‘Šè¡¥å……ï¼Œè§£å†³INT-001è‡³INT-004é›†æˆç¼ºå¤±é—®é¢˜**

### 8.6 å¯¼èˆªé›†æˆ

**ä¿®æ”¹æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/navigation/NavGraph.kt`

```kotlin
// åœ¨NavHostä¸­æ·»åŠ è”ç³»äººè¯¦æƒ…é¡µè·¯ç”±
composable(
    route = NavRoutes.CONTACT_DETAIL,
    arguments = listOf(
        navArgument("contactId") { 
            type = NavType.StringType 
        }
    )
) { backStackEntry ->
    val contactId = backStackEntry.arguments?.getString("contactId") ?: return@composable
    ContactDetailTabScreen(
        contactId = contactId,
        onNavigateBack = { navController.popBackStack() },
        onNavigateToPromptEditor = { 
            navController.navigate(NavRoutes.createPromptEditorRoute(contactId)) 
        }
    )
}

// æ·»åŠ æ–°å»ºè”ç³»äººé¡µè·¯ç”±
composable(route = NavRoutes.CREATE_CONTACT) {
    CreateContactScreen(
        onCancel = { navController.popBackStack() },
        onDone = { navController.popBackStack() },
        onAddFact = { /* æ‰“å¼€æ·»åŠ äº‹å®å¯¹è¯æ¡† */ }
    )
}
```

**ä¿®æ”¹æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/navigation/NavRoutes.kt`

```kotlin
object NavRoutes {
    // ç°æœ‰è·¯ç”±...
    
    // æ–°å¢ï¼šè”ç³»äººè¯¦æƒ…é¡µè·¯ç”±
    const val CONTACT_DETAIL = "contact_detail/{contactId}"
    
    // æ–°å¢ï¼šæ–°å»ºè”ç³»äººé¡µè·¯ç”±
    const val CREATE_CONTACT = "create_contact"
    
    /**
     * åˆ›å»ºè”ç³»äººè¯¦æƒ…é¡µè·¯ç”±
     * @param contactId è”ç³»äººID
     */
    fun createContactDetailRoute(contactId: String): String {
        return "contact_detail/$contactId"
    }
    
    /**
     * åˆ›å»ºæç¤ºè¯ç¼–è¾‘å™¨è·¯ç”±ï¼ˆè”ç³»äººä¸“å±ï¼‰
     * @param contactId è”ç³»äººID
     */
    fun createPromptEditorRoute(contactId: String): String {
        return "prompt_editor?contactId=$contactId"
    }
}
```

### 8.7 DIæ¨¡å—é›†æˆ

**ä¿®æ”¹æ–‡ä»¶**: `app/src/main/java/com/empathy/ai/di/PersonaModule.kt`

```kotlin
@Module
@InstallIn(SingletonComponent::class)
abstract class PersonaModule {
    
    // ç°æœ‰ç»‘å®š...
    
    companion object {
        /**
         * æä¾›è·å–è”ç³»äººè¯¦æƒ…UseCase
         */
        @Provides
        @Singleton
        fun provideGetContactDetailUseCase(
            contactRepository: ContactRepository,
            brainTagRepository: BrainTagRepository,
            conversationRepository: ConversationRepository
        ): GetContactDetailUseCase {
            return GetContactDetailUseCase(
                contactRepository,
                brainTagRepository,
                conversationRepository
            )
        }
        
        /**
         * æä¾›æ›´æ–°è”ç³»äººUseCase
         */
        @Provides
        @Singleton
        fun provideUpdateContactUseCase(
            contactRepository: ContactRepository
        ): UpdateContactUseCase {
            return UpdateContactUseCase(contactRepository)
        }
        
        /**
         * æä¾›åˆ›å»ºè”ç³»äººUseCase
         */
        @Provides
        @Singleton
        fun provideCreateContactUseCase(
            contactRepository: ContactRepository
        ): CreateContactUseCase {
            return CreateContactUseCase(contactRepository)
        }
    }
}
```

**è¯´æ˜**: ViewModelä½¿ç”¨`@HiltViewModel`æ³¨è§£ï¼ŒHiltä¼šè‡ªåŠ¨å¤„ç†ViewModelçš„åˆ›å»ºå’Œæ³¨å…¥ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨Moduleä¸­ç»‘å®šã€‚

```kotlin
// ContactDetailTabViewModel.kt
@HiltViewModel
class ContactDetailTabViewModel @Inject constructor(
    private val getContactDetailUseCase: GetContactDetailUseCase,
    private val updateContactUseCase: UpdateContactUseCase,
    savedStateHandle: SavedStateHandle
) : ViewModel() {
    // ViewModelå®ç°...
}

// CreateContactViewModel.kt
@HiltViewModel
class CreateContactViewModel @Inject constructor(
    private val createContactUseCase: CreateContactUseCase
) : ViewModel() {
    // ViewModelå®ç°...
}
```

### 8.8 å…¥å£ç‚¹é›†æˆ

**ä¿®æ”¹æ–‡ä»¶**: `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/contact/ContactListScreen.kt`

```kotlin
@Composable
fun ContactListScreen(
    viewModel: ContactListViewModel = hiltViewModel(),
    onNavigateToContactDetail: (String) -> Unit,  // å¯¼èˆªåˆ°è”ç³»äººè¯¦æƒ…
    onNavigateToCreateContact: () -> Unit         // å¯¼èˆªåˆ°æ–°å»ºè”ç³»äºº
) {
    val uiState by viewModel.uiState.collectAsState()
    
    Scaffold(
        floatingActionButton = {
            FloatingActionButton(
                onClick = onNavigateToCreateContact,
                containerColor = iOSBlue
            ) {
                Icon(Icons.Default.Add, contentDescription = "æ–°å»ºè”ç³»äºº")
            }
        }
    ) { paddingValues ->
        LazyColumn(
            modifier = Modifier.padding(paddingValues)
        ) {
            items(uiState.contacts, key = { it.id }) { contact ->
                ContactListItem(
                    contact = contact,
                    onClick = { onNavigateToContactDetail(contact.id) }
                )
            }
        }
    }
}
```

### 8.9 æ•°æ®åº“é›†æˆéªŒè¯

**ç°æœ‰Entity/DAOå·²æ³¨å†Œï¼Œæ— éœ€ä¿®æ”¹**:
- `ContactProfileEntity` - å·²åœ¨AppDatabaseä¸­æ³¨å†Œ
- `ContactDao` - å·²åœ¨DatabaseModuleä¸­æä¾›
- `BrainTagEntity` - å·²åœ¨AppDatabaseä¸­æ³¨å†Œ
- `BrainTagDao` - å·²åœ¨DatabaseModuleä¸­æä¾›

**éªŒè¯æ­¥éª¤**:
1. ç¡®è®¤`AppDatabase`çš„`entities`æ•°ç»„åŒ…å«æ‰€æœ‰å¿…è¦Entity
2. ç¡®è®¤`DatabaseModule`æä¾›äº†æ‰€æœ‰å¿…è¦DAO
3. è¿è¡Œæ•°æ®åº“è¿ç§»æµ‹è¯•ç¡®ä¿å…¼å®¹æ€§

---

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 9.1 Canvasç»‘åˆ¶ä¼˜åŒ–

#### åŸåˆ™
1. ä½¿ç”¨`remember`ç¼“å­˜`Brush`ã€`Path`ç­‰å¯¹è±¡
2. ä½¿ç”¨`drawWithCache`ç¼“å­˜ç»‘åˆ¶ç»“æœ
3. é¿å…åœ¨`Canvas`å†…éƒ¨åˆ›å»ºå¯¹è±¡

```kotlin
// âœ… æ­£ç¡®ï¼šç¼“å­˜Brush
val gradientBrush = remember {
    Brush.sweepGradient(colors = listOf(...))
}

// âŒ é”™è¯¯ï¼šæ¯æ¬¡é‡ç»„éƒ½åˆ›å»ºæ–°Brush
Canvas(modifier) {
    val brush = Brush.sweepGradient(colors = listOf(...)) // æ€§èƒ½é—®é¢˜
}
```

### 9.2 åŠ¨ç”»æ€§èƒ½ä¼˜åŒ–

#### åŸåˆ™
1. ä½¿ç”¨`animateDpAsState`è€Œé`animateOffsetAsState`
2. ä½¿ç”¨`graphicsLayer`è¿›è¡Œç¡¬ä»¶åŠ é€Ÿ
3. åŠ¨ç”»æ—¶é•¿æ§åˆ¶åœ¨200-300ms

```kotlin
// âœ… ä½¿ç”¨graphicsLayerè¿›è¡Œç¡¬ä»¶åŠ é€Ÿ
Box(
    modifier = Modifier.graphicsLayer {
        translationX = sliderOffset.toPx()
    }
)

// âŒ é¿å…ä½¿ç”¨offsetè¿›è¡ŒåŠ¨ç”»
Box(
    modifier = Modifier.offset(x = sliderOffset) // å¯èƒ½è§¦å‘é‡æ–°å¸ƒå±€
)
```

### 9.3 åˆ—è¡¨æ€§èƒ½ä¼˜åŒ–

#### åŸåˆ™
1. ä¸º`LazyColumn`çš„`items`æä¾›ç¨³å®šçš„`key`
2. ä½¿ç”¨`contentPadding`é¿å…è¾¹ç¼˜è£å‰ª
3. é¿å…åœ¨`item`å†…éƒ¨è¿›è¡Œå¤æ‚è®¡ç®—

```kotlin
LazyColumn(
    contentPadding = PaddingValues(vertical = 16.dp)
) {
    items(
        items = timelineItems,
        key = { it.id } // âœ… æä¾›ç¨³å®šçš„key
    ) { item ->
        // ä½¿ç”¨rememberç¼“å­˜itemçŠ¶æ€
        val itemState = remember(item) { TimelineItemState(item) }
        TimelineItemCard(state = itemState)
    }
}
```

### 9.4 é™çº§æ–¹æ¡ˆ

| åœºæ™¯ | æ£€æµ‹æ¡ä»¶ | é™çº§ç­–ç•¥ |
|------|----------|----------|
| ä½ç«¯è®¾å¤‡ | `Build.VERSION.SDK_INT < 26` | ç¦ç”¨æ¸å˜ï¼Œä½¿ç”¨çº¯è‰² |
| åŠ¨ç”»å¡é¡¿ | å¸§ç‡ < 30fps | å‡å°‘åŠ¨ç”»æ—¶é•¿è‡³100ms |
| å†…å­˜ä¸è¶³ | `Runtime.freeMemory() < 50MB` | ç¦ç”¨Canvasç¼“å­˜ |
| åˆ—è¡¨è¿‡é•¿ | items > 100 | å¯ç”¨åˆ†é¡µåŠ è½½ |

---

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†ä¸é™çº§ç­–ç•¥

> **æœ¬ç« èŠ‚æ ¹æ®DR-00020å®¡æŸ¥æŠ¥å‘Šè¡¥å……ï¼Œè§£å†³é”™è¯¯å¤„ç†ç­–ç•¥ä¸å®Œæ•´é—®é¢˜**

### 9.5 Canvasç»˜åˆ¶é”™è¯¯å¤„ç†

```kotlin
/**
 * å®‰å…¨çš„Canvasç»˜åˆ¶åŒ…è£…å™¨
 */
@Composable
fun SafeCanvas(
    modifier: Modifier = Modifier,
    onDrawError: (Throwable) -> Unit = {},
    onDraw: DrawScope.() -> Unit
) {
    var hasError by remember { mutableStateOf(false) }
    
    if (hasError) {
        // é™çº§æ˜¾ç¤ºï¼šä½¿ç”¨ç®€å•çš„å ä½ç¬¦
        Box(
            modifier = modifier.background(Color.LightGray),
            contentAlignment = Alignment.Center
        ) {
            Text("åŠ è½½ä¸­...", color = Color.Gray)
        }
    } else {
        Canvas(modifier = modifier) {
            try {
                onDraw()
            } catch (e: Exception) {
                hasError = true
                onDrawError(e)
            }
        }
    }
}
```

### 9.6 åŠ¨ç”»é™çº§å¤„ç†

```kotlin
/**
 * è‡ªé€‚åº”åŠ¨ç”»é…ç½®
 * æ ¹æ®è®¾å¤‡æ€§èƒ½è‡ªåŠ¨è°ƒæ•´åŠ¨ç”»å‚æ•°
 */
object AdaptiveAnimationConfig {
    private var isLowEndDevice: Boolean? = null
    
    /**
     * æ£€æµ‹æ˜¯å¦ä¸ºä½ç«¯è®¾å¤‡
     */
    fun isLowEndDevice(context: Context): Boolean {
        if (isLowEndDevice == null) {
            val activityManager = context.getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager
            isLowEndDevice = activityManager.isLowRamDevice ||
                    Build.VERSION.SDK_INT < Build.VERSION_CODES.O
        }
        return isLowEndDevice!!
    }
    
    /**
     * è·å–è‡ªé€‚åº”åŠ¨ç”»æ—¶é•¿
     */
    fun getAnimationDuration(context: Context, defaultDuration: Int = 250): Int {
        return if (isLowEndDevice(context)) {
            (defaultDuration * 0.5).toInt() // ä½ç«¯è®¾å¤‡å‡åŠ
        } else {
            defaultDuration
        }
    }
    
    /**
     * è·å–è‡ªé€‚åº”åŠ¨ç”»è§„æ ¼
     */
    @Composable
    fun <T> adaptiveAnimationSpec(
        defaultSpec: AnimationSpec<T> = tween(250, easing = FastOutSlowInEasing)
    ): AnimationSpec<T> {
        val context = LocalContext.current
        return remember(context) {
            if (isLowEndDevice(context)) {
                tween(125, easing = LinearEasing) // ç®€åŒ–åŠ¨ç”»
            } else {
                defaultSpec
            }
        }
    }
}
```

### 9.7 åˆ—è¡¨åŠ è½½é”™è¯¯å¤„ç†

```kotlin
/**
 * å¸¦é”™è¯¯å¤„ç†çš„æ—¶å…‰è½´è§†å›¾
 */
@Composable
fun SafeEmotionTimelineView(
    items: List<TimelineItem>,
    onItemClick: (TimelineItem) -> Unit,
    onError: (Throwable) -> Unit = {},
    modifier: Modifier = Modifier
) {
    var loadError by remember { mutableStateOf<Throwable?>(null) }
    
    when {
        loadError != null -> {
            // é”™è¯¯çŠ¶æ€
            ErrorStateView(
                message = "åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•",
                onRetry = { loadError = null }
            )
        }
        items.isEmpty() -> {
            // ç©ºçŠ¶æ€
            EmptyStateView(
                message = "æš‚æ— è®°å½•",
                icon = Icons.Default.Timeline
            )
        }
        else -> {
            // æ­£å¸¸æ˜¾ç¤º
            LaunchedEffect(items) {
                try {
                    // é¢„åŠ è½½éªŒè¯
                    items.forEach { item ->
                        require(item.id.isNotBlank()) { "Invalid item id" }
                    }
                } catch (e: Exception) {
                    loadError = e
                    onError(e)
                }
            }
            
            EmotionTimelineView(
                items = items,
                onItemClick = onItemClick,
                modifier = modifier
            )
        }
    }
}

@Composable
private fun ErrorStateView(
    message: String,
    onRetry: () -> Unit
) {
    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(32.dp),
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.Center
    ) {
        Icon(
            imageVector = Icons.Default.Error,
            contentDescription = null,
            tint = iOSRed,
            modifier = Modifier.size(48.dp)
        )
        Spacer(modifier = Modifier.height(16.dp))
        Text(
            text = message,
            fontSize = 16.sp,
            color = iOSTextSecondary
        )
        Spacer(modifier = Modifier.height(16.dp))
        TextButton(onClick = onRetry) {
            Text("é‡è¯•", color = iOSBlue)
        }
    }
}

@Composable
private fun EmptyStateView(
    message: String,
    icon: ImageVector
) {
    Column(
        modifier = Modifier
            .fillMaxSize()
            .padding(32.dp),
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.Center
    ) {
        Icon(
            imageVector = icon,
            contentDescription = null,
            tint = iOSTextTertiary,
            modifier = Modifier.size(64.dp)
        )
        Spacer(modifier = Modifier.height(16.dp))
        Text(
            text = message,
            fontSize = 16.sp,
            color = iOSTextSecondary
        )
    }
}
```

### 9.8 å†…å­˜ä¸è¶³å¤„ç†

```kotlin
/**
 * å†…å­˜ç›‘æ§å·¥å…·
 */
object MemoryMonitor {
    private const val LOW_MEMORY_THRESHOLD = 50 * 1024 * 1024L // 50MB
    
    /**
     * æ£€æŸ¥æ˜¯å¦å†…å­˜ä¸è¶³
     */
    fun isLowMemory(): Boolean {
        val runtime = Runtime.getRuntime()
        val freeMemory = runtime.freeMemory()
        val maxMemory = runtime.maxMemory()
        val usedMemory = runtime.totalMemory() - freeMemory
        val availableMemory = maxMemory - usedMemory
        
        return availableMemory < LOW_MEMORY_THRESHOLD
    }
    
    /**
     * è·å–å†…å­˜ä½¿ç”¨å»ºè®®
     */
    fun getMemoryAdvice(): MemoryAdvice {
        return when {
            isLowMemory() -> MemoryAdvice.REDUCE_QUALITY
            else -> MemoryAdvice.NORMAL
        }
    }
}

enum class MemoryAdvice {
    NORMAL,         // æ­£å¸¸æ¨¡å¼
    REDUCE_QUALITY  // é™ä½è´¨é‡æ¨¡å¼
}

/**
 * æ ¹æ®å†…å­˜çŠ¶æ€è°ƒæ•´å›¾è¡¨æ¸²æŸ“
 */
@Composable
fun AdaptiveHealthRingChart(
    progress: Float,
    score: Int,
    modifier: Modifier = Modifier
) {
    val memoryAdvice = remember { MemoryMonitor.getMemoryAdvice() }
    
    when (memoryAdvice) {
        MemoryAdvice.NORMAL -> {
            // å®Œæ•´æ¸²æŸ“ï¼šæ¸å˜ + åŠ¨ç”»
            HealthRingChart(
                progress = progress,
                score = score,
                modifier = modifier
            )
        }
        MemoryAdvice.REDUCE_QUALITY -> {
            // ç®€åŒ–æ¸²æŸ“ï¼šçº¯è‰² + æ— åŠ¨ç”»
            SimpleRingChart(
                progress = progress,
                score = score,
                modifier = modifier
            )
        }
    }
}
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 10.1 å•å…ƒæµ‹è¯•

#### è‰²å½©ç³»ç»Ÿæµ‹è¯•

```kotlin
class EmotionColorsTest {
    @Test
    fun `getGradient returns correct colors for each emotion type`() {
        EmotionType.values().forEach { type ->
            val gradient = EmotionColors.getGradient(type)
            assertThat(gradient).hasSize(2)
            assertThat(gradient[0]).isNotEqualTo(gradient[1])
        }
    }
}

class MacaronTagColorsTest {
    @Test
    fun `getColorPair returns consistent color for same tag name`() {
        val tag = "æµ‹è¯•æ ‡ç­¾"
        val pair1 = MacaronTagColors.getColorPair(tag)
        val pair2 = MacaronTagColors.getColorPair(tag)
        assertThat(pair1).isEqualTo(pair2)
    }
}
```

#### ç»„ä»¶çŠ¶æ€æµ‹è¯•

```kotlin
class OverviewUiStateTest {
    @Test
    fun `default state has empty values`() {
        val state = OverviewUiState()
        assertThat(state.contactName).isEmpty()
        assertThat(state.relationshipScore).isEqualTo(0)
        assertThat(state.coreTags).isEmpty()
    }
}
```

### 10.2 UIæµ‹è¯•

#### åˆ†æ®µæ§åˆ¶å™¨æµ‹è¯•

```kotlin
class IOSSegmentedControlTest {
    @get:Rule
    val composeTestRule = createComposeRule()
    
    @Test
    fun `clicking tab triggers onTabSelected callback`() {
        var selectedIndex = 0
        
        composeTestRule.setContent {
            IOSSegmentedControl(
                tabs = listOf("æ¦‚è§ˆ", "äº‹å®æµ", "ç”»åƒ", "èµ„æ–™åº“"),
                selectedIndex = selectedIndex,
                onTabSelected = { selectedIndex = it }
            )
        }
        
        composeTestRule.onNodeWithText("äº‹å®æµ").performClick()
        assertThat(selectedIndex).isEqualTo(1)
    }
}
```

#### åœ†ç¯å›¾æµ‹è¯•

```kotlin
class HealthRingChartTest {
    @get:Rule
    val composeTestRule = createComposeRule()
    
    @Test
    fun `displays score in center`() {
        composeTestRule.setContent {
            HealthRingChart(
                progress = 0.85f,
                score = 85
            )
        }
        
        composeTestRule.onNodeWithText("85").assertIsDisplayed()
    }
}
```

### 10.3 é›†æˆæµ‹è¯•

```kotlin
class ContactDetailTabScreenTest {
    @get:Rule
    val composeTestRule = createAndroidComposeRule<MainActivity>()
    
    @Test
    fun `tab switching works correctly`() {
        // å¯¼èˆªåˆ°è”ç³»äººè¯¦æƒ…é¡µ
        composeTestRule.onNodeWithText("è”ç³»äºº").performClick()
        composeTestRule.onNodeWithText("å°çº¢").performClick()
        
        // éªŒè¯é»˜è®¤æ˜¾ç¤ºæ¦‚è§ˆé¡µ
        composeTestRule.onNodeWithText("å…³ç³»åˆ†æ•°").assertIsDisplayed()
        
        // åˆ‡æ¢åˆ°äº‹å®æµé¡µ
        composeTestRule.onNodeWithText("äº‹å®æµ").performClick()
        composeTestRule.onNodeWithText("æ—¶å…‰è½´").assertIsDisplayed()
        
        // åˆ‡æ¢åˆ°ç”»åƒåº“é¡µ
        composeTestRule.onNodeWithText("ç”»åƒ").performClick()
        composeTestRule.onNodeWithText("å…´è¶£çˆ±å¥½").assertIsDisplayed()
    }
}
```

---

## ğŸŒ å›½é™…åŒ–æ”¯æŒ

### 11.1 å­—ç¬¦ä¸²èµ„æº

**æ–°å¢æ–‡ä»¶**: `presentation/src/main/res/values/strings_contact_detail.xml`

```xml
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <!-- æ ‡ç­¾é¡µ -->
    <string name="tab_overview">æ¦‚è§ˆ</string>
    <string name="tab_fact_stream">äº‹å®æµ</string>
    <string name="tab_persona">æ ‡ç­¾ç”»åƒ</string>
    <string name="tab_data_vault">èµ„æ–™åº“</string>
    
    <!-- æ¦‚è§ˆé¡µ -->
    <string name="label_days_known">å·²ç›¸è¯† %d å¤©</string>
    <string name="label_relationship_good">å…³ç³»è‰¯å¥½</string>
    <string name="label_core_tags">æ ¸å¿ƒæ ‡ç­¾</string>
    <string name="label_new_discovery">æ–°å‘ç°</string>
    <string name="label_custom_prompt">ä¸º%sè®¾ç½®ä¸“å±AIåˆ†ææŒ‡ä»¤</string>
    <string name="label_ai_learning">AIæ­£åœ¨å­¦ä¹ ä¸­...</string>
    
    <!-- äº‹å®æµé¡µ -->
    <string name="view_timeline">æ—¶å…‰è½´</string>
    <string name="view_list">æ¸…å•</string>
    <string name="filter_all">å…¨éƒ¨</string>
    <string name="btn_manual_summary">æ‰‹åŠ¨æ€»ç»“</string>
    <string name="label_ai_suggestion">AI å»ºè®®</string>
    <string name="label_score_change">å…³ç³»åˆ†æ•° %+d</string>
    
    <!-- ç”»åƒåº“é¡µ -->
    <string name="search_tags_hint">æœç´¢æ ‡ç­¾æˆ–åˆ†ç±»...</string>
    <string name="category_interests">å…´è¶£çˆ±å¥½</string>
    <string name="category_work">å·¥ä½œä¿¡æ¯</string>
    <string name="category_strategy">æ²Ÿé€šç­–ç•¥</string>
    <string name="category_risk">é›·åŒºæ ‡ç­¾</string>
    <string name="label_tag_count">%dä¸ª</string>
    <string name="risk_high">é«˜é£é™©</string>
    <string name="risk_medium">ä¸­é£é™©</string>
    <string name="risk_low">ä½é£é™©</string>
    <string name="label_ai_inference">AI è‡ªåŠ¨æ¨æµ‹</string>
    <string name="btn_accept_all">å…¨éƒ¨é‡‡çº³</string>
    <string name="btn_add_tag">æ·»åŠ æ ‡ç­¾</string>
    
    <!-- èµ„æ–™åº“é¡µ -->
    <string name="title_data_source">æ•°æ®æ¥æº</string>
    <string name="subtitle_data_source">ç®¡ç†ä¸è¯¥è”ç³»äººç›¸å…³çš„æ‰€æœ‰æ•°æ®</string>
    <string name="label_total_count">æ•°æ®æ€»é‡</string>
    <string name="data_chat">èŠå¤©è®°å½•</string>
    <string name="data_summary">AI æ€»ç»“</string>
    <string name="hint_media_developing">åª’ä½“åŠŸèƒ½å¼€å‘ä¸­</string>
    <string name="status_completed">å·²å®Œæˆ</string>
    <string name="status_not_available">ä¸å¯ç”¨</string>
    
    <!-- æ–°å»ºè”ç³»äººé¡µ -->
    <string name="title_new_contact">æ–°å»ºè”ç³»äºº</string>
    <string name="btn_cancel">å–æ¶ˆ</string>
    <string name="btn_done">å®Œæˆ</string>
    <string name="btn_add_photo">æ·»åŠ ç…§ç‰‡</string>
    <string name="label_name">å§“å</string>
    <string name="hint_name">è¾“å…¥å§“å</string>
    <string name="label_goal">æ²Ÿé€šç›®æ ‡</string>
    <string name="hint_goal">ä¾‹å¦‚ï¼šå»ºç«‹åˆæ­¥ä¿¡ä»»</string>
    <string name="btn_add_fact">æ·»åŠ ç”»åƒäº‹å®</string>
</resources>
```

### 11.2 ä½¿ç”¨ç¤ºä¾‹

```kotlin
// åœ¨Composableä¸­ä½¿ç”¨
Text(
    text = stringResource(R.string.tab_overview),
    fontSize = 13.sp
)

// å¸¦å‚æ•°çš„å­—ç¬¦ä¸²
Text(
    text = stringResource(R.string.label_days_known, daysKnown),
    fontSize = 11.sp
)
```


---

## ğŸ“ æ–‡ä»¶ç»“æ„

### 12.1 æ–°å¢æ–‡ä»¶æ¸…å•

```
presentation/src/main/kotlin/com/empathy/ai/presentation/
â”œâ”€â”€ theme/
â”‚   â”œâ”€â”€ Color.kt                        # ä¿®æ”¹ï¼šæ–°å¢iOSç³»ç»Ÿè‰²
â”‚   â”œâ”€â”€ EmotionColors.kt                # æ–°å¢ï¼šæƒ…ç»ªç±»å‹é¢œè‰²
â”‚   â”œâ”€â”€ MacaronTagColors.kt             # æ–°å¢ï¼šé©¬å¡é¾™æ ‡ç­¾è‰²
â”‚   â””â”€â”€ CategoryBarColors.kt            # æ–°å¢ï¼šåˆ†ç±»è‰²æ¡é¢œè‰²
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ component/
â”‚   â”‚   â”œâ”€â”€ ios/
â”‚   â”‚   â”‚   â”œâ”€â”€ IOSSegmentedControl.kt  # æ–°å¢ï¼šåˆ†æ®µæ§åˆ¶å™¨
â”‚   â”‚   â”‚   â””â”€â”€ IOSNavigationBar.kt     # æ–°å¢ï¼šiOSå¯¼èˆªæ 
â”‚   â”‚   â”œâ”€â”€ chart/
â”‚   â”‚   â”‚   â”œâ”€â”€ HealthRingChart.kt      # æ–°å¢ï¼šåœ†ç¯å›¾
â”‚   â”‚   â”‚   â””â”€â”€ SparklineChart.kt       # æ–°å¢ï¼šè¶‹åŠ¿å›¾
â”‚   â”‚   â”œâ”€â”€ timeline/
â”‚   â”‚   â”‚   â”œâ”€â”€ EmotionNode.kt          # æ–°å¢ï¼šæƒ…ç»ªèŠ‚ç‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ TimelineLine.kt         # æ–°å¢ï¼šè¿æ¥çº¿
â”‚   â”‚   â”‚   â”œâ”€â”€ EmotionTimelineView.kt  # æ–°å¢ï¼šæ—¶å…‰è½´è§†å›¾
â”‚   â”‚   â”‚   â””â”€â”€ TimelineCard.kt         # æ–°å¢ï¼šæ—¶å…‰è½´å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ filter/
â”‚   â”‚   â”‚   â””â”€â”€ FilterChipRow.kt        # æ–°å¢ï¼šç­›é€‰èƒ¶å›Š
â”‚   â”‚   â”œâ”€â”€ persona/
â”‚   â”‚   â”‚   â”œâ”€â”€ CategoryCard.kt         # æ–°å¢ï¼šåˆ†ç±»å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ RiskTagItem.kt          # æ–°å¢ï¼šé›·åŒºæ ‡ç­¾é¡¹
â”‚   â”‚   â”‚   â”œâ”€â”€ StrategyTagItem.kt      # æ–°å¢ï¼šç­–ç•¥æ ‡ç­¾é¡¹
â”‚   â”‚   â”‚   â””â”€â”€ AiInferenceSection.kt   # æ–°å¢ï¼šAIæ¨æµ‹åŒºåŸŸ
â”‚   â”‚   â”œâ”€â”€ tag/
â”‚   â”‚   â”‚   â””â”€â”€ MacaronTagChip.kt       # æ–°å¢ï¼šé©¬å¡é¾™æ ‡ç­¾
â”‚   â”‚   â”œâ”€â”€ vault/
â”‚   â”‚   â”‚   â”œâ”€â”€ DataStatisticsCard.kt   # æ–°å¢ï¼šç»Ÿè®¡å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ DataSourceGridCard.kt   # æ–°å¢ï¼šæ•°æ®å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ DataSourceGrid.kt       # æ–°å¢ï¼šæ•°æ®ç½‘æ ¼
â”‚   â”‚   â”‚   â””â”€â”€ StatusBadge.kt          # æ–°å¢ï¼šçŠ¶æ€è§’æ ‡
â”‚   â”‚   â””â”€â”€ contact/
â”‚   â”‚       â”œâ”€â”€ AvatarPicker.kt         # æ–°å¢ï¼šå¤´åƒé€‰æ‹©å™¨
â”‚   â”‚       â”œâ”€â”€ ContactFormCard.kt      # æ–°å¢ï¼šè¡¨å•å¡ç‰‡
â”‚   â”‚       â””â”€â”€ AddFactButton.kt        # æ–°å¢ï¼šæ·»åŠ äº‹å®æŒ‰é’®
â”‚   â””â”€â”€ screen/
â”‚       â””â”€â”€ contact/
â”‚           â”œâ”€â”€ overview/
â”‚           â”‚   â””â”€â”€ OverviewTab.kt      # é‡å†™ï¼šæ¦‚è§ˆé¡µ
â”‚           â”œâ”€â”€ factstream/
â”‚           â”‚   â””â”€â”€ FactStreamTab.kt    # é‡å†™ï¼šäº‹å®æµé¡µ
â”‚           â”œâ”€â”€ persona/
â”‚           â”‚   â””â”€â”€ PersonaTab.kt       # é‡å†™ï¼šç”»åƒåº“é¡µ
â”‚           â”œâ”€â”€ vault/
â”‚           â”‚   â””â”€â”€ DataVaultTab.kt     # é‡å†™ï¼šèµ„æ–™åº“é¡µ
â”‚           â””â”€â”€ CreateContactScreen.kt  # é‡å†™ï¼šæ–°å»ºè”ç³»äººé¡µ
â””â”€â”€ res/
    â””â”€â”€ values/
        â””â”€â”€ strings_contact_detail.xml  # æ–°å¢ï¼šå›½é™…åŒ–å­—ç¬¦ä¸²
```

### 12.2 æ–‡ä»¶ç»Ÿè®¡

| ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| æ–°å¢ç»„ä»¶ | 20ä¸ª | iOSç»„ä»¶ã€å›¾è¡¨ã€æ—¶å…‰è½´ã€ç”»åƒã€èµ„æ–™åº“ã€è”ç³»äºº |
| é‡å†™é¡µé¢ | 5ä¸ª | æ¦‚è§ˆã€äº‹å®æµã€ç”»åƒåº“ã€èµ„æ–™åº“ã€æ–°å»ºè”ç³»äºº |
| ä¿®æ”¹æ–‡ä»¶ | 1ä¸ª | Color.kt |
| æ–°å¢èµ„æº | 1ä¸ª | strings_contact_detail.xml |
| **æ€»è®¡** | **27ä¸ª** | |

---

## âš ï¸ é£é™©è¯„ä¼°ä¸ç¼“è§£

### 13.1 æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| Canvasç»˜åˆ¶å¤æ‚åº¦é«˜ | ä¸­ | ä¸­ | å‚è€ƒFD-00019å®ç°æ–¹æ¡ˆï¼Œä½¿ç”¨ç¼“å­˜ä¼˜åŒ– |
| åŠ¨ç”»æ€§èƒ½é—®é¢˜ | ä½ | ä¸­ | ä½¿ç”¨`graphicsLayer`ç¡¬ä»¶åŠ é€Ÿ |
| å›å½’é—®é¢˜ | ä¸­ | é«˜ | åˆ†é˜¶æ®µæµ‹è¯•ï¼Œä¿ç•™æ—§ä»£ç å¤‡ä»½ |
| è®¾è®¡ç¨¿è¿˜åŸåº¦ä¸è¶³ | ä¸­ | ä¸­ | ä¸¥æ ¼å¯¹ç…§HTMLè®¾è®¡ç¨¿ï¼Œé€åƒç´ éªŒè¯ |

### 13.2 è¿›åº¦é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| ç»„ä»¶å¼€å‘è¶…æ—¶ | ä¸­ | ä¸­ | ä¼˜å…ˆå®ç°P0ç»„ä»¶ï¼ŒP1ç»„ä»¶å¯å»¶å |
| é›†æˆé—®é¢˜ | ä½ | é«˜ | æ¯å®Œæˆä¸€ä¸ªæ¨¡å—ç«‹å³é›†æˆæµ‹è¯• |
| éœ€æ±‚å˜æ›´ | ä½ | ä¸­ | ç»„ä»¶è®¾è®¡ä¿æŒçµæ´»æ€§ |

### 13.3 ç¼“è§£ç­–ç•¥

1. **åˆ†é˜¶æ®µå®æ–½**: æŒ‰ç…§FD-00020çš„7ä¸ªå¼€å‘é˜¶æ®µé¡ºåºå®æ–½
2. **ä¼˜å…ˆæ ¸å¿ƒç»„ä»¶**: å…ˆå®ç°IOSSegmentedControlã€HealthRingChartç­‰P0ç»„ä»¶
3. **æŒç»­æµ‹è¯•**: æ¯å®Œæˆä¸€ä¸ªæ¨¡å—ç«‹å³è¿›è¡Œå•å…ƒæµ‹è¯•å’ŒUIæµ‹è¯•
4. **ä»£ç å®¡æŸ¥**: å…³é”®ç»„ä»¶å®Œæˆåè¿›è¡Œä»£ç å®¡æŸ¥

---

## ğŸ”„ é›†æˆç­–ç•¥

> **æœ¬ç« èŠ‚æ ¹æ®DR-00020å®¡æŸ¥æŠ¥å‘Šè¡¥å……ï¼Œè§£å†³å®æ–½ç»†èŠ‚ä¸å¤Ÿé—®é¢˜**

### 13.4 ä»£ç å¤‡ä»½ç­–ç•¥

#### å¤‡ä»½åŸåˆ™
1. **å®Œå…¨é‡å†™ï¼Œä¸ä¿®æ”¹åŸæ–‡ä»¶**: æ–°ç»„ä»¶ä½¿ç”¨æ–°æ–‡ä»¶åï¼Œä¿ç•™æ—§ä»£ç 
2. **Gitåˆ†æ”¯ç®¡ç†**: åœ¨`feature/prd20-contact-detail-ui`åˆ†æ”¯å¼€å‘
3. **æ¸è¿›å¼æ›¿æ¢**: é€šè¿‡Feature Flagæ§åˆ¶æ–°æ—§UIåˆ‡æ¢

#### å¤‡ä»½æ–‡ä»¶æ¸…å•

| åŸæ–‡ä»¶ | å¤‡ä»½æ–¹å¼ | è¯´æ˜ |
|--------|----------|------|
| OverviewTab.kt | é‡å‘½åä¸ºOverviewTabLegacy.kt | ä¿ç•™è‡³éªŒè¯å®Œæˆ |
| FactStreamTab.kt | é‡å‘½åä¸ºFactStreamTabLegacy.kt | ä¿ç•™è‡³éªŒè¯å®Œæˆ |
| PersonaTab.kt | é‡å‘½åä¸ºPersonaTabLegacy.kt | ä¿ç•™è‡³éªŒè¯å®Œæˆ |
| DataVaultTab.kt | é‡å‘½åä¸ºDataVaultTabLegacy.kt | ä¿ç•™è‡³éªŒè¯å®Œæˆ |
| CreateContactScreen.kt | é‡å‘½åä¸ºCreateContactScreenLegacy.kt | ä¿ç•™è‡³éªŒè¯å®Œæˆ |

#### Feature Flagå®ç°

```kotlin
/**
 * UIç‰ˆæœ¬æ§åˆ¶
 */
object UiVersionConfig {
    // é€šè¿‡BuildConfigæˆ–RemoteConfigæ§åˆ¶
    var useNewContactDetailUi: Boolean = BuildConfig.USE_NEW_CONTACT_DETAIL_UI
}

// åœ¨ContactDetailTabScreenä¸­ä½¿ç”¨
@Composable
fun ContactDetailTabScreen(contactId: String) {
    if (UiVersionConfig.useNewContactDetailUi) {
        NewContactDetailTabScreen(contactId)
    } else {
        LegacyContactDetailTabScreen(contactId)
    }
}
```

### 13.5 åˆ†é˜¶æ®µå‘å¸ƒè®¡åˆ’

| é˜¶æ®µ | èŒƒå›´ | éªŒè¯æ–¹å¼ | å›æ»šæ¡ä»¶ |
|------|------|----------|----------|
| Alpha | å†…éƒ¨æµ‹è¯• | æ‰‹åŠ¨æµ‹è¯• | ä»»ä½•å´©æºƒ |
| Beta | 10%ç”¨æˆ· | A/Bæµ‹è¯• | å´©æºƒç‡>0.1% |
| RC | 50%ç”¨æˆ· | ç›‘æ§æŒ‡æ ‡ | æ€§èƒ½ä¸‹é™>20% |
| GA | 100%ç”¨æˆ· | å…¨é‡ç›‘æ§ | ä¸¥é‡é—®é¢˜åé¦ˆ |

### 13.6 å›æ»šæœºåˆ¶

```kotlin
/**
 * å›æ»šè§¦å‘å™¨
 */
object RollbackTrigger {
    private const val CRASH_THRESHOLD = 3
    private var crashCount = 0
    
    /**
     * è®°å½•å´©æºƒå¹¶æ£€æŸ¥æ˜¯å¦éœ€è¦å›æ»š
     */
    fun recordCrash(): Boolean {
        crashCount++
        if (crashCount >= CRASH_THRESHOLD) {
            // è§¦å‘å›æ»š
            UiVersionConfig.useNewContactDetailUi = false
            return true
        }
        return false
    }
    
    /**
     * é‡ç½®å´©æºƒè®¡æ•°
     */
    fun reset() {
        crashCount = 0
    }
}
```

### 13.7 éªŒè¯æµ‹è¯•æ–¹æ¡ˆ

#### åŠŸèƒ½éªŒè¯æ¸…å•

| åŠŸèƒ½ç‚¹ | éªŒè¯æ–¹æ³• | é€šè¿‡æ ‡å‡† |
|--------|----------|----------|
| Tabåˆ‡æ¢ | UIæµ‹è¯• | åˆ‡æ¢å“åº”<100ms |
| æ•°æ®åŠ è½½ | é›†æˆæµ‹è¯• | åŠ è½½æ—¶é—´<500ms |
| åŠ¨ç”»æµç•…åº¦ | æ€§èƒ½æµ‹è¯• | å¸§ç‡â‰¥60fps |
| å†…å­˜å ç”¨ | æ€§èƒ½æµ‹è¯• | å¢é‡<10MB |
| å¯¼èˆªè·³è½¬ | UIæµ‹è¯• | æ— é—ªçƒã€æ— å´©æºƒ |

#### å›å½’æµ‹è¯•ç”¨ä¾‹

```kotlin
@Test
fun `æ–°UIä¸å½±å“ç°æœ‰è”ç³»äººåˆ—è¡¨åŠŸèƒ½`() {
    // 1. æ‰“å¼€è”ç³»äººåˆ—è¡¨
    composeTestRule.onNodeWithText("è”ç³»äºº").performClick()
    
    // 2. éªŒè¯åˆ—è¡¨æ­£å¸¸æ˜¾ç¤º
    composeTestRule.onNodeWithTag("contact_list").assertIsDisplayed()
    
    // 3. ç‚¹å‡»è”ç³»äººè¿›å…¥è¯¦æƒ…
    composeTestRule.onNodeWithText("å°çº¢").performClick()
    
    // 4. éªŒè¯è¯¦æƒ…é¡µæ­£å¸¸æ˜¾ç¤º
    composeTestRule.onNodeWithText("æ¦‚è§ˆ").assertIsDisplayed()
    
    // 5. è¿”å›åˆ—è¡¨
    composeTestRule.onNodeWithContentDescription("è¿”å›").performClick()
    
    // 6. éªŒè¯åˆ—è¡¨çŠ¶æ€ä¿æŒ
    composeTestRule.onNodeWithTag("contact_list").assertIsDisplayed()
}
```

---

## ğŸ“… å®æ–½è®¡åˆ’

### 14.1 å¼€å‘é˜¶æ®µ

| é˜¶æ®µ | å†…å®¹ | é¢„ä¼°æ—¶é—´ | ä¾èµ– | äº§å‡º |
|------|------|----------|------|------|
| é˜¶æ®µ1 | è‰²å½©ç³»ç»Ÿå’Œé€šç”¨ç»„ä»¶ | 2å°æ—¶ | æ—  | Color.ktæ‰©å±•ã€3ä¸ªé¢œè‰²å·¥å…·ç±» |
| é˜¶æ®µ2 | iOSç»„ä»¶åº“ | 3å°æ—¶ | é˜¶æ®µ1 | IOSSegmentedControlã€IOSNavigationBar |
| é˜¶æ®µ3 | å›¾è¡¨ç»„ä»¶ | 3å°æ—¶ | é˜¶æ®µ1 | HealthRingChartã€SparklineChart |
| é˜¶æ®µ4 | æ—¶å…‰è½´ç»„ä»¶ | 4å°æ—¶ | é˜¶æ®µ1 | EmotionNodeã€EmotionTimelineViewã€TimelineCard |
| é˜¶æ®µ5 | ç”»åƒåº“ç»„ä»¶ | 4å°æ—¶ | é˜¶æ®µ1 | CategoryCardã€MacaronTagChipã€AiInferenceSection |
| é˜¶æ®µ6 | èµ„æ–™åº“ç»„ä»¶ | 3å°æ—¶ | é˜¶æ®µ1 | DataStatisticsCardã€DataSourceGrid |
| é˜¶æ®µ7 | è”ç³»äººç»„ä»¶ | 2å°æ—¶ | é˜¶æ®µ1 | AvatarPickerã€ContactFormCard |
| é˜¶æ®µ8 | æ¦‚è§ˆé¡µé‡å†™ | 4å°æ—¶ | é˜¶æ®µ2-3 | OverviewTab.kt |
| é˜¶æ®µ9 | äº‹å®æµé¡µé‡å†™ | 4å°æ—¶ | é˜¶æ®µ4 | FactStreamTab.kt |
| é˜¶æ®µ10 | ç”»åƒåº“é¡µé‡å†™ | 4å°æ—¶ | é˜¶æ®µ5 | PersonaTab.kt |
| é˜¶æ®µ11 | èµ„æ–™åº“é¡µé‡å†™ | 3å°æ—¶ | é˜¶æ®µ6 | DataVaultTab.kt |
| é˜¶æ®µ12 | æ–°å»ºè”ç³»äººé¡µé‡å†™ | 2å°æ—¶ | é˜¶æ®µ7 | CreateContactScreen.kt |
| é˜¶æ®µ13 | é›†æˆæµ‹è¯•å’Œä¿®å¤ | 4å°æ—¶ | é˜¶æ®µ8-12 | æµ‹è¯•æŠ¥å‘Šã€Bugä¿®å¤ |

**æ€»è®¡**: çº¦42å°æ—¶

### 14.2 é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | å®Œæˆæ ‡å‡† | é¢„è®¡æ—¥æœŸ |
|--------|----------|----------|
| M1: åŸºç¡€ç»„ä»¶å®Œæˆ | é˜¶æ®µ1-7å®Œæˆï¼Œæ‰€æœ‰ç»„ä»¶å¯ç‹¬ç«‹è¿è¡Œ | +3å¤© |
| M2: é¡µé¢é‡å†™å®Œæˆ | é˜¶æ®µ8-12å®Œæˆï¼Œæ‰€æœ‰é¡µé¢å¯æ­£å¸¸æ˜¾ç¤º | +5å¤© |
| M3: é›†æˆæµ‹è¯•é€šè¿‡ | é˜¶æ®µ13å®Œæˆï¼Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡ | +6å¤© |
| M4: å‘å¸ƒå°±ç»ª | ä»£ç å®¡æŸ¥é€šè¿‡ï¼Œæ–‡æ¡£æ›´æ–°å®Œæˆ | +7å¤© |

---

## âœ… éªŒæ”¶æ ‡å‡†

### 15.1 è§†è§‰éªŒæ”¶

- [ ] æ‰€æœ‰é¡µé¢èƒŒæ™¯è‰²ç»Ÿä¸€ä¸º`#F2F2F7`æˆ–`#F5F5F7`
- [ ] å¡ç‰‡åœ†è§’ç»Ÿä¸€ä¸º14dpæˆ–16dp
- [ ] åˆ†æ®µæ§åˆ¶å™¨æ ·å¼ä¸è®¾è®¡ç¨¿ä¸€è‡´
- [ ] åœ†ç¯å›¾æ¸å˜å’ŒåŠ¨ç”»æ•ˆæœæ­£ç¡®
- [ ] æƒ…ç»ªèŠ‚ç‚¹é¢œè‰²ä¸EmotionTypeå¯¹åº”
- [ ] é©¬å¡é¾™è‰²æ ‡ç­¾æ ·å¼æ­£ç¡®
- [ ] å·¦ä¾§è‰²æ¡é¢œè‰²ä¸åˆ†ç±»å¯¹åº”
- [ ] çŠ¶æ€è§’æ ‡é¢œè‰²ä¸DataStatuså¯¹åº”

### 15.2 äº¤äº’éªŒæ”¶

- [ ] åˆ†æ®µæ§åˆ¶å™¨æ»‘å—åŠ¨ç”»æµç•…ï¼ˆ250msï¼‰
- [ ] å¡ç‰‡ç‚¹å‡»æœ‰ç¼©æ”¾åé¦ˆ
- [ ] æ·¡å…¥åŠ¨ç”»é”™è½æœ‰è‡´ï¼ˆ50msé—´éš”ï¼‰
- [ ] æŠ˜å /å±•å¼€åŠ¨ç”»å¹³æ»‘
- [ ] ç­›é€‰åˆ‡æ¢å“åº”åŠæ—¶
- [ ] è§†å›¾åˆ‡æ¢æ— é—ªçƒ

### 15.3 åŠŸèƒ½éªŒæ”¶

- [ ] æ‰€æœ‰åŸæœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ•°æ®æ­£ç¡®å±•ç¤º
- [ ] å¯¼èˆªè·³è½¬æ­£ç¡®
- [ ] è¡¨å•éªŒè¯æœ‰æ•ˆ
- [ ] ç©ºçŠ¶æ€æ­£ç¡®æ˜¾ç¤º

### 15.4 æ€§èƒ½éªŒæ”¶

- [ ] é¡µé¢åŠ è½½æ—¶é—´ < 500ms
- [ ] åŠ¨ç”»å¸§ç‡ â‰¥ 60fps
- [ ] å†…å­˜å ç”¨æ— æ˜æ˜¾å¢åŠ 
- [ ] æ— ANRæˆ–å´©æºƒ

### 15.5 æµ‹è¯•éªŒæ”¶

- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- [ ] UIæµ‹è¯•å…¨éƒ¨é€šè¿‡
- [ ] é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## ğŸ“ é™„å½•

### A. è®¾è®¡ç¨¿å¼•ç”¨

| é¡µé¢ | è®¾è®¡ç¨¿ | å…³é”®è¡Œå· |
|------|--------|----------|
| æ¦‚è§ˆé¡µ | æ¦‚è§ˆé¡µ.html | 58-78(åˆ†æ®µæ§åˆ¶å™¨), 83-108(ä¸ªäººä¿¡æ¯), 111-165(åœ†ç¯å›¾) |
| äº‹å®æµé¡µ | äº‹å®æµé¡µ.html | 100-200(æ—¶å…‰è½´), 350-450(æ¸…å•è§†å›¾) |
| ç”»åƒåº“é¡µ | ç”»åƒåº“é¡µ.html | 80-130(åˆ†ç±»å¡ç‰‡), 150-220(é›·åŒºæ ‡ç­¾) |
| èµ„æ–™åº“é¡µ | èµ„æ–™åº“é¡µ.html | 45-65(ç»Ÿè®¡å¡ç‰‡), 70-150(æ•°æ®ç½‘æ ¼) |
| æ–°å»ºè”ç³»äººé¡µ | æ–°å»ºè”ç³»äººé¡µ.html | 20-25(å¯¼èˆªæ ), 30-45(å¤´åƒ), 50-75(è¡¨å•) |

### B. å‚è€ƒæ–‡æ¡£

- [iOS Human Interface Guidelines - Color](https://developer.apple.com/design/human-interface-guidelines/color)
- [Jetpack Compose Animation](https://developer.android.com/jetpack/compose/animation)
- [Compose Canvas](https://developer.android.com/jetpack/compose/graphics/draw/overview)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-26
**æœ€åæ›´æ–°**: 2025-12-26
**è´Ÿè´£äºº**: Kiro
**å®¡æ ¸äºº**: å¾…å®š
