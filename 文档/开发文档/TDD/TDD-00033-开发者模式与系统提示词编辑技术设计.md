# TDD-00033: å¼€å‘è€…æ¨¡å¼ä¸ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘æŠ€æœ¯è®¾è®¡

## 1. æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| æ–‡æ¡£ç±»å‹ | TDD (Technical Design Document) |
| æ–‡æ¡£ç¼–å· | TDD-00033 |
| åŠŸèƒ½åç§° | å¼€å‘è€…æ¨¡å¼ä¸ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘ |
| ç‰ˆæœ¬ | 1.0 |
| åˆ›å»ºæ—¥æœŸ | 2026-01-08 |
| æœ€åæ›´æ–° | 2026-01-08 |
| ä½œè€… | Kiro |
| å®¡æ ¸äºº | å¾…å®¡æ ¸ |
| å®¡æ ¸çŠ¶æ€ | å¾…å®¡æ ¸ |
| å…³è”æ–‡æ¡£ | PRD-00033, TDD-00005, TDD-00015 |

### 1.1 ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´è¯´æ˜ |
|------|------|------|----------|
| 1.0 | 2026-01-08 | Kiro | åˆå§‹ç‰ˆæœ¬ |

### 1.2 æŠ€æœ¯æ ˆ

| æŠ€æœ¯é¢†åŸŸ | æŠ€æœ¯é€‰æ‹© | ç‰ˆæœ¬ | ç”¨é€” |
|---------|----------|------|------|
| UIæ¡†æ¶ | Jetpack Compose | BOM 2024.12.01 | å£°æ˜å¼UI |
| è®¾è®¡ç³»ç»Ÿ | Material 3 | 1.3.1 | UIç»„ä»¶å’Œä¸»é¢˜ |
| ä¾èµ–æ³¨å…¥ | Hilt | 2.52 | ä¾èµ–ç®¡ç† |
| JSONåºåˆ—åŒ– | Moshi | 1.15.1 | é…ç½®æ–‡ä»¶è§£æ |
| å¼‚æ­¥å¤„ç† | Kotlin Coroutines | 1.9.0 | å¼‚æ­¥æ“ä½œ |

---

## 2. æ¶æ„æ¦‚è¿°

### 2.1 è®¾è®¡ç›®æ ‡

å®ç°ç±»ä¼¼Androidç³»ç»Ÿçš„"å¼€å‘è€…æ¨¡å¼"ï¼Œé€šè¿‡éšè—å…¥å£è§£é”ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘åŠŸèƒ½ï¼Œæ”¯æŒè¿è¡Œæ—¶ä¿®æ”¹5ä¸ªAIåœºæ™¯çš„Headerå’ŒFooterï¼Œæ— éœ€é‡æ–°ç¼–è¯‘APKã€‚

**æ ¸å¿ƒç›®æ ‡**ï¼š
- éšè—å…¥å£ï¼šç‚¹å‡»ç‰ˆæœ¬å·7æ¬¡è§£é”
- ä¸æŒä¹…åŒ–ï¼šæ¯æ¬¡å¯åŠ¨Appéœ€é‡æ–°è§£é”
- 5ä¸ªåœºæ™¯ï¼šANALYZEã€POLISHã€REPLYã€SUMMARYã€AI_ADVISOR
- å³æ—¶ç”Ÿæ•ˆï¼šä¿®æ”¹åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯
- æœ€å¤§å¤ç”¨ï¼šå¤ç”¨ç°æœ‰æç¤ºè¯ç¼–è¾‘å™¨å’Œè®¾ç½®ç•Œé¢ç»„ä»¶

### 2.2 è®¾è®¡åŸåˆ™

- **æœ€å°ä¾µå…¥**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½å’Œç”¨æˆ·ä½“éªŒ
- **æœ€å¤§å¤ç”¨**ï¼šå¤ç”¨ç°æœ‰ç»„ä»¶ï¼Œå‡å°‘æ–°ä»£ç 
- **å®‰å…¨éš”ç¦»**ï¼šå¼€å‘è€…åŠŸèƒ½ä¸æ™®é€šåŠŸèƒ½éš”ç¦»
- **å³æ—¶ç”Ÿæ•ˆ**ï¼šä¿®æ”¹åç«‹å³ç”Ÿæ•ˆåˆ°æ­£å¼é…ç½®


---

## 3. æ•´ä½“æ¶æ„è®¾è®¡

### 3.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Presentation Layer                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SettingsScreen â”‚â”€â”€â”€â–¶â”‚DeveloperOptions â”‚â”€â”€â”€â–¶â”‚SystemPromptList â”‚ â”‚
â”‚  â”‚  (ç‰ˆæœ¬å·ç‚¹å‡»)    â”‚    â”‚    Section      â”‚    â”‚    Screen       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚          â”‚
â”‚                                                          â–¼          â”‚
â”‚                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                                               â”‚SystemPromptEdit â”‚   â”‚
â”‚                                               â”‚    Screen       â”‚   â”‚
â”‚                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ViewModel Layer                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚DeveloperMode    â”‚    â”‚SystemPromptEditViewModel        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ViewModel        â”‚    â”‚                                 â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Domain Layer                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Model                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚SystemPrompt     â”‚    â”‚SystemPromptScene                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚Config           â”‚    â”‚(6ä¸ªåœºæ™¯æšä¸¾)                     â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Repository Interface                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚SystemPromptRepository                                   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Data Layer                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Local Storage                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚SystemPrompt     â”‚    â”‚system_prompts.json              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚Storage          â”‚â”€â”€â”€â–¶â”‚(Appç§æœ‰ç›®å½•)                     â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Repository Implementation                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚SystemPromptRepositoryImpl                               â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¨¡å—å½±å“èŒƒå›´

```
domain/
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ SystemPromptConfig.kt       # ğŸ†• æ–°å¢ï¼šç³»ç»Ÿæç¤ºè¯é…ç½®æ¨¡å‹
â”‚   â””â”€â”€ SystemPromptScene.kt        # ğŸ†• æ–°å¢ï¼š6ä¸ªåœºæ™¯æšä¸¾
â”œâ”€â”€ repository/
â”‚   â””â”€â”€ SystemPromptRepository.kt   # ğŸ†• æ–°å¢ï¼šä»“åº“æ¥å£

data/
â”œâ”€â”€ local/
â”‚   â””â”€â”€ SystemPromptStorage.kt      # ğŸ†• æ–°å¢ï¼šJSONæ–‡ä»¶å­˜å‚¨
â”œâ”€â”€ repository/
â”‚   â””â”€â”€ SystemPromptRepositoryImpl.kt # ğŸ†• æ–°å¢ï¼šä»“åº“å®ç°
â””â”€â”€ di/
    â””â”€â”€ PromptModule.kt             # ğŸ”„ æ›´æ–°ï¼šæ·»åŠ DIé…ç½®

presentation/
â”œâ”€â”€ ui/screen/settings/
â”‚   â”œâ”€â”€ SettingsScreen.kt           # ğŸ”„ æ›´æ–°ï¼šæ·»åŠ ç‰ˆæœ¬å·ç‚¹å‡»é€»è¾‘
â”‚   â””â”€â”€ component/
â”‚       â””â”€â”€ DeveloperOptionsSection.kt # ğŸ†• æ–°å¢ï¼šå¼€å‘è€…é€‰é¡¹åŒºåŸŸ
â”œâ”€â”€ ui/screen/developer/
â”‚   â”œâ”€â”€ SystemPromptListScreen.kt   # ğŸ†• æ–°å¢ï¼šåœºæ™¯åˆ—è¡¨é¡µ
â”‚   â””â”€â”€ SystemPromptEditScreen.kt   # ğŸ†• æ–°å¢ï¼šåœºæ™¯ç¼–è¾‘é¡µ
â”œâ”€â”€ viewmodel/
â”‚   â”œâ”€â”€ DeveloperModeViewModel.kt   # ğŸ†• æ–°å¢ï¼šå¼€å‘è€…æ¨¡å¼çŠ¶æ€
â”‚   â””â”€â”€ SystemPromptEditViewModel.kt # ğŸ†• æ–°å¢ï¼šç¼–è¾‘é¡µViewModel
â””â”€â”€ navigation/
    â””â”€â”€ NavGraph.kt                 # ğŸ”„ æ›´æ–°ï¼šæ·»åŠ è·¯ç”±

domain/util/
â””â”€â”€ SystemPrompts.kt                # ğŸ”„ æ›´æ–°ï¼šæ”¯æŒè¯»å–è‡ªå®šä¹‰é…ç½®
```

### 3.3 æ•°æ®æµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¼€å‘è€…æ¨¡å¼è§£é”æµç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ç”¨æˆ·ç‚¹å‡»ç‰ˆæœ¬å·                                                      â”‚
â”‚       â”‚                                                             â”‚
â”‚       â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚SettingsViewModelâ”‚                                               â”‚
â”‚  â”‚ clickCount++    â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ clickCount < 7                    clickCount == 7            â”‚   â”‚
â”‚  â”‚      â”‚                                  â”‚                    â”‚   â”‚
â”‚  â”‚      â–¼                                  â–¼                    â”‚   â”‚
â”‚  â”‚ Toast: "å†ç‚¹å‡»Xæ¬¡"              Toast: "å·²è¿›å…¥å¼€å‘è€…æ¨¡å¼"      â”‚   â”‚
â”‚  â”‚                                         â”‚                    â”‚   â”‚
â”‚  â”‚                                         â–¼                    â”‚   â”‚
â”‚  â”‚                              isDeveloperMode = true          â”‚   â”‚
â”‚  â”‚                                         â”‚                    â”‚   â”‚
â”‚  â”‚                                         â–¼                    â”‚   â”‚
â”‚  â”‚                              æ˜¾ç¤º"å¼€å‘è€…é€‰é¡¹"åŒºåŸŸ              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘æµç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  ç”¨æˆ·ç¼–è¾‘Header/Footer                                              â”‚
â”‚       â”‚                                                             â”‚
â”‚       â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SystemPromptEditViewModel                                    â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ updateHeader(scene, newHeader)                          â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ updateFooter(scene, newFooter)                          â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SystemPromptRepository.saveConfig(config)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SystemPromptStorage.writeConfig(config)                      â”‚   â”‚
â”‚  â”‚ â†’ /data/data/com.empathy.ai/files/prompts/system_prompts.jsonâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                     â”‚
â”‚                               â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SystemPrompts.getHeader(scene) / getFooter(scene)            â”‚   â”‚
â”‚  â”‚ â†’ ä¼˜å…ˆè¯»å–è‡ªå®šä¹‰é…ç½®ï¼Œfallbackåˆ°é»˜è®¤å€¼                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. è¯¦ç»†è®¾è®¡

### 4.1 æ•°æ®æ¨¡å‹è®¾è®¡

#### 4.1.1 SystemPromptSceneæšä¸¾

**æ–‡ä»¶ä½ç½®**ï¼š`domain/model/SystemPromptScene.kt`

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯åœºæ™¯æšä¸¾
 *
 * å®šä¹‰å¯ç¼–è¾‘çš„5ä¸ªæ ¸å¿ƒAIåœºæ™¯
 * 
 * > æ ¹æ®PRD-00033éœ€æ±‚ï¼Œç³»ç»Ÿæ”¯æŒ5ä¸ªæ ¸å¿ƒåœºæ™¯
 * > CHECKå’ŒEXTRACTåœºæ™¯å·²åºŸå¼ƒï¼ˆTD-00015ï¼‰
 *
 * @property displayName æ˜¾ç¤ºåç§°
 * @property description åœºæ™¯æè¿°
 * @property icon åœºæ™¯å›¾æ ‡ï¼ˆEmojiï¼‰
 *
 * @see PRD-00033 å¼€å‘è€…æ¨¡å¼ä¸ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘
 */
enum class SystemPromptScene(
    val displayName: String,
    val description: String,
    val icon: String
) {
    /**
     * èŠå¤©åˆ†æåœºæ™¯
     */
    ANALYZE(
        displayName = "èŠå¤©åˆ†æ",
        description = "åˆ†æå¯¹æ–¹è¯´çš„è¯ï¼Œæä¾›æ²Ÿé€šå»ºè®®",
        icon = "ğŸ”"
    ),

    /**
     * æ¶¦è‰²ä¼˜åŒ–åœºæ™¯ï¼ˆå«é£é™©æ£€æŸ¥ï¼‰
     */
    POLISH(
        displayName = "æ¶¦è‰²ä¼˜åŒ–",
        description = "ä¼˜åŒ–ç”¨æˆ·è‰ç¨¿ï¼Œä½¿è¡¨è¾¾æ›´å¾—ä½“ï¼ˆå«é£é™©æ£€æŸ¥ï¼‰",
        icon = "âœï¸"
    ),

    /**
     * ç”Ÿæˆå›å¤åœºæ™¯
     */
    REPLY(
        displayName = "ç”Ÿæˆå›å¤",
        description = "æ ¹æ®å¯¹æ–¹æ¶ˆæ¯ç”Ÿæˆåˆé€‚çš„å›å¤",
        icon = "ğŸ’¬"
    ),

    /**
     * æ¯æ—¥æ€»ç»“åœºæ™¯
     */
    SUMMARY(
        displayName = "æ¯æ—¥æ€»ç»“",
        description = "ç”Ÿæˆæ¯æ—¥å¯¹è¯æ€»ç»“",
        icon = "ğŸ“Š"
    ),

    /**
     * AIå†›å¸ˆåœºæ™¯
     */
    AI_ADVISOR(
        displayName = "AIå†›å¸ˆ",
        description = "AIå†›å¸ˆå¯¹è¯æ¨¡å¼ï¼Œæä¾›æ·±åº¦ç­–ç•¥åˆ†æ",
        icon = "ğŸ¯"
    );

    companion object {
        /**
         * è·å–æ‰€æœ‰åœºæ™¯åˆ—è¡¨
         */
        fun getAllScenes(): List<SystemPromptScene> = entries.toList()
    }
}
```


#### 4.1.2 SystemPromptConfigæ•°æ®æ¨¡å‹

**æ–‡ä»¶ä½ç½®**ï¼š`domain/model/SystemPromptConfig.kt`

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯é…ç½®
 *
 * @property version é…ç½®ç‰ˆæœ¬å·
 * @property scenes å„åœºæ™¯çš„æç¤ºè¯é…ç½®
 * @property lastModified æœ€åä¿®æ”¹æ—¶é—´
 *
 * @see PRD-00033 å¼€å‘è€…æ¨¡å¼ä¸ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘
 */
data class SystemPromptConfig(
    val version: Int = CURRENT_VERSION,
    val scenes: Map<SystemPromptScene, SceneSystemPrompt> = emptyMap(),
    val lastModified: Long = System.currentTimeMillis()
) {
    companion object {
        const val CURRENT_VERSION = 1

        /**
         * åˆ›å»ºç©ºé…ç½®ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰
         */
        fun createEmpty(): SystemPromptConfig = SystemPromptConfig()
    }

    /**
     * è·å–æŒ‡å®šåœºæ™¯çš„Header
     * @param scene åœºæ™¯
     * @return è‡ªå®šä¹‰Headerï¼Œå¦‚æœæœªè®¾ç½®åˆ™è¿”å›null
     */
    fun getHeader(scene: SystemPromptScene): String? {
        return scenes[scene]?.header
    }

    /**
     * è·å–æŒ‡å®šåœºæ™¯çš„Footer
     * @param scene åœºæ™¯
     * @return è‡ªå®šä¹‰Footerï¼Œå¦‚æœæœªè®¾ç½®åˆ™è¿”å›null
     */
    fun getFooter(scene: SystemPromptScene): String? {
        return scenes[scene]?.footer
    }

    /**
     * æ›´æ–°æŒ‡å®šåœºæ™¯çš„é…ç½®
     */
    fun updateScene(
        scene: SystemPromptScene,
        header: String?,
        footer: String?
    ): SystemPromptConfig {
        val updatedScenes = scenes.toMutableMap()
        updatedScenes[scene] = SceneSystemPrompt(
            header = header,
            footer = footer,
            updatedAt = System.currentTimeMillis()
        )
        return copy(
            scenes = updatedScenes,
            lastModified = System.currentTimeMillis()
        )
    }

    /**
     * é‡ç½®æŒ‡å®šåœºæ™¯ä¸ºé»˜è®¤å€¼
     */
    fun resetScene(scene: SystemPromptScene): SystemPromptConfig {
        val updatedScenes = scenes.toMutableMap()
        updatedScenes.remove(scene)
        return copy(
            scenes = updatedScenes,
            lastModified = System.currentTimeMillis()
        )
    }

    /**
     * é‡ç½®æ‰€æœ‰åœºæ™¯ä¸ºé»˜è®¤å€¼
     */
    fun resetAll(): SystemPromptConfig {
        return SystemPromptConfig()
    }
}

/**
 * å•ä¸ªåœºæ™¯çš„ç³»ç»Ÿæç¤ºè¯é…ç½®
 *
 * @property header è‡ªå®šä¹‰Headerï¼ˆè§’è‰²å®šä¹‰ï¼‰ï¼Œnullè¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼
 * @property footer è‡ªå®šä¹‰Footerï¼ˆè¾“å‡ºæ ¼å¼ï¼‰ï¼Œnullè¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼
 * @property updatedAt æ›´æ–°æ—¶é—´
 */
data class SceneSystemPrompt(
    val header: String? = null,
    val footer: String? = null,
    val updatedAt: Long = System.currentTimeMillis()
)
```

#### 4.1.3 å¯¼å‡ºé…ç½®æ•°æ®æ¨¡å‹

**æ–‡ä»¶ä½ç½®**ï¼š`domain/model/SystemPromptExport.kt`

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯å¯¼å‡ºæ ¼å¼
 *
 * @property version å¯¼å‡ºæ ¼å¼ç‰ˆæœ¬
 * @property exportTime å¯¼å‡ºæ—¶é—´
 * @property scenes åœºæ™¯é…ç½®æ˜ å°„
 */
data class SystemPromptExport(
    val version: String = "1.0",
    val exportTime: String,
    val scenes: Map<String, SceneExportData>
)

/**
 * å•ä¸ªåœºæ™¯çš„å¯¼å‡ºæ•°æ®
 */
data class SceneExportData(
    val header: String?,
    val footer: String?
)
```

---

### 4.2 Repositoryè®¾è®¡

#### 4.2.1 SystemPromptRepositoryæ¥å£

**æ–‡ä»¶ä½ç½®**ï¼š`domain/repository/SystemPromptRepository.kt`

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯ä»“åº“æ¥å£
 *
 * @see PRD-00033 å¼€å‘è€…æ¨¡å¼ä¸ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘
 */
interface SystemPromptRepository {

    /**
     * è·å–ç³»ç»Ÿæç¤ºè¯é…ç½®
     * @return é…ç½®ç»“æœ
     */
    suspend fun getConfig(): Result<SystemPromptConfig>

    /**
     * ä¿å­˜ç³»ç»Ÿæç¤ºè¯é…ç½®
     * @param config é…ç½®
     * @return ä¿å­˜ç»“æœ
     */
    suspend fun saveConfig(config: SystemPromptConfig): Result<Unit>

    /**
     * è·å–æŒ‡å®šåœºæ™¯çš„Header
     * @param scene åœºæ™¯
     * @return è‡ªå®šä¹‰Headerï¼Œå¦‚æœæœªè®¾ç½®åˆ™è¿”å›null
     */
    suspend fun getHeader(scene: SystemPromptScene): String?

    /**
     * è·å–æŒ‡å®šåœºæ™¯çš„Footer
     * @param scene åœºæ™¯
     * @return è‡ªå®šä¹‰Footerï¼Œå¦‚æœæœªè®¾ç½®åˆ™è¿”å›null
     */
    suspend fun getFooter(scene: SystemPromptScene): String?

    /**
     * æ›´æ–°æŒ‡å®šåœºæ™¯çš„é…ç½®
     * @param scene åœºæ™¯
     * @param header æ–°çš„Header
     * @param footer æ–°çš„Footer
     * @return æ›´æ–°ç»“æœ
     */
    suspend fun updateScene(
        scene: SystemPromptScene,
        header: String?,
        footer: String?
    ): Result<Unit>

    /**
     * é‡ç½®æŒ‡å®šåœºæ™¯ä¸ºé»˜è®¤å€¼
     * @param scene åœºæ™¯
     * @return é‡ç½®ç»“æœ
     */
    suspend fun resetScene(scene: SystemPromptScene): Result<Unit>

    /**
     * é‡ç½®æ‰€æœ‰åœºæ™¯ä¸ºé»˜è®¤å€¼
     * @return é‡ç½®ç»“æœ
     */
    suspend fun resetAll(): Result<Unit>

    /**
     * å¯¼å‡ºé…ç½®ä¸ºJSONå­—ç¬¦ä¸²
     * @return JSONå­—ç¬¦ä¸²
     */
    suspend fun exportToJson(): Result<String>

    /**
     * å¯¼å‡ºé…ç½®ä¸ºMarkdownå­—ç¬¦ä¸²
     * @return Markdownå­—ç¬¦ä¸²
     */
    suspend fun exportToMarkdown(): Result<String>

    /**
     * ä»JSONå­—ç¬¦ä¸²å¯¼å…¥é…ç½®
     * @param json JSONå­—ç¬¦ä¸²
     * @return å¯¼å…¥ç»“æœ
     */
    suspend fun importFromJson(json: String): Result<Unit>
}
```

#### 4.2.2 SystemPromptRepositoryImplå®ç°

**æ–‡ä»¶ä½ç½®**ï¼š`data/repository/SystemPromptRepositoryImpl.kt`

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯ä»“åº“å®ç°
 */
@Singleton
class SystemPromptRepositoryImpl @Inject constructor(
    private val storage: SystemPromptStorage,
    private val moshi: Moshi
) : SystemPromptRepository {

    // å†…å­˜ç¼“å­˜
    private var cachedConfig: SystemPromptConfig? = null

    override suspend fun getConfig(): Result<SystemPromptConfig> {
        cachedConfig?.let { return Result.success(it) }
        
        return storage.readConfig().also { result ->
            result.getOrNull()?.let { cachedConfig = it }
        }
    }

    override suspend fun saveConfig(config: SystemPromptConfig): Result<Unit> {
        return storage.writeConfig(config).also { result ->
            if (result.isSuccess) {
                cachedConfig = config
            }
        }
    }

    override suspend fun getHeader(scene: SystemPromptScene): String? {
        return getConfig().getOrNull()?.getHeader(scene)
    }

    override suspend fun getFooter(scene: SystemPromptScene): String? {
        return getConfig().getOrNull()?.getFooter(scene)
    }

    override suspend fun updateScene(
        scene: SystemPromptScene,
        header: String?,
        footer: String?
    ): Result<Unit> {
        val currentConfig = getConfig().getOrElse { SystemPromptConfig.createEmpty() }
        val updatedConfig = currentConfig.updateScene(scene, header, footer)
        return saveConfig(updatedConfig)
    }

    override suspend fun resetScene(scene: SystemPromptScene): Result<Unit> {
        val currentConfig = getConfig().getOrElse { return Result.success(Unit) }
        val updatedConfig = currentConfig.resetScene(scene)
        return saveConfig(updatedConfig)
    }

    override suspend fun resetAll(): Result<Unit> {
        cachedConfig = null
        return storage.deleteConfig()
    }

    override suspend fun exportToJson(): Result<String> {
        return try {
            val config = getConfig().getOrElse { SystemPromptConfig.createEmpty() }
            val export = SystemPromptExport(
                exportTime = java.time.Instant.now().toString(),
                scenes = config.scenes.mapKeys { it.key.name }.mapValues { (_, value) ->
                    SceneExportData(header = value.header, footer = value.footer)
                }
            )
            val adapter = moshi.adapter(SystemPromptExport::class.java).indent("  ")
            Result.success(adapter.toJson(export))
        } catch (e: Exception) {
            Result.failure(e)
        }
    }

    override suspend fun exportToMarkdown(): Result<String> {
        return try {
            val config = getConfig().getOrElse { SystemPromptConfig.createEmpty() }
            val markdown = buildString {
                appendLine("# ç³»ç»Ÿæç¤ºè¯é…ç½®")
                appendLine()
                appendLine("å¯¼å‡ºæ—¶é—´: ${java.time.Instant.now()}")
                appendLine()
                appendLine("---")
                appendLine()

                SystemPromptScene.getAllScenes().forEach { scene ->
                    val sceneConfig = config.scenes[scene]
                    appendLine("## ${scene.icon} ${scene.displayName} (${scene.name})")
                    appendLine()
                    appendLine("### Header")
                    appendLine()
                    appendLine("```")
                    appendLine(sceneConfig?.header ?: "(ä½¿ç”¨é»˜è®¤å€¼)")
                    appendLine("```")
                    appendLine()
                    appendLine("### Footer")
                    appendLine()
                    appendLine("```")
                    appendLine(sceneConfig?.footer ?: "(ä½¿ç”¨é»˜è®¤å€¼)")
                    appendLine("```")
                    appendLine()
                    appendLine("---")
                    appendLine()
                }
            }
            Result.success(markdown)
        } catch (e: Exception) {
            Result.failure(e)
        }
    }

    override suspend fun importFromJson(json: String): Result<Unit> {
        return try {
            val adapter = moshi.adapter(SystemPromptExport::class.java)
            val export = adapter.fromJson(json)
                ?: return Result.failure(Exception("è§£æJSONå¤±è´¥"))

            val scenes = export.scenes.mapNotNull { (key, value) ->
                try {
                    val scene = SystemPromptScene.valueOf(key)
                    scene to SceneSystemPrompt(
                        header = value.header,
                        footer = value.footer
                    )
                } catch (e: IllegalArgumentException) {
                    null // å¿½ç•¥æœªçŸ¥åœºæ™¯
                }
            }.toMap()

            val config = SystemPromptConfig(scenes = scenes)
            saveConfig(config)
        } catch (e: Exception) {
            Result.failure(e)
        }
    }
}
```


---

### 4.3 å­˜å‚¨å±‚è®¾è®¡

#### 4.3.1 SystemPromptStorage

**æ–‡ä»¶ä½ç½®**ï¼š`data/local/SystemPromptStorage.kt`

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯å­˜å‚¨
 *
 * è´Ÿè´£å°†ç³»ç»Ÿæç¤ºè¯é…ç½®æŒä¹…åŒ–åˆ°JSONæ–‡ä»¶
 *
 * @see PRD-00033 å¼€å‘è€…æ¨¡å¼ä¸ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘
 */
@Singleton
class SystemPromptStorage @Inject constructor(
    @ApplicationContext private val context: Context,
    private val moshi: Moshi
) {
    companion object {
        private const val TAG = "SystemPromptStorage"
        private const val PROMPTS_DIR = "prompts"
        private const val SYSTEM_PROMPTS_FILE = "system_prompts.json"
    }

    private val promptsDir: File by lazy {
        File(context.filesDir, PROMPTS_DIR).also { it.mkdirs() }
    }

    private val systemPromptsFile: File by lazy {
        File(promptsDir, SYSTEM_PROMPTS_FILE)
    }

    private val adapter: JsonAdapter<SystemPromptConfig> by lazy {
        moshi.adapter(SystemPromptConfig::class.java).indent("  ")
    }

    /**
     * è¯»å–é…ç½®
     */
    suspend fun readConfig(): Result<SystemPromptConfig> = withContext(Dispatchers.IO) {
        try {
            if (!systemPromptsFile.exists()) {
                Log.d(TAG, "é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºé…ç½®")
                return@withContext Result.success(SystemPromptConfig.createEmpty())
            }

            val json = systemPromptsFile.readText(Charsets.UTF_8)
            val config = adapter.fromJson(json)
                ?: return@withContext Result.failure(Exception("è§£æé…ç½®æ–‡ä»¶å¤±è´¥"))

            Log.d(TAG, "è¯»å–é…ç½®æˆåŠŸï¼ŒåŒ…å«${config.scenes.size}ä¸ªåœºæ™¯é…ç½®")
            Result.success(config)
        } catch (e: Exception) {
            Log.e(TAG, "è¯»å–é…ç½®å¤±è´¥", e)
            Result.failure(e)
        }
    }

    /**
     * å†™å…¥é…ç½®
     */
    suspend fun writeConfig(config: SystemPromptConfig): Result<Unit> = withContext(Dispatchers.IO) {
        try {
            val json = adapter.toJson(config)
            systemPromptsFile.writeText(json, Charsets.UTF_8)
            Log.d(TAG, "å†™å…¥é…ç½®æˆåŠŸ")
            Result.success(Unit)
        } catch (e: Exception) {
            Log.e(TAG, "å†™å…¥é…ç½®å¤±è´¥", e)
            Result.failure(e)
        }
    }

    /**
     * åˆ é™¤é…ç½®æ–‡ä»¶
     */
    suspend fun deleteConfig(): Result<Unit> = withContext(Dispatchers.IO) {
        try {
            if (systemPromptsFile.exists()) {
                systemPromptsFile.delete()
                Log.d(TAG, "åˆ é™¤é…ç½®æ–‡ä»¶æˆåŠŸ")
            }
            Result.success(Unit)
        } catch (e: Exception) {
            Log.e(TAG, "åˆ é™¤é…ç½®æ–‡ä»¶å¤±è´¥", e)
            Result.failure(e)
        }
    }

    /**
     * æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
     */
    fun hasConfig(): Boolean = systemPromptsFile.exists()
}
```

---

### 4.4 SystemPromptsä¿®æ”¹

#### 4.4.1 æ”¯æŒè‡ªå®šä¹‰é…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`domain/util/SystemPrompts.kt`

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯å¸¸é‡
 *
 * ç®¡ç†ä¸å¯ä¿®æ”¹çš„ç³»ç»Ÿçº¦æŸæç¤ºè¯ï¼ŒåŒ…æ‹¬è§’è‰²å®šä¹‰å’Œè¾“å‡ºæ ¼å¼çº¦æŸ
 * 
 * ğŸ†• æ”¯æŒå¼€å‘è€…æ¨¡å¼ä¸‹çš„è‡ªå®šä¹‰é…ç½®è¦†ç›–
 */
object SystemPrompts {

    // ğŸ†• è‡ªå®šä¹‰é…ç½®æä¾›è€…ï¼ˆç”±DIæ³¨å…¥ï¼‰
    private var customConfigProvider: (() -> SystemPromptConfig?)? = null

    /**
     * ğŸ†• è®¾ç½®è‡ªå®šä¹‰é…ç½®æä¾›è€…
     * åœ¨Applicationåˆå§‹åŒ–æ—¶è°ƒç”¨
     */
    fun setCustomConfigProvider(provider: () -> SystemPromptConfig?) {
        customConfigProvider = provider
    }

    /**
     * è·å–åœºæ™¯çš„ç³»ç»Ÿå¤´éƒ¨ï¼ˆè§’è‰²å®šä¹‰ï¼‰
     * 
     * ğŸ†• ä¼˜å…ˆè¿”å›è‡ªå®šä¹‰é…ç½®ï¼Œfallbackåˆ°é»˜è®¤å€¼
     *
     * @param scene åœºæ™¯ç±»å‹
     * @return ç³»ç»Ÿå¤´éƒ¨æç¤ºè¯
     */
    fun getHeader(scene: PromptScene): String {
        // å°è¯•è·å–è‡ªå®šä¹‰é…ç½®
        val customHeader = getCustomHeader(scene)
        if (customHeader != null) {
            return customHeader
        }
        
        // è¿”å›é»˜è®¤å€¼
        return getDefaultHeader(scene)
    }

    /**
     * è·å–åœºæ™¯çš„ç³»ç»Ÿå°¾éƒ¨ï¼ˆæ ¼å¼çº¦æŸï¼‰
     * 
     * ğŸ†• ä¼˜å…ˆè¿”å›è‡ªå®šä¹‰é…ç½®ï¼Œfallbackåˆ°é»˜è®¤å€¼
     *
     * @param scene åœºæ™¯ç±»å‹
     * @return ç³»ç»Ÿå°¾éƒ¨æç¤ºè¯
     */
    fun getFooter(scene: PromptScene): String {
        // å°è¯•è·å–è‡ªå®šä¹‰é…ç½®
        val customFooter = getCustomFooter(scene)
        if (customFooter != null) {
            return customFooter
        }
        
        // è¿”å›é»˜è®¤å€¼
        return getDefaultFooter(scene)
    }

    /**
     * ğŸ†• è·å–è‡ªå®šä¹‰Header
     */
    private fun getCustomHeader(scene: PromptScene): String? {
        val systemScene = mapToSystemPromptScene(scene) ?: return null
        return customConfigProvider?.invoke()?.getHeader(systemScene)
    }

    /**
     * ğŸ†• è·å–è‡ªå®šä¹‰Footer
     */
    private fun getCustomFooter(scene: PromptScene): String? {
        val systemScene = mapToSystemPromptScene(scene) ?: return null
        return customConfigProvider?.invoke()?.getFooter(systemScene)
    }

    /**
     * ğŸ†• PromptSceneåˆ°SystemPromptSceneçš„æ˜ å°„
     */
    private fun mapToSystemPromptScene(scene: PromptScene): SystemPromptScene? {
        return when (scene) {
            PromptScene.ANALYZE -> SystemPromptScene.ANALYZE
            PromptScene.POLISH -> SystemPromptScene.POLISH
            PromptScene.REPLY -> SystemPromptScene.REPLY
            PromptScene.SUMMARY -> SystemPromptScene.SUMMARY
            PromptScene.AI_ADVISOR -> SystemPromptScene.AI_ADVISOR
            else -> null
        }
    }

    /**
     * è·å–é»˜è®¤Header
     */
    fun getDefaultHeader(scene: PromptScene): String = when (scene) {
        PromptScene.ANALYZE -> ANALYZE_HEADER
        // ... å…¶ä»–åœºæ™¯ä¿æŒä¸å˜
    }

    /**
     * è·å–é»˜è®¤Footer
     */
    fun getDefaultFooter(scene: PromptScene): String = when (scene) {
        PromptScene.ANALYZE -> ANALYZE_FOOTER
        // ... å…¶ä»–åœºæ™¯ä¿æŒä¸å˜
    }

    // ... ç°æœ‰çš„å¸¸é‡å®šä¹‰ä¿æŒä¸å˜
}
```

---

### 4.5 ViewModelè®¾è®¡

#### 4.5.1 DeveloperModeViewModel

**æ–‡ä»¶ä½ç½®**ï¼š`presentation/viewmodel/DeveloperModeViewModel.kt`

```kotlin
/**
 * å¼€å‘è€…æ¨¡å¼ViewModel
 *
 * ç®¡ç†å¼€å‘è€…æ¨¡å¼çš„è§£é”çŠ¶æ€
 * æ³¨æ„ï¼šçŠ¶æ€ä¸æŒä¹…åŒ–ï¼Œæ¯æ¬¡å¯åŠ¨Appéœ€é‡æ–°è§£é”
 */
@HiltViewModel
class DeveloperModeViewModel @Inject constructor() : ViewModel() {

    companion object {
        private const val UNLOCK_CLICK_COUNT = 7
    }

    private val _isDeveloperMode = MutableStateFlow(false)
    val isDeveloperMode: StateFlow<Boolean> = _isDeveloperMode.asStateFlow()

    private val _clickCount = MutableStateFlow(0)
    val clickCount: StateFlow<Int> = _clickCount.asStateFlow()

    private val _toastMessage = MutableSharedFlow<String>()
    val toastMessage: SharedFlow<String> = _toastMessage.asSharedFlow()

    /**
     * å¤„ç†ç‰ˆæœ¬å·ç‚¹å‡»
     */
    fun onVersionClick() {
        if (_isDeveloperMode.value) {
            // å·²è§£é”ï¼Œä¸å†å¤„ç†
            return
        }

        _clickCount.value++

        viewModelScope.launch {
            when {
                _clickCount.value >= UNLOCK_CLICK_COUNT -> {
                    _isDeveloperMode.value = true
                    _toastMessage.emit("å·²è¿›å…¥å¼€å‘è€…æ¨¡å¼")
                }
                _clickCount.value >= 3 -> {
                    val remaining = UNLOCK_CLICK_COUNT - _clickCount.value
                    _toastMessage.emit("å†ç‚¹å‡» $remaining æ¬¡è¿›å…¥å¼€å‘è€…æ¨¡å¼")
                }
            }
        }
    }

    /**
     * é€€å‡ºå¼€å‘è€…æ¨¡å¼
     */
    fun exitDeveloperMode() {
        _isDeveloperMode.value = false
        _clickCount.value = 0
    }
}
```

#### 4.5.2 SystemPromptEditViewModel

**æ–‡ä»¶ä½ç½®**ï¼š`presentation/viewmodel/SystemPromptEditViewModel.kt`

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘ViewModel
 */
@HiltViewModel
class SystemPromptEditViewModel @Inject constructor(
    private val repository: SystemPromptRepository,
    savedStateHandle: SavedStateHandle
) : ViewModel() {

    private val scene: SystemPromptScene = savedStateHandle.get<String>("scene")
        ?.let { SystemPromptScene.valueOf(it) }
        ?: SystemPromptScene.ANALYZE

    private val _uiState = MutableStateFlow(SystemPromptEditUiState())
    val uiState: StateFlow<SystemPromptEditUiState> = _uiState.asStateFlow()

    init {
        loadConfig()
    }

    private fun loadConfig() {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }

            repository.getConfig().fold(
                onSuccess = { config ->
                    val sceneConfig = config.scenes[scene]
                    _uiState.update {
                        it.copy(
                            isLoading = false,
                            scene = scene,
                            header = sceneConfig?.header ?: "",
                            footer = sceneConfig?.footer ?: "",
                            defaultHeader = getDefaultHeader(scene),
                            defaultFooter = getDefaultFooter(scene),
                            isUsingDefaultHeader = sceneConfig?.header == null,
                            isUsingDefaultFooter = sceneConfig?.footer == null
                        )
                    }
                },
                onFailure = { error ->
                    _uiState.update {
                        it.copy(
                            isLoading = false,
                            error = error.message
                        )
                    }
                }
            )
        }
    }

    fun updateHeader(header: String) {
        _uiState.update {
            it.copy(
                header = header,
                isUsingDefaultHeader = false,
                hasChanges = true
            )
        }
    }

    fun updateFooter(footer: String) {
        _uiState.update {
            it.copy(
                footer = footer,
                isUsingDefaultFooter = false,
                hasChanges = true
            )
        }
    }

    fun resetHeader() {
        _uiState.update {
            it.copy(
                header = "",
                isUsingDefaultHeader = true,
                hasChanges = true
            )
        }
    }

    fun resetFooter() {
        _uiState.update {
            it.copy(
                footer = "",
                isUsingDefaultFooter = true,
                hasChanges = true
            )
        }
    }

    fun save() {
        viewModelScope.launch {
            _uiState.update { it.copy(isSaving = true) }

            val header = if (_uiState.value.isUsingDefaultHeader) null else _uiState.value.header
            val footer = if (_uiState.value.isUsingDefaultFooter) null else _uiState.value.footer

            repository.updateScene(scene, header, footer).fold(
                onSuccess = {
                    _uiState.update {
                        it.copy(
                            isSaving = false,
                            hasChanges = false,
                            saveSuccess = true
                        )
                    }
                },
                onFailure = { error ->
                    _uiState.update {
                        it.copy(
                            isSaving = false,
                            error = error.message
                        )
                    }
                }
            )
        }
    }

    private fun getDefaultHeader(scene: SystemPromptScene): String {
        // è¿”å›å¯¹åº”åœºæ™¯çš„é»˜è®¤Header
        return when (scene) {
            SystemPromptScene.ANALYZE -> SystemPrompts.getDefaultHeader(PromptScene.ANALYZE)
            SystemPromptScene.POLISH -> SystemPrompts.getDefaultHeader(PromptScene.POLISH)
            SystemPromptScene.REPLY -> SystemPrompts.getDefaultHeader(PromptScene.REPLY)
            SystemPromptScene.SUMMARY -> SystemPrompts.getDefaultHeader(PromptScene.SUMMARY)
            SystemPromptScene.AI_ADVISOR -> SystemPrompts.AI_ADVISOR_HEADER
        }
    }

    private fun getDefaultFooter(scene: SystemPromptScene): String {
        return when (scene) {
            SystemPromptScene.ANALYZE -> SystemPrompts.getDefaultFooter(PromptScene.ANALYZE)
            SystemPromptScene.POLISH -> SystemPrompts.getDefaultFooter(PromptScene.POLISH)
            SystemPromptScene.REPLY -> SystemPrompts.getDefaultFooter(PromptScene.REPLY)
            SystemPromptScene.SUMMARY -> SystemPrompts.getDefaultFooter(PromptScene.SUMMARY)
            SystemPromptScene.AI_ADVISOR -> SystemPrompts.AI_ADVISOR_FOOTER
        }
    }
}

/**
 * ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘UIçŠ¶æ€
 */
data class SystemPromptEditUiState(
    val isLoading: Boolean = false,
    val isSaving: Boolean = false,
    val scene: SystemPromptScene = SystemPromptScene.ANALYZE,
    val header: String = "",
    val footer: String = "",
    val defaultHeader: String = "",
    val defaultFooter: String = "",
    val isUsingDefaultHeader: Boolean = true,
    val isUsingDefaultFooter: Boolean = true,
    val hasChanges: Boolean = false,
    val saveSuccess: Boolean = false,
    val error: String? = null
)
```


---

### 4.6 UIç•Œé¢è®¾è®¡

#### 4.6.1 DeveloperOptionsSectionç»„ä»¶

**æ–‡ä»¶ä½ç½®**ï¼š`presentation/ui/screen/settings/component/DeveloperOptionsSection.kt`

```kotlin
/**
 * å¼€å‘è€…é€‰é¡¹åŒºåŸŸç»„ä»¶
 *
 * @param onSystemPromptEditClick ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘ç‚¹å‡»å›è°ƒ
 * @param modifier Modifier
 */
@Composable
fun DeveloperOptionsSection(
    onSystemPromptEditClick: () -> Unit,
    modifier: Modifier = Modifier
) {
    Column(modifier = modifier) {
        // åŒºåŸŸæ ‡é¢˜
        Text(
            text = "å¼€å‘è€…é€‰é¡¹",
            style = MaterialTheme.typography.titleMedium,
            fontWeight = FontWeight.SemiBold,
            color = MaterialTheme.colorScheme.primary,
            modifier = Modifier.padding(horizontal = 16.dp, vertical = 8.dp)
        )

        // ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘å…¥å£
        ListItem(
            headlineContent = {
                Text(text = "ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘")
            },
            supportingContent = {
                Text(
                    text = "ç¼–è¾‘AIåœºæ™¯çš„ç³»ç»Ÿæç¤ºè¯ï¼ˆHeader/Footerï¼‰",
                    color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)
                )
            },
            leadingContent = {
                Icon(
                    imageVector = Icons.Default.Code,
                    contentDescription = null,
                    tint = MaterialTheme.colorScheme.primary
                )
            },
            trailingContent = {
                Icon(
                    imageVector = Icons.AutoMirrored.Filled.KeyboardArrowRight,
                    contentDescription = null,
                    tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.4f)
                )
            },
            modifier = Modifier.clickable(onClick = onSystemPromptEditClick)
        )
    }
}
```

#### 4.6.2 SystemPromptListScreen

**æ–‡ä»¶ä½ç½®**ï¼š`presentation/ui/screen/developer/SystemPromptListScreen.kt`

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯åœºæ™¯åˆ—è¡¨é¡µ
 */
@Composable
fun SystemPromptListScreen(
    onNavigateBack: () -> Unit,
    onNavigateToEdit: (SystemPromptScene) -> Unit,
    viewModel: SystemPromptListViewModel = hiltViewModel()
) {
    val uiState by viewModel.uiState.collectAsStateWithLifecycle()

    Scaffold(
        topBar = {
            TopAppBar(
                title = { Text("ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘") },
                navigationIcon = {
                    IconButton(onClick = onNavigateBack) {
                        Icon(Icons.AutoMirrored.Filled.ArrowBack, "è¿”å›")
                    }
                },
                actions = {
                    // å¯¼å‡ºæŒ‰é’®
                    IconButton(onClick = { viewModel.showExportDialog() }) {
                        Icon(Icons.Default.Upload, "å¯¼å‡º")
                    }
                    // å¯¼å…¥æŒ‰é’®
                    IconButton(onClick = { viewModel.showImportDialog() }) {
                        Icon(Icons.Default.Download, "å¯¼å…¥")
                    }
                    // é‡ç½®å…¨éƒ¨æŒ‰é’®
                    IconButton(onClick = { viewModel.showResetAllDialog() }) {
                        Icon(Icons.Default.Refresh, "é‡ç½®å…¨éƒ¨")
                    }
                }
            )
        }
    ) { paddingValues ->
        LazyColumn(
            modifier = Modifier
                .fillMaxSize()
                .padding(paddingValues)
        ) {
            item {
                Text(
                    text = "é€‰æ‹©è¦ç¼–è¾‘çš„AIåœºæ™¯ï¼š",
                    style = MaterialTheme.typography.bodyMedium,
                    color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f),
                    modifier = Modifier.padding(16.dp)
                )
            }

            items(SystemPromptScene.getAllScenes()) { scene ->
                SceneListItem(
                    scene = scene,
                    isCustomized = uiState.customizedScenes.contains(scene),
                    onClick = { onNavigateToEdit(scene) }
                )
            }

            item {
                Spacer(modifier = Modifier.height(16.dp))
            }
        }
    }

    // å¯¼å‡ºå¯¹è¯æ¡†
    if (uiState.showExportDialog) {
        ExportDialog(
            onDismiss = { viewModel.hideExportDialog() },
            onExportJson = { viewModel.exportToJson() },
            onExportMarkdown = { viewModel.exportToMarkdown() }
        )
    }

    // å¯¼å…¥å¯¹è¯æ¡†
    if (uiState.showImportDialog) {
        ImportDialog(
            onDismiss = { viewModel.hideImportDialog() },
            onImport = { content -> viewModel.importFromJson(content) }
        )
    }

    // é‡ç½®ç¡®è®¤å¯¹è¯æ¡†
    if (uiState.showResetAllDialog) {
        AlertDialog(
            onDismissRequest = { viewModel.hideResetAllDialog() },
            title = { Text("é‡ç½®å…¨éƒ¨é…ç½®") },
            text = { Text("ç¡®å®šè¦å°†æ‰€æœ‰åœºæ™¯æ¢å¤ä¸ºé»˜è®¤é…ç½®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚") },
            confirmButton = {
                TextButton(onClick = { viewModel.resetAll() }) {
                    Text("ç¡®å®š", color = MaterialTheme.colorScheme.error)
                }
            },
            dismissButton = {
                TextButton(onClick = { viewModel.hideResetAllDialog() }) {
                    Text("å–æ¶ˆ")
                }
            }
        )
    }
}

/**
 * åœºæ™¯åˆ—è¡¨é¡¹
 */
@Composable
private fun SceneListItem(
    scene: SystemPromptScene,
    isCustomized: Boolean,
    onClick: () -> Unit
) {
    ListItem(
        headlineContent = {
            Row(verticalAlignment = Alignment.CenterVertically) {
                Text(text = "${scene.icon} ${scene.displayName}")
                if (isCustomized) {
                    Spacer(modifier = Modifier.width(8.dp))
                    Text(
                        text = "å·²è‡ªå®šä¹‰",
                        style = MaterialTheme.typography.labelSmall,
                        color = MaterialTheme.colorScheme.primary
                    )
                }
            }
        },
        supportingContent = {
            Text(
                text = scene.description,
                color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)
            )
        },
        trailingContent = {
            Icon(
                imageVector = Icons.AutoMirrored.Filled.KeyboardArrowRight,
                contentDescription = null,
                tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.4f)
            )
        },
        modifier = Modifier.clickable(onClick = onClick)
    )
}
```

#### 4.6.3 SystemPromptEditScreen

**æ–‡ä»¶ä½ç½®**ï¼š`presentation/ui/screen/developer/SystemPromptEditScreen.kt`

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘é¡µ
 */
@Composable
fun SystemPromptEditScreen(
    onNavigateBack: () -> Unit,
    viewModel: SystemPromptEditViewModel = hiltViewModel()
) {
    val uiState by viewModel.uiState.collectAsStateWithLifecycle()
    val context = LocalContext.current

    // ä¿å­˜æˆåŠŸæç¤º
    LaunchedEffect(uiState.saveSuccess) {
        if (uiState.saveSuccess) {
            Toast.makeText(context, "ä¿å­˜æˆåŠŸï¼Œå·²ç«‹å³ç”Ÿæ•ˆ", Toast.LENGTH_SHORT).show()
        }
    }

    Scaffold(
        topBar = {
            TopAppBar(
                title = { Text("${uiState.scene.icon} ${uiState.scene.displayName}") },
                navigationIcon = {
                    IconButton(onClick = onNavigateBack) {
                        Icon(Icons.AutoMirrored.Filled.ArrowBack, "è¿”å›")
                    }
                },
                actions = {
                    TextButton(
                        onClick = { viewModel.save() },
                        enabled = uiState.hasChanges && !uiState.isSaving
                    ) {
                        if (uiState.isSaving) {
                            CircularProgressIndicator(
                                modifier = Modifier.size(16.dp),
                                strokeWidth = 2.dp
                            )
                        } else {
                            Text("ä¿å­˜")
                        }
                    }
                }
            )
        }
    ) { paddingValues ->
        if (uiState.isLoading) {
            Box(
                modifier = Modifier
                    .fillMaxSize()
                    .padding(paddingValues),
                contentAlignment = Alignment.Center
            ) {
                CircularProgressIndicator()
            }
        } else {
            LazyColumn(
                modifier = Modifier
                    .fillMaxSize()
                    .padding(paddingValues)
            ) {
                // Headerç¼–è¾‘åŒº
                item {
                    PromptEditSection(
                        title = "Header (è§’è‰²å®šä¹‰)",
                        content = if (uiState.isUsingDefaultHeader) 
                            uiState.defaultHeader else uiState.header,
                        isUsingDefault = uiState.isUsingDefaultHeader,
                        defaultContent = uiState.defaultHeader,
                        onContentChange = { viewModel.updateHeader(it) },
                        onResetToDefault = { viewModel.resetHeader() }
                    )
                }

                // Footerç¼–è¾‘åŒº
                item {
                    PromptEditSection(
                        title = "Footer (è¾“å‡ºæ ¼å¼)",
                        content = if (uiState.isUsingDefaultFooter) 
                            uiState.defaultFooter else uiState.footer,
                        isUsingDefault = uiState.isUsingDefaultFooter,
                        defaultContent = uiState.defaultFooter,
                        onContentChange = { viewModel.updateFooter(it) },
                        onResetToDefault = { viewModel.resetFooter() }
                    )
                }

                item {
                    Spacer(modifier = Modifier.height(32.dp))
                }
            }
        }
    }
}

/**
 * æç¤ºè¯ç¼–è¾‘åŒºåŸŸ
 */
@Composable
private fun PromptEditSection(
    title: String,
    content: String,
    isUsingDefault: Boolean,
    defaultContent: String,
    onContentChange: (String) -> Unit,
    onResetToDefault: () -> Unit
) {
    Column(
        modifier = Modifier
            .fillMaxWidth()
            .padding(16.dp)
    ) {
        Row(
            modifier = Modifier.fillMaxWidth(),
            horizontalArrangement = Arrangement.SpaceBetween,
            verticalAlignment = Alignment.CenterVertically
        ) {
            Text(
                text = title,
                style = MaterialTheme.typography.titleSmall,
                fontWeight = FontWeight.SemiBold
            )
            if (!isUsingDefault) {
                TextButton(onClick = onResetToDefault) {
                    Text("æ¢å¤é»˜è®¤", style = MaterialTheme.typography.labelSmall)
                }
            }
        }

        Spacer(modifier = Modifier.height(8.dp))

        if (isUsingDefault) {
            // æ˜¾ç¤ºé»˜è®¤å€¼ï¼ˆåªè¯»ï¼‰
            Surface(
                modifier = Modifier.fillMaxWidth(),
                color = MaterialTheme.colorScheme.surfaceVariant,
                shape = RoundedCornerShape(8.dp)
            ) {
                Column(modifier = Modifier.padding(12.dp)) {
                    Text(
                        text = "(ä½¿ç”¨é»˜è®¤å€¼)",
                        style = MaterialTheme.typography.labelSmall,
                        color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.5f)
                    )
                    Spacer(modifier = Modifier.height(4.dp))
                    Text(
                        text = defaultContent,
                        style = MaterialTheme.typography.bodySmall,
                        color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)
                    )
                }
            }
            Spacer(modifier = Modifier.height(8.dp))
            OutlinedButton(
                onClick = { onContentChange(defaultContent) },
                modifier = Modifier.fillMaxWidth()
            ) {
                Text("ç‚¹å‡»ç¼–è¾‘è‡ªå®šä¹‰å†…å®¹")
            }
        } else {
            // ç¼–è¾‘åŒº
            OutlinedTextField(
                value = content,
                onValueChange = onContentChange,
                modifier = Modifier
                    .fillMaxWidth()
                    .heightIn(min = 200.dp),
                textStyle = MaterialTheme.typography.bodySmall.copy(
                    fontFamily = FontFamily.Monospace
                ),
                placeholder = { Text("è¾“å…¥è‡ªå®šä¹‰å†…å®¹...") }
            )
            Spacer(modifier = Modifier.height(4.dp))
            Text(
                text = "å­—ç¬¦æ•°: ${content.length}",
                style = MaterialTheme.typography.labelSmall,
                color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.5f)
            )
        }
    }
}
```


---

## 5. å¯¼èˆªé…ç½®

### 5.1 è·¯ç”±å®šä¹‰

**æ–‡ä»¶ä½ç½®**ï¼š`presentation/navigation/NavRoutes.kt`

```kotlin
/**
 * å¯¼èˆªè·¯ç”±å®šä¹‰
 */
object NavRoutes {
    // ... ç°æœ‰è·¯ç”± ...

    // ğŸ†• å¼€å‘è€…æ¨¡å¼è·¯ç”±
    const val SYSTEM_PROMPT_LIST = "developer/system_prompt_list"
    const val SYSTEM_PROMPT_EDIT = "developer/system_prompt_edit/{scene}"

    fun systemPromptEdit(scene: SystemPromptScene): String {
        return "developer/system_prompt_edit/${scene.name}"
    }
}
```

### 5.2 NavGraphé…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`presentation/navigation/NavGraph.kt`

```kotlin
@Composable
fun NavGraph(
    navController: NavHostController,
    // ... å…¶ä»–å‚æ•°
) {
    NavHost(
        navController = navController,
        startDestination = NavRoutes.HOME
    ) {
        // ... ç°æœ‰è·¯ç”± ...

        // ğŸ†• ç³»ç»Ÿæç¤ºè¯åˆ—è¡¨é¡µ
        composable(NavRoutes.SYSTEM_PROMPT_LIST) {
            SystemPromptListScreen(
                onNavigateBack = { navController.popBackStack() },
                onNavigateToEdit = { scene ->
                    navController.navigate(NavRoutes.systemPromptEdit(scene))
                }
            )
        }

        // ğŸ†• ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘é¡µ
        composable(
            route = NavRoutes.SYSTEM_PROMPT_EDIT,
            arguments = listOf(
                navArgument("scene") { type = NavType.StringType }
            )
        ) {
            SystemPromptEditScreen(
                onNavigateBack = { navController.popBackStack() }
            )
        }
    }
}
```


---

## 6. DIé…ç½®

### 6.1 PromptModuleæ›´æ–°

**æ–‡ä»¶ä½ç½®**ï¼š`data/di/PromptModule.kt`

```kotlin
@Module
@InstallIn(SingletonComponent::class)
object PromptModule {

    // ... ç°æœ‰é…ç½® ...

    // ğŸ†• ç³»ç»Ÿæç¤ºè¯å­˜å‚¨
    @Provides
    @Singleton
    fun provideSystemPromptStorage(
        @ApplicationContext context: Context,
        moshi: Moshi
    ): SystemPromptStorage {
        return SystemPromptStorage(context, moshi)
    }

    // ğŸ†• ç³»ç»Ÿæç¤ºè¯ä»“åº“
    @Provides
    @Singleton
    fun provideSystemPromptRepository(
        storage: SystemPromptStorage,
        moshi: Moshi
    ): SystemPromptRepository {
        return SystemPromptRepositoryImpl(storage, moshi)
    }
}
```

### 6.2 Moshié€‚é…å™¨é…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`data/di/NetworkModule.kt`

```kotlin
@Module
@InstallIn(SingletonComponent::class)
object NetworkModule {

    @Provides
    @Singleton
    fun provideMoshi(): Moshi {
        return Moshi.Builder()
            .add(KotlinJsonAdapterFactory())
            // ğŸ†• æ·»åŠ SystemPromptSceneé€‚é…å™¨
            .add(SystemPromptSceneAdapter())
            .build()
    }
}

/**
 * SystemPromptSceneæšä¸¾çš„Moshié€‚é…å™¨
 */
class SystemPromptSceneAdapter {
    @ToJson
    fun toJson(scene: SystemPromptScene): String = scene.name

    @FromJson
    fun fromJson(name: String): SystemPromptScene = SystemPromptScene.valueOf(name)
}
```


### 6.3 Applicationåˆå§‹åŒ–

**æ–‡ä»¶ä½ç½®**ï¼š`app/EmpathyApplication.kt`

```kotlin
@HiltAndroidApp
class EmpathyApplication : Application() {

    @Inject
    lateinit var systemPromptRepository: SystemPromptRepository

    override fun onCreate() {
        super.onCreate()

        // ğŸ†• åˆå§‹åŒ–SystemPromptsçš„è‡ªå®šä¹‰é…ç½®æä¾›è€…
        initSystemPromptsProvider()
    }

    private fun initSystemPromptsProvider() {
        // è®¾ç½®è‡ªå®šä¹‰é…ç½®æä¾›è€…
        SystemPrompts.setCustomConfigProvider {
            // åŒæ­¥è·å–é…ç½®ï¼ˆä½¿ç”¨runBlockingï¼Œä»…åœ¨åˆå§‹åŒ–æ—¶è°ƒç”¨ï¼‰
            runBlocking {
                systemPromptRepository.getConfig().getOrNull()
            }
        }
    }
}
```

---

## 7. é”™è¯¯å¤„ç†æœºåˆ¶

### 7.1 é”™è¯¯ç±»å‹å®šä¹‰

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯ç›¸å…³é”™è¯¯
 */
sealed class SystemPromptError : Exception() {
    
    /** é…ç½®æ–‡ä»¶è¯»å–å¤±è´¥ */
    data class ReadError(override val message: String) : SystemPromptError()
    
    /** é…ç½®æ–‡ä»¶å†™å…¥å¤±è´¥ */
    data class WriteError(override val message: String) : SystemPromptError()
    
    /** JSONè§£æå¤±è´¥ */
    data class ParseError(override val message: String) : SystemPromptError()
    
    /** å¯¼å…¥æ ¼å¼é”™è¯¯ */
    data class ImportError(override val message: String) : SystemPromptError()
    
    /** æœªçŸ¥åœºæ™¯ */
    data class UnknownScene(val sceneName: String) : SystemPromptError() {
        override val message: String = "æœªçŸ¥åœºæ™¯: $sceneName"
    }
}
```


### 7.2 é”™è¯¯å¤„ç†ç­–ç•¥

| é”™è¯¯åœºæ™¯ | å¤„ç†ç­–ç•¥ | ç”¨æˆ·æç¤º |
|---------|---------|---------|
| é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ | è¿”å›ç©ºé…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼ | æ— ï¼ˆé™é»˜å¤„ç†ï¼‰ |
| é…ç½®æ–‡ä»¶æŸå | åˆ é™¤æŸåæ–‡ä»¶ï¼Œä½¿ç”¨é»˜è®¤å€¼ | Toast: "é…ç½®æ–‡ä»¶å·²æŸåï¼Œå·²æ¢å¤é»˜è®¤" |
| JSONè§£æå¤±è´¥ | è¿”å›ç©ºé…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼ | Toast: "é…ç½®è§£æå¤±è´¥ï¼Œå·²ä½¿ç”¨é»˜è®¤å€¼" |
| å†™å…¥å¤±è´¥ | é‡è¯•ä¸€æ¬¡ï¼Œå¤±è´¥åˆ™æŠ¥é”™ | Toast: "ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•" |
| å¯¼å…¥æ ¼å¼é”™è¯¯ | æ‹’ç»å¯¼å…¥ï¼Œæç¤ºæ ¼å¼è¦æ±‚ | Dialog: "å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®" |
| æœªçŸ¥åœºæ™¯ | å¿½ç•¥è¯¥åœºæ™¯ï¼Œç»§ç»­å¤„ç†å…¶ä»– | æ— ï¼ˆé™é»˜å¿½ç•¥ï¼‰ |

### 7.3 Fallbackæœºåˆ¶

```kotlin
/**
 * SystemPromptsä¸­çš„Fallbacké€»è¾‘
 */
object SystemPrompts {
    
    fun getHeader(scene: PromptScene): String {
        return try {
            // 1. å°è¯•è·å–è‡ªå®šä¹‰é…ç½®
            getCustomHeader(scene) 
                // 2. Fallbackåˆ°é»˜è®¤å€¼
                ?: getDefaultHeader(scene)
        } catch (e: Exception) {
            // 3. å¼‚å¸¸æ—¶ä½¿ç”¨é»˜è®¤å€¼
            Log.e(TAG, "è·å–Headerå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼", e)
            getDefaultHeader(scene)
        }
    }
}
```

---

## 8. æµ‹è¯•ç­–ç•¥

### 8.1 å•å…ƒæµ‹è¯•

#### 8.1.1 æ•°æ®æ¨¡å‹æµ‹è¯•

**æ–‡ä»¶ä½ç½®**ï¼š`domain/src/test/kotlin/.../model/SystemPromptConfigTest.kt`

```kotlin
class SystemPromptConfigTest {

    @Test
    fun `åˆ›å»ºç©ºé…ç½®åº”è¿”å›é»˜è®¤å€¼`() {
        val config = SystemPromptConfig.createEmpty()
        
        assertThat(config.version).isEqualTo(SystemPromptConfig.CURRENT_VERSION)
        assertThat(config.scenes).isEmpty()
    }

    @Test
    fun `æ›´æ–°åœºæ™¯åº”æ­£ç¡®ä¿å­˜é…ç½®`() {
        val config = SystemPromptConfig.createEmpty()
        val updated = config.updateScene(
            scene = SystemPromptScene.ANALYZE,
            header = "è‡ªå®šä¹‰Header",
            footer = "è‡ªå®šä¹‰Footer"
        )
        
        assertThat(updated.getHeader(SystemPromptScene.ANALYZE))
            .isEqualTo("è‡ªå®šä¹‰Header")
        assertThat(updated.getFooter(SystemPromptScene.ANALYZE))
            .isEqualTo("è‡ªå®šä¹‰Footer")
    }

    @Test
    fun `é‡ç½®åœºæ™¯åº”ç§»é™¤è‡ªå®šä¹‰é…ç½®`() {
        val config = SystemPromptConfig.createEmpty()
            .updateScene(SystemPromptScene.ANALYZE, "Header", "Footer")
            .resetScene(SystemPromptScene.ANALYZE)
        
        assertThat(config.getHeader(SystemPromptScene.ANALYZE)).isNull()
    }
}
```


#### 8.1.2 Repositoryæµ‹è¯•

**æ–‡ä»¶ä½ç½®**ï¼š`data/src/test/kotlin/.../repository/SystemPromptRepositoryImplTest.kt`

```kotlin
@OptIn(ExperimentalCoroutinesApi::class)
class SystemPromptRepositoryImplTest {

    private lateinit var storage: SystemPromptStorage
    private lateinit var moshi: Moshi
    private lateinit var repository: SystemPromptRepositoryImpl

    @Before
    fun setup() {
        storage = mockk()
        moshi = Moshi.Builder().add(KotlinJsonAdapterFactory()).build()
        repository = SystemPromptRepositoryImpl(storage, moshi)
    }

    @Test
    fun `getConfigåº”è¿”å›å­˜å‚¨çš„é…ç½®`() = runTest {
        val config = SystemPromptConfig.createEmpty()
        coEvery { storage.readConfig() } returns Result.success(config)
        
        val result = repository.getConfig()
        
        assertThat(result.isSuccess).isTrue()
        assertThat(result.getOrNull()).isEqualTo(config)
    }

    @Test
    fun `updateSceneåº”æ­£ç¡®æ›´æ–°å¹¶ä¿å­˜`() = runTest {
        val config = SystemPromptConfig.createEmpty()
        coEvery { storage.readConfig() } returns Result.success(config)
        coEvery { storage.writeConfig(any()) } returns Result.success(Unit)
        
        val result = repository.updateScene(
            SystemPromptScene.ANALYZE,
            "æ–°Header",
            "æ–°Footer"
        )
        
        assertThat(result.isSuccess).isTrue()
        coVerify { storage.writeConfig(any()) }
    }

    @Test
    fun `exportToJsonåº”ç”Ÿæˆæœ‰æ•ˆJSON`() = runTest {
        val config = SystemPromptConfig.createEmpty()
            .updateScene(SystemPromptScene.ANALYZE, "Header", "Footer")
        coEvery { storage.readConfig() } returns Result.success(config)
        
        val result = repository.exportToJson()
        
        assertThat(result.isSuccess).isTrue()
        assertThat(result.getOrNull()).contains("ANALYZE")
    }
}
```

#### 8.1.3 ViewModelæµ‹è¯•

**æ–‡ä»¶ä½ç½®**ï¼š`presentation/src/test/kotlin/.../viewmodel/DeveloperModeViewModelTest.kt`

```kotlin
@OptIn(ExperimentalCoroutinesApi::class)
class DeveloperModeViewModelTest {

    @get:Rule
    val mainDispatcherRule = MainDispatcherRule()

    private lateinit var viewModel: DeveloperModeViewModel

    @Before
    fun setup() {
        viewModel = DeveloperModeViewModel()
    }

    @Test
    fun `ç‚¹å‡»ç‰ˆæœ¬å·7æ¬¡åº”è§£é”å¼€å‘è€…æ¨¡å¼`() = runTest {
        repeat(7) { viewModel.onVersionClick() }
        
        assertThat(viewModel.isDeveloperMode.value).isTrue()
    }

    @Test
    fun `ç‚¹å‡»ç‰ˆæœ¬å·6æ¬¡ä¸åº”è§£é”`() = runTest {
        repeat(6) { viewModel.onVersionClick() }
        
        assertThat(viewModel.isDeveloperMode.value).isFalse()
    }

    @Test
    fun `å·²è§£é”åå†æ¬¡ç‚¹å‡»ä¸åº”æœ‰æ•ˆæœ`() = runTest {
        repeat(7) { viewModel.onVersionClick() }
        viewModel.onVersionClick() // ç¬¬8æ¬¡
        
        assertThat(viewModel.clickCount.value).isEqualTo(7)
    }

    @Test
    fun `exitDeveloperModeåº”é‡ç½®çŠ¶æ€`() = runTest {
        repeat(7) { viewModel.onVersionClick() }
        viewModel.exitDeveloperMode()
        
        assertThat(viewModel.isDeveloperMode.value).isFalse()
        assertThat(viewModel.clickCount.value).isEqualTo(0)
    }
}
```


### 8.2 é›†æˆæµ‹è¯•

#### 8.2.1 ç«¯åˆ°ç«¯æµ‹è¯•

**æ–‡ä»¶ä½ç½®**ï¼š`app/src/androidTest/kotlin/.../SystemPromptIntegrationTest.kt`

```kotlin
@HiltAndroidTest
@RunWith(AndroidJUnit4::class)
class SystemPromptIntegrationTest {

    @get:Rule
    val hiltRule = HiltAndroidRule(this)

    @get:Rule
    val composeTestRule = createAndroidComposeRule<MainActivity>()

    @Inject
    lateinit var repository: SystemPromptRepository

    @Before
    fun setup() {
        hiltRule.inject()
    }

    @Test
    fun ç‚¹å‡»ç‰ˆæœ¬å·7æ¬¡åº”æ˜¾ç¤ºå¼€å‘è€…é€‰é¡¹() {
        // å¯¼èˆªåˆ°è®¾ç½®é¡µé¢
        composeTestRule.onNodeWithText("è®¾ç½®").performClick()
        
        // ç‚¹å‡»ç‰ˆæœ¬å·7æ¬¡
        repeat(7) {
            composeTestRule.onNodeWithText("v1.0.0").performClick()
        }
        
        // éªŒè¯å¼€å‘è€…é€‰é¡¹æ˜¾ç¤º
        composeTestRule.onNodeWithText("å¼€å‘è€…é€‰é¡¹").assertIsDisplayed()
    }

    @Test
    fun ç¼–è¾‘ç³»ç»Ÿæç¤ºè¯åº”ç«‹å³ç”Ÿæ•ˆ() = runTest {
        // è§£é”å¼€å‘è€…æ¨¡å¼
        // ... çœç•¥è§£é”æ­¥éª¤
        
        // è¿›å…¥ç¼–è¾‘é¡µé¢
        composeTestRule.onNodeWithText("ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘").performClick()
        composeTestRule.onNodeWithText("èŠå¤©åˆ†æ").performClick()
        
        // ç¼–è¾‘Header
        composeTestRule.onNodeWithText("ç‚¹å‡»ç¼–è¾‘è‡ªå®šä¹‰å†…å®¹")
            .performClick()
        composeTestRule.onNodeWithTag("header_input")
            .performTextInput("è‡ªå®šä¹‰Header")
        
        // ä¿å­˜
        composeTestRule.onNodeWithText("ä¿å­˜").performClick()
        
        // éªŒè¯é…ç½®å·²ä¿å­˜
        val config = repository.getConfig().getOrNull()
        assertThat(config?.getHeader(SystemPromptScene.ANALYZE))
            .isEqualTo("è‡ªå®šä¹‰Header")
    }
}
```

### 8.3 æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

| æ¨¡å— | ç›®æ ‡è¦†ç›–ç‡ | é‡ç‚¹æµ‹è¯•å†…å®¹ |
|-----|-----------|-------------|
| domain/model | 90% | æ•°æ®æ¨¡å‹çš„åˆ›å»ºã€æ›´æ–°ã€é‡ç½® |
| data/repository | 85% | é…ç½®è¯»å†™ã€å¯¼å…¥å¯¼å‡º |
| data/local | 80% | æ–‡ä»¶å­˜å‚¨ã€é”™è¯¯å¤„ç† |
| presentation/viewmodel | 85% | çŠ¶æ€ç®¡ç†ã€äº‹ä»¶å¤„ç† |
| é›†æˆæµ‹è¯• | - | ç«¯åˆ°ç«¯æµç¨‹éªŒè¯ |


---

## 9. å®æ–½è®¡åˆ’

### 9.1 ä»»åŠ¡åˆ†è§£

| ä»»åŠ¡ID | ä»»åŠ¡æè¿° | æ¨¡å— | é¢„ä¼°å·¥æ—¶ | ä¾èµ– | ä¼˜å…ˆçº§ |
|--------|---------|------|---------|------|--------|
| **é˜¶æ®µ1: æ•°æ®å±‚** |
| T-001 | åˆ›å»ºSystemPromptSceneæšä¸¾ | :domain | 0.5h | - | P0 |
| T-002 | åˆ›å»ºSystemPromptConfigæ•°æ®æ¨¡å‹ | :domain | 1h | T-001 | P0 |
| T-003 | åˆ›å»ºSystemPromptRepositoryæ¥å£ | :domain | 0.5h | T-002 | P0 |
| T-004 | å®ç°SystemPromptStorageå­˜å‚¨ç±» | :data | 1.5h | T-002 | P0 |
| T-005 | å®ç°SystemPromptRepositoryImpl | :data | 1.5h | T-003, T-004 | P0 |
| T-006 | æ›´æ–°PromptModuleæ·»åŠ DIé…ç½® | :data | 0.5h | T-005 | P0 |
| **é˜¶æ®µ2: æ ¸å¿ƒé›†æˆ** |
| T-007 | ä¿®æ”¹SystemPromptsæ”¯æŒè‡ªå®šä¹‰é…ç½® | :domain | 1h | T-005 | P0 |
| T-008 | æ›´æ–°Applicationåˆå§‹åŒ–é…ç½®æä¾›è€… | :app | 0.5h | T-007 | P0 |
| **é˜¶æ®µ3: å¼€å‘è€…æ¨¡å¼å…¥å£** |
| T-009 | å®ç°DeveloperModeViewModel | :presentation | 1h | - | P0 |
| T-010 | ä¿®æ”¹SettingsScreenæ·»åŠ ç‰ˆæœ¬å·ç‚¹å‡»é€»è¾‘ | :presentation | 1h | T-009 | P0 |
| T-011 | å®ç°DeveloperOptionsSectionç»„ä»¶ | :presentation | 0.5h | T-009 | P0 |
| **é˜¶æ®µ4: ç¼–è¾‘ç•Œé¢** |
| T-012 | å®ç°SystemPromptListViewModel | :presentation | 1h | T-005 | P0 |
| T-013 | å®ç°SystemPromptListScreen | :presentation | 1.5h | T-012 | P0 |
| T-014 | å®ç°SystemPromptEditViewModel | :presentation | 1.5h | T-005 | P0 |
| T-015 | å®ç°SystemPromptEditScreen | :presentation | 2h | T-014 | P0 |
| T-016 | æ·»åŠ å¯¼èˆªè·¯ç”±é…ç½® | :presentation | 0.5h | T-013, T-015 | P0 |
| **é˜¶æ®µ5: å¯¼å…¥å¯¼å‡º** |
| T-017 | å®ç°JSONå¯¼å‡ºåŠŸèƒ½ | :data | 1h | T-005 | P1 |
| T-018 | å®ç°Markdownå¯¼å‡ºåŠŸèƒ½ | :data | 0.5h | T-005 | P1 |
| T-019 | å®ç°JSONå¯¼å…¥åŠŸèƒ½ | :data | 1h | T-005 | P1 |
| T-020 | å®ç°å¯¼å‡º/å¯¼å…¥UIå¯¹è¯æ¡† | :presentation | 1h | T-017, T-019 | P1 |
| **é˜¶æ®µ6: æµ‹è¯•** |
| T-021 | æ•°æ®æ¨¡å‹å•å…ƒæµ‹è¯• | :domain | 1h | T-002 | P1 |
| T-022 | Repositoryå•å…ƒæµ‹è¯• | :data | 1.5h | T-005 | P1 |
| T-023 | ViewModelå•å…ƒæµ‹è¯• | :presentation | 1.5h | T-014 | P1 |
| T-024 | é›†æˆæµ‹è¯• | :app | 1h | å…¨éƒ¨ | P1 |

**æ€»é¢„ä¼°å·¥æ—¶**: çº¦22å°æ—¶


### 9.2 é‡Œç¨‹ç¢‘è®¡åˆ’

| é‡Œç¨‹ç¢‘ | åŒ…å«ä»»åŠ¡ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|--------|---------|--------|---------|
| **M1: æ•°æ®å±‚å®Œæˆ** | T-001 ~ T-006 | æ•°æ®æ¨¡å‹ã€å­˜å‚¨ã€ä»“åº“ | å•å…ƒæµ‹è¯•é€šè¿‡ |
| **M2: æ ¸å¿ƒé›†æˆå®Œæˆ** | T-007 ~ T-008 | SystemPromptsæ”¯æŒè‡ªå®šä¹‰ | é…ç½®å¯è¦†ç›–é»˜è®¤å€¼ |
| **M3: å…¥å£å¯ç”¨** | T-009 ~ T-011 | å¼€å‘è€…æ¨¡å¼è§£é”åŠŸèƒ½ | ç‚¹å‡»7æ¬¡å¯è§£é” |
| **M4: ç¼–è¾‘åŠŸèƒ½å®Œæˆ** | T-012 ~ T-016 | å®Œæ•´ç¼–è¾‘ç•Œé¢ | å¯ç¼–è¾‘å¹¶ä¿å­˜é…ç½® |
| **M5: å¯¼å…¥å¯¼å‡ºå®Œæˆ** | T-017 ~ T-020 | å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ | å¯å¯¼å‡º/å¯¼å…¥é…ç½® |
| **M6: æµ‹è¯•å®Œæˆ** | T-021 ~ T-024 | å®Œæ•´æµ‹è¯•å¥—ä»¶ | è¦†ç›–ç‡è¾¾æ ‡ |

### 9.3 ä¾èµ–å…³ç³»å›¾

```
T-001 â”€â”€â–º T-002 â”€â”€â–º T-003 â”€â”€â–º T-005 â”€â”€â–º T-007 â”€â”€â–º T-008
              â”‚                   â”‚
              â””â”€â”€â–º T-004 â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”œâ”€â”€â–º T-012 â”€â”€â–º T-013 â”€â”€â”
                                  â”‚                      â”‚
                                  â””â”€â”€â–º T-014 â”€â”€â–º T-015 â”€â”€â”¼â”€â”€â–º T-016
                                                         â”‚
T-009 â”€â”€â–º T-010 â”€â”€â–º T-011 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     
T-005 â”€â”€â–º T-017 â”€â”€â”
     â”‚            â”œâ”€â”€â–º T-020
     â””â”€â”€â–º T-019 â”€â”€â”˜
```

### 9.4 é£é™©ä¸ç¼“è§£

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|------|---------|
| Moshiåºåˆ—åŒ–Map<Enum, Object>é—®é¢˜ | ä¸­ | é«˜ | ä½¿ç”¨è‡ªå®šä¹‰é€‚é…å™¨ï¼Œæå‰éªŒè¯ |
| SystemPromptsé™æ€æ–¹æ³•éš¾ä»¥æ³¨å…¥ | ä½ | ä¸­ | ä½¿ç”¨Provideræ¨¡å¼ï¼ŒApplicationåˆå§‹åŒ– |
| é…ç½®æ–‡ä»¶æŸåå¯¼è‡´AIåŠŸèƒ½å¼‚å¸¸ | ä½ | é«˜ | å®ç°å®Œå–„çš„Fallbackæœºåˆ¶ |
| å¯¼å…¥æ ¼å¼å…¼å®¹æ€§é—®é¢˜ | ä¸­ | ä½ | ä¸¥æ ¼æ ¡éªŒï¼Œå‹å¥½é”™è¯¯æç¤º |

---

## 10. é™„å½•

### 10.1 æ–‡ä»¶æ¸…å•æ±‡æ€»

#### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `domain/model/SystemPromptScene.kt` | åœºæ™¯æšä¸¾ |
| `domain/model/SystemPromptConfig.kt` | é…ç½®æ•°æ®æ¨¡å‹ |
| `domain/model/SystemPromptExport.kt` | å¯¼å‡ºæ•°æ®æ¨¡å‹ |
| `domain/repository/SystemPromptRepository.kt` | ä»“åº“æ¥å£ |
| `data/local/SystemPromptStorage.kt` | æ–‡ä»¶å­˜å‚¨ |
| `data/repository/SystemPromptRepositoryImpl.kt` | ä»“åº“å®ç° |
| `presentation/viewmodel/DeveloperModeViewModel.kt` | å¼€å‘è€…æ¨¡å¼VM |
| `presentation/viewmodel/SystemPromptListViewModel.kt` | åˆ—è¡¨é¡µVM |
| `presentation/viewmodel/SystemPromptEditViewModel.kt` | ç¼–è¾‘é¡µVM |
| `presentation/ui/screen/settings/component/DeveloperOptionsSection.kt` | å¼€å‘è€…é€‰é¡¹ç»„ä»¶ |
| `presentation/ui/screen/developer/SystemPromptListScreen.kt` | åœºæ™¯åˆ—è¡¨é¡µ |
| `presentation/ui/screen/developer/SystemPromptEditScreen.kt` | åœºæ™¯ç¼–è¾‘é¡µ |

#### ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ |
|---------|---------|
| `domain/util/SystemPrompts.kt` | æ·»åŠ è‡ªå®šä¹‰é…ç½®æ”¯æŒ |
| `data/di/PromptModule.kt` | æ·»åŠ DIé…ç½® |
| `presentation/navigation/NavRoutes.kt` | æ·»åŠ è·¯ç”±å®šä¹‰ |
| `presentation/navigation/NavGraph.kt` | æ·»åŠ è·¯ç”±é…ç½® |
| `presentation/ui/screen/settings/SettingsScreen.kt` | æ·»åŠ ç‰ˆæœ¬å·ç‚¹å‡»é€»è¾‘ |
| `app/EmpathyApplication.kt` | åˆå§‹åŒ–é…ç½®æä¾›è€… |

### 10.2 ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|-----|------|
| [PRD-00033](../PRD/PRD-00033-å¼€å‘è€…æ¨¡å¼ä¸ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘.md) | éœ€æ±‚æ–‡æ¡£ |
| [TDD-00015](TDD-00015-æç¤ºè¯è®¾ç½®ä¼˜åŒ–æŠ€æœ¯è®¾è®¡.md) | æç¤ºè¯ç³»ç»Ÿå‚è€ƒ |
| [SUMMARY-00001](../å®¡æŸ¥æŠ¥å‘Š/SUMMARY-00001-ç³»ç»Ÿæç¤ºè¯ä¼˜åŒ–æ€»ç»“.md) | ç³»ç»Ÿæç¤ºè¯åˆ†æ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2026-01-08
**æ›´æ–°è€…**: Kiro
