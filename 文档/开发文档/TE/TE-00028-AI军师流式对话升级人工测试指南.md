# TE-00028: FD-00028 AI军师流式对话升级 - 人工测试指南

**测试日期**: 2026-01-04
**任务编号**: FD-00028
**测试人员**: 待定
**版本**: v1.0

---

## 1. 测试概述

### 1.1 测试目的
对FD-00028 AI军师流式对话升级功能进行全面人工测试验证，确保流式响应、思考过程展示、停止生成等核心功能正常运行。

### 1.2 测试范围
| 功能模块 | 状态 | 优先级 |
|----------|------|--------|
| SSE流式响应 | 待测试 | P0 |
| 思考过程展示 | 待测试 | P0 |
| 停止生成功能 | 待测试 | P1 |
| 重新生成功能 | 待测试 | P1 |
| 流式光标动画 | 待测试 | P1 |
| 错误处理与降级 | 待测试 | P2 |
| 数据库迁移(v13→v14) | 待测试 | P0 |

### 1.3 测试环境
- **设备**: Android手机/MuMu模拟器(192.0.2.1:7555)
- **系统版本**: Android 8.0+
- **应用版本**: 最新Debug版本
- **网络环境**: 稳定的互联网连接
- **AI服务商**: 已配置有效的API密钥（推荐DeepSeek用于测试思考过程）

---

## 2. 前置条件

### 2.1 环境准备
1. 安装最新Debug APK到测试设备
2. 配置至少一个AI服务商（推荐DeepSeek R1用于思考过程测试）
3. 创建至少一个联系人用于AI军师对话
4. 确保网络连接稳定

### 2.2 测试数据准备
- 联系人：至少1个有基本画像信息的联系人
- AI服务商：配置有效的API密钥
- 测试问题：准备多个不同复杂度的问题用于测试


---

## 3. 测试用例

### 3.1 SSE流式响应测试

#### TC-STREAM-001: 基本流式响应
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证AI回复能够实时逐字显示 |
| **前置条件** | 进入AI军师对话界面，选择一个联系人 |
| **操作步骤** | 1. 在输入框输入"你好，请介绍一下自己"<br>2. 点击发送按钮<br>3. 观察AI回复显示过程 |
| **预期结果** | ✅ 用户消息立即显示在对话列表<br>✅ AI回复逐字/逐词实时显示<br>✅ 显示流式光标（闪烁的▌）<br>✅ 完成后光标消失 |
| **测试结果** | 通过  |
| **备注** | |

#### TC-STREAM-002: 长文本流式响应
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证长文本流式响应的稳定性 |
| **前置条件** | 进入AI军师对话界面 |
| **操作步骤** | 1. 输入"请详细分析一下如何与内向的人建立良好的沟通关系，给出至少5个具体建议"<br>2. 发送并观察完整响应过程 |
| **预期结果** | ✅ 长文本能够完整显示<br>✅ 流式过程流畅无卡顿<br>✅ 自动滚动到最新内容<br>✅ 完成后消息状态正确 |
| **测试结果** | 通过|
| **备注** | |

#### TC-STREAM-003: 流式光标动画
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证流式光标动画效果 |
| **前置条件** | 触发AI流式响应 |
| **操作步骤** | 1. 发送任意消息<br>2. 观察AI回复末尾的光标 |
| **预期结果** | ✅ 显示闪烁的▌光标<br>✅ 闪烁频率约500ms<br>✅ 颜色为主题色<br>✅ 完成后光标消失 |
| **测试结果** | 未通过 |
| **备注** | 实际UI的后面没有我们的光标跳动|


---

### 3.2 思考过程展示测试

#### TC-THINK-001: 思考过程显示（DeepSeek R1）
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证思考过程能够正确展示 |
| **前置条件** | 配置DeepSeek R1模型作为默认服务商 |
| **操作步骤** | 1. 进入AI军师对话界面<br>2. 输入复杂问题"分析一下如何处理与同事的矛盾"<br>3. 观察思考过程区域 |
| **预期结果** | ✅ 显示"思考中..."标题<br>✅ 思考内容实时更新<br>✅ 显示思考耗时<br>✅ 思考完成后显示"思考过程" |
| **测试结果** |  通过 |
| **备注** | 需要使用支持思考过程的模型（如DeepSeek R1） |

#### TC-THINK-002: 思考过程折叠/展开
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证思考过程的折叠功能 |
| **前置条件** | AI回复包含思考过程 |
| **操作步骤** | 1. 等待AI回复完成<br>2. 点击思考过程区域标题<br>3. 再次点击 |
| **预期结果** | ✅ 默认折叠状态<br>✅ 点击可展开显示完整思考内容<br>✅ 再次点击可折叠<br>✅ 动画过渡平滑 |
| **测试结果** | 通过|
| **备注** | |

#### TC-THINK-003: 思考耗时显示
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证思考耗时统计准确 |
| **前置条件** | AI回复包含思考过程 |
| **操作步骤** | 1. 发送问题触发思考<br>2. 观察思考耗时显示 |
| **预期结果** | ✅ 实时显示思考耗时（秒）<br>✅ 完成后显示总耗时<br>✅ 格式如"1.5s" |
| **测试结果** | 通过 |
| **备注** | |

#### TC-THINK-004: 无思考过程的模型
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证不支持思考过程的模型正常工作 |
| **前置条件** | 配置普通OpenAI模型 |
| **操作步骤** | 1. 切换到不支持思考过程的模型<br>2. 发送问题<br>3. 观察回复 |
| **预期结果** | ✅ 不显示思考过程区域<br>✅ 直接显示文本回复<br>✅ 流式响应正常 |
| **测试结果** | 通过 |
| **备注** | |


---

### 3.3 停止生成功能测试

#### TC-STOP-001: 停止生成按钮显示
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证停止按钮在流式响应时显示 |
| **前置条件** | 进入AI军师对话界面 |
| **操作步骤** | 1. 发送消息触发AI响应<br>2. 观察输入栏区域 |
| **预期结果** | ✅ 流式响应时显示红色停止按钮<br>✅ 发送按钮被替换为停止按钮<br>✅ 停止图标清晰可见 |
| **测试结果** | 通过|
| **备注** | |

#### TC-STOP-002: 停止生成功能
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证点击停止按钮能中断响应 |
| **前置条件** | AI正在流式响应中 |
| **操作步骤** | 1. 发送一个会产生长回复的问题<br>2. 在AI回复过程中点击停止按钮<br>3. 观察响应状态 |
| **预期结果** | ✅ 响应立即停止<br>✅ 已生成的内容保留<br>✅ 消息状态变为"已取消"<br>✅ 停止按钮恢复为发送按钮 |
| **测试结果** | 通过|
| **备注** | |

#### TC-STOP-003: 停止后输入框状态
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证停止后可继续输入 |
| **前置条件** | 已停止一次生成 |
| **操作步骤** | 1. 停止生成后<br>2. 在输入框输入新消息<br>3. 发送 |
| **预期结果** | ✅ 输入框可正常输入<br>✅ 可发送新消息<br>✅ 新消息正常响应 |
| **测试结果** | 通过|
| **备注** | |


---

### 3.4 重新生成功能测试

#### TC-REGEN-001: 重新生成按钮显示
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证重新生成按钮在正确位置显示 |
| **前置条件** | 有至少一条AI回复 |
| **操作步骤** | 1. 完成一次AI对话<br>2. 查看最后一条AI消息 |
| **预期结果** | ✅ 最后一条AI消息下方显示"重新生成"按钮<br>✅ 按钮样式为蓝色文字+刷新图标<br>✅ 仅最后一条AI消息显示此按钮 |
| **测试结果** |未通过|
| **备注** | |

#### TC-REGEN-002: 重新生成功能
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证重新生成能产生新回复 |
| **前置条件** | 有至少一条AI回复 |
| **操作步骤** | 1. 点击"重新生成"按钮<br>2. 观察响应过程 |
| **预期结果** | ✅ 原AI回复被删除<br>✅ 使用相同问题重新请求<br>✅ 新回复流式显示<br>✅ 可能产生不同内容 |
| **测试结果** |未通过|
| **备注** | 关于我们这个任务，当我们这个AI反应完全了过后，我们就自动的变成了那个变成了那个呃变成了我们的那个就直接变成我们那个三个点，不知道为什么，请你解决一下这个问题。 |

#### TC-REGEN-003: 流式响应中禁用重新生成
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证流式响应时不能重新生成 |
| **前置条件** | AI正在流式响应中 |
| **操作步骤** | 1. 发送消息触发流式响应<br>2. 观察重新生成按钮状态 |
| **预期结果** | ✅ 流式响应时不显示重新生成按钮<br>✅ 或按钮被禁用 |
| **测试结果** |  未通过 |
| **备注** | 同上一个按钮点击没有任何反应|


---

### 3.5 错误处理与降级测试

#### TC-ERR-001: 网络断开错误处理
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证网络断开时的错误处理 |
| **前置条件** | 进入AI军师对话界面 |
| **操作步骤** | 1. 发送消息<br>2. 在流式响应过程中断开网络<br>3. 观察错误处理 |
| **预期结果** | ✅ 显示错误提示<br>✅ 消息状态变为失败<br>✅ 显示重试按钮<br>✅ 应用不崩溃 |
| **测试结果** | 未通过 |
| **备注** | 卡在思考界面没有反应|

#### TC-ERR-002: API密钥无效错误
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证API密钥无效时的错误处理 |
| **前置条件** | 配置无效的API密钥 |
| **操作步骤** | 1. 修改API密钥为无效值<br>2. 发送消息<br>3. 观察错误处理 |
| **预期结果** | ✅ 显示认证错误提示<br>✅ 消息状态变为失败<br>✅ 提示用户检查API密钥 |
| **测试结果** | 未通过  |
| **备注** | 呃，它并没有显示地告诉用户，你需要去检查AP密钥，它只有一个SSE HTTP connection L401，所以说没有没有实际的报告。|

#### TC-ERR-003: 失败消息重试
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证失败消息可以重试 |
| **前置条件** | 有一条发送失败的消息 |
| **操作步骤** | 1. 找到失败的消息<br>2. 点击"重试"按钮<br>3. 恢复网络后观察 |
| **预期结果** | ✅ 重试按钮可点击<br>✅ 重新发送请求<br>✅ 成功后消息状态更新 |
| **测试结果** |未通过
| **备注** |  重试没有反应|

#### TC-ERR-004: 错误消息删除
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证可以删除失败的消息 |
| **前置条件** | 有一条发送失败的消息 |
| **操作步骤** | 1. 找到失败的消息<br>2. 点击"删除"按钮 |
| **预期结果** | ✅ 消息被删除<br>✅ 对话列表更新 |
| **测试结果** |未通过|
| **备注** | 没有删除按钮|


---

### 3.6 UI交互测试

#### TC-UI-001: 消息气泡样式
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证消息气泡iOS风格样式 |
| **前置条件** | 有用户和AI消息 |
| **操作步骤** | 1. 观察用户消息气泡<br>2. 观察AI消息气泡 |
| **预期结果** | ✅ 用户消息：蓝色背景，右对齐<br>✅ AI消息：白色/灰色背景，左对齐<br>✅ 圆角样式正确<br>✅ 头像显示正确 |
| **测试结果** | 未通过 |
| **备注** | 安卓今典没有使用ios的|

#### TC-UI-002: 自动滚动到底部
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证新消息时自动滚动 |
| **前置条件** | 对话列表有多条消息 |
| **操作步骤** | 1. 滚动到对话列表顶部<br>2. 发送新消息<br>3. 观察滚动行为 |
| **预期结果** | ✅ 发送消息后自动滚动到底部<br>✅ 流式响应时持续滚动<br>✅ 滚动动画平滑 |
| **测试结果** |未通过|
| **备注** | 会自动上弹到顶部|

#### TC-UI-003: 输入框状态
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证输入框在不同状态下的表现 |
| **前置条件** | 进入AI军师对话界面 |
| **操作步骤** | 1. 空输入时观察发送按钮<br>2. 输入文字后观察<br>3. 流式响应时观察 |
| **预期结果** | ✅ 空输入：发送按钮灰色禁用<br>✅ 有输入：发送按钮蓝色可用<br>✅ 流式中：显示"AI正在回复..."占位符<br>✅ 流式中：输入框禁用 |
| **测试结果** | 通过|
| **备注** | |

#### TC-UI-004: 会话切换
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证会话切换功能 |
| **前置条件** | 有多个会话 |
| **操作步骤** | 1. 点击会话选择器<br>2. 切换到其他会话<br>3. 创建新会话 |
| **预期结果** | ✅ 会话列表正确显示<br>✅ 切换后加载对应对话<br>✅ 新建会话功能正常 |
| **测试结果** |未通过|
| **备注** | |


---

### 3.7 数据库迁移测试

#### TC-DB-001: 数据库v13到v14迁移
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证数据库迁移不丢失数据 |
| **前置条件** | 安装旧版本应用并创建数据 |
| **操作步骤** | 1. 安装旧版本APK（v13数据库）<br>2. 创建AI军师对话数据<br>3. 安装新版本APK（v14数据库）<br>4. 打开应用检查数据 |
| **预期结果** | ✅ 应用正常启动<br>✅ 原有对话数据保留<br>✅ 新Block表已创建<br>✅ 现有AI消息已迁移为MAIN_TEXT Block |
| **测试结果** | 通过|
| **备注** | |

#### TC-DB-002: Block数据持久化
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证Block数据正确保存 |
| **前置条件** | 完成一次流式对话 |
| **操作步骤** | 1. 发送消息获取AI回复<br>2. 关闭应用<br>3. 重新打开应用<br>4. 查看对话历史 |
| **预期结果** | ✅ 对话内容完整保留<br>✅ 思考过程（如有）保留<br>✅ 消息状态正确 |
| **测试结果** | 未通过  |
| **备注** | 呃，因为我们的对话在结束的时候，它就会直接退出，然后就变成了三个点，根本看不出来，所以说无法做到。|

---

### 3.8 性能测试

#### TC-PERF-001: 流式响应流畅度
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证流式响应不卡顿 |
| **前置条件** | 进入AI军师对话界面 |
| **操作步骤** | 1. 发送问题触发长回复<br>2. 观察流式显示过程<br>3. 尝试滚动对话列表 |
| **预期结果** | ✅ 文字显示流畅<br>✅ 帧率≥30fps<br>✅ 滚动不卡顿<br>✅ 无明显延迟 |
| **测试结果** | 通过 |
| **备注** | |

#### TC-PERF-002: 智能节流验证
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证数据库写入节流有效 |
| **前置条件** | 开启调试日志 |
| **操作步骤** | 1. 发送问题触发流式响应<br>2. 观察数据库写入日志 |
| **预期结果** | ✅ 不是每个字符都写入数据库<br>✅ 约300ms节流间隔<br>✅ 块类型变化时立即写入<br>✅ 完成时强制刷新 |
| **测试结果** | 待测试 |
| **备注** | 可通过Logcat观察BlockUpdateManager日志 |

#### TC-PERF-003: 内存占用
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证流式对话不造成内存泄漏 |
| **前置条件** | Android Studio Profiler |
| **操作步骤** | 1. 连续进行10次对话<br>2. 观察内存占用变化 |
| **预期结果** | ✅ 内存占用稳定<br>✅ 无明显内存泄漏<br>✅ GC后内存回收正常 |
| **测试结果** | 待测试 |
| **备注** | |


---

## 4. 测试结果汇总

| 测试分类 | 用例数 | 通过 | 未通过 | 待测试 | 通过率 |
|----------|--------|------|--------|--------|--------|
| SSE流式响应 | 3 | 2 | 1 | 0 | 66.7% |
| 思考过程展示 | 4 | 4 | 0 | 0 | 100% |
| 停止生成功能 | 3 | 3 | 0 | 0 | 100% |
| 重新生成功能 | 3 | 0 | 3 | 0 | 0% |
| 错误处理与降级 | 4 | 0 | 4 | 0 | 0% |
| UI交互测试 | 4 | 1 | 3 | 0 | 25% |
| 数据库迁移 | 2 | 1 | 1 | 0 | 50% |
| 性能测试 | 3 | 1 | 0 | 2 | 33.3% |
| **总计** | **26** | **12** | **12** | **2** | **46.2%** |

---

## 5. 问题记录

| 编号 | 测试用例 | 问题描述 | 严重程度 | 状态 |
|------|----------|----------|----------|------|
| P0-001 | TC-STREAM-003 | 流式光标动画未显示 | P2 | 待修复 |
| P0-002 | TC-REGEN-001/002/003 | 重新生成按钮无反应 | P0 | 待修复 |
| P0-003 | TC-ERR-001 | 断网时卡在思考界面 | P1 | 待修复 |
| P0-004 | TC-ERR-002 | API错误提示不友好 | P1 | 待修复 |
| P0-005 | TC-ERR-003 | 重试功能无反应 | P1 | 待修复 |
| P0-006 | TC-ERR-004 | 没有删除失败消息按钮 | P1 | 待修复 |
| P0-007 | TC-UI-001 | 消息气泡样式问题 | P2 | 待修复 |
| P0-008 | TC-UI-002 | 滚动时自动跳回顶部 | P0 | 待修复 |
| P0-009 | TC-UI-004 | 会话切换问题 | P1 | 待修复 |
| P0-010 | TC-DB-002 | 对话结束后显示三个省略号 | P0 | 待修复 |
| P0-011 | 人工结果 | 输入时自动弹出三个省略号 | P0 | 待修复 |
| P0-012 | 人工结果 | 已创建对话中重新输入无反应 | P0 | 待修复 |
| P0-013 | 人工结果 | 停止后显示三个省略号 | P1 | 待修复 |
| P0-014 | 人工结果 | 输出内容MD格式未渲染 | P2 | 待修复 |

**详细问题分析请参考**: [BUG-00044-AI军师流式对话多问题系统性分析](../BUG/BUG-00044-AI军师流式对话多问题系统性分析.md)

---

## 6. 测试总结

### 6.1 测试执行情况
- **测试开始时间**: 2026-01-04
- **测试结束时间**: 2026-01-04
- **总测试时间**: 约2小时
- **执行人员**: 人工测试

### 6.2 遗留问题
| 问题ID | 描述 | 处理方案 | 负责人 |
|--------|------|----------|--------|
| BUG-00044 | AI军师流式对话多问题 | 参见BUG文档 | 待分配 |

### 6.3 测试结论
☐ 所有测试通过，FD-00028功能验收通过
☐ 存在轻微问题，建议修复后重新测试
☒ **存在严重问题，需要返工**

**问题总结**:
- P0级问题: 5个（阻塞核心功能）
- P1级问题: 6个（影响用户体验）
- P2级问题: 3个（优化改进）

**下一步行动**:
1. 根据BUG-00044文档修复所有问题
2. 使用TE-00028-V2测试指南进行修复后验证

---

## 7. 附录

### 7.1 相关文档
- [FD-00028功能设计文档](../FD/FD-00028-AI军师流式对话升级功能设计.md)
- [PRD-00028需求文档](../PRD/PRD-00028-AI军师流式对话升级需求.md)
- [TDD-00028技术设计文档](../TDD/TDD-00028-AI军师流式对话升级技术设计.md)

### 7.2 测试数据
```
测试联系人: 
测试服务商: DeepSeek / OpenAI
测试模型: deepseek-chat / deepseek-reasoner / gpt-4
```

### 7.3 环境信息
```
设备型号:
系统版本:
应用版本:
构建版本:
数据库版本: v14
```

### 7.4 调试命令
```bash
# 安装APK到MuMu模拟器
adb -s 192.0.2.1:7555 install -r app\build\outputs\apk\debug\app-debug.apk

# 启动应用
adb -s 192.0.2.1:7555 shell am start -n com.empathy.ai/.ui.MainActivity

# 查看流式相关日志
adb -s 192.0.2.1:7555 logcat | findstr "Streaming\|SSE\|Block"

# AI调试日志
scripts\ai-debug.bat -d 192.0.2.1:7555
```

---

**测试人员签名**: ________________

**日期**: ________________
