# TE-00028-V2: FD-00028 AI军师流式对话升级 - 人工测试指南（修复后验证版）

**测试日期**: 待定
**任务编号**: FD-00028
**测试人员**: 待定
**版本**: v2.0
**前置条件**: BUG-00044修复完成

---

## 1. 测试概述

### 1.1 测试目的
验证BUG-00044中列出的所有问题已修复，确保AI军师流式对话功能正常运行。

### 1.2 测试范围
| 功能模块 | 关联BUG | 优先级 | 状态 |
|----------|---------|--------|------|
| 流式响应完成后显示 | P0-001 | P0 | 待测试 |
| 重新生成功能 | P0-002 | P0 | 待测试 |
| 已创建对话重新输入 | P0-003 | P0 | 待测试 |
| 滚动行为 | P0-004 | P0 | 待测试 |
| 输入时状态显示 | P0-005 | P0 | 待测试 |
| 重试功能 | P1-001 | P1 | 待测试 |
| 停止生成后显示 | P1-002 | P1 | 待测试 |
| 断网错误处理 | P1-003 | P1 | 待测试 |
| API错误提示 | P1-004 | P1 | 待测试 |
| 会话切换 | P1-005 | P1 | 待测试 |
| 删除失败消息 | P1-006 | P1 | 待测试 |
| 流式光标动画 | P2-001 | P2 | 待测试 |
| Markdown渲染 | P2-002 | P2 | 待测试 |

### 1.3 测试环境
- **设备**: Android手机/MuMu模拟器(127.0.0.1:7555)
- **系统版本**: Android 8.0+
- **应用版本**: BUG-00044修复后的Debug版本
- **网络环境**: 稳定的互联网连接
- **AI服务商**: 已配置有效的API密钥（推荐DeepSeek）

---

## 2. 前置条件

### 2.1 环境准备
1. 安装BUG-00044修复后的Debug APK
2. 配置至少一个AI服务商（推荐DeepSeek R1用于思考过程测试）
3. 创建至少一个联系人用于AI军师对话
4. 确保网络连接稳定

### 2.2 测试数据准备
- 联系人：至少1个有基本画像信息的联系人
- AI服务商：配置有效的API密钥
- 测试问题：准备多个不同复杂度的问题用于测试

---

## 3. P0级问题验证测试

### TC-P0-001: 流式响应完成后显示验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P0-001 |
| **测试目的** | 验证AI回复完成后正确显示完整内容，不再显示"..." |
| **前置条件** | 进入AI军师对话界面 |
| **操作步骤** | 1. 输入"请介绍一下自己"<br>2. 点击发送<br>3. 等待AI流式回复完成<br>4. 观察AI消息显示 |
| **预期结果** | ✅ 流式过程中内容逐字显示<br>✅ 完成后显示完整AI回复内容<br>✅ 不显示"..."或空内容<br>✅ 消息气泡样式正确 |
| **测试结果** | |
| **备注** | |

### TC-P0-002: 重新生成功能验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P0-002 |
| **测试目的** | 验证重新生成按钮点击有效 |
| **前置条件** | 完成一次AI对话 |
| **操作步骤** | 1. 完成一次AI对话<br>2. 点击最后一条AI消息下方的"重新生成"按钮<br>3. 观察响应 |
| **预期结果** | ✅ 点击后立即响应<br>✅ 原AI回复被删除<br>✅ 使用相同问题重新请求<br>✅ 新回复流式显示 |
| **测试结果** | |
| **备注** | |

### TC-P0-003: 已创建对话重新输入验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P0-003 |
| **测试目的** | 验证在已有对话中发送新消息正常响应 |
| **前置条件** | 完成一次AI对话 |
| **操作步骤** | 1. 完成一次AI对话<br>2. 在同一会话中输入新问题"继续聊聊"<br>3. 点击发送<br>4. 观察响应 |
| **预期结果** | ✅ 新消息正常发送<br>✅ 不卡在"正在生成"状态<br>✅ AI正常回复<br>✅ 对话历史保持完整 |
| **测试结果** | |
| **备注** | |

### TC-P0-004: 滚动行为验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P0-004 |
| **测试目的** | 验证滚动时不会自动跳回顶部 |
| **前置条件** | 进行多轮对话，产生较长的对话历史 |
| **操作步骤** | 1. 进行5轮以上对话<br>2. 向上滚动查看历史消息<br>3. 停留在中间位置<br>4. 等待几秒观察 |
| **预期结果** | ✅ 滚动位置保持不变<br>✅ 不会自动跳回顶部或底部<br>✅ 用户可自由浏览历史 |
| **测试结果** | |
| **备注** | |

### TC-P0-004-B: 新消息时滚动行为验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P0-004 |
| **测试目的** | 验证在底部时新消息自动滚动 |
| **前置条件** | 进行多轮对话 |
| **操作步骤** | 1. 滚动到对话底部<br>2. 发送新消息<br>3. 观察滚动行为 |
| **预期结果** | ✅ 在底部时，新消息自动滚动到可见<br>✅ 流式响应时持续滚动到最新内容 |
| **测试结果** | |
| **备注** | |

### TC-P0-005: 输入时状态显示验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P0-005 |
| **测试目的** | 验证输入时不会自动弹出"..."消息 |
| **前置条件** | 进入AI军师对话界面 |
| **操作步骤** | 1. 在输入框输入文字<br>2. 观察对话列表<br>3. 删除输入内容<br>4. 再次输入 |
| **预期结果** | ✅ 输入时对话列表不变<br>✅ 不出现"..."消息<br>✅ 只有点击发送后才显示新消息 |
| **测试结果** | |
| **备注** | |

---

## 4. P1级问题验证测试

### TC-P1-001: 重试功能验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P1-001 |
| **测试目的** | 验证失败消息的重试按钮有效 |
| **前置条件** | 有一条发送失败的消息 |
| **操作步骤** | 1. 断开网络发送消息（制造失败）<br>2. 恢复网络<br>3. 点击失败消息的"重试"按钮<br>4. 观察响应 |
| **预期结果** | ✅ 重试按钮可点击<br>✅ 点击后重新发送请求<br>✅ 成功后消息状态更新<br>✅ AI正常回复 |
| **测试结果** | |
| **备注** | |

### TC-P1-002: 停止生成后显示验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P1-002 |
| **测试目的** | 验证停止生成后不显示"..."消息 |
| **前置条件** | 进入AI军师对话界面 |
| **操作步骤** | 1. 发送一个会产生长回复的问题<br>2. 在AI回复过程中点击停止按钮<br>3. 观察消息显示 |
| **预期结果** | ✅ 响应立即停止<br>✅ 已生成的内容保留<br>✅ 不显示空的"..."消息<br>✅ 消息状态显示"已取消"或类似提示 |
| **测试结果** | |
| **备注** | |

### TC-P1-003: 断网错误处理验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P1-003 |
| **测试目的** | 验证断网时正确显示错误提示 |
| **前置条件** | 进入AI军师对话界面 |
| **操作步骤** | 1. 发送消息<br>2. 在流式响应过程中断开网络<br>3. 观察错误处理 |
| **预期结果** | ✅ 不卡在"思考中..."界面<br>✅ 显示友好的错误提示（如"网络连接失败"）<br>✅ 消息状态变为失败<br>✅ 显示重试按钮 |
| **测试结果** | |
| **备注** | |

### TC-P1-004: API错误提示验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P1-004 |
| **测试目的** | 验证API错误显示友好提示 |
| **前置条件** | 配置无效的API密钥 |
| **操作步骤** | 1. 修改API密钥为无效值<br>2. 发送消息<br>3. 观察错误提示 |
| **预期结果** | ✅ 显示友好的错误提示<br>✅ 提示内容包含"API密钥"相关信息<br>✅ 不显示原始HTTP错误码<br>✅ 引导用户检查设置 |
| **测试结果** | |
| **备注** | 测试后记得恢复正确的API密钥 |

### TC-P1-005: 会话切换验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P1-005 |
| **测试目的** | 验证会话切换时请求不被迁移 |
| **前置条件** | 有多个会话 |
| **操作步骤** | 1. 在会话A中发送消息<br>2. 在AI回复过程中切换到会话B<br>3. 观察两个会话的状态 |
| **预期结果** | ✅ 会话A的流式响应被取消<br>✅ 会话B正常加载<br>✅ 会话B不显示会话A的请求<br>✅ 可以在会话B中正常发送新消息 |
| **测试结果** | |
| **备注** | |

### TC-P1-006: 删除失败消息验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P1-006 |
| **测试目的** | 验证可以删除失败的消息 |
| **前置条件** | 有一条发送失败的消息 |
| **操作步骤** | 1. 找到失败的消息<br>2. 点击"删除"按钮<br>3. 观察结果 |
| **预期结果** | ✅ 删除按钮可见<br>✅ 点击后消息被删除<br>✅ 对话列表正确更新 |
| **测试结果** | |
| **备注** | |

---

## 5. P2级问题验证测试

### TC-P2-001: 流式光标动画验证
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P2-001 |
| **测试目的** | 验证流式光标动画正确显示 |
| **前置条件** | 进入AI军师对话界面 |
| **操作步骤** | 1. 发送任意消息<br>2. 观察AI回复末尾的光标 |
| **预期结果** | ✅ 显示闪烁的▌光标<br>✅ 闪烁频率约500ms<br>✅ 颜色为主题色<br>✅ 完成后光标消失 |
| **测试结果** | |
| **备注** | |

### TC-P2-002: Markdown渲染验证（可选）
| 项目 | 内容 |
|------|------|
| **关联BUG** | BUG-044-P2-002 |
| **测试目的** | 验证Markdown格式正确渲染 |
| **前置条件** | 进入AI军师对话界面 |
| **操作步骤** | 1. 发送"请用Markdown格式列出3个建议"<br>2. 观察AI回复的格式显示 |
| **预期结果** | ✅ 粗体文字正确显示<br>✅ 列表格式正确显示<br>✅ 不显示原始Markdown字符 |
| **测试结果** | |
| **备注** | 此功能为优化项，可能未实现 |

---

## 6. 回归测试

### TC-REG-001: 基本流式响应
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证基本流式响应功能正常 |
| **操作步骤** | 1. 发送简单问题<br>2. 观察流式响应过程 |
| **预期结果** | ✅ 用户消息立即显示<br>✅ AI回复逐字显示<br>✅ 完成后消息完整 |
| **测试结果** | |

### TC-REG-002: 思考过程展示
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证思考过程展示功能正常（DeepSeek R1） |
| **操作步骤** | 1. 使用DeepSeek R1模型<br>2. 发送复杂问题<br>3. 观察思考过程 |
| **预期结果** | ✅ 显示"思考中..."<br>✅ 思考内容实时更新<br>✅ 显示思考耗时<br>✅ 思考完成后可折叠 |
| **测试结果** | |

### TC-REG-003: 停止生成功能
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证停止生成功能正常 |
| **操作步骤** | 1. 发送问题<br>2. 在流式响应中点击停止按钮 |
| **预期结果** | ✅ 响应立即停止<br>✅ 停止按钮恢复为发送按钮<br>✅ 可继续发送新消息 |
| **测试结果** | |

### TC-REG-004: 数据库持久化
| 项目 | 内容 |
|------|------|
| **测试目的** | 验证对话数据正确保存 |
| **操作步骤** | 1. 完成一次对话<br>2. 关闭应用<br>3. 重新打开应用<br>4. 查看对话历史 |
| **预期结果** | ✅ 对话内容完整保留<br>✅ 思考过程（如有）保留<br>✅ 消息状态正确 |
| **测试结果** | |

---

## 7. 测试结果汇总

| 测试分类 | 用例数 | 通过 | 未通过 | 通过率 |
|----------|--------|------|--------|--------|
| P0级问题验证 | 6 | | | |
| P1级问题验证 | 6 | | | |
| P2级问题验证 | 2 | | | |
| 回归测试 | 4 | | | |
| **总计** | **18** | | | |

---

## 8. 问题记录

| 编号 | 测试用例 | 问题描述 | 严重程度 | 状态 |
|------|----------|----------|----------|------|
| | | | | |

---

## 9. 测试总结

### 9.1 测试执行情况
- **测试开始时间**: 
- **测试结束时间**: 
- **总测试时间**: 
- **执行人员**: 

### 9.2 遗留问题
| 问题ID | 描述 | 处理方案 | 负责人 |
|--------|------|----------|--------|
| | | | |

### 9.3 测试结论
☐ 所有BUG已修复，FD-00028功能验收通过
☐ 部分BUG已修复，需要继续修复后重新测试
☐ 存在新问题，需要分析处理

---

## 10. 附录

### 10.1 相关文档
- [BUG-00044问题分析文档](../BUG/BUG-00044-AI军师流式对话多问题系统性分析.md)
- [TE-00028测试总结报告](./TE-00028-测试总结报告.md)
- [FD-00028功能设计文档](../FD/FD-00028-AI军师流式对话升级功能设计.md)

### 10.2 调试命令
```bash
# 安装APK到MuMu模拟器
adb -s 127.0.0.1:7555 install -r app\build\outputs\apk\debug\app-debug.apk

# 启动应用
adb -s 127.0.0.1:7555 shell am start -n com.empathy.ai/.ui.MainActivity

# 查看流式相关日志
adb -s 127.0.0.1:7555 logcat | findstr "Streaming\|SSE\|Block\|AiAdvisor"

# AI调试日志
scripts\ai-debug.bat -d 127.0.0.1:7555
```

---

**测试人员签名**: ________________

**日期**: ________________
