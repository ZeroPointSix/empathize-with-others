# BUG-00045 人工测试指南

**测试日期**: 2026-01-05
**APK版本**: BUG-00045修复版
**测试设备**: MuMu模拟器 (192.0.2.1:7555)

---

## 🚀 快速开始

应用已安装并启动。如需重新启动：
```bash
adb -s 192.0.2.1:7555 shell am start -n com.empathy.ai/.ui.MainActivity
```

---

## 📋 测试清单

### 测试1: AI回复完成后内容保持 ⭐ 最重要

**操作步骤**:
1. 点击底部导航栏的"联系人"
2. 选择任意联系人，点击进入
3. 点击右上角"AI军师"图标进入对话界面
4. 在输入框输入"你好"，点击发送
5. **观察AI回复过程**

**预期结果**:
- ✅ AI回复逐字显示（流式效果）
- ✅ 回复完成后，内容**保持显示**，不消失
- ✅ 消息保留在对话列表中

**失败表现**:
- ❌ AI回复完成后内容消失
- ❌ 只显示空白或"..."

---

### 测试2: 重新生成不重复用户消息

**操作步骤**:
1. 完成测试1后，对话中应有1条用户消息和1条AI回复
2. 点击AI回复下方的"重新生成"按钮
3. 等待新的AI回复完成
4. **数一数用户消息有几条**

**预期结果**:
- ✅ 用户消息"你好"只有**1条**
- ✅ AI重新生成新的回复
- ✅ 没有重复的用户消息

**失败表现**:
- ❌ 出现2条或更多"你好"消息
- ❌ 消息列表变长了

---

### 测试3: 不显示"..."占位消息

**操作步骤**:
1. 在对话界面发送新消息"1+1等于几"
2. **仔细观察整个过程**

**预期结果**:
- ✅ 用户消息立即显示
- ✅ AI回复区域显示"正在生成"或实际内容
- ✅ **不出现单独的"..."消息**
- ✅ 完成后只有用户消息和AI回复

**失败表现**:
- ❌ 出现只显示"..."的消息气泡
- ❌ 有多余的占位消息

---

### 测试4: AI服务正常接入

**操作步骤**:
1. 发送问题"请介绍一下你自己"
2. 观察AI回复内容

**预期结果**:
- ✅ AI回复有意义的内容（如自我介绍）
- ✅ 不是默认错误消息
- ✅ 回复长度合理

**失败表现**:
- ❌ 回复"无法理解你的请求"
- ❌ 显示错误提示
- ❌ 无任何回复

---

## 🔧 调试命令

如果测试失败，使用以下命令查看日志：

```bash
# 查看AI请求日志
scripts\ai-debug.bat -d 192.0.2.1:7555

# 查看流式相关日志
adb -s 192.0.2.1:7555 logcat | findstr "Streaming\|SSE\|AiAdvisor"

# 查看错误日志
adb -s 192.0.2.1:7555 logcat *:E | findstr "empathy"
```

---

## 📝 测试结果记录

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 测试1: AI回复保持 | ☐ 通过 / ☐ 失败 | |
| 测试2: 重新生成 | ☐ 通过 / ☐ 失败 | |
| 测试3: 无占位消息 | ☐ 通过 / ☐ 失败 | |
| 测试4: AI服务接入 | ☐ 通过 / ☐ 失败 | |

---

## ⚠️ 前置条件

确保已配置AI服务商：
1. 进入"设置" → "AI服务商配置"
2. 确认有默认服务商（如DeepSeek）
3. 确认API密钥有效

---

**测试人员**: ________________
**测试时间**: ________________
