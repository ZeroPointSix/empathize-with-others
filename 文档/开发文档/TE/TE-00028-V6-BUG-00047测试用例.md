# TE-00028-V6: BUG-00047 AI军师流式对话V5问题测试用例

**创建日期**: 2026-01-05
**关联BUG**: BUG-00047
**关联任务**: FD-00028 AI军师流式对话升级
**测试类型**: 功能测试 + 回归测试
**状态**: 🔄 待执行

---

## 1. 测试目标

验证BUG-00047中两个核心问题的修复效果：
1. P0-V5-001: AI生成回复时短暂出现两个AI回复框
2. P0-V5-002: 停止生成后消息直接消失，无重新生成按钮

---

## 2. 测试环境

### 2.1 设备要求
- Android设备或模拟器（API 24+）
- 已配置AI服务商（DeepSeek或OpenAI）
- 网络连接正常

### 2.2 前置条件
- 应用已安装并启动
- 至少有一个联系人
- AI服务商已配置且API密钥有效

---

## 3. 测试用例

### 3.1 P0-V5-001: 双气泡问题测试

#### TC-001: 正常流式响应单气泡显示
**优先级**: P0
**前置条件**: 进入AI军师对话界面

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 输入消息"你好" | 输入框显示"你好" |
| 2 | 点击发送按钮 | 用户消息气泡显示 |
| 3 | 观察AI回复生成过程 | **只显示一个AI气泡**，内容实时更新 |
| 4 | 等待AI回复完成 | 气泡内容完整显示，无闪烁 |

**验证点**:
- [ ] 整个流式过程中只有一个AI气泡
- [ ] 没有出现两个气泡同时显示的情况
- [ ] 流式完成后气泡平滑过渡

---

#### TC-002: 快速连续发送消息
**优先级**: P0
**前置条件**: 进入AI军师对话界面

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 发送第一条消息 | 开始流式响应 |
| 2 | 等待AI回复完成 | 第一条回复完整显示 |
| 3 | 立即发送第二条消息 | 开始新的流式响应 |
| 4 | 观察消息列表 | **每条AI回复只有一个气泡** |

**验证点**:
- [ ] 第一条回复完成后正确显示
- [ ] 第二条回复开始时没有重复气泡
- [ ] 消息列表顺序正确

---

#### TC-003: 流式完成时的过渡
**优先级**: P0
**前置条件**: 进入AI军师对话界面

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 发送一条需要较长回复的问题 | 开始流式响应 |
| 2 | 仔细观察流式完成的瞬间 | **无闪烁、无双气泡** |
| 3 | 检查最终显示的消息 | 内容完整，格式正确 |

**验证点**:
- [ ] 流式气泡到普通气泡的过渡平滑
- [ ] 没有出现内容消失再出现的情况
- [ ] 没有出现两个气泡同时存在的情况

---

### 3.2 P0-V5-002: 停止生成问题测试

#### TC-004: 有内容时停止生成
**优先级**: P0
**前置条件**: 进入AI军师对话界面

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 发送一条消息 | 开始流式响应 |
| 2 | 等待AI输出一些内容（约2-3秒） | 气泡中显示部分内容 |
| 3 | 点击"停止"按钮 | 流式停止 |
| 4 | 观察消息气泡 | **消息保持显示，带"[用户已停止生成]"标记** |
| 5 | 检查气泡下方 | **显示"重新生成"按钮** |

**验证点**:
- [ ] 已生成的内容保留显示
- [ ] 显示"[用户已停止生成]"标记
- [ ] 显示"重新生成"按钮
- [ ] 消息状态为CANCELLED

---

#### TC-005: 无内容时停止生成
**优先级**: P0
**前置条件**: 进入AI军师对话界面

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 发送一条消息 | 开始流式响应 |
| 2 | 立即点击"停止"按钮（在AI输出任何内容前） | 流式停止 |
| 3 | 观察消息气泡 | **显示"[用户已停止生成]"** |
| 4 | 检查气泡下方 | **显示"重新生成"按钮** |

**验证点**:
- [ ] 即使没有内容也保留消息
- [ ] 显示"[用户已停止生成]"标记
- [ ] 显示"重新生成"按钮
- [ ] 消息不会直接消失

---

#### TC-006: 停止后重新生成
**优先级**: P0
**前置条件**: 完成TC-004或TC-005

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 点击"重新生成"按钮 | 开始新的流式响应 |
| 2 | 观察消息列表 | **只有一个AI气泡**，旧消息被替换 |
| 3 | 等待新回复完成 | 新内容完整显示 |

**验证点**:
- [ ] 重新生成功能正常工作
- [ ] 没有出现双气泡
- [ ] 新内容正确显示

---

### 3.3 回归测试

#### TC-007: 正常流式响应完整流程
**优先级**: P1
**前置条件**: 进入AI军师对话界面

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 发送消息 | 用户消息显示 |
| 2 | 观察思考过程（如果有） | 思考内容正确显示 |
| 3 | 观察文本生成 | 打字机效果正常 |
| 4 | 等待完成 | 内容完整，光标消失 |

**验证点**:
- [ ] 流式响应功能正常
- [ ] 思考过程显示正确
- [ ] 打字机效果流畅

---

#### TC-008: 会话切换
**优先级**: P1
**前置条件**: 有多个会话

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 在会话A发送消息 | 开始流式响应 |
| 2 | 切换到会话B | 流式停止，会话B内容显示 |
| 3 | 切换回会话A | 会话A内容正确显示 |

**验证点**:
- [ ] 会话切换功能正常
- [ ] 状态隔离正确
- [ ] 没有跨会话数据污染

---

#### TC-009: 错误处理
**优先级**: P1
**前置条件**: 模拟网络错误

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 断开网络 | - |
| 2 | 发送消息 | 显示错误提示 |
| 3 | 恢复网络 | - |
| 4 | 重试发送 | 正常工作 |

**验证点**:
- [ ] 错误提示友好
- [ ] 重试功能正常

---

## 4. 测试结果记录

| 用例编号 | 测试结果 | 测试人 | 测试时间 | 备注 |
|----------|----------|--------|----------|------|
| TC-001 | ⬜ 待测试 | | | |
| TC-002 | ⬜ 待测试 | | | |
| TC-003 | ⬜ 待测试 | | | |
| TC-004 | ⬜ 待测试 | | | |
| TC-005 | ⬜ 待测试 | | | |
| TC-006 | ⬜ 待测试 | | | |
| TC-007 | ⬜ 待测试 | | | |
| TC-008 | ⬜ 待测试 | | | |
| TC-009 | ⬜ 待测试 | | | |

**测试结果说明**:
- ✅ 通过
- ❌ 失败
- ⬜ 待测试
- ⚠️ 部分通过

---

## 5. 问题记录

| 问题编号 | 关联用例 | 问题描述 | 严重程度 | 状态 |
|----------|----------|----------|----------|------|
| | | | | |

---

**文档版本**: v1.0
**创建日期**: 2026-01-05
**最后更新**: 2026-01-05
