# TE-00070：悬浮球 App 内不可见测试用例
## 文档信息
| 项目 | 内容 |
|------|------|
| 文档编号 | TE-00070 |
| 关联BUG | BUG-00070 |
| 测试类型 | 功能测试 + 回归测试 + 兼容性测试 |
| 编写者 | Codex |
| 编写日期 | 2026-01-13 |

---

## 一、测试范围
### 1.1 测试目标
验证悬浮球在 App 内可见，且多显示屏场景下保持一致显示：
1. App 内悬浮球可见。
2. 切换 App 后悬浮球仍可见。
3. 重启 App 后悬浮球显示不回退。
4. 悬浮球拖动、最小化、恢复不回归。

### 1.2 关联模块
| 模块 | 文件 | 测试类型 |
|------|------|----------|
| 悬浮窗服务 | `app/src/main/java/com/empathy/ai/domain/service/FloatingWindowService.kt` | 集成/回归 |
| 悬浮窗设置 | `presentation/src/main/kotlin/com/empathy/ai/presentation/ui/screen/settings/SettingsScreen.kt` | 功能 |
| 悬浮窗偏好 | `data/src/main/kotlin/com/empathy/ai/data/local/FloatingWindowPreferences.kt` | 功能 |

---

## 二、手动测试用例

| 用例编号 | 场景 | 步骤 | 预期结果 |
|---------|------|------|----------|
| TC-M-001 | App 内可见 | 打开 App → 开启悬浮窗 | App 内出现悬浮球 |
| TC-M-002 | 切换 App | 在 App 内确认悬浮球可见 → 切到桌面/其他 App | 悬浮球仍可见 |
| TC-M-003 | 返回 App | 从其他 App 切回本 App | 悬浮球可见 |
| TC-M-004 | 进程重启 | 关闭 App 进程 → 重启 | 悬浮球仍显示在 App 内 |
| TC-M-005 | 拖动保存 | 拖动悬浮球到新位置 → 重启 | 位置恢复到新位置 |
| TC-M-006 | 最小化/恢复 | 展开悬浮窗 → 最小化 → 点击悬浮球 | 正常最小化与恢复 |

---

## 三、兼容性测试矩阵
| 设备/环境 | 版本 | 预期 |
|-----------|------|------|
| MuMu 模拟器 | Android 12+ | App 内可见 |
| OPPO 真机 | Android 12+ | App 内可见 |

---

## 四、回归测试关注点
- 悬浮球显示模式（IDLE/LOADING/SUCCESS/ERROR）切换正常。
- 连续截屏开关不影响悬浮球显示。
- 悬浮窗权限与服务启停逻辑无回归。

---

## 五、执行命令（如需）
```bash
# 构建
./gradlew :app:assembleDebug

# 安装到 MuMu
adb -s 127.0.0.1:7555 install -r -d app/build/outputs/apk/debug/app-debug.apk
```

---

## 六、相关文档
- `文档/开发文档/BUG/BUG-00070-悬浮球App内不显示问题.md`
