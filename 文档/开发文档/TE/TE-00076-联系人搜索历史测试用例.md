# TE-00076：联系人搜索历史测试用例

## 文档信息

| 项目 | 内容 |
|------|------|
| **文档编号** | TE-00076 |
| **关联需求** | FREE-20260118 联系人搜索历史 |
| **测试类型** | 功能测试 + 单元测试 |
| **编写者** | Codex |
| **编写日期** | 2026-01-18 |

---

## 一、测试范围

### 1.1 测试目标

验证联系人搜索历史功能的完整性和正确性，确保：
1. 搜索模式下显示最近搜索历史
2. 点击历史关键词可自动回填并执行搜索
3. 搜索历史能被保存与去重
4. 清空按钮能正确清空历史

### 1.2 测试模块

| 模块 | 文件 | 测试类型 |
|------|------|----------|
| ViewModel | `ContactListViewModel.kt` | 单元测试 |
| UI | `ContactListScreen.kt` | 人工测试 |

---

## 二、单元测试用例

**测试文件**：
- `presentation/src/test/kotlin/com/empathy/ai/presentation/viewmodel/ContactSearchHistoryFeatureTest.kt`
- `domain/src/test/kotlin/com/empathy/ai/domain/usecase/GetContactSearchHistoryUseCaseTest.kt`
- `domain/src/test/kotlin/com/empathy/ai/domain/usecase/SaveContactSearchQueryUseCaseTest.kt`
- `domain/src/test/kotlin/com/empathy/ai/domain/usecase/ClearContactSearchHistoryUseCaseTest.kt`

### TC-001：保存搜索历史应更新最近搜索列表

```kotlin
@Test
fun `保存搜索历史应更新最近搜索列表`() = runTest {
    val viewModel = createViewModel()
    viewModel.onEvent(ContactListUiEvent.StartSearch)
    viewModel.onEvent(ContactListUiEvent.UpdateSearchQuery("张"))
    viewModel.onEvent(ContactListUiEvent.SaveSearchHistory)
    val state = viewModel.uiState.value
    assertTrue(state.searchHistory.contains("张"))
}
```

### TC-002：清空搜索历史应置空列表

```kotlin
@Test
fun `清空搜索历史应置空列表`() = runTest {
    val viewModel = createViewModel()
    viewModel.onEvent(ContactListUiEvent.ClearSearchHistory)
    val state = viewModel.uiState.value
    assertTrue(state.searchHistory.isEmpty())
}
```

### TC-003：读取/保存/清空历史用例成功与失败分支

已在以下单元测试中覆盖：
- `GetContactSearchHistoryUseCaseTest`
- `SaveContactSearchQueryUseCaseTest`
- `ClearContactSearchHistoryUseCaseTest`

---

## 三、人工测试用例

### TC-101：搜索历史展示

**前置条件**：至少存在 1 条历史搜索关键词  
**步骤**：
1. 打开联系人列表
2. 点击搜索按钮进入搜索模式
3. 保持搜索输入框为空

**预期结果**：
1. 显示“最近搜索”区域
2. 历史关键词列表可见

### TC-102：点击历史关键词回填并搜索

**步骤**：
1. 在“最近搜索”中点击任一关键词

**预期结果**：
1. 搜索框自动回填关键词
2. 搜索结果按关键词过滤并显示

### TC-103：保存搜索历史（正常命中）

**步骤**：
1. 输入关键词并获得匹配结果
2. 点击联系人进入详情页或关闭搜索
3. 返回联系人列表再次进入搜索模式

**预期结果**：
1. 最近搜索列表包含刚输入的关键词
2. 同关键词不会出现重复项

### TC-104：清空搜索历史

**步骤**：
1. 进入搜索模式
2. 点击“清空”按钮

**预期结果**：
1. 最近搜索列表清空
2. 不再显示历史列表内容

---

## 四、补充说明

- 搜索历史最大保存条数为 8 条
- 搜索历史存储使用 SharedPreferences
