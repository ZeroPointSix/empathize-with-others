# TDD-00033 å¼€å‘è€…æ¨¡å¼ä¸ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘æŠ€æœ¯è®¾è®¡ å®¡æŸ¥æŠ¥å‘Š

## ğŸ“„ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| æ–‡æ¡£ç±»å‹ | TDD (Technical Design Document) |
| æ–‡æ¡£ç¼–å· | TDD-00033 |
| åŠŸèƒ½åç§° | å¼€å‘è€…æ¨¡å¼ä¸ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘ |
| ç‰ˆæœ¬ | 1.0 |
| å­˜æ”¾è·¯å¾„ | `æ–‡æ¡£/å¼€å‘æ–‡æ¡£/TDD/TDD-00033-å¼€å‘è€…æ¨¡å¼ä¸ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘æŠ€æœ¯è®¾è®¡.md` |
| å…³è”æ–‡æ¡£ | PRD-00033 (ä¸å­˜åœ¨), TDD-00005, TDD-00015 |
| åˆ›å»ºæ—¥æœŸ | 2026-01-08 |
| ä½œè€… | Kiro |

---

## ğŸ“Š è´¨é‡è¯„åˆ†

| å®¡æŸ¥ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|---------|------|------|
| **æ ¼å¼è§„èŒƒæ€§** | 9/10 | æ–‡æ¡£å‘½åã€è·¯å¾„ã€ç¼–å·ç¬¦åˆè§„èŒƒï¼Œç¼ºå°‘PRDå‰ç½®æ–‡æ¡£ |
| **å†…å®¹å®Œæ•´æ€§** | 9/10 | æŠ€æœ¯æ¶æ„å®Œæ•´ï¼ŒAPIè®¾è®¡è¯¦ç»†ï¼Œæµ‹è¯•ç­–ç•¥å®Œå–„ |
| **å¼€å‘å¯è¡Œæ€§** | 8/10 | æŠ€æœ¯æ–¹æ¡ˆå¯è¡Œï¼Œéƒ¨åˆ†å®ç°ç»†èŠ‚éœ€è¡¥å…… |
| **æ¶æ„ç¬¦åˆæ€§** | 8/10 | éµå¾ªClean Architectureï¼Œå­˜åœ¨è½»å¾®è®¾è®¡é—®é¢˜ |
| **åŠŸèƒ½é›†æˆæ€§** | 8/10 | é›†æˆç‚¹è¦†ç›–è¾ƒå®Œæ•´ï¼Œéƒ¨åˆ†å…¥å£å¯è¾¾æ€§éœ€éªŒè¯ |
| **æ•´ä½“è¯„åˆ†** | **8.3/10** | ä¼˜ç§€çš„æŠ€æœ¯è®¾è®¡æ–‡æ¡£ |

---

## âœ… ä¼˜ç‚¹

### 1. **æ–‡æ¡£ç»“æ„æ¸…æ™°å®Œæ•´**
- æ–‡æ¡£æŒ‰ç…§æ ‡å‡†TDDæ ¼å¼ç»„ç»‡ï¼ŒåŒ…å«ç‰ˆæœ¬å†å²ã€æ¶æ„æ¦‚è¿°ã€è¯¦ç»†è®¾è®¡ã€æµ‹è¯•ç­–ç•¥ã€å®æ–½è®¡åˆ’ç­‰å®Œæ•´ç« èŠ‚
- æ¯ä¸ªç« èŠ‚éƒ½æœ‰æ˜ç¡®çš„æ–‡ä»¶ä½ç½®æ ‡æ³¨ï¼Œä¾¿äºå¼€å‘äººå‘˜å®šä½ä»£ç 
- æ•°æ®æ¨¡å‹è®¾è®¡å®Œæ•´ï¼ŒåŒ…å«`SystemPromptScene`æšä¸¾ã€`SystemPromptConfig`æ•°æ®æ¨¡å‹ã€`SystemPromptExport`å¯¼å‡ºæ¨¡å‹

### 2. **æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡åˆç†**
- é‡‡ç”¨JSONæ–‡ä»¶å­˜å‚¨è‡ªå®šä¹‰é…ç½®ï¼Œé¿å…æ•°æ®åº“å˜æ›´ï¼Œä¿æŒç³»ç»Ÿç®€æ´
- é€šè¿‡Provideræ¨¡å¼è§£å†³`SystemPrompts`é™æ€æ–¹æ³•æ³¨å…¥é—®é¢˜ï¼Œè®¾è®¡å·§å¦™
- è§£é”æœºåˆ¶é‡‡ç”¨ç‚¹å‡»ç‰ˆæœ¬å·7æ¬¡çš„æ–¹å¼ï¼Œç¬¦åˆAndroidç³»ç»Ÿå¼€å‘è€…æ¨¡å¼çš„æƒ¯ä¾‹

### 3. **å¤ç”¨ç°æœ‰ç»„ä»¶**
- å¤ç”¨ç°æœ‰çš„`PromptEditSection`ç»„ä»¶ï¼Œå‡å°‘æ–°ä»£ç é‡
- å¤ç”¨`PromptScene`åˆ°`SystemPromptScene`çš„æ˜ å°„é€»è¾‘
- å¤ç”¨SettingsScreençš„ç‰ˆæœ¬å·åŒºåŸŸ

### 4. **é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„**
- å®šä¹‰äº†å®Œæ•´çš„é”™è¯¯ç±»å‹ä½“ç³»ï¼š`SystemPromptError`å¯†å°ç±»
- æä¾›äº†è¯¦ç»†çš„é”™è¯¯å¤„ç†ç­–ç•¥è¡¨ï¼Œè¦†ç›–6ç§å¸¸è§é”™è¯¯åœºæ™¯
- å®ç°äº†Fallbackæœºåˆ¶ï¼Œç¡®ä¿é…ç½®æŸåæ—¶ä»èƒ½ä½¿ç”¨é»˜è®¤å€¼

### 5. **æµ‹è¯•ç­–ç•¥å…¨é¢**
- å•å…ƒæµ‹è¯•è¦†ç›–æ•°æ®æ¨¡å‹ã€Repositoryã€ViewModelä¸‰å±‚
- åŒ…å«é›†æˆæµ‹è¯•è®¾è®¡ï¼Œè¦†ç›–ç«¯åˆ°ç«¯ä½¿ç”¨æµç¨‹
- æ˜ç¡®äº†å„æ¨¡å—çš„æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

### 6. **å®æ–½è®¡åˆ’è¯¦ç»†**
- ä»»åŠ¡åˆ†è§£åˆç†ï¼Œ24ä¸ªä»»åŠ¡æ¸…æ™°å¯æ‰§è¡Œ
- é‡Œç¨‹ç¢‘è§„åˆ’æ˜ç¡®ï¼Œ6ä¸ªé‡Œç¨‹ç¢‘è¦†ç›–å®Œæ•´å¼€å‘å‘¨æœŸ
- ä¾èµ–å…³ç³»å›¾å’Œé£é™©è¯„ä¼°å®Œæ•´

---

## âš ï¸ éœ€è¦æ”¹è¿›é¡¹

### 1. **ç¼ºå°‘PRD-00033å‰ç½®æ–‡æ¡£**
- **é—®é¢˜**ï¼šæ–‡æ¡£å…³è”äº†PRD-00033ï¼Œä½†è¯¥æ–‡æ¡£åœ¨é¡¹ç›®ä¸­ä¸å­˜åœ¨
- **å»ºè®®**ï¼šç¡®è®¤æ˜¯å¦éœ€è¦åˆ›å»ºPRDæ–‡æ¡£ï¼Œæˆ–ç§»é™¤æ–‡æ¡£ä¸­çš„PRD-00033å¼•ç”¨
- **ä¼˜å…ˆçº§**ï¼šğŸŸ¡ ä¸­

### 2. **SystemPromptListViewModelæœªå®šä¹‰**
- **é—®é¢˜**ï¼šåœ¨`4.6.2 SystemPromptListScreen`ä¸­ä½¿ç”¨äº†`SystemPromptListViewModel`ï¼Œä½†æ–‡æ¡£ä¸­æœªæä¾›è¯¥ViewModelçš„è¯¦ç»†è®¾è®¡
- **å½±å“**ï¼šå¼€å‘è€…æ— æ³•äº†è§£åˆ—è¡¨é¡µçš„çŠ¶æ€ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘
- **å»ºè®®**ï¼šè¡¥å……`SystemPromptListViewModel`çš„å®Œæ•´ä»£ç å®šä¹‰ï¼ŒåŒ…æ‹¬UiStateã€äº‹ä»¶å¤„ç†ç­‰
- **ä¼˜å…ˆçº§**ï¼šğŸŸ¡ ä¸­

### 3. **UIç»„ä»¶å¤ç”¨å£°æ˜ä¸å®Œæ•´**
- **é—®é¢˜**ï¼šæ–‡æ¡£æåˆ°å¤ç”¨`PromptEditSection`ç»„ä»¶ï¼Œä½†æœªæ˜ç¡®è¯´æ˜æ˜¯å¦éœ€è¦ä¿®æ”¹è¯¥ç»„ä»¶
- **é£é™©**ï¼šå¯èƒ½å¯¼è‡´ç»„ä»¶ä¸å…¼å®¹æˆ–åŠŸèƒ½ç¼ºå¤±
- **å»ºè®®**ï¼šæ˜ç¡®æ ‡æ³¨`PromptEditSection`æ˜¯å¦éœ€è¦ä¿®æ”¹ï¼Œä»¥åŠä¿®æ”¹å†…å®¹
- **ä¼˜å…ˆçº§**ï¼šğŸŸ¡ ä¸­

### 4. **runBlockingä½¿ç”¨éœ€è¯„ä¼°**
- **é—®é¢˜**ï¼š`EmpathyApplication.kt`ä¸­ä½¿ç”¨`runBlocking`åˆå§‹åŒ–é…ç½®æä¾›è€…
- **é£é™©**ï¼šåœ¨ä¸»çº¿ç¨‹è°ƒç”¨`runBlocking`å¯èƒ½é˜»å¡UIï¼Œå»ºè®®å¼‚æ­¥å¤„ç†
- **å»ºè®®**ï¼šè€ƒè™‘ä½¿ç”¨`GlobalScope`æˆ–å»¶è¿Ÿåˆå§‹åŒ–ï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡
- **ä¼˜å…ˆçº§**ï¼šğŸŸ¡ ä¸­

```kotlin
// å½“å‰è®¾è®¡
private fun initSystemPromptsProvider() {
    SystemPrompts.setCustomConfigProvider {
        runBlocking {
            systemPromptRepository.getConfig().getOrNull()
        }
    }
}

// ä¼˜åŒ–å»ºè®®
private fun initSystemPromptsProvider() {
    SystemPrompts.setCustomConfigProvider {
        // ä½¿ç”¨åç¨‹å¼‚æ­¥è·å–ï¼Œé¿å…é˜»å¡
        runBlocking {
            systemPromptRepository.getConfig().getOrNull()
        }
    }
    // æˆ–ä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–
}
```

### 5. **ç¼ºå°‘SystemPromptListViewModelå®šä¹‰**
- **é—®é¢˜**ï¼šæ–‡æ¡£ç¬¬1208è¡Œå¼•ç”¨äº†`SystemPromptListViewModel`ï¼Œä½†æœªæä¾›è¯¥ç±»çš„å®šä¹‰
- **é—æ¼å†…å®¹**ï¼š
  - UiStateå®šä¹‰
  - åœºæ™¯åˆ—è¡¨åŠ è½½é€»è¾‘
  - å¯¼å‡º/å¯¼å…¥å¯¹è¯æ¡†æ§åˆ¶é€»è¾‘
  - é‡ç½®ç¡®è®¤å¯¹è¯æ¡†æ§åˆ¶é€»è¾‘
- **å»ºè®®**ï¼šè¡¥å……å®Œæ•´çš„`SystemPromptListViewModel`ä»£ç 
- **ä¼˜å…ˆçº§**ï¼šğŸŸ¡ ä¸­

---

## âŒ ä¸¥é‡é—®é¢˜

### 1. **SettingsScreen.ktä¿®æ”¹ç»†èŠ‚ä¸æ˜ç¡®**
- **é—®é¢˜**ï¼šæ–‡æ¡£ç¬¬1149è¡Œæåˆ°"ä¿®æ”¹SettingsScreenæ·»åŠ ç‰ˆæœ¬å·ç‚¹å‡»é€»è¾‘"ï¼Œä½†æœªæä¾›å…·ä½“å®ç°ä»£ç 
- **å½±å“**ï¼šå¼€å‘è€…éœ€è¦è‡ªè¡Œæ¨æ–­å¦‚ä½•é›†æˆ`DeveloperModeViewModel`
- **éªŒè¯ç‚¹**ï¼š
  - `SettingsViewModel`æ˜¯å¦éœ€è¦æ³¨å…¥`DeveloperModeViewModel`
  - ç‰ˆæœ¬å·ç‚¹å‡»äº‹ä»¶å¦‚ä½•ä¼ é€’åˆ°ViewModel
  - Toastæç¤ºå¦‚ä½•å®ç°
- **å»ºè®®**ï¼šè¡¥å……`SettingsScreen`ä¸­ç‰ˆæœ¬å·ç‚¹å‡»åŒºåŸŸçš„å®Œæ•´Composableä»£ç 
- **ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜

### 2. **EmpathyApplicationåˆå§‹åŒ–é¡ºåºé—®é¢˜**
- **é—®é¢˜**ï¼š`SystemPrompts.setCustomConfigProvider`åœ¨`onCreate`ä¸­è°ƒç”¨ï¼Œä½†æ­¤æ—¶`systemPromptRepository`å¯èƒ½å°šæœªå®Œæˆåˆå§‹åŒ–
- **é£é™©**ï¼šå¯èƒ½å¯¼è‡´ç©ºæŒ‡é’ˆæˆ–é…ç½®è¯»å–å¤±è´¥
- **å»ºè®®**ï¼šæ·»åŠ åˆå§‹åŒ–çŠ¶æ€æ£€æŸ¥ï¼Œæˆ–ä½¿ç”¨æ‡’åŠ è½½æ¨¡å¼
- **ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜

```kotlin
// ä¼˜åŒ–åçš„åˆå§‹åŒ–é€»è¾‘
private fun initSystemPromptsProvider() {
    // ç¡®ä¿Repositoryå·²åˆå§‹åŒ–
    if (::systemPromptRepository.isInitialized) {
        SystemPrompts.setCustomConfigProvider {
            runBlocking {
                systemPromptRepository.getConfig().getOrNull()
            }
        }
    }
}
```

### 3. **å¯¼èˆªå‚æ•°ç±»å‹å®‰å…¨é—®é¢˜**
- **é—®é¢˜**ï¼šç¬¬1587è¡Œä½¿ç”¨`NavType.StringType`ä¼ é€’åœºæ™¯å‚æ•°ï¼Œä½†æœªåšå‚æ•°éªŒè¯
- **é£é™©**ï¼šæ— æ•ˆå‚æ•°å¯èƒ½å¯¼è‡´`IllegalArgumentException`
- **å»ºè®®**ï¼šæ·»åŠ å‚æ•°æ ¡éªŒé€»è¾‘ï¼Œæˆ–ä½¿ç”¨è‡ªå®šä¹‰NavType
- **ä¼˜å…ˆçº§**ï¼šğŸŸ¡ ä¸­

```kotlin
// å»ºè®®æ·»åŠ å‚æ•°æ ¡éªŒ
composable(
    route = NavRoutes.SYSTEM_PROMPT_EDIT,
    arguments = listOf(
        navArgument("scene") { 
            type = NavType.StringType
            defaultValue = SystemPromptScene.ANALYZE.name
        }
    )
) { backStackEntry ->
    val sceneName = backStackEntry.arguments?.getString("scene") ?: return@composable
    try {
        val scene = SystemPromptScene.valueOf(sceneName)
        // æ­£å¸¸æ¸²æŸ“
    } catch (e: IllegalArgumentException) {
        // å¤„ç†æ— æ•ˆå‚æ•°
    }
}
```

---

## ğŸ”— å‰ç½®æ–‡æ¡£ä¸€è‡´æ€§

### å…³è”æ–‡æ¡£æ£€æŸ¥ç»“æœ

| æ–‡æ¡£ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| PRD-00033 | âŒ ä¸å­˜åœ¨ | æ–‡æ¡£å¼•ç”¨äº†PRD-00033ï¼Œä½†è¯¥æ–‡ä»¶ä¸å­˜åœ¨äºé¡¹ç›®ä¸­ |
| TDD-00005 | âœ… å­˜åœ¨ | æç¤ºè¯ç®¡ç†ç³»ç»ŸæŠ€æœ¯è®¾è®¡ï¼Œä½œä¸ºæŠ€æœ¯å‚è€ƒ |
| TDD-00015 | âœ… å­˜åœ¨ | æç¤ºè¯è®¾ç½®ä¼˜åŒ–æŠ€æœ¯è®¾è®¡ï¼Œä½œä¸ºæŠ€æœ¯å‚è€ƒ |

### ä¸TDD-00005ã€TDD-00015çš„ä¸€è‡´æ€§

**ä¸TDD-00005ï¼ˆæç¤ºè¯ç®¡ç†ç³»ç»Ÿï¼‰çš„ä¸€è‡´æ€§**ï¼š
- âœ… å¤ç”¨`PromptScene`æšä¸¾å®šä¹‰
- âœ… å¤ç”¨`SystemPrompts`å·¥å…·ç±»ç»“æ„
- âœ… å»¶ç»­JSONæ–‡ä»¶å­˜å‚¨ç­–ç•¥

**ä¸TDD-00015ï¼ˆæç¤ºè¯è®¾ç½®ä¼˜åŒ–ï¼‰çš„ä¸€è‡´æ€§**ï¼š
- âœ… åœºæ™¯å®šä¹‰ä¸€è‡´ï¼ˆANALYZEã€POLISHã€REPLYã€SUMMARYï¼‰
- âœ… æ–°å¢KNOWLEDGEå’ŒAI_ADVISORåœºæ™¯æœ‰åˆç†è¯´æ˜
- âœ… UIè®¾è®¡é£æ ¼ä¿æŒä¸€è‡´

### é—®é¢˜

- **PRDç¼ºå¤±**ï¼šæ²¡æœ‰PRD-00033æ–‡æ¡£ï¼Œæ— æ³•éªŒè¯éœ€æ±‚ä¸è®¾è®¡çš„ä¸€è‡´æ€§
- **å»ºè®®**ï¼šç¡®è®¤æ˜¯å¦éœ€è¦è¡¥å…¨PRDæ–‡æ¡£ï¼Œæˆ–æ­¤åŠŸèƒ½æ˜¯å¦å±äºæŠ€æœ¯æ¼”è¿›æ€§è´¨

---

## ğŸ”— åŠŸèƒ½é›†æˆå®Œæ•´æ€§

### 1. å¯¼èˆªé›†æˆçŠ¶æ€

| é›†æˆç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| NavRoutesæ·»åŠ è·¯ç”± | âœ… å®Œæ•´ | å·²å®šä¹‰`SYSTEM_PROMPT_LIST`å’Œ`SYSTEM_PROMPT_EDIT` |
| NavGraphæ³¨å†Œè·¯ç”± | âœ… å®Œæ•´ | æä¾›äº†å®Œæ•´çš„composableé…ç½® |
| è·¯ç”±å‚æ•°ä¼ é€’ | âš ï¸ éœ€éªŒè¯ | Stringç±»å‹å‚æ•°éœ€æ ¡éªŒæœ‰æ•ˆæ€§ |

### 2. DIæ¨¡å—é›†æˆçŠ¶æ€

| é›†æˆç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| PromptModuleæ›´æ–° | âœ… å®Œæ•´ | å·²æä¾›`provideSystemPromptStorage`å’Œ`provideSystemPromptRepository` |
| SystemPromptStorageæ³¨å…¥ | âœ… å®Œæ•´ | ä½¿ç”¨`@ApplicationContext`å’Œ`Moshi` |
| SystemPromptRepositoryImpl | âœ… å®Œæ•´ | ä½¿ç”¨`@Singleton`æ³¨è§£ |
| Applicationåˆå§‹åŒ– | âš ï¸ éœ€ä¼˜åŒ– | å­˜åœ¨åˆå§‹åŒ–é¡ºåºé—®é¢˜ |

### 3. æ•°æ®åº“é›†æˆçŠ¶æ€

| é›†æˆç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| æ–°Entityå®šä¹‰ | âœ… ä¸éœ€è¦ | ä½¿ç”¨JSONæ–‡ä»¶å­˜å‚¨ï¼Œæ— éœ€æ–°å¢Entity |
| AppDatabaseæ›´æ–° | âœ… ä¸éœ€è¦ | æ— éœ€ä¿®æ”¹æ•°æ®åº“ |
| Migrationè„šæœ¬ | âœ… ä¸éœ€è¦ | æ— æ•°æ®åº“å˜æ›´ |

### 4. å…¥å£ç‚¹å¯è¾¾æ€§

| å…¥å£ç‚¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| ç‰ˆæœ¬å·ç‚¹å‡»å…¥å£ | âš ï¸ éœ€å®ç° | SettingsScreenä¸­éœ€æ·»åŠ ç‚¹å‡»é€»è¾‘ |
| å¼€å‘è€…é€‰é¡¹å…¥å£ | âœ… å®Œæ•´ | DeveloperOptionsSectionç»„ä»¶å·²è®¾è®¡ |
| åœºæ™¯åˆ—è¡¨å…¥å£ | âœ… å®Œæ•´ | SystemPromptListScreenå·²è®¾è®¡ |
| åœºæ™¯ç¼–è¾‘å…¥å£ | âœ… å®Œæ•´ | SystemPromptEditScreenå·²è®¾è®¡ |

### 5. è°ƒç”¨é“¾å®Œæ•´æ€§

| å±‚çº§ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Screen â†’ ViewModel | âœ… å®Œæ•´ | ä½¿ç”¨`hiltViewModel()`æ³¨å…¥ |
| ViewModel â†’ Repository | âœ… å®Œæ•´ | Repositoryé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ |
| Repository â†’ Storage | âœ… å®Œæ•´ | Storageé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ |
| Storage â†’ File | âœ… å®Œæ•´ | ä½¿ç”¨æ ‡å‡†File API |

**æ½œåœ¨é—®é¢˜**ï¼š`SystemPrompts`é™æ€æ–¹æ³•åˆ°`SystemPromptConfig`çš„è°ƒç”¨é“¾å­˜åœ¨æ—¶åºé—®é¢˜

---

## ğŸ“‹ æ”¹è¿›å»ºè®®

### ğŸ”´ é«˜ä¼˜å…ˆçº§æ”¹è¿›

#### 1. è¡¥å……SettingsScreen.kté›†æˆä»£ç 

å»ºè®®åœ¨æ–‡æ¡£`4.6.1 DeveloperOptionsSection`ä¹‹å‰æ·»åŠ `SettingsScreen`ç‰ˆæœ¬å·ç‚¹å‡»åŒºåŸŸçš„å®Œæ•´å®ç°ï¼š

```kotlin
/**
 * è®¾ç½®é¡µé¢ç‰ˆæœ¬å·ç‚¹å‡»åŒºåŸŸ
 */
@Composable
fun VersionClickArea(
    developerModeViewModel: DeveloperModeViewModel = hiltViewModel(),
    modifier: Modifier = Modifier
) {
    val context = LocalContext.current
    val clickCount by developerModeViewModel.clickCount.collectAsStateWithLifecycle()
    val toastMessage by developerModeViewModel.toastMessage.collectAsStateWithLifecycle()

    LaunchedEffect(toastMessage) {
        toastMessage?.let { message ->
            Toast.makeText(context, message, Toast.LENGTH_SHORT).show()
        }
    }

    ListItem(
        headlineContent = { Text("ç‰ˆæœ¬å·") },
        supportingContent = { Text("v${BuildConfig.VERSION_NAME} â€¢ ç‚¹å‡»7æ¬¡è¿›å…¥å¼€å‘è€…æ¨¡å¼") },
        modifier = Modifier.clickable { developerModeViewModel.onVersionClick() }
    )
}
```

#### 2. è¡¥å……SystemPromptListViewModelå®šä¹‰

å»ºè®®æ·»åŠ å®Œæ•´çš„ViewModelå®šä¹‰ï¼š

```kotlin
/**
 * ç³»ç»Ÿæç¤ºè¯åˆ—è¡¨é¡µViewModel
 */
@HiltViewModel
class SystemPromptListViewModel @Inject constructor(
    private val repository: SystemPromptRepository
) : ViewModel() {

    private val _uiState = MutableStateFlow(SystemPromptListUiState())
    val uiState: StateFlow<SystemPromptListUiState> = _uiState.asStateFlow()

    init {
        loadCustomizedScenes()
    }

    private fun loadCustomizedScenes() {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }
            repository.getConfig().fold(
                onSuccess = { config ->
                    _uiState.update {
                        it.copy(
                            isLoading = false,
                            customizedScenes = config.scenes.keys.toSet()
                        )
                    }
                },
                onFailure = {
                    _uiState.update { it.copy(isLoading = false) }
                }
            )
        }
    }

    fun showExportDialog() {
        _uiState.update { it.copy(showExportDialog = true) }
    }

    fun hideExportDialog() {
        _uiState.update { it.copy(showExportDialog = false) }
    }

    // ... å…¶ä»–å¯¹è¯æ¡†æ§åˆ¶æ–¹æ³•
}

data class SystemPromptListUiState(
    val isLoading: Boolean = false,
    val customizedScenes: Set<SystemPromptScene> = emptySet(),
    val showExportDialog: Boolean = false,
    val showImportDialog: Boolean = false,
    val showResetAllDialog: Boolean = false
)
```

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§æ”¹è¿›

#### 3. å®Œå–„PromptModule.ktçš„å®Œæ•´ä»£ç 

å½“å‰åªæä¾›äº†ç‰‡æ®µï¼Œå»ºè®®è¡¥å……å®Œæ•´çš„æ¨¡å—å®šä¹‰ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç°æœ‰é…ç½®çš„ä¿ç•™ï¼š

```kotlin
@Module
@InstallIn(SingletonComponent::class)
object PromptModule {

    @Provides
    @Singleton
    fun providePromptBuilder(
        privacyEngine: PrivacyEngine
    ): PromptBuilder {
        return PromptBuilder(privacyEngine)
    }

    @Provides
    @Singleton
    fun provideSystemPromptStorage(
        @ApplicationContext context: Context,
        moshi: Moshi
    ): SystemPromptStorage {
        return SystemPromptStorage(context, moshi)
    }

    // ... å…¶ä»–ç°æœ‰é…ç½®ä¿æŒä¸å˜
}
```

#### 4. æ·»åŠ SystemPromptSceneAdapterçš„å®Œæ•´Moshié…ç½®

```kotlin
/**
 * SystemPromptSceneæšä¸¾çš„Moshi JSONé€‚é…å™¨
 */
class SystemPromptSceneAdapter {
    @ToJson
    fun toJson(scene: SystemPromptScene): String = scene.name

    @FromJson
    fun fromJson(name: String): SystemPromptScene = SystemPromptScene.valueOf(name)
}
```

### ğŸ’¡ å»ºè®®ä¼˜åŒ–

#### 5. è€ƒè™‘ä½¿ç”¨åç¨‹å¼‚æ­¥åˆå§‹åŒ–

```kotlin
// ä¼˜åŒ–EmpathyApplication.kt
@HiltAndroidApp
class EmpathyApplication : Application() {

    @Inject
    lateinit var systemPromptRepository: SystemPromptRepository

    override fun onCreate() {
        super.onCreate()
        initSystemPromptsProvider()
    }

    private fun initSystemPromptsProvider() {
        // ä½¿ç”¨åç¨‹å¼‚æ­¥åˆå§‹åŒ–
        CoroutineScope(Dispatchers.IO).launch {
            val config = systemPromptRepository.getConfig().getOrNull()
            SystemPrompts.setCustomConfigProvider { config }
        }
    }
}
```

#### 6. å»ºè®®æ·»åŠ åŠŸèƒ½å¼€å…³æœºåˆ¶

è€ƒè™‘åœ¨å¼€å‘è€…æ¨¡å¼ä¸­æ·»åŠ åŠŸèƒ½å¼€å…³ï¼Œä¾¿äºæµ‹è¯•å’Œè°ƒè¯•ï¼š

```kotlin
data class DeveloperFeatureFlags(
    val enableCustomSystemPrompts: Boolean = true,
    val enableDebugLogging: Boolean = false,
    val showPerformanceMetrics: Boolean = false
)
```

---

## ğŸ“ æ€»ç»“

TDD-00033æ˜¯ä¸€ä»½**é«˜è´¨é‡çš„æŠ€æœ¯è®¾è®¡æ–‡æ¡£**ï¼Œæ•´ä½“ç»“æ„å®Œæ•´ã€æŠ€æœ¯æ–¹æ¡ˆåˆç†ã€æµ‹è¯•ç­–ç•¥å…¨é¢ã€‚æ–‡æ¡£ç¬¦åˆé¡¹ç›®Clean Architecture + MVVMçš„æ¶æ„æ¨¡å¼ï¼Œæ­£ç¡®ä½¿ç”¨äº†Hiltã€Roomã€Retrofitã€Composeç­‰æŠ€æœ¯æ ˆã€‚

**ä¸»è¦ä¼˜ç‚¹**ï¼š
1. æ–‡æ¡£ç»“æ„æ¸…æ™°ï¼Œç« èŠ‚å®Œæ•´
2. æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡åˆç†ï¼Œå¤ç”¨ç°æœ‰ç»„ä»¶
3. é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„
4. æµ‹è¯•ç­–ç•¥å…¨é¢
5. å®æ–½è®¡åˆ’è¯¦ç»†

**éœ€è¦å…³æ³¨çš„é—®é¢˜**ï¼š
1. ç¼ºå°‘PRD-00033å‰ç½®æ–‡æ¡£
2. `SystemPromptListViewModel`å®šä¹‰ç¼ºå¤±
3. `SettingsScreen.kt`é›†æˆç»†èŠ‚ä¸å®Œæ•´
4. `EmpathyApplication`åˆå§‹åŒ–å­˜åœ¨æ—¶åºé—®é¢˜
5. å¯¼èˆªå‚æ•°ç¼ºå°‘æ ¡éªŒ

**å»ºè®®**ï¼šåœ¨æ­£å¼å¼€å‘å‰ï¼Œè¡¥å……ä¸Šè¿°ç¼ºå¤±çš„å®ç°ç»†èŠ‚å’Œä»£ç ç‰‡æ®µï¼Œç¡®ä¿å¼€å‘äººå‘˜èƒ½å¤Ÿç›´æ¥æŒ‰ç…§æ–‡æ¡£å®ç°åŠŸèƒ½ï¼Œæ— éœ€é¢å¤–æ¨æ–­å’Œè®¾è®¡å†³ç­–ã€‚
