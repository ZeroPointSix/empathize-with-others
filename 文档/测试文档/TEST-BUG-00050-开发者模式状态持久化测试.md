# TEST-BUG-00050 开发者模式状态持久化测试

## 📋 测试概述

| 属性 | 值 |
|------|-----|
| **关联Bug** | BUG-00050 |
| **测试类型** | 单元测试 + 手动验收测试 |
| **测试状态** | ✅ 单元测试通过，待手动验收 |
| **创建日期** | 2026-01-08 |

---

## 🧪 单元测试

### 测试文件
`presentation/src/test/kotlin/com/empathy/ai/presentation/viewmodel/DeveloperModeViewModelTest.kt`

### 测试用例列表

| 序号 | 测试用例 | 描述 | 状态 |
|------|---------|------|------|
| 1 | `初始化时应从Repository读取开发者模式状态` | 验证ViewModel初始化时正确读取持久化状态 | ✅ |
| 2 | `初始化时如果Repository中未解锁则开发者模式应为关闭` | 验证未解锁状态的正确处理 | ✅ |
| 3 | `初始化时如果Session已过期则开发者模式应为关闭` | 验证Session过期时状态重置 | ✅ |
| 4 | `点击版本号7次应解锁开发者模式` | 验证解锁逻辑和持久化 | ✅ |
| 5 | `点击版本号少于7次不应解锁开发者模式` | 验证解锁阈值 | ✅ |
| 6 | `点击版本号3次后应显示提示信息` | 验证提示消息 | ✅ |
| 7 | `已解锁状态下点击版本号不应有任何效果` | 验证已解锁状态的处理 | ✅ |
| 8 | `退出开发者模式应重置状态并清除持久化` | 验证退出逻辑 | ✅ |
| 9 | `解锁开发者模式后应持久化状态` | 验证持久化调用 | ✅ |
| 10 | `导航离开后返回应保持开发者模式状态` | 验证导航后状态保持 | ✅ |
| 11 | `重置点击计数应将计数归零` | 验证重置功能 | ✅ |

---

## 📱 手动验收测试

### 测试环境
- 设备：Android 真机或模拟器
- 系统版本：Android 7.0+ (API 24+)
- 应用版本：Debug APK

### 测试步骤

#### 场景1：导航后状态保持

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 打开应用，进入设置页面 | 设置页面正常显示 |
| 2 | 连续点击版本号7次 | 显示"已进入开发者模式"提示 |
| 3 | 确认开发者选项显示 | 显示"系统提示词管理"等开发者选项 |
| 4 | 点击底部导航"联系人" | 进入联系人列表页面 |
| 5 | 点击底部导航"设置" | 返回设置页面 |
| 6 | 检查开发者选项 | **开发者选项仍然显示** |

#### 场景2：导航到AI军师后状态保持

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 确保开发者模式已激活 | 开发者选项显示 |
| 2 | 点击底部导航"AI军师" | 进入AI军师页面 |
| 3 | 点击底部导航"设置" | 返回设置页面 |
| 4 | 检查开发者选项 | **开发者选项仍然显示** |

#### 场景3：应用重启后状态重置

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 确保开发者模式已激活 | 开发者选项显示 |
| 2 | 完全关闭应用（从最近任务中移除） | 应用关闭 |
| 3 | 重新打开应用，进入设置页面 | 设置页面正常显示 |
| 4 | 检查开发者选项 | **开发者选项不显示**（已重置） |

#### 场景4：多次导航后状态保持

| 步骤 | 操作 | 预期结果 |
|------|------|---------|
| 1 | 激活开发者模式 | 开发者选项显示 |
| 2 | 导航到联系人 → AI军师 → 设置 | 多次导航 |
| 3 | 检查开发者选项 | **开发者选项仍然显示** |
| 4 | 进入系统提示词管理 | 正常进入 |
| 5 | 返回设置页面 | 开发者选项仍然显示 |

---

## 🔧 运行测试命令

### 运行单元测试
```bash
.\gradlew :presentation:testDebugUnitTest --tests "com.empathy.ai.presentation.viewmodel.DeveloperModeViewModelTest"
```

### 构建Debug APK进行手动测试
```bash
.\gradlew assembleDebug
```

APK位置：`app/build/outputs/apk/debug/app-debug.apk`

---

## ✅ 测试结果

### 单元测试
- **状态**：✅ 全部通过
- **测试数量**：11个
- **覆盖率**：DeveloperModeViewModel 核心逻辑 100%

### 手动验收测试
- **状态**：⏳ 待执行
- **执行人**：待分配
- **执行日期**：待定

---

**文档版本**: 1.0
**最后更新**: 2026-01-08
