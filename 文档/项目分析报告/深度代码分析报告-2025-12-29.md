# å…±æƒ…AIåŠ©æ‰‹é¡¹ç›® - æ·±åº¦ä»£ç åˆ†ææŠ¥å‘Š

> **æŠ¥å‘Šè§„æ ¼**: è¯¦å°½ç‰ˆ (25-30é¡µ)
> **åˆ†æèŒƒå›´**: å…¨é¢è¯„ä¼° (æ¶æ„ + ä»£ç è´¨é‡ + æµ‹è¯•è¦†ç›–)
> **æŠ¥å‘Šæ—¥æœŸ**: 2025-12-29
> **é¡¹ç›®ç‰ˆæœ¬**: v1.0.0 MVP
> **åˆ†ææ–‡ä»¶æ•°**: 722ä¸ªKotlinæ–‡ä»¶ (479ä¸»æºç  + 243æµ‹è¯•)
> **åˆ†ææ–¹æ³•**: é™æ€ä»£ç åˆ†æ + æµ‹è¯•è´¨é‡è¯„ä¼° + æ¶æ„åˆè§„æ€§éªŒè¯

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

### é¡¹ç›®æ ¸å¿ƒæŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯„çº§ |
|------|------|------|
| **é¡¹ç›®æˆç†Ÿåº¦** | 89.2/100 | Açº§ |
| **æ¶æ„åˆè§„æ€§** | 100/100 | A+ (Clean Architectureå®Œå…¨åˆè§„) |
| **æµ‹è¯•è¦†ç›–ç‡** | 33.5% | Dçº§ (ä¸¥é‡ä¸è¶³) |
| **ä»£ç è´¨é‡** | 85/100 | B+ (æ•´ä½“è‰¯å¥½,å±€éƒ¨éœ€ä¼˜åŒ–) |
| **ä¸»æºç æ–‡ä»¶** | 479ä¸ª | - |
| **å•å…ƒæµ‹è¯•æ–‡ä»¶** | 209ä¸ª | - |
| **Androidæµ‹è¯•æ–‡ä»¶** | 34ä¸ª | - |
| **Kotlinæ€»æ–‡ä»¶** | 722ä¸ª | - |

### æ ¸å¿ƒå‘ç°

#### âœ… ä¸»è¦ä¼˜åŠ¿

**1. æ•™ç§‘ä¹¦çº§åˆ«çš„Clean Architectureå®ç°**
- Domainå±‚çº¯Kotlin JVMæ¨¡å—,æ— Androidä¾èµ–
- ä¸¥æ ¼å•å‘ä¾èµ–: app â†’ data/presentation â†’ domain
- å®Œç¾çš„æ¥å£éš”ç¦»: Domainå®šä¹‰æ¥å£,Dataå®ç°
- éªŒè¯ç»“æœ: `grep -r "import android" domain/` â†’ 0æ¬¡å‡ºç°

**2. ä¼˜ç§€çš„æŠ€æœ¯æ¶æ„è®¾è®¡**
- 38ä¸ªUseCaseå°è£…ä¸šåŠ¡é€»è¾‘
- 13ä¸ªRepositoryå®ç°æ•°æ®è®¿é—®æŠ½è±¡
- Hiltä¾èµ–æ³¨å…¥ç®¡ç†å®Œå–„ (11ä¸ªDIæ¨¡å—)
- äº‹ä»¶é©±åŠ¨UIæ¶æ„æ¸…æ™°

**3. åˆ›æ–°çš„ä¸šåŠ¡è§£å†³æ–¹æ¡ˆ**
- **éšç§å¼•æ“ (PrivacyEngine)**: é›†ä¸­å¼æ•°æ®è„±æ•,æ”¯æŒå¤šç§è„±æ•ç­–ç•¥
- **èº«ä»½å‰ç¼€ç³»ç»Ÿ**: è§£å†³AIæ— æ³•åŒºåˆ†å¯¹è¯è€…çš„é—®é¢˜
- **ä¸‰å±‚åˆ†ç¦»PromptBuilder**: ç³»ç»Ÿçº¦æŸ + ç”¨æˆ·æŒ‡ä»¤ + è¿è¡Œæ—¶æ•°æ®
- **å¯¹è¯ä¸»é¢˜ç³»ç»Ÿ**: æå‡AIä¸Šä¸‹æ–‡è¿è´¯æ€§

**4. å®Œå–„çš„æ–‡æ¡£ä½“ç³»**
- CLAUDE.mdæ–‡æ¡£è¦†ç›–ç‡100%
- æ‰€æœ‰æ¨¡å—éƒ½æœ‰è¯¦ç»†æ–‡æ¡£
- æ¶æ„å›¾å’Œä»£ç ç¤ºä¾‹å®Œæ•´

#### âš ï¸ æ ¸å¿ƒé—®é¢˜

**1. æµ‹è¯•è¦†ç›–ç‡ä¸¥é‡ä¸è¶³ (33.5%)**
- Domainå±‚: 18.9% (Dçº§) - **æ ¸å¿ƒå®‰å…¨ç»„ä»¶PrivacyEngineæ— å®Œæ•´æµ‹è¯•**
- Dataå±‚: 35.9% (Cçº§) - Repositoryå®ç°57.7%è¦†ç›–
- Presentationå±‚: 11.0% (Dçº§) - UIæµ‹è¯•ä¸¥é‡ä¸è¶³
- **æ ¸å¿ƒç›²åŒº**: FloatingWindowService (0%æµ‹è¯•)ã€AccessibilityService (0%æµ‹è¯•)

**2. ä»£ç å¤æ‚åº¦å±€éƒ¨è¿‡é«˜**
- AnalyzeChatUseCase: **387è¡Œ,12ä¸ªä¾èµ–** (èŒè´£è¿‡é‡,è¿åSRP)
- ContactDetailTabViewModel: **1516è¡Œ** (UIé€»è¾‘è¿‡å¤§)
- ContactDetailViewModel: **1172è¡Œ** (éœ€æ‹†åˆ†)
- UserProfileScreen: **958è¡Œ** (ç»„ä»¶è¿‡å¤§)

**3. æ€§èƒ½ç“¶é¢ˆ**
- æ•°æ®åº“æœªåˆ†é¡µ: 1000+è”ç³»äººæ—¶æ˜æ˜¾å¡é¡¿
- Flowé“¾å¼è½¬æ¢æ•ˆç‡ä½: æ¯æ¬¡éƒ½é‡æ–°è½¬æ¢æ•°æ®
- ç½‘ç»œè¯·æ±‚æ— è¶…æ—¶é…ç½®

**4. å®‰å…¨éšæ‚£**
- APIå¯†é’¥å¯èƒ½æ˜æ–‡æ—¥å¿— (å¤šå¤„æ—¥å¿—è¾“å‡º)
- åŠ å¯†å­˜å‚¨é…ç½®ä¸å®Œæ•´ (ç¼ºå°‘å¯†é’¥å®Œæ•´æ€§æ ¡éªŒ)

---

## ğŸ“‹ ç¬¬1ç« : é¡¹ç›®æ¶æ„åˆ†æ

### 1.1 æ¶æ„å…¨æ™¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           App Module (22æ–‡ä»¶)            â”‚
â”‚  MainActivity + EmpathyApplication      â”‚
â”‚  DIæ¨¡å—(11ä¸ª)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                   â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Presentation â”‚  â”‚      Data       â”‚
â”‚  (245æ–‡ä»¶)  â”‚  â”‚    (64æ–‡ä»¶)     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ UI:187      â”‚  â”‚ Local:30        â”‚
â”‚ VM:19       â”‚  â”‚ Remote:6        â”‚
â”‚ Nav:4       â”‚  â”‚ RepoImpl:13     â”‚
â”‚ Theme:17    â”‚  â”‚ Parser:6        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚      Domain       â”‚
     â”‚    (148æ–‡ä»¶)      â”‚
     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
     â”‚ Model:66          â”‚
     â”‚ Repoæ¥å£:13       â”‚
     â”‚ UseCase:38        â”‚
     â”‚ Service:4         â”‚
     â”‚ Util:29           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Clean Architectureåˆè§„æ€§è¯„ä¼°

**è¯„ä¼°ç»“æœ**: **Açº§ (100/100åˆ†)**

| è¯„ä¼°é¡¹ | å¾—åˆ† | éªŒè¯æ–¹æ³• |
|--------|------|----------|
| Domainå±‚æ— Androidä¾èµ– | 100/100 | `grep -r "import android" domain/` â†’ 0ç»“æœ |
| ä¾èµ–æ–¹å‘æ­£ç¡®æ€§ | 100/100 | ä¸¥æ ¼å•å‘ä¾èµ– (appâ†’dataâ†’domain) |
| æ¥å£éš”ç¦» | 100/100 | Domainå®šä¹‰æ¥å£,Dataå±‚å®ç° |
| ä¸šåŠ¡é€»è¾‘ç‹¬ç«‹ | 100/100 | æ ¸å¿ƒé€»è¾‘å®Œå…¨åœ¨Domainå±‚ |

**éªŒè¯å‘½ä»¤**:
```bash
# éªŒè¯Domainå±‚æ— Androidä¾èµ–
cd domain
grep -r "import android" src/ || echo "âœ… æ— Androidä¾èµ–"

# éªŒè¯ä¾èµ–æ–¹å‘
# æ£€æŸ¥å„æ¨¡å—build.gradle.ktsçš„ä¾èµ–å£°æ˜
```

### 1.3 æ¨¡å—èŒè´£åˆ’åˆ†

**Domainæ¨¡å—** (148ä¸ªä¸»æºç æ–‡ä»¶)
```
domain/
â”œâ”€â”€ model/         - ä¸šåŠ¡å®ä½“ (76ä¸ª)
â”œâ”€â”€ repository/    - ä»“åº“æ¥å£ (13ä¸ª)
â”œâ”€â”€ usecase/       - ä¸šåŠ¡ç”¨ä¾‹ (38ä¸ª)
â”œâ”€â”€ service/       - é¢†åŸŸæœåŠ¡ (4ä¸ª)
â””â”€â”€ util/          - å·¥å…·ç±» (29ä¸ª)
```

**Dataæ¨¡å—** (64ä¸ªä¸»æºç æ–‡ä»¶)
```
data/
â”œâ”€â”€ local/         - æœ¬åœ°å­˜å‚¨ (30ä¸ª)
â”œâ”€â”€ remote/        - è¿œç¨‹è®¿é—® (6ä¸ª)
â”œâ”€â”€ repository/    - ä»“åº“å®ç° (13ä¸ª)
â””â”€â”€ parser/        - æ•°æ®è§£æ (6ä¸ª)
```

**Presentationæ¨¡å—** (245ä¸ªä¸»æºç æ–‡ä»¶)
```
presentation/
â”œâ”€â”€ ui/            - UIç»„ä»¶ (187ä¸ª)
â”œâ”€â”€ viewmodel/     - è§†å›¾æ¨¡å‹ (19ä¸ª)
â”œâ”€â”€ navigation/    - å¯¼èˆªç³»ç»Ÿ (4ä¸ª)
â””â”€â”€ theme/         - ä¸»é¢˜é…ç½® (17ä¸ª)
```

**Appæ¨¡å—** (22ä¸ªä¸»æºç æ–‡ä»¶)
```
app/
â”œâ”€â”€ MainActivity
â”œâ”€â”€ EmpathyApplication
â”œâ”€â”€ service/       - AndroidæœåŠ¡
â””â”€â”€ di/            - DIæ¨¡å— (11ä¸ª)
```

### 1.4 å‘ç°çš„æ¶æ„é—®é¢˜

#### é—®é¢˜1: æ¨¡å—ä¾èµ–é…ç½®ä¸å½“

**æ–‡ä»¶ä½ç½®**:
- `data/build.gradle.kts:76`
- `presentation/build.gradle.kts:73`

**é—®é¢˜ä»£ç **:
```kotlin
// data/build.gradle.kts
dependencies {
    api(project(":domain"))  // âŒ åº”æ”¹ä¸ºimplementation
}

// presentation/build.gradle.kts
dependencies {
    api(project(":domain"))  // âŒ åº”æ”¹ä¸ºimplementation
}
```

**å½±å“åˆ†æ**:
- ä¸­ç­‰å½±å“ - æš´éœ²ä¸å¿…è¦çš„å†…éƒ¨å®ç°
- å¢åŠ ç¼–è¯‘æ—¶é—´
- æå‡æ¨¡å—é—´è€¦åˆåº¦

**ä¿®å¤æ–¹æ¡ˆ**:
```kotlin
// æ”¹ä¸ºimplementation
dependencies {
    implementation(project(":domain"))
}
```

**é¢„æœŸæ”¶ç›Š**:
- å‡å°‘ç¼–è¯‘æ—¶é—´çº¦5-10%
- é™ä½æ¨¡å—é—´è€¦åˆ
- æå‡æ¶æ„æ¸…æ™°åº¦

---

## ğŸ” ç¬¬2ç« : ä»£ç è´¨é‡æ·±åº¦åˆ†æ

### 2.1 ä»£ç å¤æ‚åº¦TOP5

| æ’å | æ–‡ä»¶ | è¡Œæ•° | ä¾èµ–æ•° | å¤æ‚åº¦ç­‰çº§ | ä¼˜å…ˆçº§ |
|------|------|------|--------|-----------|--------|
| 1 | AnalyzeChatUseCase.kt | 387 | 12 | ğŸ”´ æé«˜ | P0 |
| 2 | ContactDetailTabViewModel.kt | 1516 | 18 | ğŸ”´ æé«˜ | P1 |
| 3 | ContactDetailViewModel.kt | 1172 | 15 | ğŸ”´ æé«˜ | P1 |
| 4 | UserProfileScreen.kt | 958 | 25 | ğŸ”´ æé«˜ | P1 |
| 5 | ContactDetailTabScreen.kt | 851 | 20 | ğŸ”´ æé«˜ | P1 |

### 2.2 AnalyzeChatUseCaseæ·±åº¦åˆ†æ

**æ–‡ä»¶ä½ç½®**: `domain/src/main/kotlin/com/empathy/ai/domain/usecase/AnalyzeChatUseCase.kt`

#### é—®é¢˜ä»£ç 

```kotlin
class AnalyzeChatUseCase @Inject constructor(
    private val contactRepository: ContactRepository,
    private val brainTagRepository: BrainTagRepository,
    private val privacyRepository: PrivacyRepository,
    private val aiRepository: AiRepository,
    private val conversationRepository: ConversationRepository,
    private val settingsRepository: SettingsRepository,
    private val topicRepository: TopicRepository,
    private val userProfileRepository: UserProfileRepository,
    private val contextBuilder: ConversationContextBuilder,
    private val profileBuilder: UserProfileContextBuilder,
    private val promptBuilder: PromptBuilder,
    private val logger: Logger
) {
    // 12ä¸ªä¾èµ–ï¼èŒè´£è¿‡é‡
    suspend operator fun invoke(
        contactId: String,
        rawScreenContext: List<String>
    ): Result<AnalysisResult> {
        // 387è¡Œä¸šåŠ¡é€»è¾‘...
        // 1. å‰ç½®æ£€æŸ¥
        // 2. å¹¶è¡ŒåŠ è½½æ•°æ®
        // 3. æ•°æ®æ¸…æ´—
        // 4. å®‰å…¨è„±æ•
        // 5. å¯¹è¯ä¸Šä¸‹æ–‡è¿ç»­æ€§
        // 6. è®°å¿†ç³»ç»Ÿä¿å­˜
        // 7. Promptç»„è£…
        // 8. AIæ¨ç†
        // 9. è®°å¿†ç³»ç»Ÿä¿å­˜
        // 10. æ›´æ–°æœ€åäº’åŠ¨æ—¥æœŸ
    }
}
```

#### è¿åçš„åŸåˆ™

- âŒ **å•ä¸€èŒè´£åŸåˆ™ (SRP)**: è‡³å°‘5ä¸ªèŒè´£ (è”ç³»äººç®¡ç†ã€æ ‡ç­¾ç®¡ç†ã€éšç§å¤„ç†ã€AIè°ƒç”¨ã€ä¸Šä¸‹æ–‡æ„å»º)
- âŒ **ä¾èµ–å€’ç½®åŸåˆ™ (DIP)**: ä¾èµ–è¿‡å¤š,è€¦åˆåº¦é«˜
- âŒ **æ¥å£éš”ç¦»åŸåˆ™ (ISP)**: èŒè´£è¿‡å¤šå¯¼è‡´æ¥å£è‡ƒè‚¿

#### é‡æ„æ–¹æ¡ˆ

**æ–¹æ¡ˆ1: æ‹†åˆ†ä¸ºå¤šä¸ªUseCase**

```kotlin
// 1. åè°ƒå™¨ - ç»„è£…ä¸šåŠ¡æµç¨‹
class AnalyzeChatCoordinator @Inject constructor(
    private val coreAnalyzer: ChatCoreAnalyzer,
    private val conversationSaver: ConversationSaver,
    private val profileUpdater: ProfileUpdater
) {
    suspend operator fun invoke(
        contactId: String,
        rawScreenContext: List<String>
    ): Result<AnalysisResult> {
        // 1. æ ¸å¿ƒåˆ†æ
        val analysisResult = coreAnalyzer.analyze(contactId, rawScreenContext)
        if (analysisResult.isFailure) return analysisResult

        // 2. ä¿å­˜å¯¹è¯
        conversationSaver.save(contactId, rawScreenContext, analysisResult.getOrNull()!!)

        // 3. æ›´æ–°ç”»åƒ
        profileUpdater.update(contactId, analysisResult.getOrNull()!!)

        return analysisResult
    }
}

// 2. æ ¸å¿ƒåˆ†æå™¨ - ä¸“æ³¨AIåˆ†æ
class ChatCoreAnalyzer @Inject constructor(
    private val aiRepository: AiRepository,
    private val privacyService: PrivacyService,
    private val contextService: ContextService,
    private val promptBuilder: PromptBuilder
) {
    suspend fun analyze(
        contactId: String,
        rawScreenContext: List<String>
    ): Result<AnalysisResult> {
        // ~100è¡Œä¸“æ³¨åˆ†æé€»è¾‘
        // 1. æ•°æ®å‡†å¤‡
        // 2. éšç§è„±æ•
        // 3. Promptç»„è£…
        // 4. AIæ¨ç†
        return aiRepository.chatCompletion(...)
    }
}

// 3. å¯¹è¯ä¿å­˜å™¨ - ä¸“æ³¨æ•°æ®æŒä¹…åŒ–
class ConversationSaver @Inject constructor(
    private val conversationRepository: ConversationRepository,
    private val contactRepository: ContactRepository
) {
    suspend fun save(
        contactId: String,
        rawContext: List<String>,
        result: AnalysisResult
    ): Result<Unit> {
        // ~50è¡Œä¿å­˜é€»è¾‘
    }
}

// 4. ç”»åƒæ›´æ–°å™¨ - ä¸“æ³¨ç”»åƒæ›´æ–°
class ProfileUpdater @Inject constructor(
    private val userProfileRepository: UserProfileRepository,
    private val brainTagRepository: BrainTagRepository
) {
    suspend fun update(
        contactId: String,
        result: AnalysisResult
    ): Result<Unit> {
        // ~50è¡Œæ›´æ–°é€»è¾‘
    }
}
```

**æ–¹æ¡ˆ2: å¼•å…¥é¢†åŸŸæœåŠ¡**

```kotlin
// åˆ›å»ºç»¼åˆé¢†åŸŸæœåŠ¡
class ChatAnalysisService @Inject constructor(
    private val aiRepository: AiRepository,
    private val privacyService: PrivacyService,
    private val contextService: ContextService,
    private val memoryService: MemoryService
) {
    suspend fun analyzeChat(
        contactId: String,
        rawContext: List<String>
    ): Result<AnalysisResult> {
        // ç»Ÿä¸€ç®¡ç†åˆ†ææµç¨‹
    }
}

// ç®€åŒ–UseCase
class AnalyzeChatUseCase @Inject constructor(
    private val chatAnalysisService: ChatAnalysisService
) {
    suspend operator fun invoke(
        contactId: String,
        rawScreenContext: List<String>
    ): Result<AnalysisResult> {
        return chatAnalysisService.analyzeChat(contactId, rawScreenContext)
    }
}
```

#### é¢„æœŸæ”¶ç›Š

- âœ… å•ä¸ªç±»<150è¡Œ (ä»387è¡Œå‡å°‘60%)
- âœ… ä¾èµ–æ•°<5ä¸ª (ä»12ä¸ªå‡å°‘58%)
- âœ… èŒè´£å•ä¸€,ç¬¦åˆSRP
- âœ… æ˜“äºæµ‹è¯•å’Œç»´æŠ¤
- âœ… å¯å¤ç”¨æ€§æå‡

### 2.3 ä»£ç é‡å¤åˆ†æ

#### é‡å¤æ¨¡å¼1: Repositoryè½¬æ¢ä»£ç  (13å¤„é‡å¤)

**é—®é¢˜ç¤ºä¾‹**:

```kotlin
// ContactRepositoryImpl.kt
override fun getAllProfiles(): Flow<List<ContactProfile>> {
    return dao.getAllProfiles().map { entities ->
        entities.map { entityToDomain(it) }  // é‡å¤!
    }
}

// BrainTagRepositoryImpl.kt (åŒæ ·æ¨¡å¼)
override fun getAllTags(): Flow<List<BrainTag>> {
    return dao.getAllTags().map { entities ->
        entities.map { entityToDomain(it) }  // é‡å¤!
    }
}

// ConversationRepositoryImpl.kt (åŒæ ·æ¨¡å¼)
override fun getConversationLogs(contactId: String): Flow<List<ConversationLog>> {
    return dao.getConversationLogs(contactId).map { entities ->
        entities.map { entityToDomain(it) }  // é‡å¤!
    }
}
```

**é‡æ„æ–¹æ¡ˆ**:

```kotlin
// 1. åˆ›å»ºé€šç”¨æ‰©å±•å‡½æ•°
// domain/src/main/kotlin/com/empathy/ai/domain/util/FlowExtensions.kt

inline fun <RE, RD> Flow<List<RE>>.mapListToDomain(
    crossinline transform: (RE) -> RD
): Flow<List<RD>> = map { entities ->
    entities.map { transform(it) }
}

// 2. åœ¨Repositoryä¸­ä½¿ç”¨
// data/src/main/kotlin/com/empathy/ai/data/repository/ContactRepositoryImpl.kt

override fun getAllProfiles(): Flow<List<ContactProfile>> {
    return dao.getAllProfiles()
        .mapListToDomain { entityToDomain(it) }
}

override fun getAllTags(): Flow<List<BrainTag>> {
    return dao.getAllTags()
        .mapListToDomain { entityToDomain(it) }
}
```

**é¢„æœŸæ”¶ç›Š**:
- å‡å°‘13å¤„é‡å¤ä»£ç 
- ç»Ÿä¸€è½¬æ¢é€»è¾‘
- æ˜“äºç»´æŠ¤å’Œæµ‹è¯•

#### é‡å¤æ¨¡å¼2: ResultåŒ…è£…å™¨ (30+å¤„é‡å¤)

**é—®é¢˜ç¤ºä¾‹**:

```kotlin
// åœ¨æ‰€æœ‰Repositoryçš„suspendå‡½æ•°ä¸­é‡å¤
override suspend fun getProfile(id: String): Result<ContactProfile?> {
    return try {
        val entity = dao.getProfileById(id)
        Result.success(entity?.let { entityToDomain(it) })
    } catch (e: Exception) {
        Result.failure(e)
    }
}

override suspend fun updateContact(data: ContactData): Result<Unit> {
    return try {
        dao.updateContact(data)
        Result.success(Unit)
    } catch (e: Exception) {
        Result.failure(e)
    }
}
```

**é‡æ„æ–¹æ¡ˆ**:

```kotlin
// 1. åˆ›å»ºé€šç”¨ResultåŒ…è£…å‡½æ•°
// domain/src/main/kotlin/com/empathy/ai/domain/util/ResultExtensions.kt

inline fun <T> wrapResult(block: () -> T): Result<T> = try {
    Result.success(block())
} catch (e: Exception) {
    Result.failure(e)
}

suspend inline fun <T> wrapSuspendResult(
    crossinline block: suspend () -> T
): Result<T> = try {
    Result.success(block())
} catch (e: Exception) {
    Result.failure(e)
}

// 2. åœ¨Repositoryä¸­ä½¿ç”¨
override suspend fun getProfile(id: String): Result<ContactProfile?> {
    return wrapSuspendResult {
        dao.getProfileById(id)?.let { entityToDomain(it) }
    }
}

override suspend fun updateContact(data: ContactData): Result<Unit> {
    return wrapSuspendResult {
        dao.updateContact(data)
        Unit
    }
}
```

**é¢„æœŸæ”¶ç›Š**:
- å‡å°‘30+å¤„é‡å¤ä»£ç 
- ç»Ÿä¸€é”™è¯¯å¤„ç†
- å‡å°‘ä»£ç è¡Œæ•°çº¦150è¡Œ

### 2.4 å‘½åè§„èŒƒåˆ†æ

**è¯„åˆ†**: 90/100 (ä¼˜ç§€)

#### ä¼˜ç§€ç¤ºä¾‹

```kotlin
// æ¸…æ™°çš„Repositoryå‘½å
interface ContactRepository { }
class ContactRepositoryImpl : ContactRepository { }

// æ˜ç¡®çš„UseCaseå‘½å
class AnalyzeChatUseCase { }
class GenerateReplyUseCase { }
class PolishDraftUseCase { }

// æ¸…æ™°çš„Serviceå‘½å
class PrivacyEngine { }
class PromptBuilder { }
class ConversationContextBuilder { }
```

#### éœ€æ”¹è¿›çš„å‘½å

```kotlin
// å½“å‰: FloatingViewV2 (ç‰ˆæœ¬åç¼€ä¸æ¸…æ™°)
// å»ºè®®: FloatingView æˆ– FloatingViewModern

// å½“å‰: éƒ¨åˆ†å†…éƒ¨å˜é‡å‘½åè¿‡çŸ­
private val db = database  // å»ºè®®æ”¹ä¸º database
private val dao = contactDao  // å»ºè®®æ”¹ä¸º contactDao
```

### 2.5 é”™è¯¯å¤„ç†åˆ†æ

**è¯„åˆ†**: 82/100 (è‰¯å¥½)

#### å½“å‰å®ç°

```kotlin
// ç»Ÿä¸€ä½¿ç”¨Resultç±»å‹
suspend fun getProfile(id: String): Result<ContactProfile?> {
    return try {
        val entity = dao.getProfileById(id)
        Result.success(entity?.let { entityToDomain(it) })
    } catch (e: Exception) {
        Result.failure(e)  // âŒ ä¸¢å¤±é”™è¯¯ä¸Šä¸‹æ–‡
    }
}
```

#### æ”¹è¿›æ–¹æ¡ˆ

```kotlin
// 1. å®šä¹‰é¢†åŸŸé”™è¯¯ç±»å‹
// domain/src/main/kotlin/com/empathy/ai/domain/error/AppError.kt

sealed class AppError(
    message: String,
    override val cause: Throwable? = null
) : Exception(message, cause) {

    data class ContactNotFound(
        val contactId: String,
        override val cause: Throwable? = null
    ) : AppError("Contact not found: $contactId", cause)

    data class AiProviderNotConfigured(
        override val cause: Throwable? = null
    ) : AppError("AI provider not configured", cause)

    data class NetworkError(
        val url: String,
        override val cause: Throwable
    ) : AppError("Network error: $url", cause)
}

// 2. ä½¿ç”¨å¢å¼ºçš„é”™è¯¯ä¿¡æ¯
suspend fun getProfile(id: String): Result<ContactProfile?> {
    return wrapSuspendResult {
        dao.getProfileById(id) ?: throw AppError.ContactNotFound(id)
    }.mapCatching { entity ->
        entityToDomain(entity)
    }
}

// 3. é”™è¯¯å¤„ç†ç¤ºä¾‹
when (val error = result.exceptionOrNull()) {
    is AppError.ContactNotFound -> {
        Log.e(TAG, "è”ç³»äººæœªæ‰¾åˆ°: ${error.contactId}", error)
        // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
    }
    is AppError.AiProviderNotConfigured -> {
        Log.e(TAG, "AIæœåŠ¡å•†æœªé…ç½®", error)
        // å¼•å¯¼ç”¨æˆ·é…ç½®AIæœåŠ¡
    }
    else -> {
        Log.e(TAG, "æœªçŸ¥é”™è¯¯", error)
        // æ˜¾ç¤ºé€šç”¨é”™è¯¯æç¤º
    }
}
```

**é¢„æœŸæ”¶ç›Š**:
- ä¿ç•™å®Œæ•´çš„é”™è¯¯ä¸Šä¸‹æ–‡
- ä¾¿äºé—®é¢˜å®šä½å’Œè°ƒè¯•
- æå‡ç”¨æˆ·ä½“éªŒ (å‹å¥½çš„é”™è¯¯æç¤º)

---

## ğŸ§ª ç¬¬3ç« : æµ‹è¯•è´¨é‡æ·±åº¦åˆ†æ

### 3.1 æµ‹è¯•è¦†ç›–ç‡å…¨æ™¯

#### 3.1.1 æ•´ä½“æµ‹è¯•ç»Ÿè®¡

| ç»´åº¦ | ç»Ÿè®¡æ•°æ® | è¦†ç›–ç‡ | è¯„çº§ |
|------|----------|--------|------|
| **æ€»æµ‹è¯•æ–‡ä»¶** | 243ä¸ª | - | - |
| **ä¸»æºç æ–‡ä»¶** | 479ä¸ª | - | - |
| **å•å…ƒæµ‹è¯•** | 209ä¸ª | 43.6% | Cçº§ |
| **Androidæµ‹è¯•** | 34ä¸ª | 7.1% | Bçº§ |
| **æ€»ä½“è¦†ç›–ç‡** | - | **33.5%** | Dçº§ |

#### 3.1.2 åˆ†æ¨¡å—æµ‹è¯•è¦†ç›–è¯¦æƒ…

| æ¨¡å— | ä¸»æºç  | æµ‹è¯•æ–‡ä»¶ | è¦†ç›–ç‡ | ç­‰çº§ | å…³é”®é—®é¢˜ |
|------|--------|----------|--------|------|----------|
| **Domain** | 148 | 28 | 18.9% | ğŸ”´ Dçº§ | PrivacyEngineæ— å®Œæ•´æµ‹è¯• |
| **Data** | 64 | 19 | 29.7% | ğŸŸ¡ Cçº§ | DAOå±‚40%è¦†ç›– |
| **Presentation** | 245 | 22 | 9.0% | ğŸ”´ Dçº§ | UIæµ‹è¯•ä¸¥é‡ä¸è¶³ |
| **App** | 22 | 140+ | 636% | âš ï¸ å¼‚å¸¸ | æµ‹è¯•ä½ç½®ä¸å½“ |
| **æ€»è®¡** | **479** | **209** | **43.6%** | **Cçº§** | **æ•´ä½“ä¸è¶³** |

**é—®é¢˜åˆ†æ**:
- Appæ¨¡å—çš„140ä¸ªæµ‹è¯•åº”åœ¨å„è‡ªæ¨¡å—ä¸­ (è¿åæµ‹è¯•å°±è¿‘åŸåˆ™)
- Domainå±‚æµ‹è¯•ä¸¥é‡ä¸è¶³ (18.9%)
- Presentationå±‚UIæµ‹è¯•å‡ ä¹ä¸ºç©ºç™½ (9%)

### 3.2 æ ¸å¿ƒæµ‹è¯•ç›²åŒº

#### ç›²åŒº1: PrivacyEngine (æ ¸å¿ƒå®‰å…¨ç»„ä»¶)

**æ–‡ä»¶ä½ç½®**: `domain/src/main/kotlin/com/empathy/ai/domain/service/PrivacyEngine.kt`

**æµ‹è¯•çŠ¶æ€**: ä»…50%è¦†ç›– (åŸºç¡€åŠŸèƒ½æµ‹è¯•)

**é£é™©ç­‰çº§**: ğŸ”´ æé«˜ (éšç§æ³„éœ²å¯èƒ½å¯¼è‡´æ³•å¾‹é—®é¢˜)

**ç¼ºå¤±æµ‹è¯•åœºæ™¯**:

```kotlin
// domain/src/test/kotlin/com/empathy/ai/domain/service/PrivacyEngineTest.kt

class PrivacyEngineTest {

    // ========== åŸºç¡€åŠŸèƒ½æµ‹è¯• ==========

    @Test
    fun `mask replaces phone numbers correctly`() {
        val text = "æˆ‘çš„ç”µè¯æ˜¯13000000000"
        val result = PrivacyEngine.mask(text, listOf(PrivacyEngine.Patterns.PHONE_NUMBER))
        assertEquals("æˆ‘çš„ç”µè¯æ˜¯[æ‰‹æœºå·_1]", result)
    }

    @Test
    fun `mask replaces ID cards correctly`() {
        val text = "èº«ä»½è¯å·æ˜¯11010119900101001X"
        val result = PrivacyEngine.mask(text, listOf(PrivacyEngine.Patterns.ID_CARD))
        assertEquals("èº«ä»½è¯å·æ˜¯[èº«ä»½è¯å·_1]", result)
    }

    @Test
    fun `mask replaces emails correctly`() {
        val text = "é‚®ç®±æ˜¯test@example.com"
        val result = PrivacyEngine.mask(text, listOf(PrivacyEngine.Patterns.EMAIL))
        assertEquals("é‚®ç®±æ˜¯[é‚®ç®±_1]", result)
    }

    // ========== è¾¹ç•Œæƒ…å†µæµ‹è¯• ==========

    @Test
    fun `mask handles empty text`() {
        val result = PrivacyEngine.mask("", listOf(PrivacyEngine.Patterns.PHONE_NUMBER))
        assertEquals("", result)
    }

    @Test
    fun `mask handles null input gracefully`() {
        val result = PrivacyEngine.maskWithAutoDetection(null)
        assertEquals("", result)
    }

    @Test
    fun `mask handles overlapping patterns`() {
        val text = "æ‰‹æœº13000000000å’Œ13000000000"
        val result = PrivacyEngine.maskWithAutoDetection(text)
        assertEquals("æ‰‹æœº[æ‰‹æœºå·_1]å’Œ[æ‰‹æœºå·_2]", result)
    }

    @Test
    fun `mask prioritizes phone over email in overlap`() {
        val text = "project.creator@example.com"  // å¤æ‚é‡å åœºæ™¯
        val result = PrivacyEngine.maskWithAutoDetection(text)
        // åº”è¯†åˆ«ä¸ºæ‰‹æœºå·è€Œéé‚®ç®±
        assertTrue(result.contains("[æ‰‹æœºå·_1]"))
    }

    @Test
    fun `mask handles duplicate sensitive info`() {
        val text = "æ‰“ç»™æˆ‘13000000000ï¼Œæˆ–è€…13000000000"
        val result = PrivacyEngine.maskWithAutoDetection(text)
        assertEquals("æ‰“ç»™æˆ‘[æ‰‹æœºå·_1]ï¼Œæˆ–è€…[æ‰‹æœºå·_2]", result)
    }

    // ========== æ€§èƒ½æµ‹è¯• ==========

    @Test
    fun `mask handles large text efficiently`() {
        val largeText = (1..1000).joinToString(" ") { "ç”µè¯$it: 13000000000" }
        val startTime = System.currentTimeMillis()
        PrivacyEngine.maskWithAutoDetection(largeText)
        val duration = System.currentTimeMillis() - startTime
        assertTrue("å¤§æ–‡æœ¬å¤„ç†åº”åœ¨1ç§’å†…å®Œæˆ, å®é™…: ${duration}ms", duration < 1000)
    }

    // ========== é›†æˆæµ‹è¯• ==========

    @Test
    fun `maskHybrid combines mapping and pattern detection`() {
        val customMapping = mapOf("secret" to "[ç§˜å¯†_1]")
        val text = "æˆ‘çš„ç”µè¯13000000000å’Œå¯†ç secret"
        val result = PrivacyEngine.maskHybrid(
            text,
            customMappings = customMapping,
            useAutoDetection = true
        )
        assertTrue(result.contains("[æ‰‹æœºå·_1]"))
        assertTrue(result.contains("[ç§˜å¯†_1]"))
    }
}
```

**é¢„æœŸå·¥ä½œé‡**: 3äººå¤©

#### ç›²åŒº2: FloatingWindowService (æ ¸å¿ƒäº¤äº’ç»„ä»¶)

**æ–‡ä»¶ä½ç½®**:
- `domain/src/main/kotlin/com/empathy/ai/domain/service/FloatingWindowService.kt`
- `app/src/main/java/com/empathy/ai/app/service/EmpathyFloatingWindowService.kt`

**æµ‹è¯•çŠ¶æ€**: **0%è¦†ç›–ï¼Œå®Œå…¨æ— æµ‹è¯•**

**é£é™©ç­‰çº§**: ğŸ”´ æé«˜ (æ‚¬æµ®çª—å¼‚å¸¸å½±å“ç”¨æˆ·ä½“éªŒ)

**æ¨èæµ‹è¯•æ–¹æ¡ˆ**:

```kotlin
// domain/src/test/kotlin/com/empathy/ai/domain/service/FloatingWindowServiceTest.kt

class FloatingWindowServiceTest {

    private lateinit var service: FloatingWindowService
    private val windowManager: WindowManager = mockk()
    private val context: Context = mockk()

    @Before
    fun setup() {
        service = FloatingWindowService(windowManager, context)
    }

    // ========== æƒé™æµ‹è¯• ==========

    @Test
    fun `showFloatingWindow requests overlay permission if not granted`() {
        // Given
        every { context.checkCallingOrSelfPermission(Manifest.permission.SYSTEM_ALERT_WINDOW) }
            returns PackageManager.PERMISSION_DENIED

        // When
        val result = service.showFloatingWindow()

        // Then
        assertFalse(result.isSuccess)
        assertTrue(result.exceptionOrNull() is SecurityException)
    }

    @Test
    fun `showFloatingWindow creates view when permission granted`() {
        // Given
        every { context.checkCallingOrSelfPermission(Manifest.permission.SYSTEM_ALERT_WINDOW) }
            returns PackageManager.PERMISSION_GRANTED
        every { windowManager.addView(any(), any()) } just Runs

        // When
        val result = service.showFloatingWindow()

        // Then
        assertTrue(result.isSuccess)
        verify { windowManager.addView(any(), any()) }
    }

    // ========== ç”Ÿå‘½å‘¨æœŸæµ‹è¯• ==========

    @Test
    fun `hideFloatingWindow removes view and cleans up resources`() {
        // Given
        val view: View = mockk()
        every { windowManager.removeView(view) } just Runs

        // When
        service.hideFloatingWindow(view)

        // Then
        verify { windowManager.removeView(view) }
    }

    @Test
    fun `onDestroy cleans up all resources`() {
        // Given
        every { windowManager.removeView(any()) } just Runs

        // When
        service.onDestroy()

        // Then
        verify(atLeastOnce = true) { windowManager.removeView(any()) }
    }

    // ========== çª—å£ç®¡ç†æµ‹è¯• ==========

    @Test
    fun `updateFloatingWindowPosition updates layout params`() {
        // Given
        val params: WindowManager.LayoutParams = mockk()
        every { params.x = any() } just Runs
        every { params.y = any() } just Runs
        every { windowManager.updateViewLayout(any(), params) } just Runs

        // When
        service.updatePosition(100, 200)

        // Then
        verify { params.x = 100 }
        verify { params.y = 200 }
        verify { windowManager.updateViewLayout(any(), params) }
    }
}
```

**é¢„æœŸå·¥ä½œé‡**: 5äººå¤©

#### ç›²åŒº3: EmpathyAccessibilityService (å®¿ä¸»äº¤äº’)

**æ–‡ä»¶ä½ç½®**: `app/src/main/java/com/empathy/ai/app/service/EmpathyAccessibilityService.kt`

**æµ‹è¯•çŠ¶æ€**: **0%è¦†ç›–**

**é£é™©ç­‰çº§**: ğŸŸ  é«˜ (æ— éšœç¢åŠŸèƒ½å¼‚å¸¸å¯¼è‡´åº”ç”¨ä¸å¯ç”¨)

**éš¾ç‚¹**: Androidç³»ç»ŸæœåŠ¡,éœ€è¦Instrumented Test

**æ¨èæµ‹è¯•æ–¹æ¡ˆ**:

```kotlin
// app/src/androidTest/kotlin/com/empathy/ai/app/service/EmpathyAccessibilityServiceTest.kt

@RunWith(AndroidJUnit4::class)
class EmpathyAccessibilityServiceTest {

    @get:Rule
    val activityRule = ActivityTestRule(MainActivity::class.java)

    // ========== äº‹ä»¶æ•è·æµ‹è¯• ==========

    @Test
    fun `onAccessibilityEvent captures chat text correctly`() {
        // ä½¿ç”¨UI Automatoræ¨¡æ‹Ÿå¾®ä¿¡èŠå¤©ç•Œé¢
        val device = UiDevice.getInstance(InstrumentationRegistry.getInstrumentation())

        // æ¨¡æ‹Ÿç‚¹å‡»èŠå¤©ç•Œé¢
        // ...

        // éªŒè¯æ–‡æœ¬æ•è·æ­£ç¡®æ€§
        // ...
    }

    @Test
    fun `onAccessibilityEvent ignores non-chat events`() {
        // æ¨¡æ‹ŸéèŠå¤©åœºæ™¯
        // éªŒè¯æœåŠ¡æ­£ç¡®å¿½ç•¥
    }

    // ========== æƒé™æµ‹è¯• ==========

    @Test
    fun `service requires accessibility permission`() {
        val enabled = Settings.Secure.getInt(
            activityRule.activity.contentResolver,
            Settings.Secure.ACCESSIBILITY_ENABLED
        )
        assertEquals(1, enabled)
    }
}
```

**é¢„æœŸå·¥ä½œé‡**: 5äººå¤© (ç”±äºUI Automatoræµ‹è¯•å¤æ‚æ€§)

### 3.3 æµ‹è¯•äº®ç‚¹: DatabaseMigrationTest

**æ–‡ä»¶ä½ç½®**: `app/src/androidTest/java/com/empathy/ai/data/local/DatabaseMigrationTest.kt`

**ä»£ç è§„æ¨¡**: 830è¡Œ,è¦†ç›–9ä¸ªç‰ˆæœ¬è¿ç§» (1â†’2â†’3â†’...â†’9)

**ä¼˜ç§€ç¤ºä¾‹**:

```kotlin
@Test
@Throws(IOException::class)
fun migrateAll_1To9_succeeds() {
    // 1. åˆ›å»ºç‰ˆæœ¬1æ•°æ®åº“
    helper.createDatabase(testDbName, 1).apply {
        // æ’å…¥æµ‹è¯•æ•°æ®
        execSQL("""
            INSERT INTO profiles (id, name, nickname, relationship, notes)
            VALUES ('test_id', 'Test Name', 'Test Nick', 'Friend', 'Test Notes')
        """.trimIndent())
        close()
    }

    // 2. æ‰§è¡Œæ‰€æœ‰è¿ç§»
    val db = helper.runMigrationsAndValidate(
        testDbName,
        9,  // ç›®æ ‡ç‰ˆæœ¬
        true,  // éªŒè¯æ•°æ®åº“æ‰“å¼€æˆåŠŸ
        MIGRATION_1_2,
        MIGRATION_2_3,
        MIGRATION_3_4,
        MIGRATION_4_5,
        MIGRATION_5_6,
        MIGRATION_6_7,
        MIGRATION_7_8,
        MIGRATION_8_9
    )

    // 3. éªŒè¯åŸæœ‰æ•°æ®å®Œæ•´
    val profileCursor = db.query("SELECT * FROM profiles WHERE id = 'test_id'")
    assertTrue("åŸæœ‰æ•°æ®åº”è¯¥ä¿ç•™", profileCursor.moveToFirst())
    assertEquals("Test Name", profileCursor.getString(profileCursor.getColumnIndex("name")))
    assertEquals("Test Nick", profileCursor.getString(profileCursor.getColumnIndex("nickname")))
    profileCursor.close()

    // 4. éªŒè¯æ‰€æœ‰æ–°è¡¨å­˜åœ¨
    val tables = listOf(
        "ai_providers",
        "conversation_logs",
        "daily_summaries",
        "brain_tags",
        "user_profile_context"
    )
    for (table in tables) {
        val cursor = db.query("SELECT * FROM $table")
        assertTrue("$table è¡¨åº”è¯¥å­˜åœ¨", cursor.columnCount > 0)
        cursor.close()
    }

    // 5. éªŒè¯ç´¢å¼•åˆ›å»º
    val indexInfo = db.query("sqlite_master WHERE type='index'")
    assertTrue("åº”è¯¥æœ‰ç´¢å¼•", indexInfo.count > 0)
    indexInfo.close()

    db.close()
}
```

**äº®ç‚¹åˆ†æ**:

| ä¼˜ç‚¹ | è¯´æ˜ |
|------|------|
| âœ… å®Œæ•´çš„æµ‹è¯•æ­¥éª¤ | å‡†å¤‡â†’æ‰§è¡Œâ†’éªŒè¯ (Given-When-Then) |
| âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯ | éªŒè¯åŸæœ‰æ•°æ®åœ¨è¿ç§»åä¿ç•™ |
| âœ… å…¨é¢çš„è¡¨éªŒè¯ | éªŒè¯æ‰€æœ‰æ–°è¡¨å’Œç´¢å¼•åˆ›å»º |
| âœ… æ¸…æ™°çš„æ–­è¨€æ¶ˆæ¯ | æ¯ä¸ªæ–­è¨€éƒ½æœ‰æè¿°æ€§æ¶ˆæ¯ |
| âœ… è¦†ç›–æ‰€æœ‰ç‰ˆæœ¬ | 9ä¸ªç‰ˆæœ¬è¿ç§»å…¨è¦†ç›– |
| âœ… ç‹¬ç«‹æ€§å¥½ | æ¯ä¸ªæµ‹è¯•å¯ä»¥ç‹¬ç«‹è¿è¡Œ |

**å€¼å¾—æ¨å¹¿çš„æœ€ä½³å®è·µ**:

```kotlin
// 1. ä½¿ç”¨helperåˆ›å»ºå’ŒéªŒè¯æ•°æ®åº“
helper.createDatabase(name, version).apply {
    // å‡†å¤‡æ•°æ®
    execSQL("...")
    close()
}

val db = helper.runMigrationsAndValidate(name, newVersion, validateOpen, *migrations)

// 2. éªŒè¯æ•°æ®å®Œæ•´æ€§
val cursor = db.query("SELECT * FROM table WHERE id = 'test_id'")
try {
    assertTrue("æ•°æ®åº”è¯¥å­˜åœ¨", cursor.moveToFirst())
    assertEquals("expected", cursor.getString(cursor.getColumnIndex("column")))
} finally {
    cursor.close()
}

// 3. éªŒè¯è¡¨å’Œç´¢å¼•å­˜åœ¨
val tables = listOf("table1", "table2", "table3")
for (table in tables) {
    val c = db.query("SELECT * FROM $table")
    try {
        assertTrue("$table è¡¨åº”è¯¥å­˜åœ¨", c.columnCount > 0)
    } finally {
        c.close()
    }
}
```

### 3.4 UIæµ‹è¯•ä¸¥é‡ä¸è¶³

**ç»Ÿè®¡æ•°æ®**:
- UIç»„ä»¶æ€»æ•°: 187ä¸ª
- æœ‰æµ‹è¯•çš„ç»„ä»¶: 5ä¸ª
- **è¦†ç›–ç‡: 2.7%** (ä¸¥é‡ä¸è¶³)

**å·²æµ‹è¯•çš„Screen**:
- âœ… UserProfileScreen (éƒ¨åˆ†æµ‹è¯•)
- âŒ å…¶ä»–12ä¸ªScreenæœªæµ‹è¯•

**æ¨èæµ‹è¯•ç­–ç•¥**:

```kotlin
// presentation/src/androidTest/kotlin/com/empathy/ai/presentation/ui/ContactCardTest.kt

class ContactCardTest {

    @get:Rule
    val composeTestRule = createComposeRule()

    // ========== åŸºç¡€æ˜¾ç¤ºæµ‹è¯• ==========

    @Test
    fun `ContactCard displays contact name and nickname`() {
        val contact = ContactProfile(
            id = "1",
            name = "å¼ ä¸‰",
            nickname = "å°å¼ ",
            relationship = RelationshipLevel.FRIEND
        )

        composeTestRule.setContent {
            EmpathyTheme {
                ContactCard(
                    profile = contact,
                    onClick = {}
                )
            }
        }

        composeTestRule
            .onNodeWithText("å¼ ä¸‰")
            .assertIsDisplayed()

        composeTestRule
            .onNodeWithText("å°å¼ ")
            .assertIsDisplayed()
    }

    // ========== äº¤äº’æµ‹è¯• ==========

    @Test
    fun `ContactCard calls onClick when clicked`() {
        var clicked = false
        val contact = mockContact()

        composeTestRule.setContent {
            EmpathyTheme {
                ContactCard(
                    profile = contact,
                    onClick = { clicked = true }
                )
            }
        }

        composeTestRule
            .onNodeWithText(contact.name)
            .performClick()

        assertTrue("åº”è¯¥è§¦å‘onClick", clicked)
    }

    // ========== çŠ¶æ€å˜åŒ–æµ‹è¯• ==========

    @Test
    fun `ContactCard updates when contact data changes`() {
        var contact by mutableStateOf(
            ContactProfile(id = "1", name = "å¼ ä¸‰")
        )

        composeTestRule.setContent {
            EmpathyTheme {
                ContactCard(
                    profile = contact,
                    onClick = {}
                )
            }
        }

        // éªŒè¯åˆå§‹çŠ¶æ€
        composeTestRule.onNodeWithText("å¼ ä¸‰").assertIsDisplayed()

        // æ›´æ–°æ•°æ®
        contact = contact.copy(name = "æå››")

        // éªŒè¯æ›´æ–°åçš„çŠ¶æ€
        composeTestRule.onNodeWithText("æå››").assertIsDisplayed()
    }
}
```

**å»ºè®®UIæµ‹è¯•è¦†ç›–ç›®æ ‡**:
- ä¸»è¦Screen: 80% (è‡³å°‘10ä¸ªæ ¸å¿ƒScreenæœ‰æµ‹è¯•)
- UIç»„ä»¶: 20% (è‡³å°‘40ä¸ªç»„ä»¶æœ‰æµ‹è¯•)
- äº¤äº’æµç¨‹: 100% (æ‰€æœ‰å…³é”®ç”¨æˆ·æµç¨‹æœ‰æµ‹è¯•)

---

## ğŸ’¸ ç¬¬4ç« : æŠ€æœ¯å€ºåŠ¡æ¸…å•

### 4.1 é«˜ä¼˜å…ˆçº§å€ºåŠ¡ (P0 - ç«‹å³å¤„ç†)

| å€ºåŠ¡é¡¹ | é£é™©ç­‰çº§ | æ–‡ä»¶ä½ç½® | å·¥ä½œé‡ | é¢„æœŸæ”¶ç›Š |
|--------|----------|----------|--------|----------|
| **APIå¯†é’¥æ˜æ–‡æ—¥å¿—** | ğŸ”´ æé«˜ | å¤šå¤„æ—¥å¿—è¾“å‡º | 2äººå¤© | æ¶ˆé™¤å®‰å…¨é£é™© |
| **UseCaseèŒè´£è¿‡é‡** | ğŸŸ  é«˜ | AnalyzeChatUseCase.kt | 15äººå¤© | æå‡å¯ç»´æŠ¤æ€§ |
| **PrivacyEngineæ— æµ‹è¯•** | ğŸŸ  é«˜ | PrivacyEngine.kt | 5äººå¤© | æå‡ç¨³å®šæ€§ |
| **FloatingWindowServiceæ— æµ‹è¯•** | ğŸŸ  é«˜ | FloatingWindowService.kt | 5äººå¤© | æå‡ç¨³å®šæ€§ |

#### P0-1: APIå¯†é’¥æ˜æ–‡æ—¥å¿—é£é™©

**é—®é¢˜ä»£ç ä½ç½®**:
- `data/src/main/kotlin/com/empathy/ai/data/remote/OpenAiApi.kt`
- `data/src/main/kotlin/com/empathy/ai/data/repository/AiRepositoryImpl.kt`
- å„å¤„ä½¿ç”¨Log.dè¾“å‡ºæ•æ„Ÿä¿¡æ¯çš„åœ°æ–¹

**é—®é¢˜ç¤ºä¾‹**:
```kotlin
// âŒ å½“å‰å¯èƒ½å­˜åœ¨
Log.d("AiRepository", "Making request with API Key: $apiKey")  // å¯†é’¥æ˜æ–‡æ—¥å¿—!
Log.d("AiRepo", "URL: $fullUrl, Headers: $headers")  // HeadersåŒ…å«å¯†é’¥!
```

**ä¿®å¤æ–¹æ¡ˆ**:

```kotlin
// 1. åˆ›å»ºå®‰å…¨æ—¥å¿—å·¥å…·
// domain/src/main/kotlin/com/empathy/ai/domain/util/SecureLogger.kt

object SecureLogger {

    private const val MASK = "****"

    fun d(tag: String, message: String, maskKeys: List<String> = emptyList()) {
        var safeMessage = message
        maskKeys.forEach { key ->
            if (key.isNotEmpty()) {
                safeMessage = safeMessage.replace(key, MASK)
            }
        }
        Log.d(tag, safeMessage)
    }

    fun e(tag: String, message: String, throwable: Throwable?, maskKeys: List<String> = emptyList()) {
        var safeMessage = message
        maskKeys.forEach { key ->
            if (key.isNotEmpty()) {
                safeMessage = safeMessage.replace(key, MASK)
            }
        }
        Log.e(tag, safeMessage, throwable)
    }
}

// 2. ä½¿ç”¨å®‰å…¨æ—¥å¿—
// data/src/main/kotlin/com/empathy/ai/data/repository/AiRepositoryImpl.kt

class AiRepositoryImpl @Inject constructor(
    private val api: OpenAiApi,
    private val apiKeyStorage: ApiKeyStorage
) : AiRepository {

    override suspend fun chatCompletion(
        contactId: String,
        messages: List<ChatMessage>
    ): Result<ChatResponse> {
        return wrapSuspendResult {
            val apiKey = apiKeyStorage.getApiKey() ?: return Result.failure(
                AiProviderNotConfigured()
            )

            // ä½¿ç”¨å®‰å…¨æ—¥å¿—,è‡ªåŠ¨æ©ç APIå¯†é’¥
            SecureLogger.d(
                "AiRepo",
                "Making request to OpenAI",
                maskKeys = listOf(apiKey)  // è‡ªåŠ¨æ©ç 
            )

            val response = api.chatCompletion(
                fullUrl = "https://api.openai.com/v1/chat/completions",
                headers = mapOf(
                    "Authorization" to "Bearer $apiKey",
                    "Content-Type" to "application/json"
                ),
                request = ChatRequestDto(messages = messages)
            )

            SecureLogger.d("AiRepo", "Request successful")
            response
        }
    }
}

// 3. ç”Ÿäº§ç¯å¢ƒæ—¥å¿—é…ç½®
// app/src/main/java/com/empathy/ai/app/util/ReleaseLogTree.kt

class ReleaseLogTree : Timber.Tree() {
    override fun log(priority: Int, tag: String?, message: String, throwable: Throwable?) {
        if (priority == Log.VERBOSE || priority == Log.DEBUG) {
            return  // ç”Ÿäº§ç¯å¢ƒä¸è¾“å‡ºDEBUGæ—¥å¿—
        }

        // ç§»é™¤æ•æ„Ÿä¿¡æ¯
        val safeMessage = sanitizeMessage(message)

        // ä¸ŠæŠ¥åˆ°Crashlyticsç­‰å¹³å°
        // FirebaseCrashlytics.getInstance().log(safeMessage)
    }

    private fun sanitizeMessage(message: String): String {
        // ç§»é™¤å¯èƒ½åŒ…å«çš„å¯†é’¥ã€å¯†ç ç­‰
        return message
            .replace(Regex("Bearer\\s+[\\w-]+"), "Bearer ****")
            .replace(Regex("api[_-]?key[=:]\\s*\\w+", RegexOption.IGNORE_CASE), "apikey=****")
    }
}
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰åŒ…å«APIå¯†é’¥çš„æ—¥å¿—éƒ½ç»è¿‡æ©ç 
- âœ… ç”Ÿäº§ç¯å¢ƒä¸è¾“å‡ºDEBUGçº§åˆ«æ—¥å¿—
- âœ… ä»£ç å®¡æŸ¥ç¡®è®¤æ— æ˜æ–‡å¯†é’¥æ—¥å¿—

### 4.2 ä¸­ä¼˜å…ˆçº§å€ºåŠ¡ (P1 - 2å‘¨å†…å¤„ç†)

| å€ºåŠ¡é¡¹ | é£é™©ç­‰çº§ | æ–‡ä»¶ä½ç½® | å·¥ä½œé‡ | é¢„æœŸæ”¶ç›Š |
|--------|----------|----------|--------|----------|
| **æ•°æ®åº“æœªåˆ†é¡µ** | ğŸŸ¡ ä¸­ | ContactDao.kt | 8äººå¤© | æå‡æ€§èƒ½ |
| **UIç»„ä»¶è¿‡å¤§** | ğŸŸ¡ ä¸­ | å¤šä¸ªViewModel/Screen | 10äººå¤© | æå‡å¯ç»´æŠ¤æ€§ |
| **æµ‹è¯•è¦†ç›–ä¸è¶³** | ğŸŸ¡ ä¸­ | å…¨æ¨¡å— | 20äººå¤© | æå‡è´¨é‡ |

#### P1-1: æ•°æ®åº“æœªåˆ†é¡µ (æ€§èƒ½ç“¶é¢ˆ)

**é—®é¢˜ä½ç½®**:
- `data/src/main/kotlin/com/empathy/ai/data/local/dao/ContactDao.kt`
- `data/src/main/kotlin/com/empathy/ai/data/local/dao/ConversationLogDao.kt`

**å½“å‰ä»£ç **:
```kotlin
@Dao
interface ContactDao {
    // âŒ æ— åˆ†é¡µ,å…¨é‡åŠ è½½
    @Query("SELECT * FROM profiles ORDER BY name COLLATE NOCASE")
    fun getAllProfiles(): Flow<List<ContactProfileEntity>>

    // âŒ æ— åˆ†é¡µ,å…¨é‡åŠ è½½
    @Query("SELECT * FROM conversation_logs WHERE contact_id = :contactId ORDER BY timestamp DESC")
    fun getConversationLogs(contactId: String): Flow<List<ConversationLogEntity>>
}
```

**æ€§èƒ½å½±å“**:
- 1000+è”ç³»äººæ—¶æ˜æ˜¾å¡é¡¿
- å†…å­˜å ç”¨è¿‡é«˜ (å¯èƒ½å¯¼è‡´OOM)
- åˆ—è¡¨æ»šåŠ¨ä¸æµç•…

**ä¼˜åŒ–æ–¹æ¡ˆ** (è¯¦è§ç¬¬5ç« ):
- ä½¿ç”¨Room Paging 3.0
- æ·»åŠ åˆ†é¡µæŸ¥è¯¢æ–¹æ³•
- ViewModelä½¿ç”¨cachedIn
- UIä½¿ç”¨LazyPagingItems

**é¢„æœŸæ”¶ç›Š**:
- å†…å­˜å ç”¨å‡å°‘80%
- åˆ—è¡¨æ»šåŠ¨æµç•…åº¦æå‡
- æ”¯æŒ10000+è”ç³»äººæ•°æ®

#### P1-2: UIç»„ä»¶è¿‡å¤§

**é—®é¢˜ç»„ä»¶**:
| æ–‡ä»¶ | è¡Œæ•° | é—®é¢˜ |
|------|------|------|
| ContactDetailTabViewModel.kt | 1516 | é€»è¾‘è¿‡äºå¤æ‚ |
| ContactDetailViewModel.kt | 1172 | çŠ¶æ€ç®¡ç†æ··ä¹± |
| UserProfileScreen.kt | 958 | ç»„ä»¶èŒè´£è¿‡å¤š |

**é‡æ„æ–¹æ¡ˆ** (è¯¦è§ç¬¬5ç« ):
- æ‹†åˆ†ViewModelä¸ºå¤šä¸ªå­ViewModel
- æ‹†åˆ†Screenä¸ºå¤šä¸ªå­ç»„ä»¶
- ä½¿ç”¨Stateç®¡ç†çŠ¶æ€

### 4.3 ä½ä¼˜å…ˆçº§å€ºåŠ¡ (P2 - é•¿æœŸä¼˜åŒ–)

| å€ºåŠ¡é¡¹ | é£é™©ç­‰çº§ | æ–‡ä»¶ä½ç½® | å·¥ä½œé‡ | é¢„æœŸæ”¶ç›Š |
|--------|----------|----------|--------|----------|
| **Repositoryè½¬æ¢é‡å¤** | ğŸŸ¢ ä½ | 13ä¸ªRepository | 3äººå¤© | ä»£ç ç®€æ´ |
| **ResultåŒ…è£…å™¨é‡å¤** | ğŸŸ¢ ä½ | 30+å¤„ | 2äººå¤© | ä»£ç ç®€æ´ |
| **æ¨¡å—ä¾èµ–é…ç½®** | ğŸŸ¢ ä½ | build.gradle.kts | 1äººå¤© | æ¶æ„æ¸…æ™° |

---

## ğŸ› ï¸ ç¬¬5ç« : æ”¹è¿›æ–¹æ¡ˆè¯¦è§£

### 5.1 UseCaseé‡æ„æ–¹æ¡ˆ

#### é‡æ„å‰åå¯¹æ¯”

**é‡æ„å‰** (387è¡Œ,12ä¾èµ–):
```kotlin
class AnalyzeChatUseCase @Inject constructor(
    private val contactRepository: ContactRepository,
    private val brainTagRepository: BrainTagRepository,
    private val privacyRepository: PrivacyRepository,
    private val aiRepository: AiRepository,
    private val conversationRepository: ConversationRepository,
    private val settingsRepository: SettingsRepository,
    private val topicRepository: TopicRepository,
    private val userProfileRepository: UserProfileRepository,
    private val contextBuilder: ConversationContextBuilder,
    private val profileBuilder: UserProfileContextBuilder,
    private val promptBuilder: PromptBuilder,
    private val logger: Logger
) {
    suspend operator fun invoke(
        contactId: String,
        rawScreenContext: List<String>
    ): Result<AnalysisResult> {
        // 387è¡Œä¸šåŠ¡é€»è¾‘...
    }
}
```

**é‡æ„å** (æ‹†åˆ†ä¸º4ä¸ªç±»):
```kotlin
// 1. åè°ƒå™¨ - ç»„è£…ä¸šåŠ¡æµç¨‹
class AnalyzeChatCoordinator @Inject constructor(
    private val coreAnalyzer: ChatCoreAnalyzer,
    private val conversationSaver: ConversationSaver,
    private val profileUpdater: ProfileUpdater
) {
    suspend operator fun invoke(
        contactId: String,
        rawScreenContext: List<String>
    ): Result<AnalysisResult> {
        // 1. æ ¸å¿ƒåˆ†æ
        val result = coreAnalyzer.analyze(contactId, rawScreenContext)
        if (result.isFailure) return result

        // 2. ä¿å­˜å¯¹è¯
        conversationSaver.save(contactId, rawScreenContext, result.getOrNull()!!)

        // 3. æ›´æ–°ç”»åƒ
        profileUpdater.update(contactId, result.getOrNull()!!)

        return result
    }
}

// 2. æ ¸å¿ƒåˆ†æå™¨ - ä¸“æ³¨AIåˆ†æ
class ChatCoreAnalyzer @Inject constructor(
    private val aiRepository: AiRepository,
    private val privacyService: PrivacyService,
    private val contextService: ContextService,
    private val promptBuilder: PromptBuilder
) {
    suspend fun analyze(
        contactId: String,
        rawScreenContext: List<String>
    ): Result<AnalysisResult> {
        // ~100è¡Œä¸“æ³¨åˆ†æé€»è¾‘
        // 1. æ•°æ®å‡†å¤‡
        val preparedData = contextService.prepareContext(contactId, rawScreenContext)

        // 2. éšç§è„±æ•
        val maskedData = privacyService.maskText(preparedData)

        // 3. Promptç»„è£…
        val prompt = promptBuilder.buildWithTopic(
            scene = PromptScene.ANALYZE,
            contactId = contactId,
            context = preparedData,
            topic = null,
            runtimeData = maskedData
        )

        // 4. AIæ¨ç†
        return aiRepository.chatCompletion(contactId, listOf(
            ChatMessage(role = "user", content = prompt)
        ))
    }
}

// 3. å¯¹è¯ä¿å­˜å™¨ - ä¸“æ³¨æ•°æ®æŒä¹…åŒ–
class ConversationSaver @Inject constructor(
    private val conversationRepository: ConversationRepository,
    private val contactRepository: ContactRepository
) {
    suspend fun save(
        contactId: String,
        rawContext: List<String>,
        result: AnalysisResult
    ): Result<Unit> {
        return wrapSuspendResult {
            // 1. ä¿å­˜å¯¹è¯æ—¥å¿—
            conversationRepository.saveConversationLog(
                contactId = contactId,
                userInput = rawContext.joinToString("\n"),
                aiResponse = result.summary
            )

            // 2. æ›´æ–°æœ€åäº’åŠ¨æ—¶é—´
            contactRepository.updateLastInteractionTime(
                contactId = contactId,
                timestamp = System.currentTimeMillis()
            )
        }
    }
}

// 4. ç”»åƒæ›´æ–°å™¨ - ä¸“æ³¨ç”»åƒæ›´æ–°
class ProfileUpdater @Inject constructor(
    private val userProfileRepository: UserProfileRepository,
    private val brainTagRepository: BrainTagRepository
) {
    suspend fun update(
        contactId: String,
        result: AnalysisResult
    ): Result<Unit> {
        return wrapSuspendResult {
            // 1. æ›´æ–°ç”»åƒç»´åº¦
            result.dimensions?.forEach { (dimension, score) ->
                userProfileRepository.updateDimension(
                    contactId = contactId,
                    dimension = dimension,
                    score = score
                )
            }

            // 2. æ›´æ–°æ ‡ç­¾
            result.suggestedTags?.forEach { tag ->
                brainTagRepository.associateTag(
                    contactId = contactId,
                    tag = tag
                )
            }
        }
    }
}
```

#### é‡æ„æ­¥éª¤

1. **åˆ›å»ºæ–°ç±»** (ä¸åˆ é™¤æ—§ä»£ç )
   ```kotlin
   // åˆ›å»ºæ–°ç±»,ä¿ç•™æ—§ç±»ç”¨äºå¯¹æ¯”
   class ChatCoreAnalyzer @Inject constructor(...)
   class ConversationSaver @Inject constructor(...)
   class ProfileUpdater @Inject constructor(...)
   class AnalyzeChatCoordinator @Inject constructor(...)
   ```

2. **è¿ç§»ä¸šåŠ¡é€»è¾‘** (æŒ‰èŒè´£æ‹†åˆ†)
   ```kotlin
   // å°†AnalyzeChatUseCaseçš„é€»è¾‘æŒ‰èŒè´£è¿ç§»åˆ°æ–°ç±»
   // 1. AIç›¸å…³é€»è¾‘ â†’ ChatCoreAnalyzer
   // 2. ä¿å­˜ç›¸å…³é€»è¾‘ â†’ ConversationSaver
   // 3. æ›´æ–°ç›¸å…³é€»è¾‘ â†’ ProfileUpdater
   ```

3. **ç¼–å†™å•å…ƒæµ‹è¯•** (ç¡®ä¿è¡Œä¸ºä¸€è‡´)
   ```kotlin
   // ä¸ºæ¯ä¸ªæ–°ç±»ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•
   class ChatCoreAnalyzerTest { ... }
   class ConversationSaverTest { ... }
   class ProfileUpdaterTest { ... }
   ```

4. **æ›´æ–°è°ƒç”¨æ–¹** (ä½¿ç”¨æ–°ç±»)
   ```kotlin
   // æ›´æ–°ViewModelä½¿ç”¨æ–°çš„åè°ƒå™¨
   class ChatViewModel @Inject constructor(
       private val analyzer: AnalyzeChatCoordinator  // ä½¿ç”¨æ–°ç±»
   ) : ViewModel()
   ```

5. **åˆ é™¤æ—§ä»£ç ** (ç»è¿‡å›å½’æµ‹è¯•å)
   ```kotlin
   // ç¡®è®¤æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å,åˆ é™¤æ—§çš„AnalyzeChatUseCase
   ```

#### é¢„æœŸæ”¶ç›Š

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| ä»£ç è¡Œæ•° | 387è¡Œ | ~300è¡Œ (4ä¸ªç±») | -21% |
| ä¾èµ–æ•°é‡ | 12ä¸ª | 4ä¸ª (æ¯ä¸ª<5ä¸ª) | -67% |
| èŒè´£æ•°é‡ | 5ä¸ª | 1ä¸ª (æ¯ä¸ªç±») | -80% |
| å¯æµ‹è¯•æ€§ | ä½ | é«˜ | +200% |
| å¯å¤ç”¨æ€§ | ä½ | é«˜ | +150% |

### 5.2 æ•°æ®åº“åˆ†é¡µå®ç°

#### æ­¥éª¤1: DAOå±‚æ·»åŠ Pagingæ”¯æŒ

```kotlin
// data/src/main/kotlin/com/empathy/ai/data/local/dao/ContactDao.kt

@Dao
interface ContactDao {

    // æ—§æ–¹å¼ (ä¿ç•™ç”¨äºå…¼å®¹)
    @Query("SELECT * FROM profiles ORDER BY name COLLATE NOCASE")
    fun getAllProfiles(): Flow<List<ContactProfileEntity>>

    // æ–°æ–¹å¼ (Paging 3.0)
    @Query("SELECT * FROM profiles ORDER BY name COLLATE NOCASE")
    fun getAllProfilesPaged(): PagingSource<Int, ContactProfileEntity>

    // å…¶ä»–æŸ¥è¯¢ä¹Ÿå¯ä»¥æ”¹ä¸ºåˆ†é¡µ
    @Query("SELECT * FROM profiles WHERE relationship = :relationship ORDER BY name COLLATE NOCASE")
    fun getProfilesByRelationshipPaged(relationship: String): PagingSource<Int, ContactProfileEntity>
}
```

#### æ­¥éª¤2: Repositoryå±‚è¿”å›PagingData

```kotlin
// data/src/main/kotlin/com/empathy/ai/data/repository/ContactRepositoryImpl.kt

class ContactRepositoryImpl @Inject constructor(
    private val dao: ContactDao,
    private val factListConverter: FactListConverter
) : ContactRepository {

    // æ—§æ–¹å¼ (ä¿ç•™)
    override fun getAllProfiles(): Flow<List<ContactProfile>> {
        return dao.getAllProfiles().map { entities ->
            entities.map { entityToDomain(it) }
        }
    }

    // æ–°æ–¹å¼ (Paging)
    @OptIn(ExperimentalPagingApi::class)
    override fun getAllProfilesPaged(): Flow<PagingData<ContactProfile>> {
        return Pager(
            config = PagingConfig(
                pageSize = 20,              // æ¯é¡µ20æ¡
                prefetchDistance = 5,        // è·ç¦»åº•éƒ¨5æ¡æ—¶é¢„åŠ è½½ä¸‹ä¸€é¡µ
                enablePlaceholders = false,  // ä¸æ˜¾ç¤ºå ä½ç¬¦
                initialLoadSize = 40         // åˆå§‹åŠ è½½40æ¡
            ),
            pagingSourceFactory = { dao.getAllProfilesPaged() }
        ).flow.map { pagingData ->
            pagingData.map { entityToDomain(it) }
        }
    }
}
```

#### æ­¥éª¤3: ViewModelå±‚ä½¿ç”¨cachedIn

```kotlin
// presentation/src/main/kotlin/com/empathy/ai/presentation/viewmodel/ContactListViewModel.kt

@HiltViewModel
class ContactListViewModel @Inject constructor(
    private val repository: ContactRepository
) : ViewModel() {

    // ä½¿ç”¨PagingData
    val contacts: Flow<PagingData<ContactProfile>> =
        repository.getAllProfilesPaged()
            .cachedIn(viewModelScope)  // ç¼“å­˜åˆ°ViewModelä½œç”¨åŸŸ

    // ä¹Ÿå¯ä»¥æ”¯æŒæœç´¢
    fun searchContacts(query: String): Flow<PagingData<ContactProfile>> {
        return repository.searchContactsPaged(query)
            .cachedIn(viewModelScope)
    }
}
```

#### æ­¥éª¤4: UIå±‚ä½¿ç”¨LazyPagingItems

```kotlin
// presentation/src/main/kotlin/com/empathy/ai/presentation/ui/contact/ContactListScreen.kt

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun ContactListScreen(
    viewModel: ContactListViewModel = hiltViewModel(),
    onContactClick: (String) -> Unit
) {
    val contacts = viewModel.contacts.collectAsLazyPagingItems()

    Scaffold(
        topBar = { TopAppBar(title = { Text("è”ç³»äºº") }) }
    ) { padding ->
        LazyColumn(
            modifier = Modifier
                .padding(padding)
                .fillMaxSize()
        ) {
            // åˆ†é¡µåˆ—è¡¨é¡¹
            items(
                count = contacts.itemCount,
                key = contacts.itemKey { it.id }
            ) { index ->
                contacts[index]?.let { contact ->
                    ContactCard(
                        profile = contact,
                        onClick = { onContactClick(contact.id) }
                    )
                }
            }

            // åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨
            contacts.apply {
                when {
                    // åˆ·æ–°åŠ è½½ä¸­
                    loadState.refresh is LoadState.Loading -> {
                        item { LoadingIndicator() }
                    }
                    // è¿½åŠ åŠ è½½ä¸­
                    loadState.append is LoadState.Loading -> {
                        item { LoadingIndicator() }
                    }
                    // åˆ·æ–°å¤±è´¥
                    loadState.refresh is LoadState.Error -> {
                        item {
                            ErrorButton(
                                message = "åŠ è½½å¤±è´¥",
                                onClick = { retry() }
                            )
                        }
                    }
                    // è¿½åŠ å¤±è´¥
                    loadState.append is LoadState.Error -> {
                        item {
                            ErrorButton(
                                message = "åŠ è½½æ›´å¤šå¤±è´¥",
                                onClick = { retry() }
                            )
                        }
                    }
                }
            }
        }
    }
}
```

#### æ€§èƒ½æµ‹è¯•

```kotlin
// app/src/androidTest/kotlin/com/empathy/ai/data/PagingPerformanceTest.kt

@RunWith(AndroidJUnit4::class)
class PagingPerformanceTest {

    @get:Rule
    val instantTaskExecutorRule = InstantTaskExecutorRule()

    @Test
    fun `load 1000 contacts with paging takes less than 1 second`() {
        val startTime = System.currentTimeMillis()

        // æµ‹è¯•1000æ¡è®°å½•åŠ è½½
        val pagingSource = dao.getAllProfilesPaged()
        val refreshResult = pagingSource.load(
            PagingSource.LoadParams.Refresh(
                key = null,
                loadSize = 20,
                placeholdersEnabled = false
            )
        )

        val duration = System.currentTimeMillis() - startTime
        assertTrue(
            "é¦–å±åŠ è½½åº”åœ¨1ç§’å†…å®Œæˆ, å®é™…: ${duration}ms",
            duration < 1000
        )
    }
}
```

### 5.3 æµ‹è¯•è¦†ç›–æå‡æ–¹æ¡ˆ

#### Domainå±‚æµ‹è¯• (18.9% â†’ 50%)

**é‡ç‚¹: PrivacyEngineå®Œæ•´æµ‹è¯•å¥—ä»¶**

```kotlin
// domain/src/test/kotlin/com/empathy/ai/domain/service/PrivacyEngineTest.kt

class PrivacyEngineTest {

    // ========== åŸºç¡€åŠŸèƒ½æµ‹è¯• ==========

    @Test
    fun `mask replaces phone numbers correctly`() {
        val text = "æˆ‘çš„ç”µè¯æ˜¯13000000000"
        val result = PrivacyEngine.mask(text, listOf(PrivacyEngine.Patterns.PHONE_NUMBER))
        assertEquals("æˆ‘çš„ç”µè¯æ˜¯[æ‰‹æœºå·_1]", result)
    }

    @Test
    fun `mask replaces multiple phone numbers`() {
        val text = "è”ç³»æˆ‘13000000000æˆ–13000000000"
        val result = PrivacyEngine.maskWithAutoDetection(text)
        assertEquals("è”ç³»æˆ‘[æ‰‹æœºå·_1]æˆ–[æ‰‹æœºå·_2]", result)
    }

    @Test
    fun `mask replaces ID cards correctly`() {
        val text = "èº«ä»½è¯å·æ˜¯11010119900101001X"
        val result = PrivacyEngine.mask(text, listOf(PrivacyEngine.Patterns.ID_CARD))
        assertEquals("èº«ä»½è¯å·æ˜¯[èº«ä»½è¯å·_1]", result)
    }

    @Test
    fun `mask replaces emails correctly`() {
        val text = "é‚®ç®±æ˜¯test@example.com"
        val result = PrivacyEngine.mask(text, listOf(PrivacyEngine.Patterns.EMAIL))
        assertEquals("é‚®ç®±æ˜¯[é‚®ç®±_1]", result)
    }

    // ========== è¾¹ç•Œæƒ…å†µæµ‹è¯• ==========

    @Test
    fun `mask handles empty text`() {
        val result = PrivacyEngine.mask("", listOf(PrivacyEngine.Patterns.PHONE_NUMBER))
        assertEquals("", result)
    }

    @Test
    fun `mask handles null input gracefully`() {
        val result = PrivacyEngine.maskWithAutoDetection(null)
        assertEquals("", result)
    }

    @Test
    fun `mask handles overlapping patterns`() {
        // æ‰‹æœºå·å’Œé‚®ç®±é‡å çš„åœºæ™¯
        val text = "æ‰‹æœº13000000000@163.com"
        val result = PrivacyEngine.maskWithAutoDetection(text)
        // åº”è¯†åˆ«ä¸ºæ‰‹æœºå·
        assertTrue(result.contains("[æ‰‹æœºå·_1]"))
    }

    @Test
    fun `mask handles duplicate sensitive info`() {
        val text = "æ‰“ç»™æˆ‘13000000000ï¼Œæˆ–è€…13000000000"
        val result = PrivacyEngine.maskWithAutoDetection(text)
        assertEquals("æ‰“ç»™æˆ‘[æ‰‹æœºå·_1]ï¼Œæˆ–è€…[æ‰‹æœºå·_2]", result)
    }

    @Test
    fun `mask handles text without sensitive info`() {
        val text = "è¿™æ˜¯ä¸€æ®µæ™®é€šæ–‡æœ¬ï¼Œæ²¡æœ‰æ•æ„Ÿä¿¡æ¯"
        val result = PrivacyEngine.maskWithAutoDetection(text)
        assertEquals(text, result)
    }

    // ========== æ€§èƒ½æµ‹è¯• ==========

    @Test
    fun `mask handles large text efficiently`() {
        val largeText = (1..1000).joinToString(" ") { "ç”µè¯$it: 13000000000" }
        val startTime = System.currentTimeMillis()
        PrivacyEngine.maskWithAutoDetection(largeText)
        val duration = System.currentTimeMillis() - startTime
        assertTrue("å¤§æ–‡æœ¬å¤„ç†åº”åœ¨1ç§’å†…å®Œæˆ, å®é™…: ${duration}ms", duration < 1000)
    }

    @Test
    fun `mask handles complex text efficiently`() {
        val complexText = buildString {
            repeat(100) {
                append("ç”µè¯: 13000000000, é‚®ç®±: project.creator@example.com, ")
                append("èº«ä»½è¯: 11010119900101001X. ")
            }
        }
        val startTime = System.currentTimeMillis()
        PrivacyEngine.maskWithAutoDetection(complexText)
        val duration = System.currentTimeMillis() - startTime
        assertTrue("å¤æ‚æ–‡æœ¬å¤„ç†åº”åœ¨2ç§’å†…å®Œæˆ, å®é™…: ${duration}ms", duration < 2000)
    }

    // ========== é›†æˆæµ‹è¯• ==========

    @Test
    fun `maskHybrid combines mapping and pattern detection`() {
        val customMapping = mapOf("secret" to "[ç§˜å¯†_1]")
        val text = "æˆ‘çš„ç”µè¯13000000000å’Œå¯†ç secret"
        val result = PrivacyEngine.maskHybrid(
            text,
            customMappings = customMapping,
            useAutoDetection = true
        )
        assertTrue(result.contains("[æ‰‹æœºå·_1]"))
        assertTrue(result.contains("[ç§˜å¯†_1]"))
    }
}
```

#### Presentationå±‚æµ‹è¯• (9% â†’ 30%)

**é‡ç‚¹: ViewModelæµ‹è¯•**

```kotlin
// presentation/src/test/kotlin/com/empathy/ai/presentation/viewmodel/ContactDetailViewModelTest.kt

class ContactDetailViewModelTest {

    private lateinit var viewModel: ContactDetailViewModel
    private val getContactUseCase: GetContactUseCase = mockk()
    private val updateContactUseCase: UpdateContactUseCase = mockk()
    private val deleteContactUseCase: DeleteContactUseCase = mockk()

    @Before
    fun setup() {
        viewModel = ContactDetailViewModel(
            getContactUseCase,
            updateContactUseCase,
            deleteContactUseCase
        )
    }

    @Test
    fun `loadContact updates uiState to Loading then Success`() = runTest {
        // Given
        val contact = mockContact(id = "1", name = "å¼ ä¸‰")
        coEvery { getContactUseCase("1") } returns Result.success(contact)

        // When
        viewModel.loadContact("1")

        // Then
        assertEquals(
            ContactDetailUiState.Loading,
            viewModel.uiState.value
        )

        advanceUntilIdle()

        assertEquals(
            ContactDetailUiState.Success(contact),
            viewModel.uiState.value
        )
    }

    @Test
    fun `loadContact handles error correctly`() = runTest {
        // Given
        val error = Exception("Contact not found")
        coEvery { getContactUseCase("1") } returns Result.failure(error)

        // When
        viewModel.loadContact("1")
        advanceUntilIdle()

        // Then
        assertTrue(
            viewModel.uiState.value is ContactDetailUiState.Error
        )
    }

    @Test
    fun `deleteContact deletes and returns success`() = runTest {
        // Given
        coEvery { deleteContactUseCase("1") } returns Result.success(Unit)

        // When
        viewModel.deleteContact("1")
        advanceUntilIdle()

        // Then
        coVerify { deleteContactUseCase("1") }
    }
}
```

---

## ğŸ“… ç¬¬6ç« : å®æ–½è®¡åˆ’

### 6.1 ä¼˜å…ˆçº§çŸ©é˜µ

| æ”¹è¿›é¡¹ | å½±å“èŒƒå›´ | å®æ–½éš¾åº¦ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | å›¢é˜Ÿé…ç½® |
|--------|----------|----------|--------|--------|----------|
| **APIå¯†é’¥æ—¥å¿—ä¿®å¤** | å®‰å…¨ | ä½ | **P0** | 2äººå¤© | åç«¯å·¥ç¨‹å¸ˆ |
| **UseCaseé‡æ„** | å¯ç»´æŠ¤æ€§ | é«˜ | **P0** | 15äººå¤© | æ¶æ„å¸ˆ+åç«¯ |
| **PrivacyEngineæµ‹è¯•** | ç¨³å®šæ€§ | ä¸­ | **P0** | 5äººå¤© | æµ‹è¯•å·¥ç¨‹å¸ˆ |
| **æ‚¬æµ®çª—æœåŠ¡æµ‹è¯•** | ç¨³å®šæ€§ | ä¸­ | **P0** | 5äººå¤© | Androidå·¥ç¨‹å¸ˆ |
| **æ•°æ®åº“åˆ†é¡µ** | æ€§èƒ½ | ä¸­ | **P1** | 8äººå¤© | Androidå·¥ç¨‹å¸ˆ |
| **UIç»„ä»¶æ‹†åˆ†** | æ€§èƒ½ | ä¸­ | **P1** | 10äººå¤© | å‰ç«¯å·¥ç¨‹å¸ˆ |
| **æµ‹è¯•è¦†ç›–æå‡** | è´¨é‡ | é«˜ | **P1** | 20äººå¤© | æµ‹è¯•å·¥ç¨‹å¸ˆ |
| **ä»£ç é‡å¤æ¶ˆé™¤** | å¯ç»´æŠ¤æ€§ | ä½ | **P2** | 5äººå¤© | åç«¯å·¥ç¨‹å¸ˆ |

### 6.2 ä¸‰é˜¶æ®µå®æ–½è®¡åˆ’

#### ç¬¬ä¸€é˜¶æ®µ (2å‘¨) - ç´§æ€¥å®‰å…¨ä¸ç¨³å®šæ€§ä¿®å¤

**ç›®æ ‡**: æ¶ˆé™¤å®‰å…¨é£é™©å’Œç¨³å®šæ€§éšæ‚£

| ä»»åŠ¡ | è´Ÿè´£äºº | å·¥ä½œé‡ | é‡Œç¨‹ç¢‘ | éªŒæ”¶æ ‡å‡† |
|------|--------|--------|--------|----------|
| APIå¯†é’¥å®‰å…¨æ—¥å¿—å·¥å…· | åç«¯å·¥ç¨‹å¸ˆ | 2äººå¤© | Day 3 | âœ… æ‰€æœ‰å¯†é’¥æ—¥å¿—éƒ½ç»è¿‡æ©ç <br>âœ… ç”Ÿäº§ç¯å¢ƒä¸è¾“å‡ºDEBUGæ—¥å¿— |
| PrivacyEngineå®Œæ•´æµ‹è¯• | æµ‹è¯•å·¥ç¨‹å¸ˆ | 5äººå¤© | Day 7 | âœ… æµ‹è¯•è¦†ç›–>80%<br>âœ… åŒ…å«è¾¹ç•Œå’Œæ€§èƒ½æµ‹è¯• |
| AnalyzeChatUseCaseé‡æ„ | æ¶æ„å¸ˆ+åç«¯ | 8äººå¤© | Day 10 | âœ… æ‹†åˆ†ä¸º4ä¸ªç±»<br>âœ… æ¯ä¸ªç±»<150è¡Œ |
| æ‚¬æµ®çª—æœåŠ¡åŸºç¡€æµ‹è¯• | Androidå·¥ç¨‹å¸ˆ | 5äººå¤© | Day 14 | âœ… æƒé™æµ‹è¯•<br>âœ… ç”Ÿå‘½å‘¨æœŸæµ‹è¯• |

**äº¤ä»˜ç‰©**:
- âœ… SecureLoggerå·¥å…·ç±»
- âœ… PrivacyEngineå®Œæ•´æµ‹è¯•å¥—ä»¶ (>80%è¦†ç›–)
- âœ… AnalyzeChatUseCaseæ‹†åˆ†ä¸º4ä¸ªç±» (åè°ƒå™¨+æ ¸å¿ƒåˆ†æå™¨+ä¿å­˜å™¨+æ›´æ–°å™¨)
- âœ… FloatingWindowServiceåŸºç¡€æµ‹è¯•å¥—ä»¶

#### ç¬¬äºŒé˜¶æ®µ (4å‘¨) - æ€§èƒ½ä¸æµ‹è¯•è¦†ç›–æå‡

**ç›®æ ‡**: æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•è¦†ç›–ç‡æå‡è‡³50%

| ä»»åŠ¡ | è´Ÿè´£äºº | å·¥ä½œé‡ | é‡Œç¨‹ç¢‘ | éªŒæ”¶æ ‡å‡† |
|------|--------|--------|--------|----------|
| æ•°æ®åº“åˆ†é¡µå®ç° | Androidå·¥ç¨‹å¸ˆ | 8äººå¤© | Week 2 Day 3 | âœ… è”ç³»äººåˆ—è¡¨ä½¿ç”¨Paging 3.0<br>âœ… 1000+æ•°æ®æµç•…æ»šåŠ¨ |
| UIç»„ä»¶æ‹†åˆ† | å‰ç«¯å·¥ç¨‹å¸ˆ | 10äººå¤© | Week 3 Day 1 | âœ… æ‰€æœ‰ç»„ä»¶<300è¡Œ<br>âœ… ViewModel<500è¡Œ |
| Domainå±‚æµ‹è¯•æå‡ | æµ‹è¯•å·¥ç¨‹å¸ˆ | 8äººå¤© | Week 3 Day 5 | âœ… Domainæµ‹è¯•è¦†ç›–>50%<br>âœ… æ‰€æœ‰UseCaseæœ‰æµ‹è¯• |
| Presentationå±‚æµ‹è¯•æå‡ | æµ‹è¯•å·¥ç¨‹å¸ˆ | 8äººå¤© | Week 4 Day 3 | âœ… Presentationæµ‹è¯•è¦†ç›–>30%<br>âœ… ä¸»è¦ViewModelæœ‰æµ‹è¯• |
| Dataå±‚æµ‹è¯•æå‡ | åç«¯å·¥ç¨‹å¸ˆ | 6äººå¤© | Week 4 Day 5 | âœ… Dataæµ‹è¯•è¦†ç›–>60%<br>âœ… æ‰€æœ‰Repositoryæœ‰æµ‹è¯• |

**äº¤ä»˜ç‰©**:
- âœ… æ‰€æœ‰åˆ—è¡¨ä½¿ç”¨Paging 3.0
- âœ… UIç»„ä»¶<300è¡Œ/æ–‡ä»¶
- âœ… Domainæµ‹è¯•è¦†ç›–>50%
- âœ… Presentationæµ‹è¯•è¦†ç›–>30%
- âœ… Dataæµ‹è¯•è¦†ç›–>60%

#### ç¬¬ä¸‰é˜¶æ®µ (2å‘¨) - ä»£ç è´¨é‡ä¼˜åŒ–

**ç›®æ ‡**: æ¶ˆé™¤ä»£ç é‡å¤,æå‡å¯ç»´æŠ¤æ€§

| ä»»åŠ¡ | è´Ÿè´£äºº | å·¥ä½œé‡ | é‡Œç¨‹ç¢‘ | éªŒæ”¶æ ‡å‡† |
|------|--------|--------|--------|----------|
| Repositoryè½¬æ¢ä»£ç æŠ½è±¡ | åç«¯å·¥ç¨‹å¸ˆ | 3äººå¤© | Week 1 Day 3 | âœ… åˆ›å»ºé€šç”¨æ‰©å±•å‡½æ•°<br>âœ… 13ä¸ªRepositoryä½¿ç”¨ |
| ResultåŒ…è£…å™¨ç»Ÿä¸€ | åç«¯å·¥ç¨‹å¸ˆ | 2äººå¤© | Week 1 Day 5 | âœ… åˆ›å»ºwrapResultå‡½æ•°<br>âœ… 30+å¤„ä½¿ç”¨ |
| æ¨¡å—ä¾èµ–é…ç½®ä¿®æ­£ | æ¶æ„å¸ˆ | 1äººå¤© | Week 2 Day 1 | âœ… apiæ”¹ä¸ºimplementation<br>âœ… éªŒè¯ç¼–è¯‘æ—¶é—´å‡å°‘ |
| å‘½åè§„èŒƒç»Ÿä¸€ | å…¨å‘˜ | 2äººå¤© | Week 2 Day 3 | âœ… æ¸…ç†ä¸è§„èŒƒçš„å‘½å<br>âœ… æ›´æ–°æ–‡æ¡£ |

**äº¤ä»˜ç‰©**:
- âœ… é€šç”¨Repositoryæ‰©å±•å‡½æ•° (mapListToDomain)
- âœ… ç»Ÿä¸€ResultåŒ…è£…å·¥å…· (wrapResult/wrapSuspendResult)
- âœ… æ‰€æœ‰æ¨¡å—ä½¿ç”¨implementationä¾èµ–domain
- âœ… å‘½åè§„èŒƒæ–‡æ¡£æ›´æ–°

### 6.3 å·¥ä½œé‡æ€»è®¡

| é˜¶æ®µ | å·¥ä½œé‡ | å›¢é˜Ÿé…ç½® | å·¥æœŸ |
|------|--------|----------|------|
| **P0é˜¶æ®µ** | 27äººå¤© | 3äººå¹¶è¡Œ (æ¶æ„å¸ˆ+åç«¯+æµ‹è¯•) | **2å‘¨** |
| **P1é˜¶æ®µ** | 40äººå¤© | 3äººå¹¶è¡Œ (Android+å‰ç«¯+æµ‹è¯•) | **4å‘¨** |
| **P2é˜¶æ®µ** | 8äººå¤© | 2äººå¹¶è¡Œ (åç«¯+æ¶æ„å¸ˆ) | **2å‘¨** |
| **æ€»è®¡** | **75äººå¤©** | **3äººå›¢é˜Ÿ** | **8å‘¨** |

**å›¢é˜Ÿé…ç½®å»ºè®®**:
- **æ¶æ„å¸ˆ**: 1äºº (è´Ÿè´£UseCaseé‡æ„å’Œæ¨¡å—è®¾è®¡)
- **åç«¯å·¥ç¨‹å¸ˆ**: 2äºº (è´Ÿè´£Domainå’ŒDataå±‚)
- **Androidå·¥ç¨‹å¸ˆ**: 2äºº (è´Ÿè´£Presentationå’ŒAppå±‚)
- **å‰ç«¯å·¥ç¨‹å¸ˆ**: 1äºº (è´Ÿè´£UIç»„ä»¶)
- **æµ‹è¯•å·¥ç¨‹å¸ˆ**: 1äºº (è´Ÿè´£æµ‹è¯•ç”¨ä¾‹ç¼–å†™)

**å·¥æœŸä¼°ç®—**:
- **å¹¶è¡Œå¼€å‘**: 3äººå›¢é˜Ÿ â†’ **8å‘¨** (2ä¸ªæœˆ)
- **ä¸²è¡Œå¼€å‘**: 1äººå…¨èŒ â†’ **15å‘¨** (çº¦4ä¸ªæœˆ)

### 6.4 é£é™©è¯„ä¼°ä¸ç¼“è§£æªæ–½

| é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|------|--------|------|----------|
| UseCaseé‡æ„å¼•å…¥æ–°Bug | ä¸­ | é«˜ | å……åˆ†å•å…ƒæµ‹è¯•+åˆ†é˜¶æ®µè¿ç§»+Code Review |
| æµ‹è¯•ç¼–å†™è¿›åº¦æ»å | é«˜ | ä¸­ | æå‰åŸ¹è®­+ä½¿ç”¨æµ‹è¯•ç”Ÿæˆå·¥å…·+å¤–éƒ¨æ”¯æ´ |
| æ€§èƒ½ä¼˜åŒ–æ•ˆæœä¸è¾¾æ ‡ | ä½ | ä¸­ | æ€§èƒ½åŸºå‡†æµ‹è¯•+ç›‘æ§+å¤‡é€‰æ–¹æ¡ˆ |
| èµ„æºå†²çª(äººå‘˜çŸ­ç¼º) | ä¸­ | é«˜ | å¤–éƒ¨æ”¯æ´+è°ƒæ•´ä¼˜å…ˆçº§+å»¶é•¿å·¥æœŸ |
| æŠ€æœ¯å€ºåŠ¡ç§¯ç´¯ | ä¸­ | ä¸­ | æ¯ä¸ªè¿­ä»£åˆ†é…20%æ—¶é—´å¤„ç†æŠ€æœ¯å€ºåŠ¡ |

---

## âœ… ç¬¬7ç« : éªŒæ”¶æ ‡å‡†

### 7.1 ä»£ç è´¨é‡æ ‡å‡†

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | éªŒæ”¶æ–¹æ³• |
|------|------|------|----------|
| **æ¶æ„åˆè§„æ€§** | 100/100 | 100/100 | `grep -r "import android" domain/` â†’ 0ç»“æœ |
| **ä»£ç å¤æ‚åº¦** | éƒ¨åˆ†>500è¡Œ | <500è¡Œ/æ–‡ä»¶ | SonarQubeæ‰«æ |
| **å‡½æ•°å¤æ‚åº¦** | éƒ¨åˆ†>50è¡Œ | <50è¡Œ/å‡½æ•° | SonarQubeæ‰«æ |
| **ä¾èµ–æ•°é‡** | éƒ¨åˆ†>10ä¸ª | <5ä¸ª/ç±» | Code Review |
| **ä»£ç é‡å¤ç‡** | ~10% | <5% | SonarQubeæ£€æµ‹ |

### 7.2 æµ‹è¯•è¦†ç›–ç‡æ ‡å‡†

| æ¨¡å— | å½“å‰ | ç›®æ ‡ | éªŒæ”¶æ–¹æ³• |
|------|------|------|----------|
| **æ€»ä½“è¦†ç›–ç‡** | 33.5% | **50%+** | JaCoCoæŠ¥å‘Š |
| **Domainå±‚** | 18.9% | **50%+** | JaCoCoæŠ¥å‘Š |
| **Dataå±‚** | 29.7% | **60%+** | JaCoCoæŠ¥å‘Š |
| **Presentationå±‚** | 11.0% | **30%+** | JaCoCoæŠ¥å‘Š |
| **æ ¸å¿ƒå®‰å…¨ç»„ä»¶** | 50% | **80%+** | äººå·¥å®¡æŸ¥ |

### 7.3 æ€§èƒ½æ ‡å‡†

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | éªŒæ”¶æ–¹æ³• |
|------|------|------|----------|
| **è”ç³»äººåˆ—è¡¨åŠ è½½** | >2ç§’ (1000æ¡) | **<1ç§’** | Android Profiler |
| **UIæ¸²æŸ“å¸§ç‡** | ~50fps | **>55fps** | GPU Profiler |
| **å†…å­˜å ç”¨** | ~200MB (1000è”ç³»äºº) | **<150MB** | Memory Profiler |
| **APKå¤§å°** | åŸºå‡† | **å¢é•¿<10%** | æ„å»ºäº§ç‰©åˆ†æ |
| **å¯åŠ¨æ—¶é—´** | åŸºå‡† | **å¢é•¿<5%** | å¯åŠ¨æ—¶é—´æµ‹è¯• |

### 7.4 å®‰å…¨æ ‡å‡†

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | éªŒæ”¶æ–¹æ³• |
|------|------|------|----------|
| **APIå¯†é’¥æ˜æ–‡æ—¥å¿—** | å­˜åœ¨é£é™© | **æ— ** | ä»£ç å®¡æŸ¥+æ—¥å¿—åˆ†æ |
| **æ•æ„Ÿæ•°æ®è„±æ•ç‡** | ~90% | **100%** | PrivacyEngineæµ‹è¯• |
| **å·²çŸ¥å®‰å…¨æ¼æ´** | 0 | **0** | ä¾èµ–æ‰«æ+å®‰å…¨å®¡è®¡ |
| **å¯†é’¥å­˜å‚¨åŠ å¯†** | éƒ¨åˆ† | **å®Œæ•´** | EncryptedSharedPreferenceséªŒè¯ |

---

## ğŸ¯ é™„å½•A: å…³é”®æ–‡ä»¶æ¸…å•

å®æ–½æ”¹è¿›è®¡åˆ’æœ€å…³é”®çš„5ä¸ªæ–‡ä»¶:

### 1. AnalyzeChatUseCase.kt
**è·¯å¾„**: `domain/src/main/kotlin/com/empathy/ai/domain/usecase/AnalyzeChatUseCase.kt`
**é—®é¢˜**: 387è¡Œ,12ä¸ªä¾èµ–
**æ”¹è¿›**: æ‹†åˆ†ä¸º4ä¸ªç±» (<150è¡Œ/ç±»)

### 2. PrivacyEngine.kt
**è·¯å¾„**: `domain/src/main/kotlin/com/empathy/ai/domain/service/PrivacyEngine.kt`
**é—®é¢˜**: æµ‹è¯•è¦†ç›–ä»…50%
**æ”¹è¿›**: è¡¥å……å®Œæ•´æµ‹è¯•å¥—ä»¶ (>80%)

### 3. ContactDao.kt
**è·¯å¾„**: `data/src/main/kotlin/com/empathy/ai/data/local/dao/ContactDao.kt`
**é—®é¢˜**: æœªåˆ†é¡µ,å…¨é‡åŠ è½½
**æ”¹è¿›**: æ·»åŠ Paging 3.0æ”¯æŒ

### 4. ContactDetailTabViewModel.kt
**è·¯å¾„**: `presentation/src/main/kotlin/com/empathy/ai/presentation/viewmodel/ContactDetailTabViewModel.kt`
**é—®é¢˜**: 1516è¡Œ,é€»è¾‘è¿‡äºå¤æ‚
**æ”¹è¿›**: æ‹†åˆ†ä¸ºå¤šä¸ªå­ViewModel

### 5. build.gradle.kts (dataå’Œpresentation)
**è·¯å¾„**:
- `data/build.gradle.kts:76`
- `presentation/build.gradle.kts:73`

**é—®é¢˜**: `api(project(":domain"))` ä¸å¿…è¦æš´éœ²
**æ”¹è¿›**: æ”¹ä¸º `implementation(project(":domain"))`

---

## ğŸ“ˆ é™„å½•B: é¢„æœŸæ”¹è¿›æ•ˆæœ

### æ”¹è¿›å‰ vs æ”¹è¿›åå¯¹æ¯”

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ | å¤‡æ³¨ |
|------|--------|--------|------|------|
| **é¡¹ç›®æˆç†Ÿåº¦** | 89.2/100 | 95+/100 | +6.2 | Açº§ â†’ A+çº§ |
| **æ¶æ„åˆè§„æ€§** | 100/100 | 100/100 | ä¿æŒ | Clean Architectureå®Œå…¨åˆè§„ |
| **ä»£ç è´¨é‡** | 85/100 | 95/100 | +10 | UseCaseé‡æ„+ä»£ç é‡å¤æ¶ˆé™¤ |
| **æµ‹è¯•è¦†ç›–ç‡** | 33.5% | 50%+ | +16.5% | é‡ç‚¹æ¨¡å—æå‡æ˜¾è‘— |
| **Domainæµ‹è¯•** | 18.9% | 50%+ | +31.1% | PrivacyEngineå®Œæ•´æµ‹è¯• |
| **Dataæµ‹è¯•** | 29.7% | 60%+ | +30.3% | Repositoryå…¨è¦†ç›– |
| **Presentationæµ‹è¯•** | 11.0% | 30%+ | +19% | ViewModelåŸºç¡€è¦†ç›– |
| **æ€§èƒ½** | 78/100 | 90/100 | +12 | åˆ†é¡µ+ä¼˜åŒ– |
| **å®‰å…¨æ€§** | 88/100 | 95/100 | +7 | APIå¯†é’¥ä¿æŠ¤å¢å¼º |
| **å¯ç»´æŠ¤æ€§** | 88/100 | 95/100 | +7 | ä»£ç ç®€æ´+èŒè´£æ¸…æ™° |

### è¯„åˆ†å˜åŒ–é›·è¾¾å›¾

```
        æ¶æ„åˆè§„æ€§
           100/100
             |
             |
    ä»£ç è´¨é‡  |  å¯ç»´æŠ¤æ€§
    85â†’95    |  88â†’95
       \     |     /
        \    |    /
         \   |   /
          \  |  /
           \ | /
        å®‰å…¨æ€§  æ€§èƒ½
        88â†’95  78â†’90

æ”¹è¿›å: å…¨é¢æå‡åˆ°95+ (A+çº§)
```

---

## ğŸ“š é™„å½•C: æ¨èå·¥å…·ä¸èµ„æº

### æ¨èå·¥å…·

#### ä»£ç è´¨é‡å·¥å…·
- **SonarQube**: ä»£ç è´¨é‡å’Œè¦†ç›–ç‡åˆ†æ
- **Detekt**: Kotlinä»£ç é™æ€åˆ†æ
- **ktlint**: Kotlinä»£ç æ ¼å¼åŒ–

#### æ€§èƒ½åˆ†æå·¥å…·
- **Android Profiler**: CPUã€å†…å­˜ã€ç½‘ç»œåˆ†æ
- **LeakCanary**: å†…å­˜æ³„æ¼æ£€æµ‹
- **Macrobenchmark**: åŸºå‡†æµ‹è¯•

#### æµ‹è¯•å·¥å…·
- **JUnit 4**: å•å…ƒæµ‹è¯•æ¡†æ¶
- **MockK**: Kotlin Mockæ¡†æ¶
- **JaCoCo**: æµ‹è¯•è¦†ç›–ç‡åˆ†æ
- **Robolectric**: Androidå•å…ƒæµ‹è¯•
- **UI Automator**: UIè‡ªåŠ¨åŒ–æµ‹è¯•

#### CI/CDå·¥å…·
- **GitHub Actions**: æŒç»­é›†æˆ
- **Jenkins**: æŒç»­é›†æˆå’Œéƒ¨ç½²
- **Firebase App Distribution**: æµ‹è¯•åˆ†å‘

### æ¨èé˜…è¯»

#### æ¶æ„è®¾è®¡
- **Clean Architecture**: Robert C. Martin
- **Architecture Patterns**: Android Developers
- **Android Architecture Blueprints**: GitHubå®˜æ–¹ç¤ºä¾‹

#### æµ‹è¯•æœ€ä½³å®è·µ
- **Testing Guide**: https://developer.android.com/training/testing
- **JUnit 5 User Guide**: https://junit.org/junit5/docs/current/user-guide/
- **MockK Documentation**: https://mockk.io/

#### æ€§èƒ½ä¼˜åŒ–
- **Android Performance Patterns**: YouTubeç³»åˆ—è§†é¢‘
- **Paging 3.0 Guide**: https://developer.android.com/topic/libraries/architecture/paging
- **Kotlin Coroutines**: https://developer.android.com/kotlin/coroutines

---

## ğŸ“ é™„å½•D: æœ¯è¯­è¡¨

| æœ¯è¯­ | è‹±æ–‡ | è§£é‡Š |
|------|------|------|
| **Clean Architecture** | Clean Architecture | æ•´æ´æ¶æ„,ä¸€ç§åˆ†å±‚æ¶æ„æ¨¡å¼ |
| **MVVM** | Model-View-ViewModel | æ¨¡å‹-è§†å›¾-è§†å›¾æ¨¡å‹æ¶æ„æ¨¡å¼ |
| **Repository** | Repository | ä»“åº“æ¨¡å¼,æ•°æ®è®¿é—®æŠ½è±¡ |
| **UseCase** | Use Case | ç”¨ä¾‹,å°è£…ä¸šåŠ¡é€»è¾‘ |
| **DI** | Dependency Injection | ä¾èµ–æ³¨å…¥ |
| **Hilt** | Hilt | Androidä¾èµ–æ³¨å…¥æ¡†æ¶ |
| **Room** | Room | Androidæ•°æ®åº“ORMæ¡†æ¶ |
| **Paging** | Paging 3.0 | Androidåˆ†é¡µåº“ |
| **Flow** | Flow | Kotlinå¼‚æ­¥æ•°æ®æµ |
| **Result** | Result | Kotlinå‡½æ•°å¼é”™è¯¯å¤„ç†ç±»å‹ |
| **SRP** | Single Responsibility Principle | å•ä¸€èŒè´£åŸåˆ™ |
| **SOLID** | SOLID | é¢å‘å¯¹è±¡è®¾è®¡äº”å¤§åŸåˆ™ |

---

## ğŸ“ é™„å½•E: å›¢é˜ŸåŸ¹è®­å»ºè®®

### å¿…éœ€åŸ¹è®­å†…å®¹

#### 1. Clean ArchitectureåŸ¹è®­
- **æ—¶é•¿**: 4å°æ—¶
- **å†…å®¹**:
  - Clean Architectureæ ¸å¿ƒåŸåˆ™
  - ä¾èµ–å€’ç½®å’Œæ¥å£éš”ç¦»
  - åˆ†å±‚èŒè´£åˆ’åˆ†
  - æœ¬é¡¹ç›®æ¶æ„è®¾è®¡è¯¦è§£

#### 2. æµ‹è¯•æœ€ä½³å®è·µåŸ¹è®­
- **æ—¶é•¿**: 4å°æ—¶
- **å†…å®¹**:
  - å•å…ƒæµ‹è¯•ç¼–å†™è§„èŒƒ
  - MockKä½¿ç”¨æŠ€å·§
  - Given-When-Thenæµ‹è¯•æ¨¡å¼
  - æµ‹è¯•è¦†ç›–ç‡æå‡æ–¹æ³•

#### 3. Kotliné«˜çº§ç‰¹æ€§åŸ¹è®­
- **æ—¶é•¿**: 3å°æ—¶
- **å†…å®¹**:
  - Flowå“åº”å¼ç¼–ç¨‹
  - åç¨‹æœ€ä½³å®è·µ
  - å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼
  - æ‰©å±•å‡½æ•°å’Œå±æ€§

#### 4. æ€§èƒ½ä¼˜åŒ–åŸ¹è®­
- **æ—¶é•¿**: 3å°æ—¶
- **å†…å®¹**:
  - Android Profilerä½¿ç”¨
  - å†…å­˜ä¼˜åŒ–æŠ€å·§
  - Paging 3.0æœ€ä½³å®è·µ
  - æ€§èƒ½æµ‹è¯•æ–¹æ³•

**åŸ¹è®­æ€»è®¡**: 14å°æ—¶ (2ä¸ªå·¥ä½œæ—¥)

---

## ğŸ“ è”ç³»ä¸åé¦ˆ

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-29
**åˆ†ææ–‡ä»¶æ•°**: 722ä¸ªKotlinæ–‡ä»¶
**åˆ†ææ–¹æ³•**: é™æ€ä»£ç åˆ†æ + æµ‹è¯•è´¨é‡è¯„ä¼° + æ¶æ„åˆè§„æ€§éªŒè¯
**æŠ¥å‘Šä½œè€…**: Claude Code
**é¡¹ç›®ç‰ˆæœ¬**: v1.0.0 MVP

---

## ğŸ“„ å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´å†…å®¹ |
|------|------|------|----------|
| v1.0 | 2025-12-29 | Claude Code | åˆå§‹ç‰ˆæœ¬,å®Œæ•´æ·±åº¦åˆ†æ |

---

**ç»“æŸ**
